{
    "version": "https://jsonfeed.org/version/1",
    "title": "木语 • All posts by \"dataset\" tag",
    "description": "Spark!",
    "home_page_url": "https://koen666.github.io",
    "items": [
        {
            "id": "https://koen666.github.io/2025/09/15/%E4%BB%8Edataset%E5%88%B0dataloader/",
            "url": "https://koen666.github.io/2025/09/15/%E4%BB%8Edataset%E5%88%B0dataloader/",
            "title": "从 dataset 到 DataLoader 的过程究竟是什么？",
            "date_published": "2025-09-14T16:00:00.000Z",
            "content_html": "<h2 id=\"dataset-dataloader\"><a class=\"anchor\" href=\"#dataset-dataloader\">#</a> <strong>dataset-&gt;dataloader</strong></h2>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">from</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">utils</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">data </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> Dataset</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> DataLoader</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> Sampler</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">nn </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">as</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">optim </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">as</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> optim</span></span></code></pre>\n<p><strong>解析：</strong></p>\n<ul>\n<li><code>torch</code>：PyTorch 主库，用于张量操作。</li>\n<li><code>Dataset</code>：数据集基类。</li>\n<li><code>DataLoader</code>：批次生成器。</li>\n<li><code>Sampler</code>：索引生成器。</li>\n<li><code>nn</code>：神经网络模块。</li>\n<li><code>optim</code>：优化器。</li>\n</ul>\n<hr>\n<h3 id=\"1-定义-dataset\"><a class=\"anchor\" href=\"#1-定义-dataset\">#</a> <strong>1. 定义 Dataset</strong></h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> MyDataset</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">Dataset</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> __init__</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> data</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> labels</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"color:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">data </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> data       </span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 存储特征列表</span></span>\n<span class=\"line\"><span style=\"color:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">labels </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> labels   </span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 存储标签列表</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> __len__</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">        return</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> len</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">data</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  # 返回样本总数</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> __getitem__</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> index</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">      x </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">data</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">index</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  # 取第 index 个特征</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">      y </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> self</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">labels</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">index</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  # 取第 index 个标签</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">      # 转为 tensor 并指定数据类型</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">        return</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">tensor</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> dtype</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">torch</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">float32</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">tensor</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">y</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> dtype</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">torch</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">long</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<p><strong>详细解析：</strong></p>\n<ol>\n<li>\n<p><code>__init__</code>：初始化 Dataset 对象，存储数据和标签。</p>\n</li>\n<li>\n<p><code>__len__</code>：Dataset 的长度（样本数），DataLoader 内部会用它来计算 batch 数量。</p>\n</li>\n<li>\n<p><code>__getitem__</code>：</p>\n<ul>\n<li>\n<p>接收一个整数 <code>index</code>。</p>\n</li>\n<li>\n<p>从列表中取数据和标签。</p>\n</li>\n<li>\n<p>转为 PyTorch 张量：</p>\n<ul>\n<li><code>x</code> 为 float32，用于计算。</li>\n<li><code>y</code> 为 long，用于分类任务的 CrossEntropyLoss。</li>\n</ul>\n</li>\n<li>\n<p>返回 <code>(x, y)</code> 元组。</p>\n</li>\n</ul>\n</li>\n<li>\n<p><strong>关键点</strong>：Dataset 本身不处理 batch，也不决定顺序，它只知道如何根据索引取单个样本。</p>\n</li>\n</ol>\n<hr>\n<h3 id=\"2-定义-sampler\"><a class=\"anchor\" href=\"#2-定义-sampler\">#</a> <strong>2. 定义 Sampler</strong></h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">class</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\"> ReverseSampler</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">Sampler</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> __init__</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> data_source</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"color:#A65E2B;--shiki-dark:#C99076\">        self</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">data_source </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> data_source  </span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># Dataset 对象</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> __iter__</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">        # 返回索引迭代器：倒序取样</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">        return</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> iter</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#998418;--shiki-dark:#B8A965\">range</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#998418;--shiki-dark:#B8A965\">len</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">data_source</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    def</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> __len__</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">self</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">        return</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> len</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">self</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">data_source</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  # 样本总数</span></span></code></pre>\n<p><strong>详细解析：</strong></p>\n<ol>\n<li>\n<p><code>__iter__</code>：</p>\n<ul>\n<li>\n<p>返回一个迭代器，用于生成索引序列。</p>\n</li>\n<li>\n<p><code>range(len(self.data_source)-1, -1, -1)</code>：</p>\n<ul>\n<li>从最大索引到 0</li>\n</ul>\n</li>\n<li>\n<p>例如数据有 5 个样本，索引顺序为 <code>[4,3,2,1,0]</code></p>\n</li>\n</ul>\n</li>\n<li>\n<p><code>__len__</code>：</p>\n<ul>\n<li>返回 Dataset 长度</li>\n<li>DataLoader 内部可能用它计算 batch 总数或进度条。</li>\n</ul>\n</li>\n<li>\n<p><strong>关键点</strong>：</p>\n<ul>\n<li>Sampler 只负责“索引顺序”，不涉及数据本身。</li>\n<li>可以用它实现顺序、随机或自定义采样策略。</li>\n</ul>\n</li>\n</ol>\n<hr>\n<h3 id=\"3-初始化-dataset-sampler\"><a class=\"anchor\" href=\"#3-初始化-dataset-sampler\">#</a> <strong>3. 初始化 Dataset + Sampler</strong></h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">data </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">4</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">5</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">6</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">7</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">8</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">9</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">10</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">labels </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">dataset </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> MyDataset</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">data</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> labels</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">sampler </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> ReverseSampler</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">dataset</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<ul>\n<li>\n<p>Dataset 保存原始数据。</p>\n</li>\n<li>\n<p>Sampler 定义索引顺序（倒序）。</p>\n</li>\n<li>\n<p>此时数据和索引是分开的：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-text\"><span class=\"line\"><span>Dataset: [ [1,2], [3,4], [5,6], [7,8], [9,10] ]</span></span>\n<span class=\"line\"><span>Sampler: [4,3,2,1,0]</span></span></code></pre>\n</li>\n</ul>\n<hr>\n<h3 id=\"4-定义-dataloader\"><a class=\"anchor\" href=\"#4-定义-dataloader\">#</a> <strong>4. 定义 DataLoader</strong></h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">batch_size </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 2</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">dataloader </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> DataLoader</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">dataset</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> batch_size</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">batch_size</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> sampler</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">sampler</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<p><strong>详细解析：</strong></p>\n<ul>\n<li>\n<p>DataLoader 接收 Dataset 对象。</p>\n</li>\n<li>\n<p><code>batch_size=2</code>：每个 batch 2 个样本。</p>\n</li>\n<li>\n<p><code>sampler=sampler</code>：使用我们自定义的倒序索引。</p>\n</li>\n<li>\n<p><strong>内部流程</strong>：</p>\n<ol>\n<li>DataLoader 调用 <code>sampler.__iter__()</code> → 得到索引迭代器 <code>[4,3,2,1,0]</code></li>\n<li>使用 <code>batch_size=2</code> 将索引分批：</li>\n</ol>\n<ul>\n<li>Batch 0：<code>[4,3]</code></li>\n<li>Batch 1：<code>[2,1]</code></li>\n<li>Batch 2：<code>[0]</code></li>\n</ul>\n<ol start=\"3\">\n<li>\n<p>对每个 batch 调用 <code>dataset.__getitem__</code>，获得 <code>(x, y)</code> 张量。</p>\n</li>\n<li>\n<p>返回 batch 张量。</p>\n<ul>\n<li><code>x_batch.shape = [batch_size, feature_dim]</code></li>\n<li><code>y_batch.shape = [batch_size]</code></li>\n</ul>\n</li>\n</ol>\n</li>\n<li>\n<p>DataLoader 可以多线程加载数据（通过 <code>num_workers</code>），提升效率。</p>\n</li>\n</ul>\n<hr>\n<h3 id=\"5-定义模型和优化器\"><a class=\"anchor\" href=\"#5-定义模型和优化器\">#</a> <strong>5. 定义模型和优化器</strong></h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">model </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Linear</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  # 输入 2 维，输出 2 维（可理解为 2 类 logits）</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">criterion </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> nn</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">CrossEntropyLoss</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  # 分类损失</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">optimizer </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> optim</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">SGD</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">model</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">parameters</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> lr</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0.01</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<ul>\n<li>\n<p><code>nn.Linear(2,2)</code>：</p>\n<ul>\n<li>输入 2 维特征 <code>[x1, x2]</code></li>\n<li>输出 2 类的 logits</li>\n</ul>\n</li>\n<li>\n<p><code>CrossEntropyLoss</code>：</p>\n<ul>\n<li>用于分类任务</li>\n<li>内部会自动做 softmax</li>\n</ul>\n</li>\n<li>\n<p><code>SGD</code>：</p>\n<ul>\n<li>随机梯度下降优化</li>\n<li>更新模型参数</li>\n</ul>\n</li>\n</ul>\n<hr>\n<h3 id=\"6-模拟训练循环\"><a class=\"anchor\" href=\"#6-模拟训练循环\">#</a> <strong>6. 模拟训练循环</strong></h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">for</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> epoch </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">in</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> range</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    for</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> x_batch</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> y_batch </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">in</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> dataloader</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">        # 前向传播</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">        outputs </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> model</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">x_batch</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">   # [batch_size, num_classes]</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">        loss </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> criterion</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">outputs</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> y_batch</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">        # 反向传播</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">        optimizer</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">zero_grad</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">        loss</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">backward</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">        optimizer</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">step</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">        print</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Batch x:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> x_batch</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">        print</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Batch y:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> y_batch</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">        print</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Loss:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> loss</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">item</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<p><strong>详细解析：</strong></p>\n<ol>\n<li>\n<p><code>for x_batch, y_batch in dataloader</code>：</p>\n<ul>\n<li>DataLoader 迭代 batch</li>\n<li>每个 batch 为 <code>(x_batch, y_batch)</code> 张量</li>\n</ul>\n</li>\n<li>\n<p><code>outputs = model(x_batch)</code>：</p>\n<ul>\n<li>前向传播，输出 <code>[batch_size, num_classes]</code> 张量</li>\n</ul>\n</li>\n<li>\n<p><code>loss = criterion(outputs, y_batch)</code>：</p>\n<ul>\n<li>计算 loss</li>\n</ul>\n</li>\n<li>\n<p><code>optimizer.zero_grad()</code>：</p>\n<ul>\n<li>清空梯度，否则梯度会累加</li>\n</ul>\n</li>\n<li>\n<p><code>loss.backward()</code>：</p>\n<ul>\n<li>自动计算梯度</li>\n</ul>\n</li>\n<li>\n<p><code>optimizer.step()</code>：</p>\n<ul>\n<li>更新模型参数</li>\n</ul>\n</li>\n<li>\n<p>打印 batch 信息，观察训练数据流与 loss</p>\n</li>\n</ol>\n<p><strong>示例输出</strong>（倒序 batch）：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-text\"><span class=\"line\"><span>Batch x: tensor([[ 9., 10.],</span></span>\n<span class=\"line\"><span>                 [ 7.,  8.]])</span></span>\n<span class=\"line\"><span>Batch y: tensor([0,1])</span></span>\n<span class=\"line\"><span>Loss: 0.7378</span></span>\n<span class=\"line\"><span>Batch x: tensor([[5.,6.],</span></span>\n<span class=\"line\"><span>                 [3.,4.]])</span></span>\n<span class=\"line\"><span>Batch y: tensor([0,1])</span></span>\n<span class=\"line\"><span>Loss: 0.6923</span></span>\n<span class=\"line\"><span>Batch x: tensor([[1.,2.]])</span></span>\n<span class=\"line\"><span>Batch y: tensor([0])</span></span>\n<span class=\"line\"><span>Loss: 0.6789</span></span></code></pre>\n<hr>\n<h3 id=\"7-数据流可视化\"><a class=\"anchor\" href=\"#7-数据流可视化\">#</a> <strong>7. 数据流可视化</strong></h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-text\"><span class=\"line\"><span>原始数据</span></span>\n<span class=\"line\"><span>data = [[1,2],[3,4],[5,6],[7,8],[9,10]]</span></span>\n<span class=\"line\"><span>labels = [0,1,0,1,0]</span></span>\n<span class=\"line\"><span>      ↓</span></span>\n<span class=\"line\"><span>      ↓</span></span>\n<span class=\"line\"><span>Dataset (MyDataset)</span></span>\n<span class=\"line\"><span>  - __getitem__ 返回单个样本</span></span>\n<span class=\"line\"><span>      ↓</span></span>\n<span class=\"line\"><span>      ↓</span></span>\n<span class=\"line\"><span>Sampler (ReverseSampler)</span></span>\n<span class=\"line\"><span>  - 返回索引序列 [4,3,2,1,0]</span></span>\n<span class=\"line\"><span>      ↓</span></span>\n<span class=\"line\"><span>      ↓</span></span>\n<span class=\"line\"><span>DataLoader (batch_size=2)</span></span>\n<span class=\"line\"><span>     - Batch 0: idx=[4,3] → x=[[9,10],[7,8]], y=[0,1]</span></span>\n<span class=\"line\"><span>     - Batch 1: idx=[2,1] → x=[[5,6],[3,4]], y=[0,1]</span></span>\n<span class=\"line\"><span>     - Batch 2: idx=[0]   → x=[[1,2]], y=[0]</span></span>\n<span class=\"line\"><span>      ↓</span></span>\n<span class=\"line\"><span>      ↓</span></span>\n<span class=\"line\"><span>模型训练</span></span>\n<span class=\"line\"><span>  - 前向传播: y_pred = model(x_batch)</span></span>\n<span class=\"line\"><span>  - 计算 loss</span></span>\n<span class=\"line\"><span>  - 反向传播: loss.backward()</span></span>\n<span class=\"line\"><span>  - 参数更新: optimizer.step()</span></span></code></pre>\n<p><strong>关键点：</strong></p>\n<ol>\n<li>Dataset：管理原始数据和取样方式。</li>\n<li>Sampler：决定索引顺序。</li>\n<li>DataLoader：负责 batch 聚合数据。</li>\n<li>模型训练：接收 batch，计算梯度，更新参数。</li>\n</ol>\n",
            "tags": [
                "dataset",
                "deeplearning",
                "pytorch",
                "dataloader"
            ]
        },
        {
            "id": "https://koen666.github.io/2025/08/09/yolo-dataset/",
            "url": "https://koen666.github.io/2025/08/09/yolo-dataset/",
            "title": "yolo+AnyLabeling实现数据集的自动标注",
            "date_published": "2025-08-09T15:00:00.000Z",
            "content_html": "<h2 id=\"一-环境准备\"><a class=\"anchor\" href=\"#一-环境准备\">#</a> 一、环境准备</h2>\n<p>首先创建一个 conda 虚拟环境，完成 yolo 相关依赖的搭建。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">pip</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> install</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> yolo</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">pip</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> install</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ultralytics</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">pip</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> install</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ncnn</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">pip</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> install</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> onnx</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> #用于格式转换</span></span></code></pre>\n<p>之后创建一个空目录，目录结构如下：</p>\n<p><img loading=\"lazy\" src=\"/images/yolo-dataset/yolotraindir.png\" alt=\"\" /></p>\n<p>准备好需要用来训练的一部分图片（50-100 张左右即可，多点也可以）。将图片分别放到 <code>images/train</code>、<code>images/val</code>、<code>images/test</code> 三个目录中。</p>\n<h2 id=\"二-数据标注\"><a class=\"anchor\" href=\"#二-数据标注\">#</a> 二、数据标注</h2>\n<p>准备好环境之后，新建一个 <code>classes.txt</code> 文件放到 <code>labels/train</code> 文件夹下，按顺序写入你的类别名称。例如我这里训练的模型用于标注电池。</p>\n<p><img loading=\"lazy\" src=\"/images/yolo-dataset/battery.png\" alt=\"\" /></p>\n<p>那你的文件内容就是：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">battery</span></span></code></pre>\n<p>ok，创建完成之后就开始对数据进行正常标注，然后将结果导出到labels/train文件夹下</p>\n<h2 id=\"三-开始训练\"><a class=\"anchor\" href=\"#三-开始训练\">#</a> 三、开始训练</h2>\n<p>首先需要写入一个配置文件<code>xxx.yaml</code>写到yolotrain目录下，内容如下</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">path:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> D:</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">\\y</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">olotrain</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">       # 数据集根目录</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">train:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> images/train</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">      # 训练集相对路径</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">val:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> images/val</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">          # 验证集相对路径</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">test</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> images/test</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">        # 测试集相对路径</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">nc:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">                    # 类别数量</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">names:</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">battery</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">       </span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 类别名称列表</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 高级参数（可选）</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">roboflow:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> &#123;&#125;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">             # 兼容 RoboFlow 数据集</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">download:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> null</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">           # 数据集下载URL</span></span></code></pre>\n<p>在虚拟环境下进入 <code>yolotrain</code> 目录输入指令开始训练：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">yolo</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> detect</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> train</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> data=D:/yolotrain/xxx.yaml</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> model=yolov8s.pt</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> epochs=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">100</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> imgsz=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">640</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> batch=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">16</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> device=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span></span></code></pre>\n<p>若要进行验证把<code>train</code>改成<code>val</code>就行了，然后那个yolo模型我放在我的git仓库里了 <a href=\"https://github.com/koen666/yolo\">yolo模型</a></p>\n<h2 id=\"四-导出onnx\"><a class=\"anchor\" href=\"#四-导出onnx\">#</a> 四、导出onnx</h2>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">yolo</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> export</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> model=D:/yolotrain/best.pt</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> format=onnx</span></span></code></pre>\n<p>训练完后，<a href=\"http://xn--runbest-qw3kp0dtg3g249a7zf2qvoqw8wv0tak73vha.pt\">可以从新得到的run文件夹下的best.pt</a>(这个就是训练的最好的模型)文件挪到外面，在调用上面那个命令生成best.onnx文件</p>\n<p>然后再创建一个xxx.yaml文件写入</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">type</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> yolov8</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">name:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> yolov8s-r20230520</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">display_name:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> koen</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">model_path:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> best.onnx</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">nms_threshold:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0.45</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">confidence_threshold:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0.25</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">classes:</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">  -</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> battery</span></span></code></pre>\n<p>这个 <code>display_name</code> 可以按需修改，这个文件就是你模型的配置文件。</p>\n<h2 id=\"五-使用yaml操作\"><a class=\"anchor\" href=\"#五-使用yaml操作\">#</a> 五、使用yaml操作</h2>\n<p>进入<code>AnyLabeling</code>软件，左侧tab栏有AI选项，点击，选择自定义模型，选择刚刚配置的yaml文件即可</p>\n",
            "tags": [
                "yolo",
                "dataset",
                "AnyLabeling"
            ]
        }
    ]
}