{
    "version": "https://jsonfeed.org/version/1",
    "title": "木语 • All posts by \"ssh\" tag",
    "description": "Spark!",
    "home_page_url": "https://koen666.github.io",
    "items": [
        {
            "id": "https://koen666.github.io/2026/02/02/ssh-l-r/",
            "url": "https://koen666.github.io/2026/02/02/ssh-l-r/",
            "title": "SSH 端口转发详解：彻底搞懂 -L 和 -R 的区别",
            "date_published": "2026-02-01T16:00:00.000Z",
            "content_html": "<p>在日常开发中，我们经常会遇到这样的需求：</p>\n<ol>\n<li><strong>想连线上的数据库</strong>，但服务器为了安全只开放了 SSH 端口，数据库端口被防火墙挡住了。</li>\n<li><strong>在本地开发了一个 Web 应用</strong>，想发给异地的同事或客户体验一下，但没有公网 IP。</li>\n</ol>\n<p>其实，只要你有一台能 SSH 登录的服务器（或者使用像 localhost.run 这样的公共服务），<strong>一条 SSH 命令</strong>就能解决上述所有问题。</p>\n<p>这就是 SSH 的**隧道（Tunneling）**功能。最常用的两个参数是 <code>-L</code> 和 <code>-R</code>，但很多人经常搞混。今天我们就来彻底理清它们。</p>\n<p>记住这句口诀：</p>\n<ul>\n<li><strong><code>-L</code> (Local)</strong>：<strong>把远程的拉回来</strong>（我想访问别人）。</li>\n<li><strong><code>-R</code> (Remote)</strong>：<strong>把本地的推出去</strong>（我想让别人访问我）。</li>\n</ul>\n<hr>\n<h2 id=\"1-ssh-l本地端口转发-local-port-forwarding\"><a class=\"anchor\" href=\"#1-ssh-l本地端口转发-local-port-forwarding\">#</a> 1. SSH -L：本地端口转发 (Local Port Forwarding)</h2>\n<p><strong>场景：</strong> 安全地连接远程服务器上的服务（如 MySQL、Redis）。</p>\n<p>假设你有一台阿里云服务器 <code>1.2.3.4</code>，上面运行着 MySQL（3306 端口），但防火墙只允许 <code>127.0.0.1</code> 访问。你在本地 Mac/Windows 上想用 Navicat 或 DBeaver 图形化管理它。</p>\n<h3 id=\"命令格式\"><a class=\"anchor\" href=\"#命令格式\">#</a> 命令格式</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">ssh</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -L</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&lt;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">本地端</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">口</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&gt;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&lt;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">目标I</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">P</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&gt;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&lt;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">目标端</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">口</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&gt;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&lt;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">用户</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">名</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&gt;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">@</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&lt;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">跳板机I</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">P</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&gt;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">实战示例</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">Bash</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">ssh</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -L</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 3000:localhost:3306</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> root@1.2.3.4</span></span></code></pre>\n<p>流量是如何走的？<br>\n当你执行这条命令后，SSH 客户端会在你本地监听 3000 端口。</p>\n<p>发起请求：你在本地 Navicat 连接 localhost:3000。</p>\n<p>进入隧道：请求被 SSH 客户端捕获，加密后通过 SSH 隧道发送给远程服务器 1.2.3.4。</p>\n<p>解密转发：服务器收到数据，解密后，根据命令中的 localhost:3306，把请求转发给它自己的 3306 端口。</p>\n<p>响应返回：数据库的数据原路返回。</p>\n<p>效果：你访问本地的 3000 端口，就等于在访问远程服务器的 3306 端口。</p>\n<h2 id=\"2-ssh-r远程端口转发-remote-port-forwarding\"><a class=\"anchor\" href=\"#2-ssh-r远程端口转发-remote-port-forwarding\">#</a> 2. SSH -R：远程端口转发 (Remote Port Forwarding)</h2>\n<p>场景： 内网穿透。将本地开发的服务暴露给公网。</p>\n<p>假设你在本地（Mac mini）开发了一个 FastAPI 服务，运行在 8001 端口。现在你需要给在国外的老板演示，或者配合微信小程序调试，需要一个公网 HTTPS 地址。</p>\n<p>命令格式</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">ssh</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -R</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&lt;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">远程端</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">口</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&gt;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&lt;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">本地I</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">P</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&gt;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&lt;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">本地端</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">口</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&gt;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&lt;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">用户</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">名</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&gt;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">@</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&lt;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">远程服务器I</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">P</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&gt;</span></span></code></pre>\n<p>实战示例<br>\n这里以公共服务 localhost.run 为例（如果你有自己的服务器也是同理）：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">ssh</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -R</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 80:localhost:8001</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> nokey@localhost.run</span></span></code></pre>\n<p>流量是如何走的？<br>\n当你执行这条命令后，SSH 服务端会在远程服务器上监听端口（或分配域名）。</p>\n<p>外部访问：老板在浏览器访问远程服务器提供的域名（如 <a href=\"https://xyz.lhr.life\">https://xyz.lhr.life</a>）。</p>\n<p>进入隧道：远程服务器收到请求，发现这是你绑定的隧道，于是把数据包塞进 SSH 连接发给你。</p>\n<p>穿透内网：数据穿过互联网和家里的路由器，到达你的电脑。</p>\n<p>本地转发：你的 SSH 客户端收到数据，转发给你本地的 localhost:8001。</p>\n<p>效果：全世界都能通过那个公网链接，访问你藏在内网里的本地服务。</p>\n",
            "tags": [
                "SSH",
                "端口转发",
                "内网穿透"
            ]
        },
        {
            "id": "https://koen666.github.io/2025/10/10/ssh-agent/",
            "url": "https://koen666.github.io/2025/10/10/ssh-agent/",
            "title": "让 SSH 登录变得“无感”且更安全",
            "date_published": "2025-10-09T16:00:00.000Z",
            "content_html": "<h2 id=\"ssh-agent-的工作原理\"><a class=\"anchor\" href=\"#ssh-agent-的工作原理\">#</a> ssh-agent 的工作原理</h2>\n<p>简化流程：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-text\"><span class=\"line\"><span>[用户] → ssh 命令 → [ssh-agent] → [私钥] → [服务器]</span></span></code></pre>\n<ol>\n<li>用户运行 <code>ssh user@host</code>。</li>\n<li>SSH 客户端向 ssh-agent 请求签名（用私钥解密挑战）。</li>\n<li>ssh-agent 返回签名，完成认证。</li>\n<li>私钥从来不会被写入磁盘或发送到服务器。</li>\n</ol>\n<h2 id=\"ssh-agent-的主要命令\"><a class=\"anchor\" href=\"#ssh-agent-的主要命令\">#</a> ssh-agent 的主要命令</h2>\n<h3 id=\"启动服务\"><a class=\"anchor\" href=\"#启动服务\">#</a> 启动服务</h3>\n<ul>\n<li>Linux/macOS：</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">eval</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#999999;--shiki-dark:#666666\">$(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">ssh-agent</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -s</span><span style=\"color:#999999;--shiki-dark:#666666\">)</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span></code></pre>\n<ul>\n<li>Windows（PowerShell）：</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-powershell\"><span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">Start-Service</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> ssh</span><span style=\"color:#999999;--shiki-dark:#666666\">-</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">agent</span></span></code></pre>\n<h3 id=\"添加私钥\"><a class=\"anchor\" href=\"#添加私钥\">#</a> 添加私钥</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">ssh-add</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ~/.ssh/id_rsa</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">        # Linux/macOS</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">ssh-add</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> C:</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">\\U</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">sers</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">\\2</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">8058</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">\\.</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">ssh</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">\\i</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">d_rsa</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">   # Windows</span></span></code></pre>\n<ul>\n<li>第一次添加会要求输入私钥密码（passphrase）</li>\n<li>添加后 session 内就无需再次输入密码</li>\n</ul>\n<h3 id=\"查看已加载密钥\"><a class=\"anchor\" href=\"#查看已加载密钥\">#</a> 查看已加载密钥</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">ssh-add</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -l</span></span></code></pre>\n<ul>\n<li>显示 agent 中已缓存的公钥指纹</li>\n</ul>\n<h3 id=\"删除密钥\"><a class=\"anchor\" href=\"#删除密钥\">#</a> 删除密钥</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">ssh-add</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -D</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">   # 删除 agent 中的所有密钥</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">ssh-add</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -d</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ~/.ssh/id_rsa</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  # 删除指定密钥</span></span></code></pre>\n<h2 id=\"windows-上-ssh-agent-服务\"><a class=\"anchor\" href=\"#windows-上-ssh-agent-服务\">#</a> Windows 上 ssh-agent 服务</h2>\n<h3 id=\"41-服务特点\"><a class=\"anchor\" href=\"#41-服务特点\">#</a> 4.1 服务特点</h3>\n<ul>\n<li>Windows 上 ssh-agent 是一个 <strong>系统服务（OpenSSH Authentication Agent）</strong></li>\n<li>可以设置为 <strong>自动启动</strong>：</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-powershell\"><span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">Set-Service</span><span style=\"color:#999999;--shiki-dark:#666666\"> -</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Name ssh</span><span style=\"color:#999999;--shiki-dark:#666666\">-</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">agent </span><span style=\"color:#999999;--shiki-dark:#666666\">-</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">StartupType Automatic</span></span></code></pre>\n<ul>\n<li>启动后在后台运行，不用每次手动开启</li>\n</ul>\n<h3 id=\"42-常见命令\"><a class=\"anchor\" href=\"#42-常见命令\">#</a> 4.2 常见命令</h3>\n<ul>\n<li>启动服务：</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-powershell\"><span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">Start-Service</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> ssh</span><span style=\"color:#999999;--shiki-dark:#666666\">-</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">agent</span></span></code></pre>\n<ul>\n<li>查看服务状态：</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-powershell\"><span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">Get-Service</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> ssh</span><span style=\"color:#999999;--shiki-dark:#666666\">-</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">agent</span></span></code></pre>\n<ul>\n<li>添加私钥：</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-powershell\"><span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">ssh</span><span style=\"color:#999999;--shiki-dark:#666666\">-</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">add C:\\Users\\</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">28058</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">\\.ssh\\id_rsa</span></span></code></pre>\n<ul>\n<li>查看已加载密钥：</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-powershell\"><span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">ssh</span><span style=\"color:#999999;--shiki-dark:#666666\">-</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">add </span><span style=\"color:#999999;--shiki-dark:#666666\">-</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">l</span></span></code></pre>\n<h2 id=\"优势\"><a class=\"anchor\" href=\"#优势\">#</a> 优势</h2>\n<ol>\n<li>\n<p><strong>免密码登录</strong></p>\n<ul>\n<li>解锁一次私钥后，整个 session 或服务周期内都无需再输入 passphrase。</li>\n</ul>\n</li>\n<li>\n<p><strong>安全</strong></p>\n<ul>\n<li>私钥只存在内存中，不会被写到磁盘或传输到服务器。</li>\n</ul>\n</li>\n<li>\n<p><strong>支持多密钥</strong></p>\n<ul>\n<li>可以同时缓存多把私钥，适合管理多个服务器或 GitHub、GitLab 等不同账号。</li>\n</ul>\n</li>\n<li>\n<p><strong>与 SSH 配置结合</strong></p>\n<ul>\n<li>配合 <code>~/.ssh/config</code> 可以针对不同 host 自动选择对应私钥。</li>\n</ul>\n</li>\n</ol>\n",
            "tags": [
                "ssh"
            ]
        }
    ]
}