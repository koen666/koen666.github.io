{
    "version": "https://jsonfeed.org/version/1",
    "title": "木语 • All posts by \"code\" category",
    "description": "Spark!",
    "home_page_url": "https://koen666.github.io",
    "items": [
        {
            "id": "https://koen666.github.io/2026/02/02/ssh-l-r/",
            "url": "https://koen666.github.io/2026/02/02/ssh-l-r/",
            "title": "SSH 端口转发详解：彻底搞懂 -L 和 -R 的区别",
            "date_published": "2026-02-01T16:00:00.000Z",
            "content_html": "<p>在日常开发中，我们经常会遇到这样的需求：</p>\n<ol>\n<li>想连接线上数据库，但服务器为了安全只开放了 SSH 端口，数据库端口被防火墙挡住。</li>\n<li>在本地开发了一个 Web 应用，想发给异地同事或客户体验，但没有公网 IP。</li>\n</ol>\n<p>只要你有一台能 SSH 登录的服务器（或使用一些公共隧道服务），用一条 SSH 命令就能解决。</p>\n<p>SSH 端口转发本质上是“隧道”（Tunneling）。最常用的两个参数是 <code>-L</code> 和 <code>-R</code>：</p>\n<ul>\n<li><code>-L</code>（Local）：把远程的服务“拉回本地”（我想访问别人）。</li>\n<li><code>-R</code>（Remote）：把本地的服务“推出远程”（我想让别人访问我）。</li>\n</ul>\n<hr>\n<h2 id=\"1-ssh-l本地端口转发local-port-forwarding\"><a class=\"anchor\" href=\"#1-ssh-l本地端口转发local-port-forwarding\">#</a> 1. SSH -L：本地端口转发（Local Port Forwarding）</h2>\n<p>适用场景：安全地连接远程服务器上的服务（如 MySQL、Redis）。</p>\n<p>假设你有一台服务器 <code>1.2.3.4</code>，上面运行着 MySQL（<code>3306</code> 端口），但防火墙只允许本机 <code>127.0.0.1</code> 访问。你在本地 Windows/macOS 上想用 Navicat 或 DBeaver 管理它。</p>\n<h3 id=\"命令格式\"><a class=\"anchor\" href=\"#命令格式\">#</a> 命令格式</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">ssh</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -L</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&lt;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">本地端</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">口</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&gt;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&lt;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">目标I</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">P</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&gt;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&lt;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">目标端</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">口</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&gt;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&lt;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">用</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">户</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&gt;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">@</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&lt;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">跳板机I</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">P</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&gt;</span></span></code></pre>\n<h3 id=\"实战示例\"><a class=\"anchor\" href=\"#实战示例\">#</a> 实战示例</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">ssh</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -L</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 3307:localhost:3306</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> root@1.2.3.4</span></span></code></pre>\n<p>执行后：</p>\n<ul>\n<li>SSH 客户端会在你本地监听 <code>3307</code>。</li>\n<li>你连接 <code>localhost:3307</code>，请求会通过 SSH 隧道转发到远程的 <code>localhost:3306</code>。</li>\n</ul>\n<h2 id=\"2-ssh-r远程端口转发remote-port-forwarding\"><a class=\"anchor\" href=\"#2-ssh-r远程端口转发remote-port-forwarding\">#</a> 2. SSH -R：远程端口转发（Remote Port Forwarding）</h2>\n<p>适用场景：内网穿透，把本地服务暴露给公网访问。</p>\n<p>假设你在本地开发了一个 FastAPI 服务，监听 <code>8001</code> 端口。现在你需要让外部人员访问（演示/联调）。</p>\n<h3 id=\"命令格式-2\"><a class=\"anchor\" href=\"#命令格式-2\">#</a> 命令格式</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">ssh</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -R</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&lt;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">远程端</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">口</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&gt;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&lt;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">本地I</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">P</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&gt;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&lt;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">本地端</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">口</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&gt;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&lt;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">用</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">户</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&gt;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">@</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&lt;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">远程服务器I</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">P</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&gt;</span></span></code></pre>\n<h3 id=\"实战示例-2\"><a class=\"anchor\" href=\"#实战示例-2\">#</a> 实战示例</h3>\n<p>如果你有自己的服务器 <code>1.2.3.4</code>，可以把远程 <code>8080</code> 映射到本地 <code>8001</code>：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">ssh</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -R</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 8080:localhost:8001</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> root@1.2.3.4</span></span></code></pre>\n<p>执行后，访问远程服务器的 <code>8080</code> 端口，就会被转发到你本机的 <code>8001</code>。</p>\n<hr>\n<h2 id=\"3-小提示\"><a class=\"anchor\" href=\"#3-小提示\">#</a> 3. 小提示</h2>\n<ul>\n<li><code>-L</code> 常用于“我访问远程内网服务”。</li>\n<li><code>-R</code> 常用于“别人访问我本地服务”。</li>\n<li>生产环境下建议配合 <code>~/.ssh/config</code>、最小权限账号、以及必要的防火墙策略使用。</li>\n</ul>\n",
            "tags": [
                "SSH",
                "端口转发",
                "内网穿透"
            ]
        },
        {
            "id": "https://koen666.github.io/2026/02/01/react-native/",
            "url": "https://koen666.github.io/2026/02/01/react-native/",
            "title": "React Native 打包实战：配置 EAS Build 生成 APK",
            "date_published": "2026-01-31T16:00:00.000Z",
            "content_html": "<p>React Native（Expo）开发完成后，如何把代码变成可以在真机上安装的 <code>.apk</code> 文件？本文记录使用 <strong>EAS Build（Expo Application Services）</strong> 进行云端打包的步骤。</p>\n<h2 id=\"1-准备工作\"><a class=\"anchor\" href=\"#1-准备工作\">#</a> 1. 准备工作</h2>\n<p>首先安装 Expo 提供的构建工具 <code>eas-cli</code> 并登录账号。若没有账号，可先注册：<a href=\"https://expo.dev/\">https://expo.dev/</a></p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 全局安装 EAS CLI</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">npm</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> install</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -g</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> eas-cli</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 登录 Expo 账号</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">eas</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> login</span></span></code></pre>\n<h2 id=\"2-项目标识配置appjson\"><a class=\"anchor\" href=\"#2-项目标识配置appjson\">#</a> 2. 项目标识配置（app.json）</h2>\n<p>在打包前，必须确认 App 的名称和唯一包名（Package Name）。打开项目根目录下的 <code>app.json</code> 进行修改：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-json\"><span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">  \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">expo</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">    \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">name</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">中医智能面诊</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">        // App 在手机桌面上显示的名称</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">    \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">slug</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">tcm-face-diagnosis</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // Expo 项目标识（英文）</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">    \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">version</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">1.0.0</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">    \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">android</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">      \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">package</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">com.koen.tcmface</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 【关键】安卓包名，必须唯一</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">      \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">adaptiveIcon</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">{</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">        \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">foregroundImage</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">./assets/adaptive-icon.png</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">        \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">backgroundColor</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">#ffffff</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">      </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">}</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">    \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">ios</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">      \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">bundleIdentifier</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">com.koen.tcmface</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // iOS 包名</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span></code></pre>\n<h2 id=\"3-构建配置easjson\"><a class=\"anchor\" href=\"#3-构建配置easjson\">#</a> 3. 构建配置（eas.json）</h2>\n<p>默认情况下，EAS Build 会生成 <code>.aab</code> 文件（用于上架 Google Play）。如果想直接生成可安装的 <code>.apk</code>，需要调整 <code>eas.json</code>。</p>\n<p>运行初始化命令：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">eas</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> build:configure</span></span></code></pre>\n<p>然后编辑生成的 <code>eas.json</code>，重点是在 <code>preview</code> 配置里设置 <code>buildType: \"apk\"</code>：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-json\"><span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">  \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">cli</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">    \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">version</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">&gt;= 7.0.0</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">  \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">build</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">    \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">development</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">      \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">developmentClient</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> true</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">      \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">distribution</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">internal</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">    \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">preview</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">      \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">android</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">{</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">        \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">buildType</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">apk</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">      </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">}</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">    \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">production</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">      \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">android</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">{</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">        \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">buildType</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">app-bundle</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">      </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">}</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span></code></pre>\n<h2 id=\"4-执行打包\"><a class=\"anchor\" href=\"#4-执行打包\">#</a> 4. 执行打包</h2>\n<p>一切准备就绪后，运行以下命令开始云端构建：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">eas</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> build</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> android</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --profile</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> preview</span></span></code></pre>\n<p>参数说明：</p>\n<ul>\n<li><code>-p android</code>：指定打包 Android 平台</li>\n<li><code>--profile preview</code>：使用 <code>preview</code> 配置（生成 APK）</li>\n</ul>\n<p>构建完成后，终端会给出下载链接（有时也会显示二维码），按提示下载安装即可。</p>\n<h2 id=\"5-可能出现的问题\"><a class=\"anchor\" href=\"#5-可能出现的问题\">#</a> 5. 可能出现的问题</h2>\n<h3 id=\"51-打包后连不上后端服务network-error\"><a class=\"anchor\" href=\"#51-打包后连不上后端服务network-error\">#</a> 5.1 打包后连不上后端服务（Network Error）</h3>\n<p><strong>现象描述</strong></p>\n<p>在开发阶段（使用 Expo Go）时，APP 可以正常连接本地后端（如 <code>http://192.168.x.x:8000</code>）。但是一旦打包成 APK（Release 版本）安装到手机上，所有涉及后端接口的请求全部失败，或者直接抛出 <code>Network Error</code>。</p>\n<p><strong>根本原因</strong></p>\n<p>Android 9（API 28）及以上版本默认的安全策略会限制明文 HTTP（Cleartext Traffic）。</p>\n<ul>\n<li><strong>开发版（Expo Go）</strong>：为了方便调试，可能对部分场景更宽松。</li>\n<li><strong>正式构建（Build）</strong>：出于安全考虑，通常更严格；如果后端是自建且只提供 HTTP（IP 直连），请求可能被系统拦截。</li>\n</ul>\n<p><strong>解决方案</strong></p>\n<p>在 Expo（Managed Workflow）中，不能直接修改 <code>AndroidManifest.xml</code>。可以用 <code>expo-build-properties</code> 插件注入网络配置。</p>\n<p><strong>操作步骤</strong></p>\n<ol>\n<li>安装配置插件（项目根目录执行）：</li>\n</ol>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">npm</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> install</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> expo-build-properties</span></span></code></pre>\n<ol start=\"2\">\n<li>修改 <code>app.json</code></li>\n</ol>\n<p>在 <code>plugins</code> 字段中添加配置，显式开启 <code>usesCleartextTraffic</code>：</p>\n<pre><code>```json\n{\n  \"expo\": {\n    \"plugins\": [\n      [\n        \"expo-build-properties\",\n        {\n          \"android\": {\n            \"usesCleartextTraffic\": true\n          }\n        }\n      ]\n    ]\n  }\n}\n```\n</code></pre>\n<ol start=\"3\">\n<li>\n<p>重新构建</p>\n<p>修改配置后，需要重新构建，配置才会写入原生层：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 如果是本地 prebuild</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">npx</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> expo</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> prebuild</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 或直接走 EAS 构建</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">eas</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> build</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> android</span></span></code></pre>\n</li>\n</ol>\n<blockquote>\n<p>注意：开启 <code>usesCleartextTraffic</code> 虽然能解决连接问题，但生产环境建议为后端配置 SSL 证书，使用 HTTPS 以保证通信安全。</p>\n</blockquote>\n",
            "tags": [
                "python",
                "react-native",
                "expo"
            ]
        },
        {
            "id": "https://koen666.github.io/2026/01/15/udocker/",
            "url": "https://koen666.github.io/2026/01/15/udocker/",
            "title": "让你在没有 root 权限的机器上跑镜像",
            "date_published": "2026-01-14T16:00:00.000Z",
            "content_html": "<h2 id=\"背景为什么我们需要它\"><a class=\"anchor\" href=\"#背景为什么我们需要它\">#</a> 背景：为什么我们需要它？</h2>\n<p>在科研和开发过程中，我们经常遇到这样的难题：</p>\n<ol>\n<li><strong>环境依赖地狱</strong>：代码依赖特定的 CUDA 版本、Ubuntu 版本或一大堆 Python 库，手动配置极易冲突。</li>\n<li><strong>没有 root 权限</strong>：实验室服务器、学校的 HPC 集群通常由管理员统一管理，普通用户账户没有 <code>sudo</code> 权限。</li>\n<li><strong>Docker 无法使用</strong>：标准 Docker 需要守护进程（Daemon）以 root 身份运行，没有权限往往意味着 <code>docker: command not found</code> 或 <code>permission denied</code>。</li>\n</ol>\n<p>虽然 <strong>Podman</strong> 是一个很好的免 root 替代品，但它对 Linux 内核版本有要求（需要 User Namespaces 支持），在某些老旧系统上仍然难以安装。</p>\n<p>这时候，<strong>udocker</strong> 就是一个非常实用的解决方案。</p>\n<h2 id=\"什么是-udocker\"><a class=\"anchor\" href=\"#什么是-udocker\">#</a> 什么是 udocker？</h2>\n<p><code>udocker</code> 是一个专门为在用户空间运行 Docker 容器而设计的工具。</p>\n<ul>\n<li><strong>纯用户空间</strong>：不需要 root 权限，也不需要安装系统级守护进程。</li>\n<li><strong>兼容性强</strong>：本质上是一个 Python 脚本，几乎可以在很多 Linux 发行版（CentOS 6/7、Ubuntu、Fedora 等）上运行。</li>\n<li><strong>原理</strong>：通过 <strong>PRoot</strong>（利用 <code>ptrace</code> 机制）或 <strong>Fakechroot</strong> 等技术，模拟 root 环境与文件系统挂载，让容器“以为”自己运行在特权环境中。</li>\n</ul>\n<p>一句话总结：只要你能运行 Python，就能跑 udocker，进而跑 Docker 镜像。</p>\n<h2 id=\"1-安装-udocker\"><a class=\"anchor\" href=\"#1-安装-udocker\">#</a> 1. 安装 udocker</h2>\n<p>安装过程很简单：下载脚本并初始化。</p>\n<h3 id=\"11-下载-udocker-脚本\"><a class=\"anchor\" href=\"#11-下载-udocker-脚本\">#</a> 1.1 下载 udocker 脚本</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">curl</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -L</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> https://raw.githubusercontent.com/indigo-dc/udocker/master/udocker.py</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> udocker</span></span></code></pre>\n<h3 id=\"12-赋予执行权限\"><a class=\"anchor\" href=\"#12-赋予执行权限\">#</a> 1.2 赋予执行权限</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">chmod</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> +x</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> udocker</span></span></code></pre>\n<h3 id=\"13-移动到你的-bin-目录可选\"><a class=\"anchor\" href=\"#13-移动到你的-bin-目录可选\">#</a> 1.3 移动到你的 bin 目录（可选）</h3>\n<p>前提：<code>~/.local/bin</code> 已在 <code>PATH</code> 中。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">mv</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> udocker</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ~/.local/bin/</span></span></code></pre>\n<h3 id=\"14-初始化\"><a class=\"anchor\" href=\"#14-初始化\">#</a> 1.4 初始化</h3>\n<p>这会自动下载所需的引擎二进制文件到 <code>~/.udocker</code> 目录。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">udocker</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> install</span></span></code></pre>\n<h3 id=\"15-验证安装\"><a class=\"anchor\" href=\"#15-验证安装\">#</a> 1.5 验证安装</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">udocker</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> version</span></span></code></pre>\n<h2 id=\"2-基本使用像-docker-一样操作\"><a class=\"anchor\" href=\"#2-基本使用像-docker-一样操作\">#</a> 2. 基本使用：像 Docker 一样操作</h2>\n<p>udocker 的命令设计上尽量模仿 Docker，但有一个关键区别：udocker 严格区分“容器创建”和“容器运行”。</p>\n<h3 id=\"21-拉取镜像pull\"><a class=\"anchor\" href=\"#21-拉取镜像pull\">#</a> 2.1 拉取镜像（pull）</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 拉取 PyTorch 镜像</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">udocker</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> pull</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> pytorch/pytorch:1.13.0-cuda11.6-cudnn8-runtime</span></span></code></pre>\n<h3 id=\"22-创建容器create\"><a class=\"anchor\" href=\"#22-创建容器create\">#</a> 2.2 创建容器（create）</h3>\n<p>在 Docker 中，<code>docker run</code> 常同时完成创建和启动；在 udocker 中，更推荐先显式创建容器。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 从镜像创建一个名为 \"my_experiment\" 的容器</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">udocker</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> create</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --name=my_experiment</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> pytorch/pytorch:1.13.0-cuda11.6-cudnn8-runtime</span></span></code></pre>\n<h3 id=\"23-运行容器run\"><a class=\"anchor\" href=\"#23-运行容器run\">#</a> 2.3 运行容器（run）</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 运行容器并进入交互式终端</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># -v 挂载目录：将宿主机当前目录挂载到容器 /workspace</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">udocker</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> run</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -v</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#999999;--shiki-dark:#666666\">$(</span><span style=\"color:#998418;--shiki-dark:#B8A965\">pwd</span><span style=\"color:#999999;--shiki-dark:#666666\">)</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">:/workspace</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> my_experiment</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> /bin/bash</span></span></code></pre>\n<p>进入容器后，你会看到自己是 root（容器内部视角）。你可以 <code>apt-get install</code> 或 <code>pip install</code>，但这些改动只影响容器文件系统，不会影响宿主机。</p>\n<h2 id=\"3-进阶技巧科研场景专用\"><a class=\"anchor\" href=\"#3-进阶技巧科研场景专用\">#</a> 3. 进阶技巧：科研场景专用</h2>\n<h3 id=\"31-启用-gpu-支持nvidia\"><a class=\"anchor\" href=\"#31-启用-gpu-支持nvidia\">#</a> 3.1 启用 GPU 支持（NVIDIA）</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 使用 --nvidia 标志启用 GPU 支持</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">udocker</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> run</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --nvidia</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> my_experiment</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> nvidia-smi</span></span></code></pre>\n<p>注意：udocker 不包含驱动程序，它只是将宿主机的 <code>/dev/nvidia*</code> 设备与相关库映射进容器。请确保宿主机已正确安装显卡驱动。</p>\n<h3 id=\"32-更改运行模式execmode\"><a class=\"anchor\" href=\"#32-更改运行模式execmode\">#</a> 3.2 更改运行模式（execmode）</h3>\n<p>如果遇到 <code>Segmentation fault</code> 或某些程序跑不起来，可以尝试更改执行模式。udocker 提供多种模式（不同版本可用项可能略有差异）。</p>\n<ul>\n<li><strong>P1/P2（PRoot）</strong>：默认模式，兼容性最好，但 I/O 密集任务可能有性能损耗。</li>\n<li><strong>F1/F2/F3（Fakechroot）</strong>：性能更好，但兼容性可能稍差。</li>\n<li><strong>R1（RunC）</strong>：若内核/环境满足条件，性能接近原生 Docker。</li>\n</ul>\n<p>查看当前模式：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">udocker</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> setup</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --execmode</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> my_experiment</span></span></code></pre>\n<p>切换为某个模式（示例：F3）：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">udocker</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> setup</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --execmode=F3</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> my_experiment</span></span></code></pre>\n<h2 id=\"4-常见问题与局限\"><a class=\"anchor\" href=\"#4-常见问题与局限\">#</a> 4. 常见问题与局限</h2>\n<h3 id=\"41-端口映射\"><a class=\"anchor\" href=\"#41-端口映射\">#</a> 4.1 端口映射</h3>\n<p>udocker 默认使用宿主机网络栈（Host Mode），因此通常不能像 Docker 那样使用 <code>-p 8080:80</code> 做 NAT 端口转发。</p>\n<ul>\n<li>如果容器内服务监听 <code>8000</code>，通常就是在宿主机 <code>8000</code> 上监听。</li>\n</ul>\n<h3 id=\"42-安全\"><a class=\"anchor\" href=\"#42-安全\">#</a> 4.2 安全</h3>\n<p>udocker 的目标偏向“可用性”，而不是强隔离。不要在容器里运行不可信/恶意代码，因为它可能影响当前用户可访问的文件（例如你的 <code>HOME</code> 目录）。</p>\n<h3 id=\"43-清理与空间占用\"><a class=\"anchor\" href=\"#43-清理与空间占用\">#</a> 4.3 清理与空间占用</h3>\n<p>容器文件默认存储在 <code>~/.udocker/containers</code> 下，不用的容器/镜像建议定期清理。</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 删除容器</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">udocker</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> rm</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> my_experiment</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 删除镜像（按实际 tag 替换）</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">udocker</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> rmi</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> pytorch/pytorch:xxxx</span></span></code></pre>\n<h2 id=\"总结\"><a class=\"anchor\" href=\"#总结\">#</a> 总结</h2>\n<p>在受限的服务器或 HPC 环境下，udocker 可以在无需 root 权限的前提下运行容器化环境，适合解决“在别人的机器上跑我的环境”这一类问题。</p>\n<p>如果你在集群上装不上 Docker，又想复用 Docker Hub 上现成镜像，可以优先试试 udocker。</p>\n",
            "tags": [
                "docker",
                "images",
                "hpc",
                "tutorial"
            ]
        },
        {
            "id": "https://koen666.github.io/2025/11/28/pipenv/",
            "url": "https://koen666.github.io/2025/11/28/pipenv/",
            "title": "像前端package.json那样管理python依赖 (uv篇)",
            "date_published": "2025-11-27T16:00:00.000Z",
            "content_html": "<blockquote>\n<p><strong>Update 2025:</strong> 时代变了。虽然 Pipenv 曾经是很好的选择，但现在由 Rust 编写的 <code>uv</code> 才是版本答案。它比 pip 快 10-100 倍，且完美支持 <code>pyproject.toml</code> 标准。</p>\n</blockquote>\n<h3 id=\"1-安装-uv-the-new-standard\"><a class=\"anchor\" href=\"#1-安装-uv-the-new-standard\">#</a> 1. 安装 uv (The New Standard)</h3>\n<p>不需要先装 Python，uv甚至可以帮你管理 Python 版本。</p>\n<p><strong>Mac / Linux:</strong></p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">curl</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -LsSf</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">https://astral.sh/uv/install.sh</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">https://astral.sh/uv/install.sh</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">|</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> sh</span></span></code></pre>\n<p><strong>Windows (PowerShell):</strong></p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-powershell\"><span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">powershell </span><span style=\"color:#999999;--shiki-dark:#666666\">-</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">c </span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">irm [https://astral.sh/uv/install.ps1](https://astral.sh/uv/install.ps1) | iex</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span></code></pre>\n<h3 id=\"2-初始化项目-npm-init\"><a class=\"anchor\" href=\"#2-初始化项目-npm-init\">#</a> 2. 初始化项目 (npm init)</h3>\n<p>进入你的项目目录，执行初始化：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">uv</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> init</span></span></code></pre>\n<p>或者创建一个新项目：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">uv</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> init</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> my-project</span></span></code></pre>\n<p>你的目录下会出现两个核心文件，完美对应前端习惯：</p>\n<ul>\n<li><strong><code>pyproject.toml</code></strong> <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>≈</mo></mrow><annotation encoding=\"application/x-tex\">\\approx</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4831em;\"></span><span class=\"mrel\">≈</span></span></span></span>  <code>package.json</code> (定义项目元数据和依赖)</li>\n<li><strong><code>uv.lock</code></strong> <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>≈</mo></mrow><annotation encoding=\"application/x-tex\">\\approx</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4831em;\"></span><span class=\"mrel\">≈</span></span></span></span>  <code>package-lock.json</code> (锁定依赖具体版本)</li>\n</ul>\n<h3 id=\"3-安装依赖-npm-install-xxx\"><a class=\"anchor\" href=\"#3-安装依赖-npm-install-xxx\">#</a> 3. 安装依赖 (npm install xxx)</h3>\n<p>告别 <code>pip install</code>，现在我们用 <code>add</code>。</p>\n<p><strong>安装普通依赖：</strong></p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">uv</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> add</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> requests</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 甚至可以指定版本</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">uv</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> add</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">flask&gt;=2.0</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span></code></pre>\n<p><strong>安装开发依赖 (DevDependencies):</strong></p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">uv</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> add</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --dev</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> pytest</span></span></code></pre>\n<h3 id=\"4-迁移旧项目-requirementstxt\"><a class=\"anchor\" href=\"#4-迁移旧项目-requirementstxt\">#</a> 4. 迁移旧项目 (requirements.txt)</h3>\n<p>如果你有一个老的 <code>requirements.txt</code>，不需要像以前那样用 PowerShell 转码了，<code>uv</code> 对编码支持很好，直接读取并添加到 <code>pyproject.toml</code> 中：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">uv</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> add</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -r</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> requirements.txt</span></span></code></pre>\n<p>执行完这一步，你的旧项目就瞬间完成了“现代化”改造。</p>\n<h3 id=\"5-一键同步环境-npm-install\"><a class=\"anchor\" href=\"#5-一键同步环境-npm-install\">#</a> 5. 一键同步环境 (npm install)</h3>\n<p>当你把代码 clone 下来，或者拉取了队友的代码后，只需要一个命令就能把所有依赖（包括 Python 解释器本身）全部装好：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">uv</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> sync</span></span></code></pre>\n<p>它会自动创建虚拟环境（默认在 <code>.venv</code>），你无需手动配置。</p>\n<h3 id=\"6-运行代码-npm-run-start\"><a class=\"anchor\" href=\"#6-运行代码-npm-run-start\">#</a> 6. 运行代码 (npm run start)</h3>\n<p>不需要手动激活虚拟环境（<code>source venv/bin/activate</code> 已经是过去式了），直接用 <code>uv run</code>：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 运行脚本</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">uv</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> run</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> app.py</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 运行模块</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">uv</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> run</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> python</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -m</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> http.server</span></span></code></pre>\n<p>uv 会自动检测并使用项目环境中的 Python。</p>\n<hr>\n<h3 id=\"总结前端-vs-python-uv版-对照表\"><a class=\"anchor\" href=\"#总结前端-vs-python-uv版-对照表\">#</a> 总结：前端 vs Python (uv版) 对照表</h3>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">前端 (Node/NPM)</th>\n<th style=\"text-align:left\">Python (uv)</th>\n<th style=\"text-align:left\">说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><code>package.json</code></td>\n<td style=\"text-align:left\"><code>pyproject.toml</code></td>\n<td style=\"text-align:left\">项目配置文件</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>package-lock.json</code></td>\n<td style=\"text-align:left\"><code>uv.lock</code></td>\n<td style=\"text-align:left\">版本锁定文件</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>npm init</code></td>\n<td style=\"text-align:left\"><code>uv init</code></td>\n<td style=\"text-align:left\">初始化</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>npm install axios</code></td>\n<td style=\"text-align:left\"><code>uv add requests</code></td>\n<td style=\"text-align:left\">安装依赖</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>npm install</code></td>\n<td style=\"text-align:left\"><code>uv sync</code></td>\n<td style=\"text-align:left\"><strong>一键安装所有依赖</strong></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>npm run start</code></td>\n<td style=\"text-align:left\"><code>uv run app.py</code></td>\n<td style=\"text-align:left\">使用环境运行</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>nvm use 18</code></td>\n<td style=\"text-align:left\"><code>uv python pin 3.12</code></td>\n<td style=\"text-align:left\"><strong>管理语言版本</strong></td>\n</tr>\n</tbody>\n</table>\n",
            "tags": [
                "python",
                "uv",
                "environment"
            ]
        },
        {
            "id": "https://koen666.github.io/2025/10/17/cypher/",
            "url": "https://koen666.github.io/2025/10/17/cypher/",
            "title": "cypher与neo4j",
            "date_published": "2025-10-17T04:00:00.000Z",
            "content_html": "<h2 id=\"一-cypher-是什么\"><a class=\"anchor\" href=\"#一-cypher-是什么\">#</a> 一、Cypher 是什么</h2>\n<p>Cypher 是操作图数据库（Neo4j）的查询语言。</p>\n<p>图数据库里的数据不是表格（像 MySQL 的表），而是“点和线”的结构：</p>\n<ul>\n<li>有很多“点”（比如“人”“病”“药”），这些“点”叫节点（Node）</li>\n<li>点和点之间有“线”连接（比如“人患病”“药治人”），这些“线”叫关系（Relationship）</li>\n</ul>\n<p>Cypher 的作用就是：描述“点和线”的模式，让数据库找到你要的数据。</p>\n<hr />\n<h2 id=\"二-节点node怎么表示\"><a class=\"anchor\" href=\"#二-节点node怎么表示\">#</a> 二、节点（Node）怎么表示</h2>\n<p>节点是图里的“实体”（比如“张三”“感冒”），写法是：</p>\n<p><code>(变量名:标签 &#123;属性&#125;)</code></p>\n<p>拆解每个部分：</p>\n<ul>\n<li><code>()</code>：必须用圆括号把节点包起来</li>\n<li><code>变量名</code>：给节点起个临时名字（比如用 <code>p</code> 代表“人”，<code>d</code> 代表“病”），方便后面引用</li>\n<li><code>:标签</code>：节点的类别（比如 <code>:Person</code> 表示“人”，<code>:Disease</code> 表示“疾病”）。一个节点可以有多个标签（比如 <code>:Person:Patient</code>）</li>\n<li><code>&#123;属性&#125;</code>：描述节点特征的键值对（比如 <code>name: &quot;张三&quot;</code>，<code>age: 30</code>）</li>\n</ul>\n<p>例子：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cypher\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 一个“人”节点：变量 p，标签 Person，属性 name 和 age</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">p</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">Person</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">name</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> \"张三\"</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 30</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 一个“疾病”节点：变量 d，标签 Disease，属性 name</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">d</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">Disease</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">name</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> \"感冒\"</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<p>可以理解为：<code>(p:Person &#123;name: &quot;张三&quot;&#125;)</code> 表示“有个叫 p 的节点，它是 Person，名字叫张三”。</p>\n<hr />\n<h2 id=\"三-关系relationship怎么表示\"><a class=\"anchor\" href=\"#三-关系relationship怎么表示\">#</a> 三、关系（Relationship）怎么表示</h2>\n<p>关系是节点之间的“连接”（比如“张三患感冒”），写法是：</p>\n<p><code>-[变量名:类型 &#123;属性&#125;]-&gt;</code></p>\n<p>拆解每个部分：</p>\n<ul>\n<li><code>-[ ]-</code>：中括号代表“这是一个关系”，横线连接两个节点</li>\n<li><code>-&gt;</code>：箭头表示方向（比如 <code>A-&gt;B</code> 表示 A 到 B 的关系；无方向可以写成 <code>--</code>）</li>\n<li><code>变量名</code>：给关系起个临时名字（比如 <code>r</code>），方便引用</li>\n<li><code>:类型</code>：关系的类别（比如 <code>:患</code> 表示“患病”，<code>:治疗</code> 表示“治疗”）。每个关系只能有一个类型</li>\n<li><code>&#123;属性&#125;</code>：描述关系特征的键值对（比如 <code>时间: &quot;2023-10-01&quot;</code>）</li>\n</ul>\n<p>例子：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cypher\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// “张三患感冒”：p（张三）通过 r（患）指向 d（感冒）</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">p</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">Person</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">name</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> \"张三\"</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#998418;--shiki-dark:#B8A965\">-</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">r</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#59873A;--shiki-dark:#80A665\">患</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">时间</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> \"2023-10-01\"</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#998418;--shiki-dark:#B8A965\">-</span><span style=\"color:#998418;--shiki-dark:#B8A965\">></span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">d</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">Disease</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">name</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> \"感冒\"</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<hr />\n<h2 id=\"四-核心操作查数据match-return\"><a class=\"anchor\" href=\"#四-核心操作查数据match-return\">#</a> 四、核心操作：查数据（MATCH + RETURN）</h2>\n<p>最常用的操作是“找数据”：</p>\n<ul>\n<li>用 <code>MATCH</code> 描述要找的“点和线的模式”</li>\n<li>用 <code>RETURN</code> 返回结果</li>\n</ul>\n<h3 id=\"1-只查节点\"><a class=\"anchor\" href=\"#1-只查节点\">#</a> 1. 只查节点</h3>\n<p>找所有叫“张三”的人：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cypher\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">MATCH</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">p</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">Person</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">name</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> \"张三\"</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">RETURN</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> p</span></span></code></pre>\n<p>找所有年龄大于 30 的人，只返回名字：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cypher\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">MATCH</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">p</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">Person</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">WHERE</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> p</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">age</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 30</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">RETURN</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> p</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">name</span></span></code></pre>\n<h3 id=\"2-查关系节点-关系\"><a class=\"anchor\" href=\"#2-查关系节点-关系\">#</a> 2. 查关系（节点 + 关系）</h3>\n<p>找“感冒”这种病有哪些伴随的症状：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cypher\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">MATCH</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">d</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">Disease</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">name</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> \"感冒\"</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#998418;--shiki-dark:#B8A965\">-</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">r</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#59873A;--shiki-dark:#80A665\">伴随症状</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#998418;--shiki-dark:#B8A965\">-</span><span style=\"color:#998418;--shiki-dark:#B8A965\">></span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">s</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">Symptom</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">RETURN</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> d</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">name</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">r</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">degree</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">s</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">name</span></span></code></pre>\n<h3 id=\"3-查路径多个关系连起来\"><a class=\"anchor\" href=\"#3-查路径多个关系连起来\">#</a> 3. 查路径（多个关系连起来）</h3>\n<p>找“张三患的病有哪些症状”（路径：人 → 患 → 病 → 伴随 → 症状）：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cypher\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">MATCH</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">p</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">Person</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">name</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> \"张三\"</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#998418;--shiki-dark:#B8A965\">-</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">r1</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#59873A;--shiki-dark:#80A665\">患</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#998418;--shiki-dark:#B8A965\">-</span><span style=\"color:#998418;--shiki-dark:#B8A965\">></span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">d</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">Disease</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#998418;--shiki-dark:#B8A965\">-</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">r2</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#59873A;--shiki-dark:#80A665\">伴随</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#998418;--shiki-dark:#B8A965\">-</span><span style=\"color:#998418;--shiki-dark:#B8A965\">></span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">s</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">Symptom</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">RETURN</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> p</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">name</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">d</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">name</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">s</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">name</span></span></code></pre>\n<hr />\n<h2 id=\"五-常用操作增删改\"><a class=\"anchor\" href=\"#五-常用操作增删改\">#</a> 五、常用操作：增删改</h2>\n<h3 id=\"1-创建create\"><a class=\"anchor\" href=\"#1-创建create\">#</a> 1. 创建（CREATE）</h3>\n<p>新增一个叫“李四”的人，年龄 25：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cypher\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">CREATE</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">Person</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">name</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> \"李四\"</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 25</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<p>给“李四”和“感冒”加一个“患”的关系，时间是今天：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cypher\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">MATCH</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">p</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">Person</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">name</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> \"李四\"</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">d</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">Disease</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">name</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> \"感冒\"</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">CREATE</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">p</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#998418;--shiki-dark:#B8A965\">-</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">:</span><span style=\"color:#59873A;--shiki-dark:#80A665\">患</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">时间</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> \"2023-10-02\"</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#998418;--shiki-dark:#B8A965\">-</span><span style=\"color:#998418;--shiki-dark:#B8A965\">></span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">d</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<h3 id=\"2-修改set\"><a class=\"anchor\" href=\"#2-修改set\">#</a> 2. 修改（SET）</h3>\n<p>把“张三”的年龄改为 31，并加上性别“男”：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cypher\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">MATCH</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">p</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">Person</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">name</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> \"张三\"</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">SET</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> p</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">age</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 31</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">p</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">gender</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> =</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> \"男\"</span></span></code></pre>\n<h3 id=\"3-删除delete-detach-delete\"><a class=\"anchor\" href=\"#3-删除delete-detach-delete\">#</a> 3. 删除（DELETE / DETACH DELETE）</h3>\n<p>删除节点前，必须先删除它的所有关系；常用 <code>DETACH DELETE</code> 一次性删除关系和节点：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-cypher\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">MATCH</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">s</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">Symptom</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">name</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> \"发烧\"</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">DETACH</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> DELETE</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> s</span></span></code></pre>\n",
            "tags": [
                "cypher",
                "neo4j",
                "database"
            ]
        },
        {
            "id": "https://koen666.github.io/2025/10/10/ssh-agent/",
            "url": "https://koen666.github.io/2025/10/10/ssh-agent/",
            "title": "让 SSH 登录变得“无感”且更安全",
            "date_published": "2025-10-09T16:00:00.000Z",
            "content_html": "<h2 id=\"ssh-agent-的工作原理\"><a class=\"anchor\" href=\"#ssh-agent-的工作原理\">#</a> ssh-agent 的工作原理</h2>\n<p>简化流程：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-text\"><span class=\"line\"><span>[用户] -> ssh 命令 -> [ssh-agent] -> [私钥] -> [服务器]</span></span></code></pre>\n<ol>\n<li>用户运行 <code>ssh user@host</code>。</li>\n<li>SSH 客户端向 ssh-agent 请求签名（用私钥完成挑战响应）。</li>\n<li>ssh-agent 返回签名，完成认证。</li>\n<li>私钥不会被发送到服务器；通常也不会被明文写入磁盘。</li>\n</ol>\n<h2 id=\"ssh-agent-的主要命令\"><a class=\"anchor\" href=\"#ssh-agent-的主要命令\">#</a> ssh-agent 的主要命令</h2>\n<h3 id=\"启动服务\"><a class=\"anchor\" href=\"#启动服务\">#</a> 启动服务</h3>\n<ul>\n<li>Linux/macOS：</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">eval</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#999999;--shiki-dark:#666666\">$(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">ssh-agent</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -s</span><span style=\"color:#999999;--shiki-dark:#666666\">)</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span></code></pre>\n<ul>\n<li>Windows（PowerShell）：</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-powershell\"><span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">Start-Service</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> ssh</span><span style=\"color:#999999;--shiki-dark:#666666\">-</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">agent</span></span></code></pre>\n<h3 id=\"添加私钥\"><a class=\"anchor\" href=\"#添加私钥\">#</a> 添加私钥</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">ssh-add</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ~/.ssh/id_rsa</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">        # Linux/macOS</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">ssh-add</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> C:</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">\\U</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">sers</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">\\2</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">8058</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">\\.</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">ssh</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">\\i</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">d_rsa</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">   # Windows</span></span></code></pre>\n<ul>\n<li>第一次添加会要求输入私钥密码（passphrase）</li>\n<li>添加后在当前 session 内通常无需再次输入密码</li>\n</ul>\n<h3 id=\"查看已加载密钥\"><a class=\"anchor\" href=\"#查看已加载密钥\">#</a> 查看已加载密钥</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">ssh-add</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -l</span></span></code></pre>\n<ul>\n<li>显示 agent 中已缓存的公钥指纹</li>\n</ul>\n<h3 id=\"删除密钥\"><a class=\"anchor\" href=\"#删除密钥\">#</a> 删除密钥</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">ssh-add</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -D</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">   # 删除 agent 中的所有密钥</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">ssh-add</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -d</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ~/.ssh/id_rsa</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  # 删除指定密钥</span></span></code></pre>\n<h2 id=\"windows-上的-ssh-agent-服务\"><a class=\"anchor\" href=\"#windows-上的-ssh-agent-服务\">#</a> Windows 上的 ssh-agent 服务</h2>\n<h3 id=\"41-服务特点\"><a class=\"anchor\" href=\"#41-服务特点\">#</a> 4.1 服务特点</h3>\n<ul>\n<li>Windows 的 ssh-agent 是一个系统服务（OpenSSH Authentication Agent）。</li>\n<li>可以设置为自动启动。</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-powershell\"><span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">Set-Service</span><span style=\"color:#999999;--shiki-dark:#666666\"> -</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Name ssh</span><span style=\"color:#999999;--shiki-dark:#666666\">-</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">agent </span><span style=\"color:#999999;--shiki-dark:#666666\">-</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">StartupType Automatic</span></span></code></pre>\n<ul>\n<li>启动后在后台运行，不用每次手动开启。</li>\n</ul>\n<h3 id=\"42-常见命令\"><a class=\"anchor\" href=\"#42-常见命令\">#</a> 4.2 常见命令</h3>\n<ul>\n<li>启动服务：</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-powershell\"><span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">Start-Service</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> ssh</span><span style=\"color:#999999;--shiki-dark:#666666\">-</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">agent</span></span></code></pre>\n<ul>\n<li>查看服务状态：</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-powershell\"><span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">Get-Service</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> ssh</span><span style=\"color:#999999;--shiki-dark:#666666\">-</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">agent</span></span></code></pre>\n<ul>\n<li>添加私钥：</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-powershell\"><span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">ssh</span><span style=\"color:#999999;--shiki-dark:#666666\">-</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">add C:\\Users\\</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">28058</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">\\.ssh\\id_rsa</span></span></code></pre>\n<ul>\n<li>查看已加载密钥：</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-powershell\"><span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">ssh</span><span style=\"color:#999999;--shiki-dark:#666666\">-</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">add </span><span style=\"color:#999999;--shiki-dark:#666666\">-</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">l</span></span></code></pre>\n<h2 id=\"优势\"><a class=\"anchor\" href=\"#优势\">#</a> 优势</h2>\n<ol>\n<li>\n<p>免密体验</p>\n<ul>\n<li>解锁一次私钥后，在同一 session 或服务周期内通常无需重复输入 passphrase。</li>\n</ul>\n</li>\n<li>\n<p><strong>安全</strong></p>\n<ul>\n<li>私钥主要在本机使用，常驻内存，不会被传输到服务器。</li>\n</ul>\n</li>\n<li>\n<p>支持多密钥</p>\n<ul>\n<li>可以同时缓存多把私钥，适合管理多个服务器或 GitHub、GitLab 等不同账号。</li>\n</ul>\n</li>\n<li>\n<p>与 SSH 配置结合</p>\n<ul>\n<li>配合 <code>~/.ssh/config</code> 可以针对不同 host 自动选择对应私钥。</li>\n</ul>\n</li>\n</ol>\n",
            "tags": [
                "ssh"
            ]
        },
        {
            "id": "https://koen666.github.io/2025/10/06/screen/",
            "url": "https://koen666.github.io/2025/10/06/screen/",
            "title": "介绍screen，挂起的虚拟终端使用",
            "date_published": "2025-10-05T16:00:00.000Z",
            "content_html": "<h2 id=\"1-screen-是什么\"><a class=\"anchor\" href=\"#1-screen-是什么\">#</a> 1. screen 是什么？</h2>\n<ul>\n<li><code>screen</code> 是一种终端复用器（terminal multiplexer）。</li>\n<li>它可以在一个终端窗口中运行多个“虚拟终端”，并允许你把会话挂到后台继续运行。</li>\n<li>常见用途：\n<ul>\n<li>在远程服务器上运行长时间任务，即使断开 SSH 也能继续执行。</li>\n<li>在一个终端里同时打开多个 shell。</li>\n<li>共享会话（多人操作同一个 session，需要权限）。</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"2-安装\"><a class=\"anchor\" href=\"#2-安装\">#</a> 2. 安装</h2>\n<p>多数 Linux 发行版可以直接安装或已预装。先检查版本：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">screen</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --version</span></span></code></pre>\n<p>如果没有安装：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># Ubuntu / Debian</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">sudo</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> apt</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> install</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> screen</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># CentOS / RHEL</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">sudo</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> yum</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> install</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> screen</span></span></code></pre>\n<h2 id=\"3-基本命令\"><a class=\"anchor\" href=\"#3-基本命令\">#</a> 3. 基本命令</h2>\n<h3 id=\"31-启动一个新-screen-会话\"><a class=\"anchor\" href=\"#31-启动一个新-screen-会话\">#</a> 3.1 启动一个新 screen 会话</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">screen</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -S</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> mysession</span></span></code></pre>\n<ul>\n<li><code>-S mysession</code>：给会话取名字，方便管理。</li>\n<li>执行后你会进入一个新的终端环境，和普通 shell 使用方式一致。</li>\n</ul>\n<h3 id=\"32-在-screen-中操作\"><a class=\"anchor\" href=\"#32-在-screen-中操作\">#</a> 3.2 在 screen 中操作</h3>\n<ul>\n<li>新建窗口：<code>Ctrl+a</code> 然后 <code>c</code></li>\n<li>切换窗口：<code>Ctrl+a</code> 然后 <code>n</code>（下一个）、<code>p</code>（上一个）</li>\n<li>查看窗口列表：<code>Ctrl+a</code> 然后 <code>\"</code></li>\n</ul>\n<h3 id=\"33-暂时离开detach会话\"><a class=\"anchor\" href=\"#33-暂时离开detach会话\">#</a> 3.3 暂时离开（detach）会话</h3>\n<p>在 screen 中按：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-text\"><span class=\"line\"><span>Ctrl+a d</span></span></code></pre>\n<p>会让 screen 会话在后台继续运行，终端回到原来的 shell。</p>\n<h3 id=\"34-恢复attach会话\"><a class=\"anchor\" href=\"#34-恢复attach会话\">#</a> 3.4 恢复（attach）会话</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">screen</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -r</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> mysession</span></span></code></pre>\n<p>如果有多个会话：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">screen</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -ls</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">screen</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -r</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 会话ID</span></span></code></pre>\n<h3 id=\"35-结束会话\"><a class=\"anchor\" href=\"#35-结束会话\">#</a> 3.5 结束会话</h3>\n<p>在 screen 内直接输入：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">exit</span></span></code></pre>\n<p>或在外部执行：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">screen</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -X</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -S</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> mysession</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> quit</span></span></code></pre>\n<h2 id=\"4-高级技巧\"><a class=\"anchor\" href=\"#4-高级技巧\">#</a> 4. 高级技巧</h2>\n<h3 id=\"41-后台运行任务\"><a class=\"anchor\" href=\"#41-后台运行任务\">#</a> 4.1 后台运行任务</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">screen</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -S</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> mytask</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -dm</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> bash</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -c</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">python myscript.py</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span></code></pre>\n<ul>\n<li><code>-dm</code>：创建会话并立即后台运行。</li>\n<li>之后可以用 <code>screen -r mytask</code> 查看进度。</li>\n</ul>\n<h3 id=\"42-日志记录\"><a class=\"anchor\" href=\"#42-日志记录\">#</a> 4.2 日志记录</h3>\n<p>在 screen 中按：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-text\"><span class=\"line\"><span>Ctrl+a H</span></span></code></pre>\n<p>会将当前窗口输出记录到 <code>screenlog.0</code>。</p>\n<h3 id=\"43-共享会话\"><a class=\"anchor\" href=\"#43-共享会话\">#</a> 4.3 共享会话</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">screen</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -x</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> mysession</span></span></code></pre>\n<p>允许多个用户同时连接到同一个会话（需要权限）。</p>\n<h2 id=\"5-总结\"><a class=\"anchor\" href=\"#5-总结\">#</a> 5. 总结</h2>\n<p><code>screen</code> 的核心价值：</p>\n<ul>\n<li>断开重连：网络断了也不会影响任务。</li>\n<li>多窗口管理：在一个终端里管理多个任务。</li>\n<li>后台执行：任务可持续运行，不占用本地终端。</li>\n</ul>\n",
            "tags": [
                "screen",
                "termux"
            ]
        },
        {
            "id": "https://koen666.github.io/2025/09/24/flask/",
            "url": "https://koen666.github.io/2025/09/24/flask/",
            "title": "Flask框架 基本使用教程",
            "date_published": "2025-09-23T16:00:00.000Z",
            "content_html": "<h2 id=\"基础介绍\"><a class=\"anchor\" href=\"#基础介绍\">#</a> 基础介绍</h2>\n<p>Flask 是一个 <strong>轻量级 Python Web 框架</strong>，特点：</p>\n<ul>\n<li>核心简单，灵活可扩展</li>\n<li>内置开发服务器和调试器</li>\n<li>支持 Jinja2 模板、路由管理、请求处理</li>\n</ul>\n<p>安装 Flask：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">pip</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> install</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> flask</span></span></code></pre>\n<p>创建最简单的 Flask 应用：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">from</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> flask </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> Flask</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 创建 Flask 应用实例</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">app </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> Flask</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#998418;--shiki-dark:#B8A965\">__name__</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 定义路由</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">@</span><span style=\"color:#59873A;--shiki-dark:#80A665\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">route</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">def</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> index</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    return</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Hello, Flask!</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 启动应用</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">if</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> __name__</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ==</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">__main__</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">run</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">debug</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">True</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<p>解释：</p>\n<ul>\n<li><code>Flask(__name__)</code>：创建应用实例，<code>__name__</code> 用于确定应用资源路径</li>\n<li><code>@app.route(&quot;/&quot;)</code>：将函数绑定到路由 <code>/</code></li>\n<li><code>app.run(debug=True)</code>：启动调试模式，会自动重载代码</li>\n</ul>\n<hr />\n<h2 id=\"模板jinja2\"><a class=\"anchor\" href=\"#模板jinja2\">#</a> 模板：Jinja2</h2>\n<p>Flask 使用 <strong>Jinja2</strong> 模板引擎。模板能动态渲染 HTML，支持变量、过滤器、条件语句、循环、继承和宏等。</p>\n<hr />\n<h3 id=\"模板继承\"><a class=\"anchor\" href=\"#模板继承\">#</a> 模板继承</h3>\n<p>父模板（base.html）：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-html\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">html</span><span style=\"color:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">head</span><span style=\"color:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    &#x3C;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">title</span><span style=\"color:#999999;--shiki-dark:#666666\">></span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">&#x3C;!--swig￼0--></span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;/</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">title</span><span style=\"color:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;/</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">head</span><span style=\"color:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">body</span><span style=\"color:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    &#x3C;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">header</span><span style=\"color:#999999;--shiki-dark:#666666\">></span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">导航</span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;/</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">header</span><span style=\"color:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    &#x3C;!--swig￼1--></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    &#x3C;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">footer</span><span style=\"color:#999999;--shiki-dark:#666666\">></span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">页脚</span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;/</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">footer</span><span style=\"color:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;/</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">body</span><span style=\"color:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;/</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">html</span><span style=\"color:#999999;--shiki-dark:#666666\">></span></span></code></pre>\n<p>子模板：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-html\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">&#x3C;!--swig￼2--></span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">&#x3C;!--swig￼3--></span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">&#x3C;!--swig￼4--></span></span></code></pre>\n<p>解释：</p>\n<ul>\n<li>`</li>\n</ul>\n",
            "tags": [
                "python",
                "web",
                "flask"
            ]
        },
        {
            "id": "https://koen666.github.io/2025/09/16/vue-router/",
            "url": "https://koen666.github.io/2025/09/16/vue-router/",
            "title": "vue如何使用router",
            "date_published": "2025-09-15T16:00:00.000Z",
            "content_html": "<h1 id=\"1新建项目并初始化-packagejson\"><a class=\"anchor\" href=\"#1新建项目并初始化-packagejson\">#</a> 1）新建项目并初始化 package.json</h1>\n<p>在你想放项目的目录执行：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">mkdir</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> vue-router-demo</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">cd</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> vue-router-demo</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">npm</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> init</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -y</span></span></code></pre>\n<p>说明：</p>\n<ul>\n<li><code>npm init -y</code> 会生成一个基本的 <code>package.json</code>，我们后面会往里面加脚本。</li>\n</ul>\n<hr />\n<h1 id=\"2从你要求的那条开始安装-vue\"><a class=\"anchor\" href=\"#2从你要求的那条开始安装-vue\">#</a> 2）从你要求的那条开始：安装 Vue</h1>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">npm</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> install</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> vue@latest</span></span></code></pre>\n<p>说明：</p>\n<ul>\n<li>这会把最新稳定版 Vue（通常是 Vue 3）装到 <code>node_modules</code> 并加入 <code>package.json</code> 的 <code>dependencies</code>。</li>\n</ul>\n<hr />\n<h1 id=\"3安装开发工具vite与-vue-插件\"><a class=\"anchor\" href=\"#3安装开发工具vite与-vue-插件\">#</a> 3）安装开发工具（Vite）与 Vue 插件</h1>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">npm</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> install</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -D</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> vite</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> @vitejs/plugin-vue</span></span></code></pre>\n<p>说明：</p>\n<ul>\n<li>Vite 是现代前端开发工具：启动快、热模块替换（HMR）体验好；<code>@vitejs/plugin-vue</code> 让 Vite 能处理 <code>.vue</code> 单文件组件（SFC）。</li>\n</ul>\n<hr />\n<h1 id=\"4安装-vue-routervue-3-对应-vue-router4\"><a class=\"anchor\" href=\"#4安装-vue-routervue-3-对应-vue-router4\">#</a> 4）安装 vue-router（Vue 3 对应 vue-router@4）</h1>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">npm</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> install</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> vue-router@4</span></span></code></pre>\n<p>说明：</p>\n<ul>\n<li><code>vue-router@4</code> 与 Vue 3 配套，负责单页应用的路由管理（链接、路由钩子、动态路由等）。</li>\n</ul>\n<hr />\n<h1 id=\"5在-packagejson-添加常用脚本\"><a class=\"anchor\" href=\"#5在-packagejson-添加常用脚本\">#</a> 5）在 <code>package.json</code> 添加常用脚本</h1>\n<p>编辑 <code>package.json</code> 的 <code>scripts</code> 字段，加入：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-json\"><span class=\"line\"><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">scripts</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">  \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">dev</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">vite</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">  \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">build</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">vite build</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">  \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">preview</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">vite preview</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n<p>说明：</p>\n<ul>\n<li><code>npm run dev</code>：本地开发服务器（带 HMR）</li>\n<li><code>npm run build</code>：生产构建（打包）</li>\n<li><code>npm run preview</code>：本地预览打包输出（用于检查构建产物）</li>\n</ul>\n<hr />\n<h1 id=\"6项目目录结构我们要创建这些文件\"><a class=\"anchor\" href=\"#6项目目录结构我们要创建这些文件\">#</a> 6）项目目录结构（我们要创建这些文件）</h1>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-text\"><span class=\"line\"><span>vue-router-demo/</span></span>\n<span class=\"line\"><span>├─ index.html</span></span>\n<span class=\"line\"><span>├─ package.json</span></span>\n<span class=\"line\"><span>├─ vite.config.js</span></span>\n<span class=\"line\"><span>└─ src/</span></span>\n<span class=\"line\"><span>   ├─ main.js</span></span>\n<span class=\"line\"><span>   ├─ App.vue</span></span>\n<span class=\"line\"><span>   ├─ router/</span></span>\n<span class=\"line\"><span>  │  └─ index.js</span></span>\n<span class=\"line\"><span>   └─ views/</span></span>\n<span class=\"line\"><span>      ├─ Home.vue</span></span>\n<span class=\"line\"><span>      ├─ About.vue</span></span>\n<span class=\"line\"><span>      └─ User.vue</span></span></code></pre>\n<p>下面逐个文件给出可复制的完整代码，并解释关键行。</p>\n<hr />\n<h1 id=\"7创建-viteconfigjs\"><a class=\"anchor\" href=\"#7创建-viteconfigjs\">#</a> 7）创建 <code>vite.config.js</code></h1>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-js\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// vite.config.js</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> defineConfig</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">vite</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> vue</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">@vitejs/plugin-vue</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> default</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> defineConfig</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  plugins</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#59873A;--shiki-dark:#80A665\">vue</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<p>说明：</p>\n<ul>\n<li>必须将 <code>@vitejs/plugin-vue</code> 注册为插件，Vite 才能识别 <code>.vue</code>。</li>\n</ul>\n<hr />\n<h1 id=\"8创建-indexhtml\"><a class=\"anchor\" href=\"#8创建-indexhtml\">#</a> 8）创建 <code>index.html</code></h1>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-html\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;!</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">doctype</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> html</span><span style=\"color:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">html</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> lang</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">en</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  &#x3C;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">head</span><span style=\"color:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    &#x3C;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">meta</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> charset</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">utf-8</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\"> /></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    &#x3C;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">meta</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> name</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">viewport</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> content</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">width=device-width, initial-scale=1.0</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\"> /></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    &#x3C;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">title</span><span style=\"color:#999999;--shiki-dark:#666666\">></span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Vue Router Demo</span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;/</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">title</span><span style=\"color:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  &#x3C;/</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">head</span><span style=\"color:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  &#x3C;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">body</span><span style=\"color:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    &#x3C;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">div</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> id</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">app</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">>&#x3C;/</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">div</span><span style=\"color:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    &#x3C;!-- vite 使用 module 脚本入口 --></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    &#x3C;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">script</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> type</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">module</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> src</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/src/main.js</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">>&#x3C;/</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">script</span><span style=\"color:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  &#x3C;/</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">body</span><span style=\"color:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;/</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">html</span><span style=\"color:#999999;--shiki-dark:#666666\">></span></span></code></pre>\n<p>说明：</p>\n<ul>\n<li>Vite 要求在 HTML 中用 <code>type=&quot;module&quot;</code> 引入入口文件（<code>/src/main.js</code>）。</li>\n</ul>\n<hr />\n<h1 id=\"9创建-srcmainjs项目启动文件\"><a class=\"anchor\" href=\"#9创建-srcmainjs项目启动文件\">#</a> 9）创建 <code>src/main.js</code>（项目启动文件）</h1>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-js\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// src/main.js</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> createApp</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">vue</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> App</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">./App.vue</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> router</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">./router</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 会自动找 src/router/index.js</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> app</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> createApp</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">App</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">use</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  // 把路由插件挂载到 Vue 应用</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">mount</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">#app</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<p>解释：</p>\n<ul>\n<li><code>createApp(App)</code>：创建 Vue 应用实例。</li>\n<li><code>app.use(router)</code>：把 vue-router 注册为插件（这样组件内可以使用 <code>&lt;router-link&gt;</code>、<code>&lt;router-view&gt;</code>、<code>useRouter()</code> 等）。</li>\n<li><code>app.mount('#app')</code>：把应用挂到 index.html 的 <code>&lt;div id=&quot;app&quot;&gt;</code>。</li>\n</ul>\n<hr />\n<h1 id=\"10创建路由文件-srcrouterindexjs\"><a class=\"anchor\" href=\"#10创建路由文件-srcrouterindexjs\">#</a> 10）创建路由文件 <code>src/router/index.js</code></h1>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-js\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// src/router/index.js</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> createRouter</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> createWebHistory</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">vue-router</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> Home</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">../views/Home.vue</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> About</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">../views/About.vue</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> User</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">../views/User.vue</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> routes</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> path</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> name</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Home</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> component</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> Home</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  // 懒加载写法（可选）：component: () => import('../views/About.vue')</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> path</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/about</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> name</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">About</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> component</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> About</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  // 动态路由： :id 是参数； props: true 会把 route.params 作为组件 props</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> path</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/user/:id</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> name</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">User</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> component</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> User</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> props</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> true</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> router</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> createRouter</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  history</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> createWebHistory</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 使用 HTML5 history 模式</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  routes</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> default</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> router</span></span></code></pre>\n<p>说明：</p>\n<ul>\n<li><code>createWebHistory()</code>：产生“漂亮的”URL（无 <code>#</code>）。但部署到静态服务器时要确保服务器把所有请求回退到 <code>index.html</code>（否则刷新会 404）。如果你不能配置服务器，改用 <code>createWebHashHistory()</code>，URL 会带 <code>#</code>（例如 <code>/#/about</code>），无需服务器配置。</li>\n</ul>\n<hr />\n<h1 id=\"11创建根组件-srcappvue\"><a class=\"anchor\" href=\"#11创建根组件-srcappvue\">#</a> 11）创建根组件 <code>src/App.vue</code></h1>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-vue\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">&#x3C;!-- src/App.vue --></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">template</span><span style=\"color:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">div</span><span style=\"color:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">nav</span><span style=\"color:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">      </span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">router-link</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> to</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">></span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Home</span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#999999;--shiki-dark:#666666\">/</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">router-link</span><span style=\"color:#999999;--shiki-dark:#666666\">></span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">      </span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">router-link</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> to</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/about</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">></span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">About</span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#999999;--shiki-dark:#666666\">/</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">router-link</span><span style=\"color:#999999;--shiki-dark:#666666\">></span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> |</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">      </span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">router-link</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> :to</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">&#123; name: 'User', params: &#123; id: 123 &#125; &#125;</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">></span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">User 123</span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#999999;--shiki-dark:#666666\">/</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">router-link</span><span style=\"color:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#999999;--shiki-dark:#666666\">/</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">nav</span><span style=\"color:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">hr</span><span style=\"color:#999999;--shiki-dark:#666666\"> /</span><span style=\"color:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    &#x3C;!-- 路由视图：当前路由对应的组件会渲染到这里 --></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">router-view</span><span style=\"color:#999999;--shiki-dark:#666666\"> /</span><span style=\"color:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#999999;--shiki-dark:#666666\">/</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">div</span><span style=\"color:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#999999;--shiki-dark:#666666\">/</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">template</span><span style=\"color:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">style</span><span style=\"color:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">nav</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> padding</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">rem</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router-link-active</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> font-weight</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> bold</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> color</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#999999;--shiki-dark:#666666\"> #</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">42b983</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#999999;--shiki-dark:#666666\">/</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">style</span><span style=\"color:#999999;--shiki-dark:#666666\">></span></span></code></pre>\n<p>说明：</p>\n<ul>\n<li><code>&lt;router-link&gt;</code>：替代 <code>&lt;a&gt;</code> 的路由链接组件，内部处理 push/replace 而不刷新页面。</li>\n<li><code>&lt;router-view&gt;</code>：路由占位符，渲染当前路由对应组件。</li>\n<li><code>.router-link-active</code>：路由激活时默认类名，可以用来高亮当前链接。</li>\n</ul>\n<hr />\n<h1 id=\"12示例视图组件homevue-aboutvue-uservue\"><a class=\"anchor\" href=\"#12示例视图组件homevue-aboutvue-uservue\">#</a> 12）示例视图组件：<code>Home.vue</code>, <code>About.vue</code>, <code>User.vue</code></h1>\n<p><code>src/views/Home.vue</code></p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-vue\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">template</span><span style=\"color:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">div</span><span style=\"color:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">h1</span><span style=\"color:#999999;--shiki-dark:#666666\">></span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Home</span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#999999;--shiki-dark:#666666\">/</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">h1</span><span style=\"color:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">p</span><span style=\"color:#999999;--shiki-dark:#666666\">></span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Welcome to the Vue + Router demo.</span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#999999;--shiki-dark:#666666\">/</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">p</span><span style=\"color:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">button</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> @click</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">goUser42</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">></span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Go to User 42 </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">programmatic</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#999999;--shiki-dark:#666666\">/</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">button</span><span style=\"color:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#999999;--shiki-dark:#666666\">/</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">div</span><span style=\"color:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#999999;--shiki-dark:#666666\">/</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">template</span><span style=\"color:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">script</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> setup</span><span style=\"color:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> useRouter</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">vue-router</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> router</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> useRouter</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> goUser42</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  // programmatic navigation</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">push</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">&#123;</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> name</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">User</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> params</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">&#123;</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> id</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 42</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">&#125;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">&#125;</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#999999;--shiki-dark:#666666\">/</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">script</span><span style=\"color:#999999;--shiki-dark:#666666\">></span></span></code></pre>\n<p><code>src/views/About.vue</code></p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-vue\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">template</span><span style=\"color:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">div</span><span style=\"color:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">h1</span><span style=\"color:#999999;--shiki-dark:#666666\">></span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">About</span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#999999;--shiki-dark:#666666\">/</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">h1</span><span style=\"color:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">p</span><span style=\"color:#999999;--shiki-dark:#666666\">></span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Simple about page.</span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#999999;--shiki-dark:#666666\">/</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">p</span><span style=\"color:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#999999;--shiki-dark:#666666\">/</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">div</span><span style=\"color:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#999999;--shiki-dark:#666666\">/</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">template</span><span style=\"color:#999999;--shiki-dark:#666666\">></span></span></code></pre>\n<p><code>src/views/User.vue</code></p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-vue\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">template</span><span style=\"color:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">div</span><span style=\"color:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">h1</span><span style=\"color:#999999;--shiki-dark:#666666\">></span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">User page</span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#999999;--shiki-dark:#666666\">/</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">h1</span><span style=\"color:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">p</span><span style=\"color:#999999;--shiki-dark:#666666\">></span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">User id: </span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">&#x3C;!--swig￼0--></span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#999999;--shiki-dark:#666666\">/</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">p</span><span style=\"color:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">button</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> @click</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">$router.back()</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">></span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Back</span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#999999;--shiki-dark:#666666\">/</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">button</span><span style=\"color:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#999999;--shiki-dark:#666666\">/</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">div</span><span style=\"color:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#999999;--shiki-dark:#666666\">/</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">template</span><span style=\"color:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">script</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> setup</span><span style=\"color:#999999;--shiki-dark:#666666\">></span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> props</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> defineProps</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  id</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">&#123;</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> type</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">[</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">String</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> Number</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> required</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> true</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">&#x3C;</span><span style=\"color:#999999;--shiki-dark:#666666\">/</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">script</span><span style=\"color:#999999;--shiki-dark:#666666\">></span></span></code></pre>\n<p>说明：</p>\n<ul>\n<li><code>Home.vue</code> 示范“编程式导航”（<code>router.push(&#123;...&#125;)</code>）。</li>\n<li><code>User.vue</code> 使用 <code>props</code> 接收路由参数（因为我们在路由配置里写了 <code>props: true</code>）。这样组件更容易测试、复用，不用在组件内部直接读 <code>$route.params</code>。</li>\n</ul>\n<hr />\n<h1 id=\"13运行开发服务器\"><a class=\"anchor\" href=\"#13运行开发服务器\">#</a> 13）运行开发服务器</h1>\n<p>在项目根运行：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">npm</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> run</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> dev</span></span></code></pre>\n<p>会看到类似：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-text\"><span class=\"line\"><span>  vite vX.X.X  ready in 200ms</span></span>\n<span class=\"line\"><span>  Local: http://localhost:5173/</span></span></code></pre>\n<p>打开浏览器访问 <code>http://localhost:5173</code>（端口以实际启动日志为准）。点击导航链接、试试“Go to User 42”按钮，URL 与页面应同步变化且不会完整刷新。</p>\n<hr />\n<h1 id=\"14打包与预览生产构建\"><a class=\"anchor\" href=\"#14打包与预览生产构建\">#</a> 14）打包与预览（生产构建）</h1>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">npm</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> run</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> build</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">npm</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> run</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> preview</span></span></code></pre>\n<ul>\n<li><code>npm run build</code> 生成静态文件（dist/）。</li>\n<li><code>npm run preview</code> 在本地起一个小服务器预览构建后的页面。</li>\n</ul>\n<p>部署注意：</p>\n<ul>\n<li>\n<p>如果使用 <code>createWebHistory()</code>（无 <code>#</code>），服务器必须配置：当用户请求 <code>/about</code> 时返回 <code>index.html</code>（single page app fallback）。例如 Nginx：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-text\"><span class=\"line\"><span>location / &#123;</span></span>\n<span class=\"line\"><span>  try_files $uri $uri/ /index.html;</span></span>\n<span class=\"line\"><span>&#125;</span></span></code></pre>\n</li>\n<li>\n<p>不想配置服务器可使用 <code>createWebHashHistory()</code>。</p>\n</li>\n</ul>\n<hr />\n<h1 id=\"15常见进阶点\"><a class=\"anchor\" href=\"#15常见进阶点\">#</a> 15）常见进阶点</h1>\n<ol>\n<li>\n<p><strong>懒加载路由（减小首包）</strong></p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-js\"><span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> path</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/about</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> component</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">></span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> import</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">../views/About.vue</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span></code></pre>\n</li>\n</ol>\n<p>这样 <code>About</code> 会被拆成单独 chunk，只有访问时才加载。</p>\n<ol start=\"2\">\n<li>\n<p><strong>路由守卫（路由拦截）</strong></p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-js\"><span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">beforeEach</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">to</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> from</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">></span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">to</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">meta</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">requiresAuth</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> &#x26;&#x26;</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> !</span><span style=\"color:#59873A;--shiki-dark:#80A665\">isLoggedIn</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> return</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">&#123;</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> name</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Home</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n</li>\n</ol>\n<p><code>to.meta</code> 可以在路由配置时设置 <code>meta: &#123; requiresAuth: true &#125;</code>。</p>\n<ol start=\"3\">\n<li><strong>嵌套路由（子路由）</strong></li>\n</ol>\n<ul>\n<li>可用于 Dashboard 布局 + 子页面。</li>\n<li>在父组件里放 <code>&lt;router-view /&gt;</code> 作为子路由的渲染位置。</li>\n</ul>\n<ol start=\"4\">\n<li><strong>命名视图</strong>（多个 <code>&lt;router-view name=&quot;...&quot;&gt;</code>）</li>\n</ol>\n<ul>\n<li>用于布局复杂页面（侧栏 + 主体同时切换不同组件）。</li>\n</ul>\n<ol start=\"5\">\n<li><strong>useRoute / useRouter</strong></li>\n</ol>\n<ul>\n<li><code>const route = useRoute()</code>：读取路由信息（params、query、meta）。</li>\n<li><code>const router = useRouter()</code>：编程式导航（push/replace）。</li>\n</ul>\n<hr />\n",
            "tags": [
                "router",
                "vue"
            ]
        },
        {
            "id": "https://koen666.github.io/2025/09/15/py_collections/",
            "url": "https://koen666.github.io/2025/09/15/py_collections/",
            "title": "collections",
            "date_published": "2025-09-14T16:00:00.000Z",
            "content_html": "<h2 id=\"1-导入方式\"><a class=\"anchor\" href=\"#1-导入方式\">#</a> 1. 导入方式</h2>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> collections</span></span></code></pre>\n<hr>\n<h2 id=\"2-常用数据结构\"><a class=\"anchor\" href=\"#2-常用数据结构\">#</a> 2. 常用数据结构</h2>\n<h3 id=\"1-counter-计数\"><a class=\"anchor\" href=\"#1-counter-计数\">#</a> 1. <code>Counter</code> — 计数</h3>\n<ul>\n<li>功能：统计元素出现的次数。</li>\n<li>类似 <code>dict</code>，但是专门用于计数。</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">from</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> collections </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> Counter</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">lst </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">a</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">b</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">a</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">c</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">b</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">a</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">cnt </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> Counter</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">lst</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">print</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">cnt</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  # Counter({'a': 3, 'b': 2, 'c': 1})</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">print</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">cnt</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">most_common</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  # [('a', 3), ('b', 2)]</span></span></code></pre>\n<hr>\n<h3 id=\"2-defaultdict-带默认值的字典\"><a class=\"anchor\" href=\"#2-defaultdict-带默认值的字典\">#</a> 2. <code>defaultdict</code> — 带默认值的字典</h3>\n<ul>\n<li>功能：访问不存在的 key 不会报错，会返回默认值。</li>\n<li>构造时传入一个函数（如 <code>int</code>、<code>list</code>、<code>set</code>）作为默认值。</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">from</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> collections </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> defaultdict</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">d </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> defaultdict</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#998418;--shiki-dark:#B8A965\">int</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  # 默认值是 0</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">d</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">a</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#999999;--shiki-dark:#666666\"> +=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">print</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">d</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">a</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  # 1</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">print</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">d</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">b</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  # 0</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">d2 </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> defaultdict</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#998418;--shiki-dark:#B8A965\">list</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">d2</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">x</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">append</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">10</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">print</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">d2</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">x</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  # [10]</span></span></code></pre>\n<blockquote>\n<p>在你之前的 <code>mask_outlier</code> 代码里：</p>\n</blockquote>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">index2label </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> collections</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">defaultdict</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#998418;--shiki-dark:#B8A965\">int</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<p>就是用 <code>int</code> 作为默认值 0，统计每个标签出现的次数。</p>\n<hr>\n<h3 id=\"3-ordereddict-有序字典\"><a class=\"anchor\" href=\"#3-ordereddict-有序字典\">#</a> 3. <code>OrderedDict</code> — 有序字典</h3>\n<ul>\n<li>功能：保持 key 的插入顺序。</li>\n<li>Python 3.7+ 的普通 dict 已经默认保持顺序，所以用途不如以前重要，但有些方法如 <code>move_to_end</code> 仍很有用。</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">from</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> collections </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> OrderedDict</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">od </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> OrderedDict</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">od</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">a</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">od</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">b</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 2</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">od</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">c</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 3</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">print</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#998418;--shiki-dark:#B8A965\">list</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">od</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">keys</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  # ['a', 'b', 'c']</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">od</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">move_to_end</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">b</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">print</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#998418;--shiki-dark:#B8A965\">list</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">od</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">keys</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  # ['a', 'c', 'b']</span></span></code></pre>\n<hr>\n<h3 id=\"4-deque-双端队列\"><a class=\"anchor\" href=\"#4-deque-双端队列\">#</a> 4. <code>deque</code> — 双端队列</h3>\n<ul>\n<li>功能：可以高效地从两端插入和删除元素。</li>\n<li>操作复杂度 O(1)，比 list 从左端插入快。</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">from</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> collections </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> deque</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">q </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> deque</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 3</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">q</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">append</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">4</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">      # 右端添加</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">q</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">appendleft</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  # 左端添加</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">print</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">q</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">         # deque([0, 1, 2, 3, 4])</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">q</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">pop</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">          # 右端删除</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">q</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">popleft</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">      # 左端删除</span></span></code></pre>\n<hr>\n<h3 id=\"5-namedtuple-命名元组\"><a class=\"anchor\" href=\"#5-namedtuple-命名元组\">#</a> 5. <code>namedtuple</code> — 命名元组</h3>\n<ul>\n<li>功能：给元组的每个元素命名，既可以像元组一样索引，也可以用属性名访问。</li>\n<li>用于存储轻量对象。</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">from</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> collections </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> namedtuple</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Point </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> namedtuple</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Point</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">x</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">y</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">p </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> Point</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">10</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 20</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">print</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">p</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  # 10</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">print</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">p</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> # 20</span></span></code></pre>\n<hr>\n<h2 id=\"3-小结\"><a class=\"anchor\" href=\"#3-小结\">#</a> 3. 小结</h2>\n<table>\n<thead>\n<tr>\n<th>数据结构</th>\n<th>特点</th>\n<th>典型用途</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Counter</td>\n<td>计数</td>\n<td>元素频率统计</td>\n</tr>\n<tr>\n<td>defaultdict</td>\n<td>key 不存在返回默认值</td>\n<td>聚合统计、累加</td>\n</tr>\n<tr>\n<td>OrderedDict</td>\n<td>保持插入顺序</td>\n<td>需要顺序字典</td>\n</tr>\n<tr>\n<td>deque</td>\n<td>双端队列，高效两端操作</td>\n<td>队列、滑动窗口</td>\n</tr>\n<tr>\n<td>namedtuple</td>\n<td>命名元组，访问像对象又像元组</td>\n<td>简单对象存储</td>\n</tr>\n</tbody>\n</table>\n<hr>\n",
            "tags": [
                "collections"
            ]
        },
        {
            "id": "https://koen666.github.io/2025/09/08/gradio/",
            "url": "https://koen666.github.io/2025/09/08/gradio/",
            "title": "关于模型可视化 Gradio 的使用",
            "date_published": "2025-09-07T16:00:00.000Z",
            "content_html": "<h2 id=\"1-hello-world-入门示例\"><a class=\"anchor\" href=\"#1-hello-world-入门示例\">#</a> 1. Hello World 入门示例</h2>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> gradio </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">as</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> gr</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 定义一个最简单的函数</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">def</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> greet</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">name</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> str</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    return</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> f</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">\"Hello, </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">name</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">!\"</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 使用 Interface 快速构建应用</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">demo </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> gr</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Interface</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    fn</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">greet</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  # 绑定函数</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    inputs</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">gr</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Textbox</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">label</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">请输入名字</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  # 输入组件：单行文本框</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    outputs</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">gr</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Textbox</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">label</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">问候语</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    # 输出组件：单行文本框</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    title</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Gradio Hello World</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">demo</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">launch</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">share</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">True</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  # 启动服务，并生成公网临时链接</span></span></code></pre>\n<h3 id=\"组件解释\"><a class=\"anchor\" href=\"#组件解释\">#</a> 组件解释：</h3>\n<ul>\n<li><strong>Textbox</strong>：输入或输出文本，支持 <code>lines</code> 参数控制多行。</li>\n<li><strong>Interface</strong>：最基础的封装方式，适合单函数输入输出。</li>\n</ul>\n<hr>\n<h2 id=\"2-加载-pytorch-pth-模型并结合-gradio\"><a class=\"anchor\" href=\"#2-加载-pytorch-pth-模型并结合-gradio\">#</a> 2. 加载 PyTorch <code>.pth</code> 模型并结合 Gradio</h2>\n<p>这里我们以 <strong>ResNet18 二分类模型（猫 vs 狗）</strong> 为例：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> torchvision</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">transforms </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">as</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> T</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">from</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> torchvision</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">models </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> resnet18</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">from</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> PIL</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> Image</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> gradio </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">as</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> gr</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 1. 加载模型结构</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">model </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> resnet18</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">pretrained</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">False</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">model</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">fc </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">nn</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Linear</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">model</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">fc</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">in_features</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  # 修改输出层为二分类</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 2. 加载训练好的权重（model.pth）</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">model</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">load_state_dict</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">torch</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">load</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">model.pth</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> map_location</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">cpu</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">model</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">eval</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  # 切换到推理模式</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 3. 定义图像预处理（与训练时一致）</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">transform </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> T</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Compose</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    T</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Resize</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">224</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 224</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  # 缩放图片</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    T</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">ToTensor</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">          # 转为 Tensor</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    T</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Normalize</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">mean</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0.485</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0.456</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0.406</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">                std</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0.229</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0.224</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0.225</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">]</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  # 标准化</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 4. 推理函数</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">def</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> predict</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">img</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> Image</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Image</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    x </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> transform</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">img</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">unsqueeze</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  # 扩展 batch 维度 [1,3,224,224]</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    with</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">no_grad</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">        logits </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> model</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  # 前向传播</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">        probs </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">softmax</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">logits</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> dim</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">squeeze</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">tolist</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  # 转换为概率</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    return</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">cat</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> probs</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">dog</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> probs</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  # 输出字典</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    </span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 5. Gradio 封装</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">demo </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> gr</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Interface</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    fn</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">predict</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    inputs</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">gr</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Image</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">type</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">pil</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> label</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">上传图片</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  # 输入组件：图像</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    outputs</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">gr</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Label</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">num_top_classes</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> label</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">预测结果</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  # 输出组件：标签（带概率条）</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    title</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">猫狗分类</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">demo</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">launch</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<h3 id=\"组件解释-2\"><a class=\"anchor\" href=\"#组件解释-2\">#</a> 组件解释：</h3>\n<ul>\n<li><strong>Image</strong>：支持上传或摄像头输入，<code>type=\"pil\"</code> 表示输出为 PIL Image。</li>\n<li><strong>Label</strong>：显示分类概率，自动渲染柱状图。</li>\n</ul>\n<hr>\n<h2 id=\"3-使用-blocks-构建多步骤界面\"><a class=\"anchor\" href=\"#3-使用-blocks-构建多步骤界面\">#</a> 3. 使用 Blocks 构建多步骤界面</h2>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">with</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> gr</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Blocks</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> as</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> demo</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    with</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> gr</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Row</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  # 横向布局</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">        img </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> gr</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Image</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">type</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">pil</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> label</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">上传图片</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">        btn </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> gr</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Button</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">开始分类</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  # 按钮</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    out </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> gr</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Label</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">num_top_classes</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> label</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">预测结果</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    # 点击按钮时执行预测</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    btn</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">click</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">fn</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">predict</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> inputs</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">img</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> outputs</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">out</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">demo</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">launch</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<h3 id=\"组件解释-3\"><a class=\"anchor\" href=\"#组件解释-3\">#</a> 组件解释：</h3>\n<ul>\n<li><strong>Blocks</strong>：更灵活的 UI 构建方式。</li>\n<li><strong>Row / Column</strong>：布局容器。</li>\n<li><strong>Button</strong>：可绑定点击事件。</li>\n</ul>\n<hr>\n<h2 id=\"4-扩展功能显示-top-k-原图\"><a class=\"anchor\" href=\"#4-扩展功能显示-top-k-原图\">#</a> 4. 扩展功能：显示 Top-K + 原图</h2>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">def</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> predict_with_img</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">img</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> Image</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Image</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    x </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> transform</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">img</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">unsqueeze</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    with</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">no_grad</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">        logits </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> model</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">        probs </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">softmax</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">logits</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> dim</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">squeeze</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    classes </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">cat</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">dog</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    result </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">cls</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> float</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">probs</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">i</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> for</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> i</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> cls</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> enumerate</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">classes</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    return</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> result</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> img  </span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 返回两个结果</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">with</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> gr</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Blocks</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> as</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> demo</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    with</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> gr</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Row</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">        img </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> gr</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Image</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">type</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">pil</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> label</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">上传图片</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">        btn </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> gr</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Button</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">开始分类</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    with</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> gr</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Row</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">        out_probs </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> gr</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Label</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">num_top_classes</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> label</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">预测概率</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">        out_img </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> gr</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Image</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">label</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">原始图片</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    btn</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">click</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">fn</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">predict_with_img</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> inputs</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">img</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> outputs</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">out_probs</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> out_img</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">demo</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">launch</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<h3 id=\"解释\"><a class=\"anchor\" href=\"#解释\">#</a> 解释：</h3>\n<ul>\n<li>Gradio 函数可以返回多个输出，并绑定到多个组件。</li>\n<li><code>Label</code> 用来显示概率条，<code>Image</code> 再显示原图，增强可解释性。</li>\n</ul>\n<hr>\n<h2 id=\"5-常用组件一览\"><a class=\"anchor\" href=\"#5-常用组件一览\">#</a> 5. 常用组件一览</h2>\n<ul>\n<li><strong>Textbox</strong>：输入文本</li>\n<li><strong>Image</strong>：上传或拍照输入图像</li>\n<li><strong>Label</strong>：展示分类结果与概率</li>\n<li><strong>Button</strong>：触发事件</li>\n<li><strong>Chatbot</strong>：用于构建对话界面（常见于 LLM Demo）</li>\n<li><strong>File</strong>：上传或下载文件</li>\n<li><strong>Slider / Dropdown / Checkbox</strong>：用于选择参数</li>\n</ul>\n<hr>\n<h2 id=\"6-队列与并发控制\"><a class=\"anchor\" href=\"#6-队列与并发控制\">#</a> 6. 队列与并发控制</h2>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">demo</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">queue</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">concurrency_count</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">launch</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<ul>\n<li><strong>queue()</strong>：开启请求队列，避免推理时间过长导致前端超时。</li>\n<li><strong>concurrency_count</strong>：同时处理的请求数。</li>\n</ul>\n<hr>\n<h2 id=\"7-自定义样式-鉴权-安全\"><a class=\"anchor\" href=\"#7-自定义样式-鉴权-安全\">#</a> 7. 自定义样式 / 鉴权 / 安全</h2>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">with</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> gr</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Blocks</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">css</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">body {background-color: #f0f8ff;}</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> as</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> demo</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    img </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> gr</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Image</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">type</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">pil</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    out </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> gr</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Label</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    img</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">change</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">predict</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> inputs</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">img</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> outputs</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">out</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">demo</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">launch</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">auth</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">admin</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">1234</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> allowed_paths</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/safe_dir</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<ul>\n<li><strong>css=</strong>：注入自定义 CSS。</li>\n<li><strong>auth=</strong>：开启简单的用户名/密码鉴权。</li>\n<li><strong>allowed_paths=</strong>：限制访问目录，避免文件泄露。</li>\n</ul>\n<hr>\n<h2 id=\"8-最终完整应用整合版\"><a class=\"anchor\" href=\"#8-最终完整应用整合版\">#</a> 8. 最终完整应用（整合版）</h2>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> gradio </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">as</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> gr</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> torchvision</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">transforms </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">as</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> T</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">from</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> torchvision</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">models </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> resnet18</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">from</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> PIL</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> Image</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 模型加载</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">model </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> resnet18</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">pretrained</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">False</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">model</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">fc </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">nn</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Linear</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">model</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">fc</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">in_features</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">model</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">load_state_dict</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">torch</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">load</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">model.pth</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> map_location</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">cpu</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">model</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">eval</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 预处理</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">transform </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> T</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Compose</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    T</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Resize</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">224</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 224</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    T</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">ToTensor</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    T</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Normalize</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">mean</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0.485</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0.456</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0.406</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">                std</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0.229</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0.224</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0.225</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">]</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 推理函数</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">def</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> predict</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">img</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> Image</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Image</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    x </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> transform</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">img</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">unsqueeze</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    with</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">no_grad</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">        logits </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> model</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">        probs </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> torch</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">softmax</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">logits</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> dim</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">squeeze</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    classes </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">cat</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">dog</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    return</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">cls</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> float</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">probs</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">i</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> for</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> i</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> cls</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> in</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> enumerate</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">classes</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 构建应用</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">with</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> gr</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Blocks</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">css</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">body {font-family: Arial; background:#fafafa;}</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> as</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> demo</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    with</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> gr</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Row</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">        img </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> gr</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Image</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">type</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">pil</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> label</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">上传图片</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">        btn </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> gr</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Button</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">开始分类</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    with</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> gr</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Row</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">        out </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> gr</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Label</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">num_top_classes</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> label</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">预测结果</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    btn</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">click</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">predict</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> inputs</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">img</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> outputs</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">out</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 开启队列 + 鉴权</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">demo</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">queue</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">concurrency_count</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">launch</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">auth</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">user</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">pass</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<hr>\n",
            "tags": [
                "python",
                "web",
                "gradio"
            ]
        },
        {
            "id": "https://koen666.github.io/2025/09/03/network/",
            "url": "https://koen666.github.io/2025/09/03/network/",
            "title": "网络核心概念精讲",
            "date_published": "2025-09-02T16:00:00.000Z",
            "content_html": "<h1 id=\"网络核心概念精讲从-ip-地址到-mac-地址\"><a class=\"anchor\" href=\"#网络核心概念精讲从-ip-地址到-mac-地址\">#</a> 网络核心概念精讲：从 IP 地址到 MAC 地址</h1>\n<blockquote>\n<p>本文系统讲解计算机网络的核心概念，包括 IP 地址、子网、路由器、DNS 等，力求用通俗易懂的语言和比喻解释复杂的技术原理。</p>\n</blockquote>\n<h2 id=\"1-网络层级模型互联网的交通规则\"><a class=\"anchor\" href=\"#1-网络层级模型互联网的交通规则\">#</a> 1. 网络层级模型：互联网的交通规则</h2>\n<p>理解网络，首先要理解它的分层模型。常见的 OSI 七层模型与 TCP/IP 五层模型，会把复杂的网络通信过程分解为多个层次，每一层只专注于自己的任务。</p>\n<p>一个经典的比喻：发送快递。</p>\n<ul>\n<li><strong>应用层</strong>：你要寄的东西本身（比如一封信），决定了通信内容（HTTP、FTP 等）。</li>\n<li><strong>传输层</strong>：将东西打包并保证可靠送达（TCP、UDP）。</li>\n<li><strong>网络层</strong>：填写收件人/发件人地址（IP 地址），负责跨网络选路（IP、路由器）。</li>\n<li><strong>数据链路层</strong>：负责在同一条链路上把包裹送到下一站（MAC 地址、交换机）。</li>\n<li><strong>物理层</strong>：最终的比特传输介质（网线、光纤、无线电波）。</li>\n</ul>\n<h2 id=\"2-ip-地址互联网上的门牌号\"><a class=\"anchor\" href=\"#2-ip-地址互联网上的门牌号\">#</a> 2. IP 地址：互联网上的“门牌号”</h2>\n<h3 id=\"21-什么是-ip-地址\"><a class=\"anchor\" href=\"#21-什么是-ip-地址\">#</a> 2.1 什么是 IP 地址</h3>\n<p>IP 地址是为互联网上的每一个设备分配的一种逻辑地址，用于在网络中定位和寻址。它就像你家的门牌号，知道了这个地址，数据包才能找到你。</p>\n<h3 id=\"22-公有-ip-vs-私有-ip\"><a class=\"anchor\" href=\"#22-公有-ip-vs-私有-ip\">#</a> 2.2 公有 IP vs. 私有 IP</h3>\n<ul>\n<li><strong>公有 IP (Public IP)</strong>：全球唯一，由运营商分配，是你在互联网上的“家庭住址”，可被公网设备直接访问。\n<ul>\n<li><strong>如何查看</strong>：浏览器访问 <code>ip.cn</code> 或 <code>whatismyip.com</code>；也可以在 PowerShell 中运行 <code>(Invoke-RestMethod -Uri \"https://api.ipify.org\").Trim()</code>。</li>\n</ul>\n</li>\n<li><strong>私有 IP (Private IP)</strong>：在局域网（LAN）内使用，非全球唯一。家里的电脑、手机通常获得私有 IP，通过路由器共享一个公有 IP 上网。\n<ul>\n<li><strong>常见范围</strong>：<code>10.0.0.0/8</code>、<code>172.16.0.0/12</code>、<code>192.168.0.0/16</code>。</li>\n<li><strong>如何查看</strong>：\n<ul>\n<li><strong>Windows</strong>：<code>Win + R</code> -&gt; 输入 <code>cmd</code> -&gt; 输入 <code>ipconfig</code>，查看“IPv4 地址”。</li>\n<li><strong>macOS/Linux</strong>：终端输入 <code>ifconfig</code> 或 <code>ip addr</code>。</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"23-ipv4-vs-ipv6\"><a class=\"anchor\" href=\"#23-ipv4-vs-ipv6\">#</a> 2.3 IPv4 vs. IPv6</h3>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">特点</th>\n<th style=\"text-align:left\">IPv4</th>\n<th style=\"text-align:left\">IPv6</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><strong>地址长度</strong></td>\n<td style=\"text-align:left\">32 位</td>\n<td style=\"text-align:left\">128 位</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>地址总量</strong></td>\n<td style=\"text-align:left\">约 42.9 亿</td>\n<td style=\"text-align:left\">近乎无限（<code>2^128</code> 个）</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>表示方法</strong></td>\n<td style=\"text-align:left\">十进制（如 <code>192.168.1.1</code>）</td>\n<td style=\"text-align:left\">十六进制（如 <code>2001:db8::1</code>）</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>本质</strong></td>\n<td style=\"text-align:left\">都是二进制数，只是对人类的不同表示方式</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"3-子网掩码与网络划分划定社区的范围\"><a class=\"anchor\" href=\"#3-子网掩码与网络划分划定社区的范围\">#</a> 3. 子网掩码与网络划分：划定“社区”的范围</h2>\n<p>光有门牌号不够，还需要知道这个门牌号属于哪个小区（网络）。子网掩码就是用来界定“小区”范围的工具。</p>\n<ul>\n<li><strong>功能</strong>：将 IP 地址划分为网络号（小区名）和主机号（门牌号）。</li>\n<li><strong>计算</strong>：将 IP 地址与子网掩码做按位与运算，即可得到网络号。</li>\n<li><strong>例子</strong>：IP <code>192.168.1.100</code>，掩码 <code>255.255.255.0</code>。\n<ul>\n<li>按位与运算后得到网络号：<code>192.168.1.0</code>。</li>\n<li>这意味着 <code>192.168.1.1</code> 到 <code>192.168.1.254</code> 的设备都在同一个“小区”内，可以直接通信。</li>\n</ul>\n</li>\n<li><strong>CIDR 表示</strong>：<code>192.168.1.0/24</code>，其中 <code>/24</code> 表示子网掩码前 24 位是 1（即 <code>255.255.255.0</code>）。</li>\n</ul>\n<p>补充：像 <code>255.255.128.0</code> 这样的掩码提供更灵活的划分方式，可以将一个大的地址段（如 <code>172.16.0.0/16</code>）划分为更小的子网，以满足不同规模的网络需求。</p>\n<h2 id=\"4-网关与路由器网络的出入口和交通枢纽\"><a class=\"anchor\" href=\"#4-网关与路由器网络的出入口和交通枢纽\">#</a> 4. 网关与路由器：网络的“出入口”和“交通枢纽”</h2>\n<h3 id=\"41-网关-gateway\"><a class=\"anchor\" href=\"#41-网关-gateway\">#</a> 4.1 网关 (Gateway)</h3>\n<ul>\n<li><strong>定义</strong>：连接两个不同网络的出入口，是一个逻辑概念。</li>\n<li><strong>地址</strong>：网关必须有一个 IP 地址，通常就是路由器 LAN 口的 IP 地址（如 <code>192.168.1.1</code>、<code>10.138.255.254</code>）。</li>\n<li><strong>功能</strong>：当设备要访问互联网（另一个网络）时，会把数据包发给网关，由网关负责转发。</li>\n</ul>\n<h3 id=\"42-路由器router\"><a class=\"anchor\" href=\"#42-路由器router\">#</a> 4.2 路由器（Router）</h3>\n<ul>\n<li><strong>定义</strong>：实现网关功能的物理设备，是网络的“交通枢纽”，根据路由表决定数据包的下一跳。</li>\n<li><strong>核心功能</strong>：\n<ol>\n<li><strong>路由</strong>：在不同网络间转发数据包。</li>\n<li><strong>NAT（网络地址转换）</strong>：将局域网内多个设备的私有 IP 转换为一个公有 IP 上网，是共享上网的基础。</li>\n<li><strong>DHCP 服务</strong>：自动为局域网内的设备分配 IP 地址、子网掩码、网关和 DNS 地址。</li>\n<li><strong>交换机 &amp; 无线 AP</strong>：提供有线端口与 Wi-Fi 接入。</li>\n</ol>\n</li>\n</ul>\n<h3 id=\"43-硬路由-vs-软路由\"><a class=\"anchor\" href=\"#43-硬路由-vs-软路由\">#</a> 4.3 硬路由 vs. 软路由</h3>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">特点</th>\n<th style=\"text-align:left\">硬路由</th>\n<th style=\"text-align:left\">软路由</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><strong>本质</strong></td>\n<td style=\"text-align:left\">专用硬件设备（如家用路由器）</td>\n<td style=\"text-align:left\">在通用硬件（电脑/工控机）上运行的路由软件</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>优点</strong></td>\n<td style=\"text-align:left\">稳定、省电、即插即用</td>\n<td style=\"text-align:left\">性能强大、功能灵活（可通过插件扩展功能）</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>缺点</strong></td>\n<td style=\"text-align:left\">功能固定、性能有限</td>\n<td style=\"text-align:left\">需自行配置、功耗较高、有学习成本</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>例子</strong></td>\n<td style=\"text-align:left\">华硕、TP-Link、网件路由器</td>\n<td style=\"text-align:left\"><strong>OpenWrt</strong>, <strong>爱快(iKuai)</strong>, <strong>ROS</strong> 系统</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"5-dhcp-vs-静态-ip自动分配与手动指定\"><a class=\"anchor\" href=\"#5-dhcp-vs-静态-ip自动分配与手动指定\">#</a> 5. DHCP vs. 静态 IP：自动分配与手动指定</h2>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">特点</th>\n<th style=\"text-align:left\">DHCP（动态分配）</th>\n<th style=\"text-align:left\">静态 IP（手动配置）</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><strong>配置方式</strong></td>\n<td style=\"text-align:left\"><strong>自动</strong></td>\n<td style=\"text-align:left\"><strong>手动</strong></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>地址变化</strong></td>\n<td style=\"text-align:left\">可能变化（租期到期）</td>\n<td style=\"text-align:left\"><strong>固定不变</strong></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>适用场景</strong></td>\n<td style=\"text-align:left\">绝大多数设备（手机、电脑）</td>\n<td style=\"text-align:left\">需要固定地址的设备（服务器、打印机、NAS 等）</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><strong>比喻</strong></td>\n<td style=\"text-align:left\">租房（地址可能变）</td>\n<td style=\"text-align:left\">自己买的房子（地址长期不变）</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"6-dns互联网的电话簿\"><a class=\"anchor\" href=\"#6-dns互联网的电话簿\">#</a> 6. DNS：互联网的“电话簿”</h2>\n<ul>\n<li><strong>全称</strong>：域名系统（Domain Name System, DNS）。</li>\n<li><strong>作用</strong>：将人类容易记住的域名（如 <code>www.google.com</code>）翻译成计算机用于通信的 IP 地址（如 <code>142.251.42.206</code>）。</li>\n<li><strong>提供方</strong>：通常由网络运营商（ISP）自动分配，也可以手动设置公共 DNS（如 <code>8.8.8.8</code>、<code>1.1.1.1</code>）。</li>\n<li><strong>查看方式</strong>：在 <code>ipconfig /all</code> 输出中查看“DNS 服务器”。</li>\n</ul>\n<h2 id=\"7-mac-地址网卡的身份证\"><a class=\"anchor\" href=\"#7-mac-地址网卡的身份证\">#</a> 7. MAC 地址：网卡的“身份证”</h2>\n<ul>\n<li><strong>定义</strong>：媒体访问控制地址（Media Access Control Address），固化在网卡硬件中，通常可认为在局域网内唯一的物理地址。</li>\n<li><strong>格式</strong>：48 位，十六进制表示（如 <code>00:1A:2B:3C:4D:5E</code>）。</li>\n<li><strong>结构</strong>：前 24 位是厂商标识（OUI），后 24 位是厂商分配的序列号。</li>\n<li><strong>作用层级</strong>：工作在数据链路层，负责同一局域网内设备间的直接寻址（“下一跳”通信）。</li>\n<li><strong>核心协议</strong>：ARP。设备通过广播“这个 IP 的 MAC 地址是什么？”来获取目标设备的物理地址，从而在局域网内直接通信。</li>\n<li><strong>与 IP 地址的关系</strong>：\n<ul>\n<li><strong>IP 地址</strong>：像收件地址，负责端到端的全局寻址（“我要去上海”）。</li>\n<li><strong>MAC 地址</strong>：像当前路段的下一站，负责一跳一跳的局部寻址（“下一站去天津”）。数据包每经过一个路由器，其源/目的 MAC 地址都会被重写，而 IP 地址通常保持不变。</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"8-总结\"><a class=\"anchor\" href=\"#8-总结\">#</a> 8. 总结</h2>\n<p>网络通信是一个精妙的协作过程：</p>\n<ol>\n<li>你想访问 <code>www.google.com</code>，DNS 首先将其解析为 IP 地址。</li>\n<li>你的电脑判断目标 IP 不在当前局域网，于是将数据包发往网关（路由器）。</li>\n<li>路由器通过 NAT 将你的私有 IP 转为公有 IP，并根据路由表将数据包转发到互联网的下一跳。</li>\n<li>在每一跳中，设备会通过 MAC 地址与 ARP 在局部链路上完成寻址。</li>\n<li>数据包最终到达目标服务器，响应再沿着相反的路径回到你的电脑。</li>\n</ol>\n<p>理解这些核心概念，就能拨开互联网的迷雾，看清数据流动的轨迹。</p>\n",
            "tags": [
                "router",
                "ip",
                "MAC"
            ]
        },
        {
            "id": "https://koen666.github.io/2025/09/01/sql/",
            "url": "https://koen666.github.io/2025/09/01/sql/",
            "title": "SQL语法规则",
            "date_published": "2025-08-31T16:00:00.000Z",
            "content_html": "<h1 id=\"一-登录-mysql\"><a class=\"anchor\" href=\"#一-登录-mysql\">#</a> 一、登录 MySQL</h1>\n<p>如果你用 <strong>命令行</strong>：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">mysql</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -u</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> root</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -p</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --socket=/var/run/mysqld/mysqld.sock</span></span></code></pre>\n<p>然后输入密码，就会进入：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-text\"><span class=\"line\"><span>mysql></span></span></code></pre>\n<p>这就是 MySQL 的提示符，表示你可以执行 SQL 命令了。</p>\n<p>如果用 <strong>Navicat</strong>，直接填入主机、端口、用户名、密码，点击“连接”。</p>\n<hr />\n<h1 id=\"二-查看已有数据库\"><a class=\"anchor\" href=\"#二-查看已有数据库\">#</a> 二、查看已有数据库</h1>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-sql\"><span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">SHOW DATABASES;</span></span></code></pre>\n<p>输出示例：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-text\"><span class=\"line\"><span>+--------------------+</span></span>\n<span class=\"line\"><span>| Database           |</span></span>\n<span class=\"line\"><span>+--------------------+</span></span>\n<span class=\"line\"><span>| information_schema |</span></span>\n<span class=\"line\"><span>| mysql              |</span></span>\n<span class=\"line\"><span>| performance_schema |</span></span>\n<span class=\"line\"><span>+--------------------+</span></span></code></pre>\n<ul>\n<li><code>mysql</code> 是系统数据库</li>\n<li><code>information_schema</code> 是系统表信息</li>\n<li>你可以自己创建数据库来存数据</li>\n</ul>\n<hr />\n<h1 id=\"三-切换当前数据库\"><a class=\"anchor\" href=\"#三-切换当前数据库\">#</a> 三、切换当前数据库</h1>\n<p>在 MySQL 中，你必须先 <strong>选择一个数据库</strong> 才能操作里面的表。<br />\n语法：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-sql\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">USE</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> 数据库名;</span></span></code></pre>\n<p>示例：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-sql\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">USE</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> school;</span></span></code></pre>\n<blockquote>\n<p>提示：切换成功后，MySQL 提示符会显示当前数据库：</p>\n</blockquote>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-text\"><span class=\"line\"><span>Database changed</span></span>\n<span class=\"line\"><span>mysql></span></span></code></pre>\n<hr />\n<h1 id=\"四-查看当前正在使用的数据库\"><a class=\"anchor\" href=\"#四-查看当前正在使用的数据库\">#</a> 四、查看当前正在使用的数据库</h1>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-sql\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">SELECT</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> DATABASE</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span></code></pre>\n<p>输出：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-text\"><span class=\"line\"><span>+------------+</span></span>\n<span class=\"line\"><span>| DATABASE() |</span></span>\n<span class=\"line\"><span>+------------+</span></span>\n<span class=\"line\"><span>| school     |</span></span>\n<span class=\"line\"><span>+------------+</span></span></code></pre>\n<hr />\n<h1 id=\"五-创建数据库\"><a class=\"anchor\" href=\"#五-创建数据库\">#</a> 五、创建数据库</h1>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-sql\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">CREATE</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> DATABASE</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> school</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span></code></pre>\n<ul>\n<li>如果数据库已存在，可以加 <code>IF NOT EXISTS</code>：</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-sql\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">CREATE</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> DATABASE</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> IF</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> NOT</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> EXISTS</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> school;</span></span></code></pre>\n<ul>\n<li>创建完后切换：</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-sql\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">USE</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> school;</span></span></code></pre>\n<hr />\n<h1 id=\"六-查看数据库里的表\"><a class=\"anchor\" href=\"#六-查看数据库里的表\">#</a> 六、查看数据库里的表</h1>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-sql\"><span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">SHOW TABLES;</span></span></code></pre>\n<ul>\n<li>如果是新建的数据库，可能显示为空。</li>\n</ul>\n<hr />\n<h1 id=\"七-创建表\"><a class=\"anchor\" href=\"#七-创建表\">#</a> 七、创建表</h1>\n<p>SQL 语法：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-sql\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">CREATE</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> TABLE</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> students</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    id </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">INT</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> PRIMARY KEY</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">,       </span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">-- 学生编号</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    name</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> VARCHAR</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">50</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">,         </span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">-- 姓名</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    age </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">INT</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">,                  </span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">-- 年龄</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    class </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">VARCHAR</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">10</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">         </span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">-- 班级</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span></code></pre>\n<p>Navicat 操作：</p>\n<ol>\n<li>右键数据库 → 新建表</li>\n<li>输入表名</li>\n<li>添加字段名、类型、主键</li>\n<li>保存</li>\n</ol>\n<hr />\n<h1 id=\"八-查看表结构\"><a class=\"anchor\" href=\"#八-查看表结构\">#</a> 八、查看表结构</h1>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-sql\"><span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">DESCRIBE students;</span></span></code></pre>\n<p>输出示例：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-text\"><span class=\"line\"><span>+-------+-------------+------+-----+---------+-------+</span></span>\n<span class=\"line\"><span>| Field | Type        | Null | Key | Default | Extra |</span></span>\n<span class=\"line\"><span>+-------+-------------+------+-----+---------+-------+</span></span>\n<span class=\"line\"><span>| id    | int         | NO   | PRI | NULL    |       |</span></span>\n<span class=\"line\"><span>| name  | varchar(50) | YES  |     | NULL    |       |</span></span>\n<span class=\"line\"><span>| age   | int         | YES  |     | NULL    |       |</span></span>\n<span class=\"line\"><span>| class | varchar(10) | YES  |     | NULL    |       |</span></span>\n<span class=\"line\"><span>+-------+-------------+------+-----+---------+-------+</span></span></code></pre>\n<hr />\n<h1 id=\"九-插入数据\"><a class=\"anchor\" href=\"#九-插入数据\">#</a> 九、插入数据</h1>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-sql\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">INSERT INTO</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> students </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">id, </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">name</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">, age, class</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">VALUES</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Alice</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">20</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">A1</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Bob</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">21</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">A2</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span></code></pre>\n<p>Navicat 可以直接右键表 → 编辑数据 → 手动添加行。</p>\n<hr />\n<h1 id=\"十-查询数据\"><a class=\"anchor\" href=\"#十-查询数据\">#</a> 十、查询数据</h1>\n<ol>\n<li>查询整个表：</li>\n</ol>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-sql\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">SELECT</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> FROM</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> students;</span></span></code></pre>\n<ol start=\"2\">\n<li>查询指定字段：</li>\n</ol>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-sql\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">SELECT</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> name</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">, age </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">FROM</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> students;</span></span></code></pre>\n<ol start=\"3\">\n<li>条件查询：</li>\n</ol>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-sql\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">SELECT</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> FROM</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> students </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">WHERE</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> class</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">A1</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span></code></pre>\n<ol start=\"4\">\n<li>排序：</li>\n</ol>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-sql\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">SELECT</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> FROM</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> students </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">ORDER BY</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> age </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">DESC</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span></code></pre>\n<hr />\n<h1 id=\"十一-更新数据\"><a class=\"anchor\" href=\"#十一-更新数据\">#</a> 十一、更新数据</h1>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-sql\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">UPDATE</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> students </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">SET</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> age</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">22</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> WHERE</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> name</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Alice</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span></code></pre>\n<hr />\n<h1 id=\"十二-删除数据\"><a class=\"anchor\" href=\"#十二-删除数据\">#</a> 十二、删除数据</h1>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-sql\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">DELETE</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> FROM</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> students </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">WHERE</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> id</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">;  </span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">-- 删除指定记录</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">DROP</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> TABLE</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> students;              </span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">-- 删除整个表</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">DROP</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> DATABASE</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> school;             </span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">-- 删除数据库</span></span></code></pre>\n<hr />\n<h1 id=\"十三-小技巧\"><a class=\"anchor\" href=\"#十三-小技巧\">#</a> 十三、小技巧</h1>\n<ul>\n<li><strong>快速切换数据库</strong></li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-sql\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">USE</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> 数据库名;</span></span></code></pre>\n<ul>\n<li><strong>查看当前数据库</strong></li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-sql\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">SELECT</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> DATABASE</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span></code></pre>\n<ul>\n<li><strong>查看表结构</strong></li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-sql\"><span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">DESCRIBE 表名;</span></span></code></pre>\n<ul>\n<li><strong>查看所有数据库</strong></li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-sql\"><span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">SHOW DATABASES;</span></span></code></pre>\n<ul>\n<li><strong>查看所有表</strong></li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-sql\"><span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">SHOW TABLES;</span></span></code></pre>\n",
            "tags": [
                "database",
                "sql"
            ]
        },
        {
            "id": "https://koen666.github.io/2025/08/25/Koa/",
            "url": "https://koen666.github.io/2025/08/25/Koa/",
            "title": "Koa 框架使用",
            "date_published": "2025-08-25T05:20:00.000Z",
            "content_html": "<h2 id=\"0-准备工作\"><a class=\"anchor\" href=\"#0-准备工作\">#</a> 0. 准备工作</h2>\n<h3 id=\"01-安装-nodejs建议-node-18\"><a class=\"anchor\" href=\"#01-安装-nodejs建议-node-18\">#</a> 0.1 安装 Node.js（建议 Node 18+）</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">node</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -v</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># v18.x 或更高</span></span></code></pre>\n<h3 id=\"02-新建项目目录并初始化\"><a class=\"anchor\" href=\"#02-新建项目目录并初始化\">#</a> 0.2 新建项目目录并初始化</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">mkdir</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> koa-step-by-step</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">cd</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> koa-step-by-step</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">npm</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> init</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -y</span></span></code></pre>\n<h3 id=\"03-esm-设置强烈建议\"><a class=\"anchor\" href=\"#03-esm-设置强烈建议\">#</a> 0.3 ESM 设置（强烈建议）</h3>\n<p>在 <code>package.json</code> 顶层加入：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-json\"><span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">  \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">type</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">module</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span></code></pre>\n<blockquote>\n<p>作用：让 Node 默认使用 ES 模块语法（<code>import</code>/<code>export</code>），并支持 <code>.mjs</code> 文件。</p>\n</blockquote>\n<h3 id=\"04-推荐本地开发脚本可热重载\"><a class=\"anchor\" href=\"#04-推荐本地开发脚本可热重载\">#</a> 0.4 推荐本地开发脚本（可热重载）</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">npm</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> i</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -D</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> nodemon</span></span></code></pre>\n<p>在 <code>package.json</code> 里加入：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-json\"><span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">  \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">scripts</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">    \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">dev</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">nodemon --ext mjs,js,json --watch . app.mjs</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">    \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">start</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">node app.mjs</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span></code></pre>\n<blockquote>\n<p>以后 <code>npm run dev</code> 就会自动重启，开发体验更好。</p>\n</blockquote>\n<hr>\n<h2 id=\"1-阶段-a最小可运行的-koa无路由-无中间件栈\"><a class=\"anchor\" href=\"#1-阶段-a最小可运行的-koa无路由-无中间件栈\">#</a> 1. 阶段 A：最小可运行的 Koa（无路由、无中间件栈）</h2>\n<h3 id=\"11-安装-koa\"><a class=\"anchor\" href=\"#11-安装-koa\">#</a> 1.1 安装 Koa</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">npm</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> i</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> koa</span></span></code></pre>\n<h3 id=\"12-新建-appmjs\"><a class=\"anchor\" href=\"#12-新建-appmjs\">#</a> 1.2 新建 <code>app.mjs</code></h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-js\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// app.mjs（阶段A）</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 目标：</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 1）启动一个最简单的 Koa 服务器</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 2）所有请求都返回 \"Hello Koa\" 文本</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> Koa</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">koa</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">   // 引入 Koa 主类</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> app</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> new</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Koa</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">   // 创建 Koa 实例</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// app.use() 注册一个中间件函数（每个请求都会走这里）</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 这是最简单的中间件：设置响应体即可</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">use</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">async</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  // ctx 是“上下文对象”，封装了 Request 和 Response 等常用属性</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Hello Koa</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 返回纯文本</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 启动 HTTP 服务，监听端口 3000</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">listen</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">3000</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  console</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">log</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Server running at http://localhost:3000</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  console</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">log</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">   当前阶段：A（最小可运行服务）</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span></code></pre>\n<h3 id=\"13-运行\"><a class=\"anchor\" href=\"#13-运行\">#</a> 1.3 运行</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">npm</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> run</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> start</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 或</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">npm</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> run</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> dev</span></span></code></pre>\n<p>浏览器打开 <a href=\"http://localhost:3000\">http://localhost:3000</a> ，能看到 <strong>Hello Koa</strong>。</p>\n<hr>\n<h2 id=\"2-阶段-b引入路由koa-router让不同路径走不同逻辑\"><a class=\"anchor\" href=\"#2-阶段-b引入路由koa-router让不同路径走不同逻辑\">#</a> 2. 阶段 B：引入路由（koa-router），让不同路径走不同逻辑</h2>\n<h3 id=\"21-安装路由中间件\"><a class=\"anchor\" href=\"#21-安装路由中间件\">#</a> 2.1 安装路由中间件</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">npm</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> i</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> koa-router</span></span></code></pre>\n<h3 id=\"22-新建-routesindexmjs\"><a class=\"anchor\" href=\"#22-新建-routesindexmjs\">#</a> 2.2 新建 <code>routes/index.mjs</code></h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-js\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// routes/index.mjs（阶段B）</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 目标：为不同 URL 配置不同处理函数</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> Router</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">koa-router</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 创建路由实例，并统一加上前缀（可选）</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> router</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> new</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Router</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> prefix</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/api</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// GET /api/hello -&gt; 返回简单文本</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">get</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/hello</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Hello from /api/hello</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// GET /api/user/:id -&gt; 返回路径参数</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">get</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/user/:id</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  // 通过 ctx.params 获取 :id 的值</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> id</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">params</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> message</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> `</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">你请求的用户ID是 </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">${</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">id</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">}</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">`</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> default</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> router</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span></code></pre>\n<h3 id=\"23-修改-appmjs-使用路由\"><a class=\"anchor\" href=\"#23-修改-appmjs-使用路由\">#</a> 2.3 修改 <code>app.mjs</code> 使用路由</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-js\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// app.mjs（阶段B）</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> Koa</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">koa</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> router</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">./routes/index.mjs</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 引入路由</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> app</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> new</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Koa</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 将路由注册到应用（注意两步：routes + allowedMethods）</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">use</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">routes</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">use</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">allowedMethods</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">listen</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">3000</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  console</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">log</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Server running at http://localhost:3000</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  console</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">log</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">   当前阶段：B（已加入路由）</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span></code></pre>\n<p>此时访问：</p>\n<ul>\n<li>GET <code>http://localhost:3000/api/hello</code></li>\n<li>GET <code>http://localhost:3000/api/user/123</code></li>\n</ul>\n<hr>\n<h2 id=\"3-阶段-c解析请求体koa-bodyparser并实现第一个-post-api\"><a class=\"anchor\" href=\"#3-阶段-c解析请求体koa-bodyparser并实现第一个-post-api\">#</a> 3. 阶段 C：解析请求体（koa-bodyparser）并实现第一个 POST API</h2>\n<h3 id=\"31-安装-body-解析中间件\"><a class=\"anchor\" href=\"#31-安装-body-解析中间件\">#</a> 3.1 安装 body 解析中间件</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">npm</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> i</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> koa-bodyparser</span></span></code></pre>\n<h3 id=\"32-在-appmjs-启用-bodyparser\"><a class=\"anchor\" href=\"#32-在-appmjs-启用-bodyparser\">#</a> 3.2 在 <code>app.mjs</code> 启用 bodyParser</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-js\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// app.mjs（阶段C）</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> Koa</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">koa</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> bodyParser</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">koa-bodyparser</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> router</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">./routes/index.mjs</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> app</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> new</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Koa</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 解析 JSON / x-www-form-urlencoded 请求体</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">use</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">bodyParser</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">use</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">routes</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">use</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">allowedMethods</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">listen</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">3000</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  console</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">log</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Server running at http://localhost:3000</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  console</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">log</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">   当前阶段：C（支持解析请求体 &amp; POST 请求）</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span></code></pre>\n<h3 id=\"33-在路由里加一个-post-示例\"><a class=\"anchor\" href=\"#33-在路由里加一个-post-示例\">#</a> 3.3 在路由里加一个 POST 示例</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-js\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// routes/index.mjs（阶段C，新增 POST 路由）</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> Router</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">koa-router</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> router</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> new</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Router</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> prefix</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/api</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">get</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/hello</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Hello from /api/hello</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">get</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/user/:id</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> id</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">params</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> message</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> `</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">你请求的用户ID是 </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">${</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">id</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">}</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">`</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// POST /api/echo -&gt; 回显请求体</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">post</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/echo</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  // 通过 ctx.request.body 获取 JSON 或表单提交的数据</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> body</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">request</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">    received</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> body</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  // 回显你发过来的数据</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">    tip</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">你已成功通过 POST 发送数据到 Koa 服务端</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> default</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> router</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span></code></pre>\n<p><strong>测试 POST：</strong></p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># Mac/Linux</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">curl</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -X</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> POST</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> http://localhost:3000/api/echo</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#A65E2B;--shiki-dark:#C99076\">  -H</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Content-Type: application/json</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#A65E2B;--shiki-dark:#C99076\">  -d</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">{\"name\":\"Alice\",\"age\":20}</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># Windows PowerShell（注意引号）</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">curl</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -X</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> POST</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> http://localhost:3000/api/echo</span><span style=\"color:#999999;--shiki-dark:#666666\"> `</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">  -H</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Content-Type: application/json</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\"> `</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">  -d</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">{</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">name</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Alice</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">age</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">:20}</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span></code></pre>\n<hr>\n<h2 id=\"4-阶段-d全局错误处理-日志打印理解洋葱模型\"><a class=\"anchor\" href=\"#4-阶段-d全局错误处理-日志打印理解洋葱模型\">#</a> 4. 阶段 D：全局错误处理 + 日志打印（理解“洋葱模型”）</h2>\n<h3 id=\"41-在-appmjs-添加错误捕获中间件\"><a class=\"anchor\" href=\"#41-在-appmjs-添加错误捕获中间件\">#</a> 4.1 在 <code>app.mjs</code> 添加错误捕获中间件</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-js\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// app.mjs（阶段D）</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> Koa</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">koa</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> bodyParser</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">koa-bodyparser</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> router</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">./routes/index.mjs</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> app</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> new</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Koa</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// ① 全局错误处理中间件（最外层）：try/catch 所有下游中间件的异常</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">use</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">async</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> next</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> start</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> Date</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">now</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 统计耗时</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  try</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    await</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> next</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">           // 交给下一个中间件</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> catch</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">err</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 统一错误响应格式</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">status</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> err</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">status</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ||</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 500</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> code</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">status</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> message</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> err</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">message</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ||</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Server Error</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 打印到控制台方便定位</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    console</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">error</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Error:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> err</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> finally</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> ms</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> Date</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">now</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> start</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 记录访问日志</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    console</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">log</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">`</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">${</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">method</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">}</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> ${</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">url</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">}</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> - </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">${</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">status </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">||</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 200</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">}</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> ${</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">ms</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">}</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">ms</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">`</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// ② 解析请求体</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">use</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">bodyParser</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// ③ 注册业务路由</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">use</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">routes</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">use</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">allowedMethods</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">listen</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">3000</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  console</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">log</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Server running at http://localhost:3000</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  console</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">log</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">   当前阶段：D（全局错误处理 &amp; 访问日志）</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span></code></pre>\n<p><strong>理解洋葱模型</strong>：最外层中间件先进入，<code>await next()</code> 后进入下一层；当下一层返回时，回到上一层继续执行 <code>finally</code> 等收尾逻辑。</p>\n<h3 id=\"42-在路由里人为抛错试试看\"><a class=\"anchor\" href=\"#42-在路由里人为抛错试试看\">#</a> 4.2 在路由里人为抛错试试看</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-js\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// routes/index.mjs（阶段D，增加一个错误示例）</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> Router</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">koa-router</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> router</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> new</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Router</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> prefix</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/api</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">get</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/boom</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  // 主动抛出一个错误，观察上文错误处理中间件如何工作</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> err</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> new</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Error</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">模拟服务端异常：/api/boom</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  err</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">status</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 418</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 仅演示，418是Teapot彩蛋状态码</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  throw</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> err</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> default</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> router</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span></code></pre>\n<p>访问 <code>GET /api/boom</code>，你会看到结构化的错误响应 + 控制台日志。</p>\n<hr>\n<h2 id=\"5-阶段-e静态资源与-favicon避免多次计数404\"><a class=\"anchor\" href=\"#5-阶段-e静态资源与-favicon避免多次计数404\">#</a> 5. 阶段 E：静态资源与 favicon（避免多次计数/404）</h2>\n<h3 id=\"51-安装-koa-static\"><a class=\"anchor\" href=\"#51-安装-koa-static\">#</a> 5.1 安装 koa-static</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">npm</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> i</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> koa-static</span></span></code></pre>\n<h3 id=\"52-在项目根目录建-public\"><a class=\"anchor\" href=\"#52-在项目根目录建-public\">#</a> 5.2 在项目根目录建 <code>public/</code></h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-text\"><span class=\"line\"><span>koa-step-by-step/</span></span>\n<span class=\"line\"><span>├─ app.mjs</span></span>\n<span class=\"line\"><span>├─ routes/</span></span>\n<span class=\"line\"><span>│  └─ index.mjs</span></span>\n<span class=\"line\"><span>└─ public/</span></span>\n<span class=\"line\"><span>   ├─ index.html</span></span>\n<span class=\"line\"><span>   └─ favicon.ico (可选)</span></span></code></pre>\n<p>简单写一个 <code>public/index.html</code>：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-html\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">&lt;!</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">doctype</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> html</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">&lt;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">html</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  &lt;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">head</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;&lt;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">meta</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> charset</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">utf-8</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;&lt;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">title</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Koa Static</span><span style=\"color:#999999;--shiki-dark:#666666\">&lt;/</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">title</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;&lt;/</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">head</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  &lt;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">body</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    &lt;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">h1</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Hello Static</span><span style=\"color:#999999;--shiki-dark:#666666\">&lt;/</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">h1</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    &lt;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">p</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">这是 public/index.html 静态页面。</span><span style=\"color:#999999;--shiki-dark:#666666\">&lt;/</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">p</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  &lt;/</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">body</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">&lt;/</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">html</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span></span></code></pre>\n<h3 id=\"53-修改-appmjs-启用静态资源\"><a class=\"anchor\" href=\"#53-修改-appmjs-启用静态资源\">#</a> 5.3 修改 <code>app.mjs</code> 启用静态资源</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-js\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// app.mjs（阶段E）</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> Koa</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">koa</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> bodyParser</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">koa-bodyparser</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> serve</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">koa-static</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> path</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">path</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> fileURLToPath</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">url</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> router</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">./routes/index.mjs</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> __filename</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> fileURLToPath</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#998418;--shiki-dark:#B8A965\">meta</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">url</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> __dirname</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> path</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">dirname</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">__filename</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> app</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> new</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Koa</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">use</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">async</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> next</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> start</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> Date</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">now</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  try</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    await</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> next</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> catch</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">err</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">status</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> err</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">status</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ||</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 500</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> code</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">status</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> message</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> err</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">message</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ||</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Server Error</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    console</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">error</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Error:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> err</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> finally</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> ms</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> Date</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">now</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> start</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    console</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">log</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">`</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">${</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">method</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">}</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> ${</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">url</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">}</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> - </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">${</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">status </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">||</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 200</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">}</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> ${</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">ms</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">}</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">ms</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">`</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">use</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">bodyParser</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 开放 public 目录为静态资源根目录：访问 / 即可打开 public/index.html</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">use</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">serve</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">path</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">join</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">__dirname</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">public</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">use</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">routes</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">use</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">allowedMethods</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">listen</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">3000</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  console</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">log</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Server running at http://localhost:3000</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  console</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">log</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">   当前阶段：E（支持静态资源与 favicon）</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span></code></pre>\n<p>现在访问 <code>http://localhost:3000/</code> 就能看到静态页面。</p>\n<blockquote>\n<p><strong>提示</strong>：许多浏览器会自动请求 <code>/favicon.ico</code>。如果没有图标，偶尔会触发两次访问等“小惊喜”。把 <code>favicon.ico</code> 放到 <code>public/</code> 里，可以避免这类困扰。</p>\n</blockquote>\n<hr>\n<h2 id=\"6-阶段-f可选模板渲染服务器端渲染一个简单页面\"><a class=\"anchor\" href=\"#6-阶段-f可选模板渲染服务器端渲染一个简单页面\">#</a> 6. 阶段 F（可选）：模板渲染（服务器端渲染一个简单页面）</h2>\n<blockquote>\n<p>如果你的服务只做 API，可跳过本节。这里展示如何用 <strong>EJS</strong> 渲染模板。</p>\n</blockquote>\n<h3 id=\"61-安装依赖\"><a class=\"anchor\" href=\"#61-安装依赖\">#</a> 6.1 安装依赖</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">npm</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> i</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> koa-views</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ejs</span></span></code></pre>\n<h3 id=\"62-目录结构新增-views\"><a class=\"anchor\" href=\"#62-目录结构新增-views\">#</a> 6.2 目录结构新增 <code>views/</code></h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-text\"><span class=\"line\"><span>koa-step-by-step/</span></span>\n<span class=\"line\"><span>├─ app.mjs</span></span>\n<span class=\"line\"><span>├─ routes/</span></span>\n<span class=\"line\"><span>│  └─ index.mjs</span></span>\n<span class=\"line\"><span>├─ public/</span></span>\n<span class=\"line\"><span>│  └─ index.html</span></span>\n<span class=\"line\"><span>└─ views/</span></span>\n<span class=\"line\"><span>   └─ home.ejs</span></span></code></pre>\n<p><code>views/home.ejs</code>：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-html\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">&lt;!</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">doctype</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> html</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">&lt;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">html</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  &lt;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">head</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;&lt;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">meta</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> charset</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">utf-8</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;&lt;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">title</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">EJS Demo</span><span style=\"color:#999999;--shiki-dark:#666666\">&lt;/</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">title</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;&lt;/</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">head</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  &lt;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">body</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    &lt;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">h1</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic\">&lt;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">%= title %&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\">&lt;/</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">h1</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    &lt;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">p</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">服务器时间：</span><span style=\"color:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic\">&lt;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">%= now %&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\">&lt;/</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">p</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  &lt;/</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">body</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">&lt;/</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">html</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span></span></code></pre>\n<h3 id=\"63-在-appmjs-配置视图中间件\"><a class=\"anchor\" href=\"#63-在-appmjs-配置视图中间件\">#</a> 6.3 在 <code>app.mjs</code> 配置视图中间件</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-js\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// app.mjs（阶段F）</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> Koa</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">koa</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> bodyParser</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">koa-bodyparser</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> serve</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">koa-static</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> views</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">koa-views</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> path</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">path</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> fileURLToPath</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">url</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> router</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">./routes/index.mjs</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> __filename</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> fileURLToPath</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#998418;--shiki-dark:#B8A965\">meta</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">url</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> __dirname</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> path</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">dirname</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">__filename</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> app</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> new</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Koa</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">use</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">async</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> next</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  try</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> next</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> catch</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">err</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">status</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> err</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">status</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ||</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 500</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> code</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">status</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> message</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> err</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">message</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ||</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Server Error</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">use</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">bodyParser</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">use</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">serve</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">path</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">join</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">__dirname</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">public</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 配置视图目录与模板引擎</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">use</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">views</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">path</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">join</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">__dirname</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">views</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> extension</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">ejs</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">use</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">routes</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">use</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">allowedMethods</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">listen</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">3000</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  console</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">log</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Server running at http://localhost:3000</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  console</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">log</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">   当前阶段：F（支持 EJS 模板渲染）</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span></code></pre>\n<h3 id=\"64-在路由中渲染一个页面\"><a class=\"anchor\" href=\"#64-在路由中渲染一个页面\">#</a> 6.4 在路由中渲染一个页面</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-js\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// routes/index.mjs（阶段F，新增 SSR 路由）</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> Router</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">koa-router</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> router</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> new</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Router</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> prefix</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/api</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// ...前面的接口保留</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// GET /page/home -&gt; 渲染 EJS 模板（注意：此路由无 /api 前缀更合适，这里仅演示）</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">get</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/page/home</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  await</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">render</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">home</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">{</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">    title</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">EJS 模板渲染示例</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">    now</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> new</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Date</span><span style=\"color:#bda437;--shiki-dark:#e6cc77\">(</span><span style=\"color:#bda437;--shiki-dark:#e6cc77\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">toLocaleString</span><span style=\"color:#bda437;--shiki-dark:#e6cc77\">(</span><span style=\"color:#bda437;--shiki-dark:#e6cc77\">)</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">}</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> default</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> router</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span></code></pre>\n<hr>\n<h2 id=\"7-阶段-g逐步rest-化-用内存数组先做-crud\"><a class=\"anchor\" href=\"#7-阶段-g逐步rest-化-用内存数组先做-crud\">#</a> 7. 阶段 G：逐步“REST 化” —— 用内存数组先做 CRUD</h2>\n<blockquote>\n<p>先<strong>不接数据库</strong>，用内存数组模拟数据源，把一套用户资源的 CRUD 接口打通，理解 REST 的路径与方法约定。</p>\n</blockquote>\n<h3 id=\"71-新建-routesusersmjs\"><a class=\"anchor\" href=\"#71-新建-routesusersmjs\">#</a> 7.1 新建 <code>routes/users.mjs</code></h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-js\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// routes/users.mjs（阶段G）</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 目标：实现 RESTful 风格的用户资源接口（内存模拟数据库）</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> Router</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">koa-router</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> router</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> new</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Router</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> prefix</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/api/users</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 用一个内存数组模拟“数据库表”</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> users</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> id</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> name</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Alice</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> age</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 20</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> id</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> name</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Bob</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#998418;--shiki-dark:#B8A965\">   age</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 22</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 工具：生成新ID（简单起见）</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> nextId</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">users</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#998418;--shiki-dark:#B8A965\">length</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ?</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> users</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">users</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#998418;--shiki-dark:#B8A965\">length</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> +</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> :</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// GET /api/users  -&gt; 列表</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">get</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">status</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 200</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> code</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 200</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> data</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> users</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// GET /api/users/:id  -&gt; 详情</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">get</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/:id</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> id</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Number</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">params</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> user</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> users</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">find</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">u</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> u</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ===</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> id</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">!</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">user</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">throw</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">404</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> `</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">用户 </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">${</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">id</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">}</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 不存在</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">`</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> code</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 200</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> data</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> user</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// POST /api/users  -&gt; 新增</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">post</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">request</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ||</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">!</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">name</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ||</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> typeof</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> !==</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">number</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">throw</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">400</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">参数不合法：需要 name(string) 与 age(number)</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> newUser</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> id</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> nextId</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  users</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">push</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">newUser</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">status</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 201</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 201：已创建</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> code</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 201</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> data</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> newUser</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// PUT /api/users/:id  -&gt; 全量更新</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">put</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/:id</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> id</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Number</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">params</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">request</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ||</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> idx</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> users</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">findIndex</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">u</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> u</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ===</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> id</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">idx</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ===</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">throw</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">404</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> `</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">用户 </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">${</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">id</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">}</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 不存在</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">`</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">!</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">name</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ||</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> typeof</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> !==</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">number</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">throw</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">400</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">参数不合法：需要 name 与 age</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  users</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">idx</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> id</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> code</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 200</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> data</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> users</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">[</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">idx</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">]</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// PATCH /api/users/:id -&gt; 部分更新（可选）</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">patch</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/:id</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> id</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Number</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">params</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> patch</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">request</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ||</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> user</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> users</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">find</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">u</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> u</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ===</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> id</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">!</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">user</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">throw</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">404</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> `</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">用户 </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">${</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">id</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">}</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 不存在</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">`</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  Object</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">assign</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">user</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> patch</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> code</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 200</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> data</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> user</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// DELETE /api/users/:id -&gt; 删除</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">delete</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/:id</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> id</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Number</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">params</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> idx</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> users</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">findIndex</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">u</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> u</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ===</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> id</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">idx</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ===</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">throw</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">404</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> `</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">用户 </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">${</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">id</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">}</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 不存在</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">`</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> deleted</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> users</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">splice</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">idx</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> code</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 200</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> data</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> deleted</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> default</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> router</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span></code></pre>\n<h3 id=\"72-在-appmjs-中注册新路由文件\"><a class=\"anchor\" href=\"#72-在-appmjs-中注册新路由文件\">#</a> 7.2 在 <code>app.mjs</code> 中注册新路由文件</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-js\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// app.mjs（阶段G）</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> Koa</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">koa</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> bodyParser</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">koa-bodyparser</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> serve</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">koa-static</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> path</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">path</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> fileURLToPath</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">url</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> baseRouter</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">./routes/index.mjs</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> usersRouter</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">./routes/users.mjs</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> __filename</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> fileURLToPath</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#998418;--shiki-dark:#B8A965\">meta</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">url</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> __dirname</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> path</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">dirname</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">__filename</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> app</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> new</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Koa</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">use</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">async</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> next</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  try</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> next</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> catch</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">err</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">status</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> err</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">status</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ||</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 500</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> code</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">status</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> message</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> err</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">message</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ||</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Server Error</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">use</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">bodyParser</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">use</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">serve</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">path</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">join</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">__dirname</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">public</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 注册多个路由模块</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">use</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">baseRouter</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">routes</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">use</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">baseRouter</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">allowedMethods</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">use</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">usersRouter</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">routes</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">use</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">usersRouter</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">allowedMethods</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">listen</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">3000</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  console</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">log</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Server running at http://localhost:3000</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  console</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">log</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">   当前阶段：G（RESTful 内存版 users 资源）</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span></code></pre>\n<p><strong>测试：</strong></p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 列表</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">curl</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> http://localhost:3000/api/users</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 详情</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">curl</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> http://localhost:3000/api/users/1</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 新增</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">curl</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -X</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> POST</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> http://localhost:3000/api/users</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#A65E2B;--shiki-dark:#C99076\">  -H</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Content-Type: application/json</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#A65E2B;--shiki-dark:#C99076\">  -d</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">{\"name\":\"Carol\",\"age\":28}</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 更新</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">curl</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -X</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> PUT</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> http://localhost:3000/api/users/1</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#A65E2B;--shiki-dark:#C99076\">  -H</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Content-Type: application/json</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#A65E2B;--shiki-dark:#C99076\">  -d</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">{\"name\":\"Alice Updated\",\"age\":21}</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 删除</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">curl</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -X</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> DELETE</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> http://localhost:3000/api/users/2</span></span></code></pre>\n<blockquote>\n<p><strong>补充：CORS</strong><br>\n若前端与后端不在同一域名/端口，需开启 CORS：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">npm</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> i</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> @koa/cors</span></span></code></pre>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-js\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> cors</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">@koa/cors</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">use</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">cors</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span></code></pre>\n</blockquote>\n<h3 id=\"73-如何实现数据库的增删改查cura\"><a class=\"anchor\" href=\"#73-如何实现数据库的增删改查cura\">#</a> 7.3 如何实现数据库的增删改查(CURA)</h3>\n<p>数据库的四个基本功能</p>\n<table>\n<thead>\n<tr>\n<th>方法</th>\n<th>描述</th>\n<th>对应 SQL</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Create</td>\n<td>新增一条记录</td>\n<td>INSERT</td>\n</tr>\n<tr>\n<td>Read</td>\n<td>查询记录</td>\n<td>SELECT</td>\n</tr>\n<tr>\n<td>Update</td>\n<td>更新记录</td>\n<td>UPDATE</td>\n</tr>\n<tr>\n<td>Delete</td>\n<td>删除记录</td>\n<td>DELETE</td>\n</tr>\n</tbody>\n</table>\n<p>在 RESTful API 中，常用 HTTP 方法对应 CRUD：</p>\n<table>\n<thead>\n<tr>\n<th>HTTP 方法</th>\n<th>路径</th>\n<th>CRUD</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>GET</td>\n<td>/api/users</td>\n<td>查询所有用户</td>\n</tr>\n<tr>\n<td>GET</td>\n<td>/api/users/:id</td>\n<td>查询单个用户</td>\n</tr>\n<tr>\n<td>POST</td>\n<td>/api/users</td>\n<td>新增用户</td>\n</tr>\n<tr>\n<td>PUT</td>\n<td>/api/users/:id</td>\n<td>全量更新用户</td>\n</tr>\n<tr>\n<td>PATCH</td>\n<td>/api/users/:id</td>\n<td>部分更新用户</td>\n</tr>\n<tr>\n<td>DELETE</td>\n<td>/api/users/:id</td>\n<td>删除用户</td>\n</tr>\n</tbody>\n</table>\n<p>首先在根目录创建<code>.env</code>文件</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-ini\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">DB_HOST</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">localhost</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">DB_USER</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">root</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">DB_PASSWORD</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">123456</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">DB_NAME</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">testdb</span></span></code></pre>\n<p>创建数据库模块<code>database/mysqldb.mjs</code>:</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-js\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> mysql</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">mysql2/promise</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> dotenv</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">dotenv</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">dotenv</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">config</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 创建连接池</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> pool</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> mysql</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">createPool</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  host</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> process</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">env</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">DB_HOST</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  user</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> process</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">env</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">DB_USER</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  password</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> process</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">env</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">DB_PASSWORD</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  database</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> process</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">env</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">DB_NAME</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  waitForConnections</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> true</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  connectionLimit</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 10</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  queueLimit</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 通用 SQL 查询函数</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> query</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">sql</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> params</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">results</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> pool</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">execute</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">sql</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> params</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  return</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> results</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// ----------------- 用户增删改查 -----------------</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 获取所有用户</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> getAllUsers</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  return</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> query</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">SELECT * FROM users</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 根据 ID 获取用户</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> getUserById</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> results</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> query</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">SELECT * FROM users WHERE id = ?</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  return</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> results</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 新增用户</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> createUser</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> result</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> query</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">INSERT INTO users (name, age) VALUES (?, ?)</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  return</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> id</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> result</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">insertId</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 更新用户</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> updateUser</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  await</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> query</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">UPDATE users SET name = ?, age = ? WHERE id = ?</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> id</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  return</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> id</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 删除用户</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> deleteUser</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> result</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> query</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">DELETE FROM users WHERE id = ?</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  return</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> result</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">affectedRows</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"></span></code></pre>\n<hr>\n<h2 id=\"8-阶段-h重构为-mvcmodel-view-controller分层\"><a class=\"anchor\" href=\"#8-阶段-h重构为-mvcmodel-view-controller分层\">#</a> 8. 阶段 H：重构为 MVC（Model-View-Controller）分层</h2>\n<blockquote>\n<p>现在把“路由里写业务”的代码拆分：<strong>路由仅负责匹配路径</strong>、<strong>Controller 负责接入/出参与校验</strong>、<strong>Service 负责业务</strong>、<strong>Model 负责数据存储</strong>（此处先用内存/假数据，下一步再换 MySQL）。</p>\n</blockquote>\n<h3 id=\"81-目录调整\"><a class=\"anchor\" href=\"#81-目录调整\">#</a> 8.1 目录调整</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-text\"><span class=\"line\"><span>koa-step-by-step/</span></span>\n<span class=\"line\"><span>├─ app.mjs</span></span>\n<span class=\"line\"><span>├─ routes/</span></span>\n<span class=\"line\"><span>│  ├─ index.mjs</span></span>\n<span class=\"line\"><span>│  └─ users.mjs       # 现在只保留路径定义和与 controller 的绑定</span></span>\n<span class=\"line\"><span>├─ controllers/</span></span>\n<span class=\"line\"><span>│  └─ userController.mjs</span></span>\n<span class=\"line\"><span>├─ services/</span></span>\n<span class=\"line\"><span>│  └─ userService.mjs</span></span>\n<span class=\"line\"><span>├─ models/</span></span>\n<span class=\"line\"><span>│  └─ userModel.mjs   # 此阶段仍用内存数组模拟 DB</span></span>\n<span class=\"line\"><span>└─ public/</span></span></code></pre>\n<h3 id=\"82-modelsusermodelmjs数据访问层\"><a class=\"anchor\" href=\"#82-modelsusermodelmjs数据访问层\">#</a> 8.2 <code>models/userModel.mjs</code>（数据访问层）</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-js\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// models/userModel.mjs（阶段H - Model 层）</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">/**</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> * 此处仍然用内存数组模拟数据库。</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> * 下一阶段会把这里的实现换成 MySQL 版本，但对外暴露的方法名尽量保持一致，</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> * 这样 Controller/Service 基本不用改动，实现“可替换的数据层”。</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> */</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> users</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> id</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> name</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Alice</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> age</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 20</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> id</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> name</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Bob</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#998418;--shiki-dark:#B8A965\">   age</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 22</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> nextId</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">users</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#998418;--shiki-dark:#B8A965\">length</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ?</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> users</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">users</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#998418;--shiki-dark:#B8A965\">length</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> +</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> :</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> findAll</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  return</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> users</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> findById</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  return</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> users</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">find</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">u</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> u</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ===</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> id</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ||</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> null</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> create</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> user</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> id</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> nextId</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  users</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">push</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">user</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  return</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> user</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> update</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> idx</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> users</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">findIndex</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">u</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> u</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ===</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> id</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">idx</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ===</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> return</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> null</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  users</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">idx</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> id</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  return</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> users</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">idx</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> patch</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> patchObj</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> user</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> users</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">find</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">u</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> u</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ===</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> id</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">!</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">user</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> return</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> null</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  Object</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">assign</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">user</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> patchObj</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  return</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> user</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> remove</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> idx</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> users</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">findIndex</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">u</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> u</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ===</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> id</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">idx</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ===</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> return</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> null</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  return</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> users</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">splice</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">idx</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span></code></pre>\n<p>直接调用数据库增删改查函数，但保持原来的 RESTful API 路由结构：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-javascript\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// routes/users.mjs（阶段G -&gt; 数据库版）</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 目标：实现 RESTful 风格的用户资源接口，直接操作 MySQL 数据库</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> Router</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">koa-router</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 从 mysqldb.mjs 导入封装好的增删改查函数</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> getAllUsers</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> getUserById</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> createUser</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> updateUser</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> deleteUser</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">../database/mysqldb.mjs</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> router</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> new</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Router</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> prefix</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/api/users</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// ----------------- RESTful 路由 -----------------</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// GET /api/users  -&gt; 获取用户列表</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">get</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  try</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> users</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> getAllUsers</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 调用数据库查询所有用户</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">status</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 200</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> code</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 200</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> data</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> users</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> catch</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">err</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">throw</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">500</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> err</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">message</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// GET /api/users/:id  -&gt; 根据 ID 获取用户详情</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">get</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/:id</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> id</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Number</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">params</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  try</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> user</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> getUserById</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 调用数据库查询单个用户</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">!</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">user</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">{</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">      ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">throw</span><span style=\"color:#bda437;--shiki-dark:#e6cc77\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">404</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> `</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">用户 </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">${</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">id</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">}</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 不存在</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">`</span><span style=\"color:#bda437;--shiki-dark:#e6cc77\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">}</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">status</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 200</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> code</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 200</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> data</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> user</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> catch</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">err</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">throw</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">500</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> err</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">message</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// POST /api/users  -&gt; 新增用户</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">post</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">request</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ||</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">!</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">name</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ||</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> typeof</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> !==</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">number</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">throw</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">400</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">参数不合法：需要 name(string) 与 age(number)</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  try</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> newUser</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> createUser</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 调用数据库新增用户</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">status</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 201</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 201：已创建</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> code</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 201</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> data</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> newUser</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> catch</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">err</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">throw</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">500</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> err</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">message</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// PUT /api/users/:id  -&gt; 全量更新用户</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">put</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/:id</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> id</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Number</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">params</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">request</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ||</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">!</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">name</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ||</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> typeof</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> !==</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">number</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">throw</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">400</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">参数不合法：需要 name(string) 与 age(number)</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  try</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> updatedUser</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> updateUser</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 调用数据库更新</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">status</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 200</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> code</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 200</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> data</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> updatedUser</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> catch</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">err</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">throw</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">500</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> err</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">message</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// PATCH /api/users/:id  -&gt; 部分更新用户</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">patch</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/:id</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> id</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Number</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">params</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> patch</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">request</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ||</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  try</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> existingUser</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> getUserById</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">!</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">existingUser</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">throw</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">404</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> `</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">用户 </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">${</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">id</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">}</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 不存在</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">`</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 合并已有数据与更新数据</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> updatedUser</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> updateUser</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> patch</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">name</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ??</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> existingUser</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> patch</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">age</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ??</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> existingUser</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">age</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">status</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 200</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> code</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 200</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> data</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> updatedUser</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> catch</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">err</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">throw</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">500</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> err</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">message</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// DELETE /api/users/:id  -&gt; 删除用户</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">delete</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/:id</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> id</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Number</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">params</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  try</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> success</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> deleteUser</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">!</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">success</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">throw</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">404</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> `</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">用户 </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">${</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">id</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">}</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 不存在</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">`</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">status</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 200</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> code</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 200</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> message</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> `</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">用户 </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">${</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">id</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">}</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 已删除</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">`</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> catch</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">err</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">throw</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">500</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> err</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">message</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> default</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> router</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span></code></pre>\n<h3 id=\"83-servicesuserservicemjs业务层\"><a class=\"anchor\" href=\"#83-servicesuserservicemjs业务层\">#</a> 8.3 <code>services/userService.mjs</code>（业务层）</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-js\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// services/userService.mjs（阶段H - Service 层）</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">/**</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> * 业务层：进行业务规则校验（示例简单化），</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> * 将 Controller 的输入转为 Model 层所需格式；</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> * 对 Model 输出进行二次处理（如脱敏、聚合等）。</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> */</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> *</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> as</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> User</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">../models/userModel.mjs</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> listUsers</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  return</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> User</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">findAll</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> getUser</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> user</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> User</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">findById</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  return</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> user</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 可添加“脱敏”等处理</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> createUser</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">!</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">name</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ||</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> typeof</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> !==</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">number</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> err</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> new</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Error</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">参数不合法：需要 name(string) 与 age(number)</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    err</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">status</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 400</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    throw</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> err</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  return</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> User</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">create</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> updateUser</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">!</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">name</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ||</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> typeof</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> !==</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">number</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> err</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> new</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Error</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">参数不合法：需要 name 与 age</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    err</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">status</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 400</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    throw</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> err</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> updated</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> User</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">update</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">!</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">updated</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> err</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> new</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Error</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">`</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">用户 </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">${</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">id</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">}</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 不存在</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">`</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    err</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">status</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 404</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    throw</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> err</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  return</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> updated</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> patchUser</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> patchObj</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> updated</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> User</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">patch</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> patchObj</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">!</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">updated</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> err</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> new</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Error</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">`</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">用户 </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">${</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">id</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">}</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 不存在</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">`</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    err</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">status</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 404</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    throw</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> err</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  return</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> updated</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> removeUser</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> deleted</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> User</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">remove</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">!</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">deleted</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> err</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> new</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Error</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">`</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">用户 </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">${</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">id</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">}</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 不存在</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">`</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    err</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">status</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 404</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    throw</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> err</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  return</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> deleted</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span></code></pre>\n<h3 id=\"84-controllersusercontrollermjs控制器层\"><a class=\"anchor\" href=\"#84-controllersusercontrollermjs控制器层\">#</a> 8.4 <code>controllers/userController.mjs</code>（控制器层）</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-js\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// controllers/userController.mjs（阶段H - Controller 层）</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">/**</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> * 控制器：仅负责与 Koa 的 ctx 交互（取参、设响应、设状态码）。</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> * 真正的业务逻辑不写在这里，全部委托给 Service。</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> */</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> *</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> as</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> UserService</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">../services/userService.mjs</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> list</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> data</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> UserService</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">listUsers</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">status</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 200</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> code</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 200</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> data</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> detail</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> id</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Number</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">params</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> data</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> UserService</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">getUser</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">!</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">data</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">throw</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">404</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> `</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">用户 </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">${</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">id</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">}</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 不存在</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">`</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> code</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 200</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> data</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> create</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">request</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ||</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> data</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> UserService</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">createUser</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">status</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 201</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> code</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 201</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> data</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> update</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> id</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Number</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">params</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">request</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ||</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> data</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> UserService</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">updateUser</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> code</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 200</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> data</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> patch</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> id</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Number</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">params</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> patchObj</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">request</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ||</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> data</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> UserService</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">patchUser</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> patchObj</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> code</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 200</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> data</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> remove</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> id</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Number</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">params</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> data</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> UserService</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">removeUser</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> code</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 200</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> data</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span></code></pre>\n<h3 id=\"85-routesusersmjs只负责绑定路径到-controller\"><a class=\"anchor\" href=\"#85-routesusersmjs只负责绑定路径到-controller\">#</a> 8.5 <code>routes/users.mjs</code>（只负责绑定路径到 Controller）</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-js\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// routes/users.mjs（阶段H）</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> Router</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">koa-router</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> *</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> as</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> UserController</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">../controllers/userController.mjs</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> router</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> new</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Router</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> prefix</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/api/users</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">get</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">     UserController</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">list</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">get</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/:id</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  UserController</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">detail</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">post</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    UserController</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">create</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">put</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/:id</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  UserController</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">update</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">patch</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/:id</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">UserController</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">patch</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">delete</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/:id</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> UserController</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">remove</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> default</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> router</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span></code></pre>\n<blockquote>\n<p>至此，已经是一个<strong>结构清晰</strong>的 REST + MVC（无数据库版）。</p>\n</blockquote>\n<hr>\n<h2 id=\"9-阶段-i把-model-换成-mysqlmysql2promise-连接池\"><a class=\"anchor\" href=\"#9-阶段-i把-model-换成-mysqlmysql2promise-连接池\">#</a> 9. 阶段 I：把 Model 换成 MySQL（mysql2/promise + 连接池）</h2>\n<h3 id=\"91-安装依赖\"><a class=\"anchor\" href=\"#91-安装依赖\">#</a> 9.1 安装依赖</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">npm</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> i</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> mysql2</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> dotenv</span></span></code></pre>\n<h3 id=\"92-新增-databasemysqlmjs连接池与-query-封装\"><a class=\"anchor\" href=\"#92-新增-databasemysqlmjs连接池与-query-封装\">#</a> 9.2 新增 <code>database/mysql.mjs</code>（连接池与 query 封装）</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-js\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// database/mysql.mjs（阶段I - 数据库基础封装）</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> mysql</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">mysql2/promise</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> dotenv</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">dotenv</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">dotenv</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">config</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 读取 .env</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 创建连接池（推荐生产环境使用连接池，而非单连接）</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> pool</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> mysql</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">createPool</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  host</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">     process</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">env</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">DB_HOST</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ||</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">localhost</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  user</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">     process</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">env</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">DB_USER</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ||</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">root</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  password</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> process</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">env</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">DB_PASSWORD</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ||</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">123456</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  database</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> process</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">env</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">DB_NAME</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ||</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">testdb</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  port</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#59873A;--shiki-dark:#80A665\">     Number</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">process</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">env</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">DB_PORT</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ||</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 3306</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  waitForConnections</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> true</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  connectionLimit</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 10</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  queueLimit</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 统一的 SQL 执行函数：自动格式化参数，返回 rows</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> query</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">sql</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> params</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">rows</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> pool</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">execute</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">sql</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> params</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  return</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> rows</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span></code></pre>\n<h3 id=\"93-在项目根目录创建-env\"><a class=\"anchor\" href=\"#93-在项目根目录创建-env\">#</a> 9.3 在项目根目录创建 <code>.env</code></h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-text\"><span class=\"line\"><span>DB_HOST=localhost</span></span>\n<span class=\"line\"><span>DB_PORT=3306</span></span>\n<span class=\"line\"><span>DB_USER=root</span></span>\n<span class=\"line\"><span>DB_PASSWORD=123456</span></span>\n<span class=\"line\"><span>DB_NAME=testdb</span></span></code></pre>\n<h3 id=\"94-初始化数据表一次性\"><a class=\"anchor\" href=\"#94-初始化数据表一次性\">#</a> 9.4 初始化数据表（一次性）</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-sql\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">CREATE</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> TABLE</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> IF</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> NOT</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> EXISTS</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> users </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">  id   </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">INT</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> AUTO_INCREMENT </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">PRIMARY KEY</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  name</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> VARCHAR</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">50</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">NOT NULL</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">  age  </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">INT</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> NOT NULL</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">  created_at </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">TIMESTAMP</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> DEFAULT</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> CURRENT_TIMESTAMP</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span></code></pre>\n<h3 id=\"95-重写-modelsusermodelmjs-为-mysql-实现\"><a class=\"anchor\" href=\"#95-重写-modelsusermodelmjs-为-mysql-实现\">#</a> 9.5 重写 <code>models/userModel.mjs</code> 为 MySQL 实现</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-js\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// models/userModel.mjs（阶段I - MySQL 版本 Model 层）</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> query</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">../database/mysql.mjs</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> findAll</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  // 返回全部用户</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  return</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> query</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">SELECT id, name, age, created_at FROM users ORDER BY id ASC</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> findById</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> rows</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> query</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">SELECT id, name, age, created_at FROM users WHERE id = ?</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  return</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> rows</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ||</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> null</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> create</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  // 使用 ? 占位符防止 SQL 注入</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> result</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> query</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">INSERT INTO users (name, age) VALUES (?, ?)</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  // 插入成功后返回新记录</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> inserted</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> findById</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">result</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">insertId</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  return</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> inserted</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> update</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> result</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> query</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">UPDATE users SET name = ?, age = ? WHERE id = ?</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> id</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">result</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">affectedRows</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ===</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> return</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> null</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  return</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> findById</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> patch</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> patchObj</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  // 动态拼接字段（示例简化，仅允许 name/age）</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> fields</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> params</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">patchObj</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">name</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> !==</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> undefined</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> fields</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">push</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">name = ?</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> params</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">push</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">patchObj</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">name</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">patchObj</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">age</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> !==</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> undefined</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> fields</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">push</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">age = ?</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  params</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">push</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">patchObj</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">age</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">fields</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#998418;--shiki-dark:#B8A965\">length</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ===</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> return</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> findById</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 无变化</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  params</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">push</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> sql</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> `</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">UPDATE users SET </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">${</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">fields</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">join</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">, </span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">}</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> WHERE id = ?</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">`</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> result</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> query</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">sql</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> params</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">result</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">affectedRows</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ===</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> return</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> null</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  return</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> findById</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> remove</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> toDelete</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> findById</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">!</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">toDelete</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> return</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> null</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> result</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> query</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">DELETE FROM users WHERE id = ?</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">result</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">affectedRows</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ===</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> return</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> null</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  return</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> toDelete</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span></code></pre>\n<blockquote>\n<p><strong>无感替换数据层</strong>：我们没有改 Controller/Service 的代码，因为它们的调用接口未变。这就是解耦的好处。</p>\n</blockquote>\n<h3 id=\"96-运行与测试\"><a class=\"anchor\" href=\"#96-运行与测试\">#</a> 9.6 运行与测试</h3>\n<ol>\n<li>确认本机 MySQL 已启动，并在 <code>.env</code> 中配置正确；</li>\n<li>执行上面的建表 SQL；</li>\n<li>启动服务：<code>npm run dev</code>；</li>\n<li>使用前文的 <code>curl</code> 测试 CRUD 接口；现在数据真实写入 MySQL！</li>\n</ol>\n<hr>\n<h2 id=\"10-阶段-j额外增强可选但常用\"><a class=\"anchor\" href=\"#10-阶段-j额外增强可选但常用\">#</a> 10. 阶段 J：额外增强（可选但常用）</h2>\n<h3 id=\"101-cors跨域\"><a class=\"anchor\" href=\"#101-cors跨域\">#</a> 10.1 CORS（跨域）</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">npm</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> i</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> @koa/cors</span></span></code></pre>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-js\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> cors</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">@koa/cors</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">use</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">cors</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> origin</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">*</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 生产建议更精细控制</span></span></code></pre>\n<h3 id=\"102-请求参数校验轻量示例\"><a class=\"anchor\" href=\"#102-请求参数校验轻量示例\">#</a> 10.2 请求参数校验（轻量示例）</h3>\n<blockquote>\n<p>在 Service 层已经有简单校验；进一步可以使用 <code>zod</code>, <code>joi</code>, <code>yup</code> 等库统一校验。</p>\n</blockquote>\n<h3 id=\"103-分页-模糊查询以-mysql-为例改造-model\"><a class=\"anchor\" href=\"#103-分页-模糊查询以-mysql-为例改造-model\">#</a> 10.3 分页 &amp; 模糊查询（以 MySQL 为例，改造 Model）</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-js\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 示例：分页查询（page 从 1 开始）</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> findPaged</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> page</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> pageSize</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 10</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> keyword</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> ''</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> offset</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">page</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> pageSize</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> where</span><span style=\"color:#999999;--shiki-dark:#666666\">  =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> keyword</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ?</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">WHERE name LIKE ?</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> :</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> ''</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> params</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> keyword</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ?</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">`</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">%</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">${</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">keyword</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">}</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">%</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">`</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> pageSize</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> offset</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> :</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">pageSize</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> offset</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> rows</span><span style=\"color:#999999;--shiki-dark:#666666\">   =</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> query</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span></span>\n<span class=\"line\"><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">    `</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">SELECT id, name, age, created_at FROM users </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">${</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">where</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">}</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ORDER BY id ASC LIMIT ? OFFSET ?</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">`</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    params</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> totalRows</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> query</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span></span>\n<span class=\"line\"><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">    `</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">SELECT COUNT(*) AS c FROM users </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">${</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">keyword </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">?</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">WHERE name LIKE ?</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> :</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> ''</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">}</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">`</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    keyword</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ?</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">`</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">%</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">${</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">keyword</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">}</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">%</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">`</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> :</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  return</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> list</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> rows</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> total</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> totalRows</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">c</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> page</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> pageSize</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span></code></pre>\n<hr>\n<h2 id=\"11-常见坑位排查faq\"><a class=\"anchor\" href=\"#11-常见坑位排查faq\">#</a> 11. 常见坑位排查（FAQ）</h2>\n<ul>\n<li><strong><code>SyntaxError: Cannot use import statement outside a module</code></strong>\n<ul>\n<li><code>package.json</code> 是否含 <code>\"type\":\"module\"</code>？或者文件是否使用 <code>.mjs</code>？</li>\n</ul>\n</li>\n<li><strong><code>Error: Cannot find module 'xxx'</code></strong>\n<ul>\n<li>依赖没装或装在了错误目录：执行 <code>npm i xxx</code>，确保命令行的当前目录正确。</li>\n</ul>\n</li>\n<li><strong><code>ctx.request.body</code> 是 <code>undefined</code></strong>\n<ul>\n<li>是否 <code>app.use(bodyParser())</code> 放在了路由前面？是否设置了正确的 <code>Content-Type</code>？</li>\n</ul>\n</li>\n<li><strong>中文乱码</strong>\n<ul>\n<li>前端/客户端请求与响应头编码问题；确保响应头 <code>Content-Type</code> 与实际内容一致（Koa 会自动根据 <code>ctx.body</code> 设定）。</li>\n</ul>\n</li>\n<li><strong>MySQL 连接失败</strong>\n<ul>\n<li>检查 <code>.env</code> 配置、数据库是否启动、端口是否被占用、防火墙、权限是否允许远程连接。</li>\n</ul>\n</li>\n</ul>\n<hr>\n<h2 id=\"12-最终项目结构参考到阶段-i-为止\"><a class=\"anchor\" href=\"#12-最终项目结构参考到阶段-i-为止\">#</a> 12. 最终项目结构参考（到阶段 I 为止）</h2>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-text\"><span class=\"line\"><span>koa-step-by-step/</span></span>\n<span class=\"line\"><span>├─ app.mjs</span></span>\n<span class=\"line\"><span>├─ public/</span></span>\n<span class=\"line\"><span>│  └─ index.html</span></span>\n<span class=\"line\"><span>├─ views/                # 若使用模板渲染</span></span>\n<span class=\"line\"><span>│  └─ home.ejs</span></span>\n<span class=\"line\"><span>├─ routes/</span></span>\n<span class=\"line\"><span>│  ├─ index.mjs</span></span>\n<span class=\"line\"><span>│  ├─ users.mjs</span></span>\n<span class=\"line\"><span>├─ controllers/</span></span>\n<span class=\"line\"><span>│  └─ userController.mjs</span></span>\n<span class=\"line\"><span>├─ services/</span></span>\n<span class=\"line\"><span>│  └─ userService.mjs</span></span>\n<span class=\"line\"><span>├─ models/</span></span>\n<span class=\"line\"><span>│  └─ userModel.mjs      # 阶段H：内存; 阶段I：MySQL</span></span>\n<span class=\"line\"><span>├─ database/</span></span>\n<span class=\"line\"><span>│  └─ mysql.mjs</span></span>\n<span class=\"line\"><span>├─ .env</span></span>\n<span class=\"line\"><span>└─ package.json</span></span></code></pre>\n<hr>\n<h2 id=\"13-一句话回顾每个阶段\"><a class=\"anchor\" href=\"#13-一句话回顾每个阶段\">#</a> 13. 一句话回顾每个阶段</h2>\n<ul>\n<li><strong>A</strong>：只有一个文件的“Hello Koa”</li>\n<li><strong>B</strong>：加上 <code>koa-router</code>，不同路径返回不同内容</li>\n<li><strong>C</strong>：解析请求体，拥有第一个 POST 接口</li>\n<li><strong>D</strong>：全局错误处理 + 访问日志，理解“洋葱模型”</li>\n<li><strong>E</strong>：静态资源与 favicon</li>\n<li><strong>F</strong>：（可选）EJS 模板渲染</li>\n<li><strong>G</strong>：RESTful 内存版 users 资源（CRUD）</li>\n<li><strong>H</strong>：重构为 MVC（Controller/Service/Model 分层）</li>\n<li><strong>I</strong>：替换 Model → MySQL（真实落库）</li>\n<li><strong>J</strong>：加强：CORS、校验、分页等</li>\n</ul>\n",
            "tags": [
                "Koa",
                "backen",
                "nodejs"
            ]
        },
        {
            "id": "https://koen666.github.io/2025/08/18/latex_2/",
            "url": "https://koen666.github.io/2025/08/18/latex_2/",
            "title": "Latex全语法使用",
            "date_published": "2025-08-18T09:20:00.000Z",
            "content_html": "<h2 id=\"1-latex-文档基本格式\"><a class=\"anchor\" href=\"#1-latex-文档基本格式\">#</a> 1. LaTeX 文档基本格式</h2>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-latex\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">documentclass</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\">article</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">   % 文档类型：article, report, book, beamer 等</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">usepackage</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">utf8</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\">inputenc</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> % 支持中文时建议用 ctex 包</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">usepackage</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\">amsmath, amssymb</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> % 数学符号扩展</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">usepackage</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\">graphicx</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> % 插入图片</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">usepackage</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\">listings</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> % 插入代码</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">usepackage</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\">xcolor</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">   % 代码高亮需要颜色</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">usepackage</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\">hyperref</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> % 超链接</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">title</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">LaTeX 学习示例</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">author</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">你的名字</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">date</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">today</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">begin</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">document</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  % 正文开始</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">maketitle</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  % 输出标题</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">section</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#59873A;--shiki-dark:#80A665\">引言</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">这是 LaTeX 的一个简单示例。</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">end</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">document</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span></code></pre>\n<blockquote>\n<p><strong>说明</strong>：</p>\n</blockquote>\n<ul>\n<li><code>\\documentclass{article}</code> 定义了文档类型。</li>\n<li><code>\\usepackage{}</code> 用来导入扩展包。</li>\n<li><code>\\section{}</code> 表示章节。</li>\n<li><code>\\maketitle</code> 会根据上面 <code>\\title</code>、<code>\\author</code>、<code>\\date</code> 生成标题页。</li>\n</ul>\n<hr>\n<h2 id=\"2-数学公式\"><a class=\"anchor\" href=\"#2-数学公式\">#</a> 2. 数学公式</h2>\n<p>LaTeX 在数学公式排版方面很强大。</p>\n<h3 id=\"21-行内公式\"><a class=\"anchor\" href=\"#21-行内公式\">#</a> 2.1 行内公式</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-latex\"><span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">这是一个行内公式：</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">$</span><span style=\"color:#998418;--shiki-dark:#B8A965\">E=mc</span><span style=\"color:#999999;--shiki-dark:#666666\">^</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">$</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">。</span></span></code></pre>\n<h3 id=\"22-独立公式\"><a class=\"anchor\" href=\"#22-独立公式\">#</a> 2.2 独立公式</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-latex\"><span class=\"line\"><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\\</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">E = mc</span><span style=\"color:#999999;--shiki-dark:#666666\">^</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">2</span></span>\n<span class=\"line\"><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\\</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span></span></code></pre>\n<h3 id=\"23-多行公式-amsmath-提供\"><a class=\"anchor\" href=\"#23-多行公式-amsmath-提供\">#</a> 2.3 多行公式 (amsmath 提供)</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-latex\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">begin</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">align</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">a</span><span style=\"color:#999999;--shiki-dark:#666666\">^</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"color:#999999;--shiki-dark:#666666\"> +</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> b</span><span style=\"color:#999999;--shiki-dark:#666666\">^</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> &amp;</span><span style=\"color:#998418;--shiki-dark:#B8A965\">= c</span><span style=\"color:#999999;--shiki-dark:#666666\">^</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> \\\\</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">e</span><span style=\"color:#999999;--shiki-dark:#666666\">^</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\">i</span><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">pi</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span><span style=\"color:#999999;--shiki-dark:#666666\"> +</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> &amp;</span><span style=\"color:#998418;--shiki-dark:#B8A965\">= </span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">end</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">align</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span></code></pre>\n<hr>\n<h2 id=\"3-插入图片\"><a class=\"anchor\" href=\"#3-插入图片\">#</a> 3. 插入图片</h2>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-latex\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">begin</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">figure</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">h</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    \\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">centering</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    \\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">includegraphics</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">width=0.5</span><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">textwidth</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">example.png</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    \\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">caption</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">这是一个示例图片</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    \\</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">label</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">fig:example</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">end</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">figure</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span></code></pre>\n<blockquote>\n<p><strong>说明</strong>：</p>\n</blockquote>\n<ul>\n<li><code>example.png</code> 必须和 <code>.tex</code> 文件在同一目录。</li>\n<li><code>width=0.5\\textwidth</code> 控制大小。</li>\n<li><code>\\caption</code> 是图注，<code>\\label</code> 用来引用。</li>\n<li>之后可用 <code>见图~\\ref{fig:example}</code> 来自动编号。</li>\n</ul>\n<hr>\n<h2 id=\"4-插入代码\"><a class=\"anchor\" href=\"#4-插入代码\">#</a> 4. 插入代码</h2>\n<p>LaTeX 用 <code>listings</code> 包来展示代码：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-latex\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">begin</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">lstlisting</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">language=Python, caption=Python 示例, label=</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">lst:py</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">def hello</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">:</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    print</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">\"Hello, LaTeX!\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">end</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">lstlisting</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span></code></pre>\n<blockquote>\n<p><strong>说明</strong>：</p>\n</blockquote>\n<ul>\n<li><code>language=Python</code> 可以换成 <code>C</code>, <code>C++</code>, <code>Java</code> 等。</li>\n<li><code>caption</code> 给代码块加标题，<code>label</code> 方便引用。</li>\n</ul>\n<p>还可以加颜色主题：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-latex\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">lstset</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">  basicstyle=</span><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">ttfamily</span><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">small</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">  keywordstyle=</span><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">color</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">blue</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">  commentstyle=</span><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">color</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">green!50!black</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">  stringstyle=</span><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">color</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">red</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">  numbers=left,</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">  numberstyle=</span><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">tiny</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">  frame=single,</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">  breaklines=true</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span></code></pre>\n<hr>\n<h2 id=\"5-表格\"><a class=\"anchor\" href=\"#5-表格\">#</a> 5. 表格</h2>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-latex\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">begin</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">table</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">h</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    \\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">centering</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    \\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">begin</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">tabular</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">|c|c|c|</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">        \\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">hline</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">        姓名 </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">&amp;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> 年龄 </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">&amp;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> 成绩 </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">\\\\</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">        \\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">hline</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">        张三 </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">&amp;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> 18 </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">&amp;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> 95 </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">\\\\</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">        李四 </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">&amp;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> 19 </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">&amp;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> 88 </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">\\\\</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">        \\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">hline</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    \\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">end</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">tabular</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    \\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">caption</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">学生信息表</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    \\</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">label</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">tab:student</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">end</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">table</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span></code></pre>\n<hr>\n<h2 id=\"6-超链接\"><a class=\"anchor\" href=\"#6-超链接\">#</a> 6. 超链接</h2>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-latex\"><span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">\\href</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">https://www.latex-project.org</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">LaTeX 官网</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span></code></pre>\n<hr>\n<h2 id=\"7-中文支持\"><a class=\"anchor\" href=\"#7-中文支持\">#</a> 7. 中文支持</h2>\n<p>如果你写中文文档，建议用 <code>ctex</code> 包：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-latex\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">documentclass</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\">ctexart</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  % 代替 article，更好支持中文</span></span></code></pre>\n<p>这样就能直接写中文了。</p>\n<hr>\n<h2 id=\"8有序列表和无序列表\"><a class=\"anchor\" href=\"#8有序列表和无序列表\">#</a> 8.有序列表和无序列表</h2>\n<h3 id=\"81-无序列表itemize\"><a class=\"anchor\" href=\"#81-无序列表itemize\">#</a> 8.1 无序列表（itemize）</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-latex\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">begin</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">itemize</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    \\</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">item</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> 这是第一点</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    \\</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">item</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> 这是第二点</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    \\</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">item</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> 这是第三点</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">end</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">itemize</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span></code></pre>\n<p>默认显示为黑色小圆点：</p>\n<ul>\n<li>这是第一点</li>\n<li>这是第二点</li>\n<li>这是第三点</li>\n</ul>\n<h3 id=\"82-有序列表enumerate\"><a class=\"anchor\" href=\"#82-有序列表enumerate\">#</a> 8.2 有序列表（enumerate）</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-latex\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">begin</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">enumerate</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    \\</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">item</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> 这是第一点</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    \\</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">item</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> 这是第二点</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    \\</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">item</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> 这是第三点</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">end</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">enumerate</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span></code></pre>\n<p>默认显示为数字编号：</p>\n<ol>\n<li>这是第一点</li>\n<li>这是第二点</li>\n<li>这是第三点</li>\n</ol>\n<h3 id=\"83-自定义编号样式\"><a class=\"anchor\" href=\"#83-自定义编号样式\">#</a> 8.3 自定义编号样式</h3>\n<p>借助 <code>enumitem</code> 包可以更灵活：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-latex\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">usepackage</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\">enumitem</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">begin</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">enumerate</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">label=</span><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">roman</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">*.</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  % 罗马数字</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    \\</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">item</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> 第一条</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    \\</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">item</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> 第二条</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">end</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">enumerate</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">begin</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">enumerate</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">label=</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">alph</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">*</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  % 小写字母</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    \\</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">item</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> 第一条</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    \\</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">item</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> 第二条</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">end</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">enumerate</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span></code></pre>\n<p>结果会变成：</p>\n<ul>\n<li>(i), (ii), (iii)...</li>\n<li>(a), (b), (c)...</li>\n</ul>\n<h3 id=\"84-无编号列表只换行没有点数字\"><a class=\"anchor\" href=\"#84-无编号列表只换行没有点数字\">#</a> 8.4 无编号列表（只换行，没有点/数字）</h3>\n<p>如果你只是想 <strong>逐行列出</strong>，但不要前面的符号，可以用 <code>description</code> 或者自定义环境：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-latex\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">begin</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">itemize</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">label=</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> % label={} 表示不要符号</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    \\</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">item</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> 第一行</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    \\</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">item</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> 第二行</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    \\</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">item</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> 第三行</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">end</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">itemize</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span></code></pre>\n<p>或者更简单：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-latex\"><span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">第一点 </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">\\\\</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">第二点 </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">\\\\</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">第三点</span></span></code></pre>\n<p>（这里 <code>\\\\</code> 表示换行）</p>\n<h2 id=\"9-bibtex-使用\"><a class=\"anchor\" href=\"#9-bibtex-使用\">#</a> 9. BibTeX 使用</h2>\n<p>在学术写作中，<strong>参考文献管理</strong>是必不可少的。LaTeX 提供了 <code>BibTeX</code> 来管理参考文献，它的好处是：</p>\n<ul>\n<li>文献集中存放在一个 <code>.bib</code> 文件里，方便复用；</li>\n<li>可以自动格式化（APA, IEEE, GB/T 7714 等）；</li>\n<li>引用时只需 <code>\\cite{}</code> 即可，省去手动编号。</li>\n</ul>\n<h3 id=\"91-建立-bib-文件\"><a class=\"anchor\" href=\"#91-建立-bib-文件\">#</a> 9.1 建立 <code>.bib</code> 文件</h3>\n<p>新建一个 <code>refs.bib</code> 文件，里面存放参考文献信息。常见条目类型有：</p>\n<ul>\n<li><code>@article</code>：期刊文章</li>\n<li><code>@book</code>：书籍</li>\n<li><code>@inproceedings</code>：会议论文</li>\n<li><code>@misc</code>：其他（网页、报JavaScript (ES6) code snippets告等）</li>\n</ul>\n<p><strong>示例：refs.bib</strong></p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bibtex\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">@</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">article</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">einstein1905</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  author</span><span style=\"color:#999999;--shiki-dark:#666666\">    =</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Albert Einstein</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  title</span><span style=\"color:#999999;--shiki-dark:#666666\">     =</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Zur Elektrodynamik bewegter Körper</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  journal</span><span style=\"color:#999999;--shiki-dark:#666666\">   =</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Annalen der Physik</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  volume</span><span style=\"color:#999999;--shiki-dark:#666666\">    =</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">17</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  number</span><span style=\"color:#999999;--shiki-dark:#666666\">    =</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">10</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  pages</span><span style=\"color:#999999;--shiki-dark:#666666\">     =</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">891--921</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  year</span><span style=\"color:#999999;--shiki-dark:#666666\">      =</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">1905</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  publisher</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Wiley</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">@</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">book</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">knuth1984</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  author</span><span style=\"color:#999999;--shiki-dark:#666666\">    =</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Donald E. Knuth</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  title</span><span style=\"color:#999999;--shiki-dark:#666666\">     =</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">The TeXbook</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  year</span><span style=\"color:#999999;--shiki-dark:#666666\">      =</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">1984</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  publisher</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Addison-Wesley</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">@</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">misc</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">latexproject</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  author</span><span style=\"color:#999999;--shiki-dark:#666666\">    =</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">LaTeX Project</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  title</span><span style=\"color:#999999;--shiki-dark:#666666\">     =</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">LaTeX Project Website</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  year</span><span style=\"color:#999999;--shiki-dark:#666666\">      =</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">2025</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  url</span><span style=\"color:#999999;--shiki-dark:#666666\">       =</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">https://www.latex-project.org/</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span></code></pre>\n<h3 id=\"92-在主-tex-文件中引用\"><a class=\"anchor\" href=\"#92-在主-tex-文件中引用\">#</a> 9.2 在主 <code>.tex</code> 文件中引用</h3>\n<p>在你的 <code>main.tex</code> 中：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-latex\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">documentclass</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\">article</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">usepackage</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">utf8</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\">inputenc</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">usepackage</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\">cite</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">   % 文献引用宏包</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">usepackage</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\">hyperref</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> % 让文献引用可点击</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">begin</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">document</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">爱因斯坦的相对论论文发表于1905年~</span><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">cite</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">einstein1905</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">。</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">LaTeX</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> 的官方文档在~</span><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">cite</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">latexproject</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> 可以找到。</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">% 生成参考文献</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">bibliographystyle</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">plain</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">   </span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">% 参考文献格式：plain, unsrt, abbrv, ieeetr 等</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">bibliography</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">refs</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">         </span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">% refs.bib 文件名，不要写扩展名</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">end</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">document</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span></code></pre>\n<h3 id=\"93-编译流程\"><a class=\"anchor\" href=\"#93-编译流程\">#</a> 9.3 编译流程</h3>\n<p>和普通 <code>.tex</code> 不同，使用 <code>bibtex</code> 时要多一步：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">pdflatex</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> main.tex</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">bibtex</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> main</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">pdflatex</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> main.tex</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">pdflatex</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> main.tex</span></span></code></pre>\n<p>解释：</p>\n<ol>\n<li>第一次 <code>pdflatex</code> 会扫描引用并生成 <code>.aux</code> 文件；</li>\n<li><code>bibtex main</code> 会读取 <code>.aux</code> 文件，从 <code>refs.bib</code> 抽取对应条目生成 <code>.bbl</code> 文件；</li>\n<li>再跑两次 <code>pdflatex</code> 让引用编号和文献列表都正确显示。</li>\n</ol>\n<h3 id=\"94-常见参考文献样式\"><a class=\"anchor\" href=\"#94-常见参考文献样式\">#</a> 9.4 常见参考文献样式</h3>\n<ul>\n<li><code>plain</code>：作者字母顺序，数字编号</li>\n<li><code>unsrt</code>：按引用顺序编号</li>\n<li><code>abbrv</code>：作者名缩写</li>\n<li><code>ieeetr</code>：IEEE 风格</li>\n<li><code>apalike</code>：APA 风格</li>\n</ul>\n<p>例如：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-latex\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">bibliographystyle</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">ieeetr</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span></code></pre>\n<h3 id=\"95-中文参考文献\"><a class=\"anchor\" href=\"#95-中文参考文献\">#</a> 9.5 中文参考文献</h3>\n<p>中文参考文献推荐用 <strong>GB/T 7714 样式</strong>（国标）：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-latex\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">usepackage</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">backend=bibtex,style=gb7714-2015</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\">biblatex</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">bibliography</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">refs</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span></code></pre>\n<p>然后在 <code>.bib</code> 文件里可以写中文，例如：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bibtex\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">@</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">book</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">li2020</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  author</span><span style=\"color:#999999;--shiki-dark:#666666\">    =</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">李四 and 张三</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  title</span><span style=\"color:#999999;--shiki-dark:#666666\">     =</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">深度学习导论</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  year</span><span style=\"color:#999999;--shiki-dark:#666666\">      =</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">2020</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  publisher</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">清华大学出版社</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span></code></pre>\n<p>这样就能自动生成符合国标的中文参考文献。</p>\n",
            "tags": [
                "math",
                "latex"
            ]
        },
        {
            "id": "https://koen666.github.io/2025/08/11/scipy/",
            "url": "https://koen666.github.io/2025/08/11/scipy/",
            "title": "scipy基本模块及其使用",
            "date_published": "2025-08-11T05:50:14.009Z",
            "content_html": "<h2 id=\"一-常量模块constants\"><a class=\"anchor\" href=\"#一-常量模块constants\">#</a> 一、常量模块(constants)</h2>\n<p>以下是 <code>scipy.constants</code> 模块中主要常量的分类表格：</p>\n<hr>\n<h3 id=\"11-数学常数\"><a class=\"anchor\" href=\"#11-数学常数\">#</a> <strong>1.1 数学常数</strong></h3>\n<table>\n<thead>\n<tr>\n<th>常量名</th>\n<th>描述</th>\n<th>值 (近似)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>pi</code></td>\n<td>圆周率 π</td>\n<td>3.141592653589793</td>\n</tr>\n<tr>\n<td><code>golden</code></td>\n<td>黄金比例 (φ)</td>\n<td>1.618033988749895</td>\n</tr>\n<tr>\n<td><code>e</code></td>\n<td>自然对数的底 (e)</td>\n<td>2.718281828459045</td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h3 id=\"12-通用物理常数\"><a class=\"anchor\" href=\"#12-通用物理常数\">#</a> <strong>1.2 通用物理常数</strong></h3>\n<table>\n<thead>\n<tr>\n<th>常量名</th>\n<th>描述</th>\n<th>值 (单位)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>c</code></td>\n<td>真空光速</td>\n<td>299792458.0 m/s</td>\n</tr>\n<tr>\n<td><code>h</code></td>\n<td>普朗克常数</td>\n<td>6.62607015e-34 J·s</td>\n</tr>\n<tr>\n<td><code>hbar</code></td>\n<td>约化普朗克常数 (h/2π)</td>\n<td>1.054571817e-34 J·s</td>\n</tr>\n<tr>\n<td><code>G</code></td>\n<td>万有引力常数</td>\n<td>6.67430e-11 m³/(kg·s²)</td>\n</tr>\n<tr>\n<td><code>g</code></td>\n<td>标准重力加速度</td>\n<td>9.80665 m/s²</td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h3 id=\"13-电磁学常数\"><a class=\"anchor\" href=\"#13-电磁学常数\">#</a> <strong>1.3 电磁学常数</strong></h3>\n<table>\n<thead>\n<tr>\n<th>常量名</th>\n<th>描述</th>\n<th>值 (单位)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>mu_0</code></td>\n<td>真空磁导率</td>\n<td>1.25663706212e-6 N/A²</td>\n</tr>\n<tr>\n<td><code>epsilon_0</code></td>\n<td>真空电容率</td>\n<td>8.8541878128e-12 F/m</td>\n</tr>\n<tr>\n<td><code>e</code> (或 <code>elementary_charge</code>)</td>\n<td>元电荷</td>\n<td>1.602176634e-19 C</td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h3 id=\"14-原子与核物理常数\"><a class=\"anchor\" href=\"#14-原子与核物理常数\">#</a> <strong>1.4 原子与核物理常数</strong></h3>\n<table>\n<thead>\n<tr>\n<th>常量名</th>\n<th>描述</th>\n<th>值 (单位)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>m_e</code></td>\n<td>电子质量</td>\n<td>9.1093837015e-31 kg</td>\n</tr>\n<tr>\n<td><code>m_p</code></td>\n<td>质子质量</td>\n<td>1.67262192369e-27 kg</td>\n</tr>\n<tr>\n<td><code>m_n</code></td>\n<td>中子质量</td>\n<td>1.67492749804e-27 kg</td>\n</tr>\n<tr>\n<td><code>Rydberg</code></td>\n<td>里德伯常数</td>\n<td>10973731.568160 1/m</td>\n</tr>\n<tr>\n<td><code>alpha</code></td>\n<td>精细结构常数</td>\n<td>0.0072973525693</td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h3 id=\"15-化学相关常数\"><a class=\"anchor\" href=\"#15-化学相关常数\">#</a> <strong>1.5 化学相关常数</strong></h3>\n<table>\n<thead>\n<tr>\n<th>常量名</th>\n<th>描述</th>\n<th>值 (单位)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>N_A</code></td>\n<td>阿伏伽德罗常数</td>\n<td>6.02214076e23 1/mol</td>\n</tr>\n<tr>\n<td><code>R</code></td>\n<td>通用气体常数</td>\n<td>8.314462618 J/(mol·K)</td>\n</tr>\n<tr>\n<td><code>atomic_mass</code></td>\n<td>原子质量单位 (u)</td>\n<td>1.66053906660e-27 kg</td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h3 id=\"16-常用单位换算因子\"><a class=\"anchor\" href=\"#16-常用单位换算因子\">#</a> <strong>1.6 常用单位换算因子</strong></h3>\n<table>\n<thead>\n<tr>\n<th>常量名</th>\n<th>描述</th>\n<th>换算关系</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>inch</code></td>\n<td>英寸 → 米</td>\n<td>0.0254 m</td>\n</tr>\n<tr>\n<td><code>foot</code></td>\n<td>英尺 → 米</td>\n<td>0.3048 m</td>\n</tr>\n<tr>\n<td><code>mile</code></td>\n<td>英里 → 米</td>\n<td>1609.344 m</td>\n</tr>\n<tr>\n<td><code>lb</code></td>\n<td>磅 → 千克</td>\n<td>0.45359237 kg</td>\n</tr>\n<tr>\n<td><code>eV</code></td>\n<td>电子伏特 → 焦耳</td>\n<td>1.602176634e-19 J</td>\n</tr>\n<tr>\n<td><code>atm</code></td>\n<td>标准大气压 → 帕斯卡</td>\n<td>101325.0 Pa</td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h3 id=\"17-温度相关\"><a class=\"anchor\" href=\"#17-温度相关\">#</a> <strong>1.7 温度相关</strong></h3>\n<table>\n<thead>\n<tr>\n<th>常量名</th>\n<th>描述</th>\n<th>值</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>zero_Celsius</code></td>\n<td>0°C 对应的开尔文温度</td>\n<td>273.15 K</td>\n</tr>\n<tr>\n<td><code>degree_Fahrenheit</code></td>\n<td>1°F 对应的开尔文间隔</td>\n<td>0.555555... K</td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h3 id=\"查找所有常量的方法\"><a class=\"anchor\" href=\"#查找所有常量的方法\">#</a> <strong>查找所有常量的方法</strong></h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">from</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> scipy </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> constants</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 列出所有常量</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">print</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#998418;--shiki-dark:#B8A965\">dir</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">constants</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 搜索包含关键词的常量（例如 'mass'）</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">print</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">constants</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">find</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">mass</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<h2 id=\"二-优化器optimize\"><a class=\"anchor\" href=\"#二-优化器optimize\">#</a> 二、优化器(optimize)</h2>\n<p>scipy的优化器是数学建模的工具，它的核心目标是 寻找函数的最小值（或最大值）、拟合模型、求解方程或系统，适用于传统数学问题<code>而非深度学习</code>(注意和pytorch这些的优化器函数区分开来)</p>\n<h3 id=\"21-无约束优化\"><a class=\"anchor\" href=\"#21-无约束优化\">#</a> <strong>2.1 无约束优化</strong></h3>\n<ul>\n<li>用途:实现查找给定区间内函数的最小值</li>\n<li>实现：</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">minimize_scalar</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> #单变量函数</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">minimize</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">        #多变量函数</span></span></code></pre>\n<ul>\n<li>\n<p>查找方法：</p>\n<ul>\n<li>单变量：<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">brent:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 使用Brent方法（结合抛物线插值和黄金分割法）</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">bounded:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 在有界区间内搜索</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">golden:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 黄金分割法</span></span></code></pre>\n</li>\n<li>多变量<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">Nelder-Mead:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 单纯形法，不需要梯度</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">BFGS:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 拟牛顿法，需要梯度</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">CG:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 共轭梯度法</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">L-BFGS-B:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 有限内存BFGS，适用于大规模问题</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">TNC:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 截断牛顿法</span></span></code></pre>\n</li>\n</ul>\n</li>\n<li>\n<p>实现实例：</p>\n</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">from</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> scipy.optimize</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> import</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> minimize</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">def</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> rosen</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">x</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">:</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    \"\"\"Rosenbrock函数\"\"\"</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    return</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> sum</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">100.0*</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">x</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#59873A;--shiki-dark:#80A665\">1:</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#59873A;--shiki-dark:#80A665\">-x</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#59873A;--shiki-dark:#80A665\">:-1</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#59873A;--shiki-dark:#80A665\">**2.0</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">**</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">2.0</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> +</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">1-x</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">:-1</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">**</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">2.0</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">x0</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:rgba(255, 18, 18, 0.8);--shiki-dark:rgba(255, 18, 18, 0.8)\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">1.3, </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">0.7,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 0.8,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 1.9,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 1.2]</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> #x0 是多维优化问题（如 minimize）的 初始猜测值（initial guess）。优化算法需要一个起点开始搜索最小值。</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">res</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> minimize</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">rosen,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> x0,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> method=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">BFGS</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> options={</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">disp</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> True}</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> #res 是 minimize 或 minimize_scalar 函数的返回结果，它是一个 OptimizeResult 对象 </span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">print</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">res.x</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span></span></code></pre>\n<p>其中res的解有如下内容</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># res 包含的重要属性：</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">res.x</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">       # 最优解（最小值点）</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">res.fun</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">     # 最优解处的函数值</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">res.nfev</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    # 函数评估次数</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">res.nit</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">     # 迭代次数</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">res.success</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> # 是否成功收敛</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">res.message</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> # 状态描述（如收敛信息）</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">res.jac</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">     # 最优解处的梯度（一阶导数）</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">res.hess</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    # 最优解处的Hessian矩阵（二阶导数，如果可用）</span></span></code></pre>\n<h3 id=\"22-全局优化\"><a class=\"anchor\" href=\"#22-全局优化\">#</a> <strong>2.2 全局优化</strong></h3>\n<ul>\n<li>用途：避免传统优化算法（如 minimize）陷入局部最优解，转而寻找 全局最优解。</li>\n<li>实现函数：</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">basinhopping</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"color:#59873A;--shiki-dark:#80A665\">盆地跳跃算法basinhopping</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">: 盆地跳跃算法</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">shgo</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">: 单纯形同伦全局优化</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">differential_evolution</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">: 差分进化算法</span></span></code></pre>\n<ul>\n<li>实例：</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">from</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> scipy.optimize</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> import</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> basinhopping</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">def</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> func</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">x</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">:</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    return</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> np.cos</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">14.5</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> x</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0.3</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> +</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">x </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">+</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0.2</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> x</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">res</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> basinhopping</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">func,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> x0=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1.0</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">print</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">\"全局最小值：x = %.4f, f(x) = %.4f\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> %</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">res.x, </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">res.fun</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<h3 id=\"23-最小二乘拟合\"><a class=\"anchor\" href=\"#23-最小二乘拟合\">#</a> <strong>2.3 最小二乘拟合</strong></h3>\n<ul>\n<li>\n<p>用途：解决非线性最小二乘问题，常用于曲线拟合。</p>\n</li>\n<li>\n<p>实现函数：</p>\n</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">least_squares</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">: 解决非线性最小二乘问题</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">curve_fit</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">: 使用最小二乘法拟合曲线</span></span></code></pre>\n<ul>\n<li>实例：</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">from</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> scipy.optimize</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> import</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> curve_fit</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">import</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> numpy</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> as</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> np</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 定义模型函数</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">def</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> func</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">x,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> a,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> b,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> c</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">:</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    return</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> a</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> np.exp</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">-b</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> x</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> +</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> c</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 生成带噪声的数据</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">xdata</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> np.linspace</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">0,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 4,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 50</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">y</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> func</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">xdata,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 2.5,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 1.3,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0.5</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">ydata</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> y</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> +</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0.2</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> np.random.normal</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">size</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">len</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">xdata</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 拟合数据</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">popt,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> pcov</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> curve_fit</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">func,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> xdata,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ydata</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">print</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">\"拟合参数：\"</span><span style=\"color:#59873A;--shiki-dark:#80A665\">,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> popt</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">#返回[a,b,c]</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">print</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">\"协方差矩阵\"</span><span style=\"color:#59873A;--shiki-dark:#80A665\">,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> pcov</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">#评估可靠性</span></span></code></pre>\n<p>[a,b,c]-&gt; <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mi>a</mi><msup><mi>e</mi><mrow><mo>−</mo><mi>b</mi><mi>x</mi></mrow></msup><mo>+</mo><mi>c</mi></mrow><annotation encoding=\"application/x-tex\">f(x)=ae^{-bx}+c</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.9324em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mord\"><span class=\"mord mathnormal\">e</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8491em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">−</span><span class=\"mord mathnormal mtight\">b</span><span class=\"mord mathnormal mtight\">x</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">c</span></span></span></span></p>\n<h3 id=\"24-方程求根\"><a class=\"anchor\" href=\"#24-方程求根\">#</a> <strong>2.4 方程求根</strong></h3>\n<ul>\n<li>方法：</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">root_scalar</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">: 单变量方程求根 </span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">#brentq, brenth, ridder, bisect, newton: 特定算法</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">root</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">: 多变量方程组求根</span></span></code></pre>\n<ul>\n<li>实现：</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">from</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> scipy</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">optimize </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> root_scalar</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">def</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> f</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    return</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> x</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">**</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  # 寻找x^3 = 1的解</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">sol </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> root_scalar</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">f</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> bracket</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> method</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">brentq</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">print</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">方程的根：</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> sol</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">root</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">from</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> scipy</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">optimize </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> root</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">def</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> func</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    return</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> +</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0.5</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> x</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">**</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1.0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">            0.5</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> x</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">**</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> +</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> x</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">sol </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> root</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">func</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">print</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">方程组的解：</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> sol</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<h3 id=\"25-线性规划\"><a class=\"anchor\" href=\"#25-线性规划\">#</a> <strong>2.5 线性规划</strong></h3>\n<ul>\n<li>什么是线性规划：结构化决策框架，其核心是在一个由线性关系定义的几何空间中，寻找最优的\"角落\"解。比如如下这个问题</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">想象你是一个工厂经理，需要决定生产两种产品A和B的数量：</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">生产A每个利润100元，B每个利润150元</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">但受限于：</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">原材料X：生产A消耗3kg，B消耗2kg，总共只有120kg</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">工时：生产A需要2小时，B需要4小时，总共只有160小时</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">线性规划就是帮你找到在资源限制下能获得最大利润的生产方案</span></span>\n<span class=\"line\"></span></code></pre>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>p</mi><mi>r</mi><mi>o</mi><mi>f</mi><mi>i</mi><mi>t</mi><mo>=</mo><mo>−</mo><mn>100</mn><mi>x</mi><mo>−</mo><mn>150</mn><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">profit=-100x-150y\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">p</span><span class=\"mord mathnormal\">ro</span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">−</span><span class=\"mord\">100</span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8389em;vertical-align:-0.1944em;\"></span><span class=\"mord\">150</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span></span></p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mrow><mo fence=\"true\">[</mo><mtable rowspacing=\"0.16em\" columnalign=\"center center\" columnspacing=\"1em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>3</mn></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>2</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>2</mn></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>4</mn></mstyle></mtd></mtr></mtable><mo fence=\"true\">]</mo></mrow><mrow><mo fence=\"true\">[</mo><mtable rowspacing=\"0.16em\" columnalign=\"center\" columnspacing=\"1em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi>x</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi>y</mi></mstyle></mtd></mtr></mtable><mo fence=\"true\">]</mo></mrow><mo>≤</mo><mrow><mo fence=\"true\">[</mo><mtable rowspacing=\"0.16em\" columnalign=\"center\" columnspacing=\"1em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>120</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>160</mn></mstyle></mtd></mtr></mtable><mo fence=\"true\">]</mo></mrow></mrow><annotation encoding=\"application/x-tex\">\\begin{bmatrix}\n3 &amp; 2 \\\\\n2 &amp; 4\n\\end{bmatrix}\n\\begin{bmatrix}\nx \\\\\ny\n\\end{bmatrix}\n\\le\n\\begin{bmatrix}\n120 \\\\\n160\n\\end{bmatrix}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:2.4em;vertical-align:-0.95em;\"></span><span class=\"minner\"><span class=\"mopen delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size3\">[</span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.45em;\"><span style=\"top:-3.61em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">3</span></span></span><span style=\"top:-2.41em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.95em;\"><span></span></span></span></span></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.45em;\"><span style=\"top:-3.61em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">2</span></span></span><span style=\"top:-2.41em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">4</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.95em;\"><span></span></span></span></span></span></span></span><span class=\"mclose delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size3\">]</span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"minner\"><span class=\"mopen delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size3\">[</span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.45em;\"><span style=\"top:-3.61em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span></span></span><span style=\"top:-2.41em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.95em;\"><span></span></span></span></span></span></span></span><span class=\"mclose delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size3\">]</span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.4em;vertical-align:-0.95em;\"></span><span class=\"minner\"><span class=\"mopen delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size3\">[</span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.45em;\"><span style=\"top:-3.61em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">120</span></span></span><span style=\"top:-2.41em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">160</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.95em;\"><span></span></span></span></span></span></span></span><span class=\"mclose delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size3\">]</span></span></span></span></span></span></span></p>\n<p>抽象一下就是：<br>\n输入: (A, b, c) → 处理: 代数变换 → 输出: x*</p>\n<p>其中：</p>\n<p>A 是约束矩阵（系统限制的编码）=&gt;不等式左侧系数 A=<br>\n<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo fence=\"true\">[</mo><mtable rowspacing=\"0.16em\" columnalign=\"center center\" columnspacing=\"1em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>3</mn></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>2</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>2</mn></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>4</mn></mstyle></mtd></mtr></mtable><mo fence=\"true\">]</mo></mrow><annotation encoding=\"application/x-tex\">\n\\begin{bmatrix}\n3 &amp; 2 \\\\\n2 &amp; 4\n\\end{bmatrix}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:2.4em;vertical-align:-0.95em;\"></span><span class=\"minner\"><span class=\"mopen delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size3\">[</span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.45em;\"><span style=\"top:-3.61em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">3</span></span></span><span style=\"top:-2.41em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.95em;\"><span></span></span></span></span></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.45em;\"><span style=\"top:-3.61em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">2</span></span></span><span style=\"top:-2.41em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">4</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.95em;\"><span></span></span></span></span></span></span></span><span class=\"mclose delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size3\">]</span></span></span></span></span></span></p>\n<p>b 是资源向量（约束条件的量化）=&gt;不等式右侧系数 b=[120,160]</p>\n<p>c 是价值向量（目标函数的权重）=&gt;利润最大化 c=[-100,-150] (线性规划默认求最小值问题) <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mo>−</mo><mn>100</mn><mi>x</mi><mo>−</mo><mn>150</mn><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">f(x)=-100x-150y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">−</span><span class=\"mord\">100</span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8389em;vertical-align:-0.1944em;\"></span><span class=\"mord\">150</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span></p>\n<p>x* 是最优决策（系统输出的解决方案）</p>\n<ul>\n<li>实现实例:</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">from</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> scipy</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">optimize </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> linprog</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 最小化 c^T x</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 约束条件: A_ub x &lt;= b_ub, A_eq x = b_eq</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">c </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 4</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  # 目标函数系数</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">A_ub </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  # 不等式约束矩阵</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">b_ub </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">6</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 4</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">             # 不等式约束右侧</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">res </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> linprog</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">c</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> A_ub</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">A_ub</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> b_ub</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">b_ub</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> bounds</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">None</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> None</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">print</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">最优解：</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> res</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">print</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">最优值：</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> res</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">fun</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<h3 id=\"26-约束优化\"><a class=\"anchor\" href=\"#26-约束优化\">#</a> <strong>2.6 约束优化</strong></h3>\n<ul>\n<li>用途：在有等式或不等式约束条件下优化目标函数。</li>\n<li>方法：</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">minimize</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> 配合约束参数</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">SLSQP:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 序列二次规划算法</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">trust-constr:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 信赖域算法</span></span></code></pre>\n<ul>\n<li>实现：</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">from</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> scipy</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">optimize </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> minimize</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 目标函数</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">def</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> objective</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    return</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> x</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 约束条件</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">def</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> constraint1</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    return</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> x</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">25.0</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">def</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> constraint2</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    return</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> sum</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">**</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">40.0</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 初始猜测</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">x0 </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">5</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">5</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 设置约束</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">con1 </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">type</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">ineq</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">fun</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> constraint1</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">con2 </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">type</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">eq</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">fun</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> constraint2</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">cons </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">con1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">con2</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 优化</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">sol </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> minimize</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">objective</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">x0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">method</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">SLSQP</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">constraints</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">cons</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">print</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">最优解：</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> sol</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<h2 id=\"三-稀疏矩阵sparse\"><a class=\"anchor\" href=\"#三-稀疏矩阵sparse\">#</a> 三、稀疏矩阵(sparse)</h2>\n<p>专门针对那些绝大多数元素为零的矩阵数据结构</p>\n<h3 id=\"31-处理稀疏矩阵\"><a class=\"anchor\" href=\"#31-处理稀疏矩阵\">#</a> <strong>3.1 处理稀疏矩阵</strong></h3>\n<ul>\n<li>方法:</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">CSC</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 压缩稀疏列（Compressed</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Sparse</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Column），按列压缩。</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">CSR</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 压缩稀疏行（Compressed</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Sparse</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Row），按行压缩。</span></span></code></pre>\n<ul>\n<li>实现:</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> numpy </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">as</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> np</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">from</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> scipy</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">sparse </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> csr_matrix</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">arr </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> np</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">array</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">print</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">csr_matrix</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">arr</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span></code></pre>\n<p>输出:</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">0,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 5</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#59873A;--shiki-dark:#80A665\">        1</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">0,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 6</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#59873A;--shiki-dark:#80A665\">        1</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">0,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 8</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#59873A;--shiki-dark:#80A665\">        2</span></span></code></pre>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">print</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">csr_matrix</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">arr</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">data</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> #输出不为零的元素[1,1,2]</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">print</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">csr_matrix</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">arr</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">count_nonzero</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> #输出非0元素总数3</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">mat </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> csr_matrix</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">arr</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">mat</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">eliminate_zeros</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">print</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">mat</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> #删除矩阵中的0元素</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">mat </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> csr_matrix</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">arr</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">mat</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">sum_duplicates</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">print</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">mat</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> #删除重复项</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">newarr </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> csr_matrix</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">arr</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">tocsc</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> #将csr转为csc</span></span></code></pre>\n<h3 id=\"32图结构sparsecsgraph\"><a class=\"anchor\" href=\"#32图结构sparsecsgraph\">#</a> <strong>3.2图结构(sparse.csgraph)</strong></h3>\n<ul>\n<li>如何查看连接组件(连接组件是指图中所有互相连通的节点的集合)</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">connected_components</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> numpy </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">as</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> np</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">from</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> scipy</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">sparse</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">csgraph </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> connected_components</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">from</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> scipy</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">sparse </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> csr_matrix</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">arr </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> np</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">array</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">newarr </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> csr_matrix</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">arr</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">print</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">connected_components</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">newarr</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<p>输出:</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">1,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> array</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">0, 0, 0</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">dtype</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">int32</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> #1代表一个连接组件，[0,0,0]代表每个元素属于哪个连接组件</span></span></code></pre>\n<ul>\n<li>Dijkstra 算法调用(用于计算一个节点到其他所有节点的最短路径)</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> numpy </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">as</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> np</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">from</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> scipy</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">sparse</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">csgraph </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> dijkstra</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">from</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> scipy</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">sparse </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> csr_matrix</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">arr </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> np</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">array</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">newarr </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> csr_matrix</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">arr</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">print</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">dijkstra</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">newarr</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> return_predecessors</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">True</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> indices</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<p>其中dijkstra的参数：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">return_predecessors:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 布尔值，设置</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> True，遍历所有路径，如果不想遍历所有路径可以设置为</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> False。</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">indices:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 元素的索引，返回该元素的所有路径。</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">limit:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 路径的最大权重。</span></span></code></pre>\n<ul>\n<li>Floyd Warshall -- 弗洛伊德算法(解决任意两点间的最短路径)</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> numpy </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">as</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> np</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">from</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> scipy</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">sparse</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">csgraph </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> floyd_warshall</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">from</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> scipy</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">sparse </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> csr_matrix</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">arr </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> np</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">array</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">newarr </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> csr_matrix</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">arr</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">print</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">floyd_warshall</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">newarr</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> return_predecessors</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">True</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<ul>\n<li>Bellman Ford -- 贝尔曼-福特算法(任意两点间的最短路径)</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> numpy </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">as</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> np</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">from</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> scipy</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">sparse</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">csgraph </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> bellman_ford</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">from</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> scipy</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">sparse </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> csr_matrix</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">arr </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> np</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">array</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">newarr </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> csr_matrix</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">arr</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">print</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">bellman_ford</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">newarr</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> return_predecessors</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">True</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> indices</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<ul>\n<li>dfs</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> numpy </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">as</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> np</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">from</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> scipy</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">sparse</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">csgraph </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> depth_first_order</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">from</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> scipy</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">sparse </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> csr_matrix</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">arr </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> np</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">array</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">newarr </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> csr_matrix</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">arr</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">print</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">depth_first_order</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">newarr</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> #传入邻接矩阵和起始遍历元素</span></span></code></pre>\n<ul>\n<li>bfs</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> numpy </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">as</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> np</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">from</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> scipy</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">sparse</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">csgraph </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> breadth_first_order</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">from</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> scipy</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">sparse </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> csr_matrix</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">arr </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> np</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">array</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">newarr </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> csr_matrix</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">arr</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">print</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">breadth_first_order</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">newarr</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n",
            "tags": [
                "python",
                "math",
                "scipy"
            ]
        },
        {
            "id": "https://koen666.github.io/2025/08/10/seaborn/",
            "url": "https://koen666.github.io/2025/08/10/seaborn/",
            "title": "seaborn实现统计图绘制",
            "date_published": "2025-08-10T06:50:00.000Z",
            "content_html": "<h2 id=\"一-设置主题和样式\"><a class=\"anchor\" href=\"#一-设置主题和样式\">#</a> 一、设置主题和样式</h2>\n<p>在进行图形绘制之前先设置好主题/样式</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 设置主题/样式（可选）</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">sns.set_theme</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">style</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">=</span><span style=\"color:#59873A;--shiki-dark:#80A665\">\"darkgrid\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">  </span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 可选风格：darkgrid, whitegrid, dark, white, ticks</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">sns.set_palette</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">\"husl\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">          </span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 设置调色板</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">sns.set_context</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">\"paper\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">         </span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 设置上下文（paper, notebook, talk, poster）</span></span></code></pre>\n<p>以下是 <code>sns.set_theme()</code>、<code>sns.set_palette()</code> 和 <code>sns.set_context()</code> 的可选参数整理成表格：</p>\n<h3 id=\"1-snsset_theme-的-style-参数图表风格\"><a class=\"anchor\" href=\"#1-snsset_theme-的-style-参数图表风格\">#</a> 1. <strong><code>sns.set_theme()</code> 的 <code>style</code> 参数（图表风格）</strong></h3>\n<table>\n<thead>\n<tr>\n<th>可选值</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>&quot;darkgrid&quot;</code></td>\n<td>默认值，灰色背景 + 白色网格线（适合大多数场景）</td>\n</tr>\n<tr>\n<td><code>&quot;whitegrid&quot;</code></td>\n<td>白色背景 + 深色网格线（适合强调数据精度）</td>\n</tr>\n<tr>\n<td><code>&quot;dark&quot;</code></td>\n<td>纯灰色背景，无网格线（简洁风格）</td>\n</tr>\n<tr>\n<td><code>&quot;white&quot;</code></td>\n<td>纯白色背景，无网格线（极简风格）</td>\n</tr>\n<tr>\n<td><code>&quot;ticks&quot;</code></td>\n<td>白色背景 + 坐标轴刻度（无网格线，类似 <code>&quot;white&quot;</code> 但更清晰的刻度）</td>\n</tr>\n</tbody>\n</table>\n<hr />\n<h3 id=\"2-snsset_palette-的调色板参数\"><a class=\"anchor\" href=\"#2-snsset_palette-的调色板参数\">#</a> 2. <strong><code>sns.set_palette()</code> 的调色板参数</strong></h3>\n<table>\n<thead>\n<tr>\n<th>类型</th>\n<th>可选值示例</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>Seaborn 内置名称</strong></td>\n<td><code>&quot;husl&quot;</code>, <code>&quot;deep&quot;</code>, <code>&quot;muted&quot;</code>, <code>&quot;bright&quot;</code>, <code>&quot;pastel&quot;</code>, <code>&quot;dark&quot;</code>, <code>&quot;colorblind&quot;</code></td>\n</tr>\n<tr>\n<td><strong>Matplotlib 色板</strong></td>\n<td><code>&quot;viridis&quot;</code>, <code>&quot;plasma&quot;</code>, <code>&quot;magma&quot;</code>, <code>&quot;cividis&quot;</code>（需安装 Matplotlib）</td>\n</tr>\n<tr>\n<td><strong>自定义颜色列表</strong></td>\n<td><code>[&quot;#FF5733&quot;, &quot;#33FF57&quot;, &quot;#3357FF&quot;]</code>（十六进制/RGB 颜色列表）</td>\n</tr>\n<tr>\n<td><strong>其他方法</strong></td>\n<td><code>sns.color_palette(&quot;hls&quot;, 8)</code> 或 <code>sns.husl_palette(10)</code> 生成动态调色板</td>\n</tr>\n</tbody>\n</table>\n<hr />\n<h3 id=\"3-snsset_context-的-context-参数图表比例\"><a class=\"anchor\" href=\"#3-snsset_context-的-context-参数图表比例\">#</a> 3. <strong><code>sns.set_context()</code> 的 <code>context</code> 参数（图表比例）</strong></h3>\n<table>\n<thead>\n<tr>\n<th>可选值</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>&quot;paper&quot;</code></td>\n<td>最小比例（适合论文或小图，字体和线条较细）</td>\n</tr>\n<tr>\n<td><code>&quot;notebook&quot;</code></td>\n<td>默认值（适合 Jupyter Notebook 或常规屏幕显示）</td>\n</tr>\n<tr>\n<td><code>&quot;talk&quot;</code></td>\n<td>较大比例（适合幻灯片演示，字体和线条加粗）</td>\n</tr>\n<tr>\n<td><code>&quot;poster&quot;</code></td>\n<td>最大比例（适合海报或大屏展示，元素显著放大）</td>\n</tr>\n</tbody>\n</table>\n<hr />\n<h3 id=\"附set_theme-的完整参数可选\"><a class=\"anchor\" href=\"#附set_theme-的完整参数可选\">#</a> 附：<code>set_theme()</code> 的完整参数（可选）</h3>\n<table>\n<thead>\n<tr>\n<th>参数</th>\n<th>类型</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>style</code></td>\n<td>str</td>\n<td>上述风格之一（如 <code>&quot;darkgrid&quot;</code>）</td>\n</tr>\n<tr>\n<td><code>palette</code></td>\n<td>str/list</td>\n<td>上述调色板之一</td>\n</tr>\n<tr>\n<td><code>context</code></td>\n<td>str/dict</td>\n<td>上述上下文之一或自定义字典</td>\n</tr>\n<tr>\n<td><code>font</code></td>\n<td>str</td>\n<td>字体（如 <code>&quot;sans-serif&quot;</code>）</td>\n</tr>\n<tr>\n<td><code>font_scale</code></td>\n<td>float</td>\n<td>字体缩放因子（默认 1）</td>\n</tr>\n<tr>\n<td><code>rc</code></td>\n<td>dict</td>\n<td>直接覆盖 Matplotlib 的 rcParams</td>\n</tr>\n</tbody>\n</table>\n<hr />\n<h3 id=\"示例代码\"><a class=\"anchor\" href=\"#示例代码\">#</a> 示例代码：</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> seaborn </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">as</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> sns</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 综合设置</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">sns</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">set_theme</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    style</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">whitegrid</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">      # 风格</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    palette</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">husl</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">         # 调色板</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    context</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">talk</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">         # 上下文</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    font</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Arial</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">           # 字体</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    font_scale</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1.2</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">          # 字体大小缩放</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 单独设置（等效于上面的 palette）</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">sns</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">set_palette</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">husl</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<p>如果需要更详细的参数（如自定义 <code>rc</code>），可以进一步参考 <a href=\"https://seaborn.pydata.org/generated/seaborn.set_theme.html\">Seaborn 官方文档</a>。</p>\n<h2 id=\"二-调用seaborn绘图函数\"><a class=\"anchor\" href=\"#二-调用seaborn绘图函数\">#</a> 二、调用seaborn绘图函数</h2>\n<p>Seaborn 提供了多种高级绘图函数，主要分为以下几类：<strong>关系型</strong>、<strong>分布型</strong>、<strong>分类型</strong>、<strong>回归型</strong>、<strong>矩阵型</strong> 和 <strong>其他辅助函数</strong>。以下是详细的分类说明和示例：</p>\n<hr />\n<h3 id=\"1-关系型绘图relational-plots\"><a class=\"anchor\" href=\"#1-关系型绘图relational-plots\">#</a> 1. <strong>关系型绘图（Relational Plots）</strong></h3>\n<p>用于展示变量之间的关系（通常用于连续数据）。</p>\n<table>\n<thead>\n<tr>\n<th>函数</th>\n<th>描述</th>\n<th>示例代码</th>\n<th>示例图</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>sns.scatterplot()</code></td>\n<td>散点图（基础）</td>\n<td><code>sns.scatterplot(data=tips, x=&quot;total_bill&quot;, y=&quot;tip&quot;, hue=&quot;time&quot;)</code></td>\n<td><img loading=\"lazy\" src=\"https://seaborn.pydata.org/_images/scatterplot_3_0.png\" alt=\"scatterplot\" /></td>\n</tr>\n<tr>\n<td><code>sns.lineplot()</code></td>\n<td>折线图（趋势展示）</td>\n<td><code>sns.lineplot(data=flights, x=&quot;year&quot;, y=&quot;passengers&quot;, hue=&quot;month&quot;)</code></td>\n<td><img loading=\"lazy\" src=\"https://seaborn.pydata.org/_images/lineplot_3_0.png\" alt=\"lineplot\" /></td>\n</tr>\n<tr>\n<td><code>sns.relplot()</code></td>\n<td>分面关系图（散点）</td>\n<td><code>sns.relplot(data=tips, x=&quot;total_bill&quot;, y=&quot;tip&quot;, col=&quot;time&quot;, kind=&quot;scatter&quot;)</code></td>\n<td><img loading=\"lazy\" src=\"https://seaborn.pydata.org/_images/scatterplot_29_0.png\" alt=\"relplot scatter\" /></td>\n</tr>\n</tbody>\n</table>\n<hr />\n<h3 id=\"2-分布型绘图distribution-plots\"><a class=\"anchor\" href=\"#2-分布型绘图distribution-plots\">#</a> 2. <strong>分布型绘图（Distribution Plots）</strong></h3>\n<p>用于展示数据的分布特征。</p>\n<table>\n<thead>\n<tr>\n<th>函数</th>\n<th>描述</th>\n<th>示例代码</th>\n<th>示例图</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>sns.histplot()</code></td>\n<td>直方图（单变量分布）</td>\n<td><code>sns.histplot(data=tips, x=&quot;total_bill&quot;, bins=20, kde=True)</code></td>\n<td><img loading=\"lazy\" src=\"https://seaborn.pydata.org/_images/histplot_13_0.png\" alt=\"histplot 示例\" /></td>\n</tr>\n<tr>\n<td><code>sns.kdeplot()</code></td>\n<td>核密度估计图（光滑分布）</td>\n<td><code>sns.kdeplot(data=tips, x=&quot;total_bill&quot;, hue=&quot;time&quot;, fill=True)</code></td>\n<td><img loading=\"lazy\" src=\"https://seaborn.pydata.org/_images/kdeplot_35_0.png\" alt=\"kdeplot 示例\" /></td>\n</tr>\n<tr>\n<td><code>sns.ecdfplot()</code></td>\n<td>经验累积分布函数图</td>\n<td><code>sns.ecdfplot(data=tips, x=&quot;total_bill&quot;, hue=&quot;time&quot;)</code></td>\n<td><img loading=\"lazy\" src=\"https://raw.githubusercontent.com/koen666/image/master/exp.png\" alt=\"ecdfplot 示例\" /> <em>(示意)</em></td>\n</tr>\n<tr>\n<td><code>sns.displot()</code></td>\n<td>分面分布图（直方/KDE）</td>\n<td><code>sns.displot(data=tips, x=&quot;total_bill&quot;, col=&quot;time&quot;, kind=&quot;hist&quot;)</code></td>\n<td><img loading=\"lazy\" src=\"https://seaborn.pydata.org/_images/distributions_31_0.png\" alt=\"displot 示例\" /></td>\n</tr>\n<tr>\n<td><code>sns.boxplot()</code></td>\n<td>箱线图（五数概括）</td>\n<td><code>sns.boxplot(data=tips, x=&quot;day&quot;, y=&quot;total_bill&quot;, hue=&quot;sex&quot;)</code></td>\n<td><img loading=\"lazy\" src=\"https://raw.githubusercontent.com/koen666/image/master/boxplot.png\" alt=\"boxplot 示例\" /> <em>(占位)</em> (<a href=\"https://docs.kanaries.net/topics/Seaborn/sns-boxplot?utm_source=chatgpt.com\" title=\"Seaborn Boxplot Tutorial: Create Custom Box Plots in Python\">Kanaries Docs</a>)</td>\n</tr>\n<tr>\n<td><code>sns.violinplot()</code></td>\n<td>小提琴图（分布+密度）</td>\n<td><code>sns.violinplot(data=tips, x=&quot;day&quot;, y=&quot;total_bill&quot;, hue=&quot;sex&quot;, split=True)</code></td>\n<td><img loading=\"lazy\" src=\"https://seaborn.pydata.org/_images/violinplot_5_0.png\" alt=\"violinplot 示例\" /> <em>(占位)</em> (<a href=\"https://www.geeksforgeeks.org/python/violinplot-using-seaborn-in-python/?utm_source=chatgpt.com\" title=\"Violinplot using Seaborn in Python - GeeksforGeeks\">GeeksforGeeks</a>)</td>\n</tr>\n</tbody>\n</table>\n<hr />\n<h3 id=\"3-分类型绘图categorical-plots\"><a class=\"anchor\" href=\"#3-分类型绘图categorical-plots\">#</a> 3. <strong>分类型绘图（Categorical Plots）</strong></h3>\n<p>用于分类变量的可视化。</p>\n<table>\n<thead>\n<tr>\n<th>函数</th>\n<th>描述</th>\n<th>示例代码</th>\n<th>示例图</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>sns.barplot()</code></td>\n<td>条形图（均值/置信区间）</td>\n<td><code>sns.barplot(data=tips, x=&quot;day&quot;, y=&quot;total_bill&quot;, hue=&quot;sex&quot;)</code></td>\n<td><img loading=\"lazy\" src=\"https://seaborn.pydata.org/_images/barplot_9_0.png\" alt=\"barplot\" /></td>\n</tr>\n<tr>\n<td><code>sns.countplot()</code></td>\n<td>计数条形图（频次）</td>\n<td><code>sns.countplot(data=tips, x=&quot;day&quot;, hue=&quot;sex&quot;)</code></td>\n<td><img loading=\"lazy\" src=\"https://seaborn.pydata.org/_images/countplot_1_0.png\" alt=\"countplot\" /></td>\n</tr>\n<tr>\n<td><code>sns.pointplot()</code></td>\n<td>点图（均值+置信区间）</td>\n<td><code>sns.pointplot(data=tips, x=&quot;day&quot;, y=&quot;total_bill&quot;, hue=&quot;sex&quot;)</code></td>\n<td><img loading=\"lazy\" src=\"https://seaborn.pydata.org/_images/pointplot_6_0.png\" alt=\"pointplot\" /></td>\n</tr>\n<tr>\n<td><code>sns.stripplot()</code></td>\n<td>散点图（分类+抖动）</td>\n<td><code>sns.stripplot(data=tips, x=&quot;day&quot;, y=&quot;total_bill&quot;, hue=&quot;sex&quot;, dodge=True)</code></td>\n<td><img loading=\"lazy\" src=\"https://seaborn.pydata.org/_images/stripplot_8_0.png\" alt=\"stripplot\" /></td>\n</tr>\n<tr>\n<td><code>sns.swarmplot()</code></td>\n<td>蜂群图（无重叠散点）</td>\n<td><code>sns.swarmplot(data=tips, x=&quot;day&quot;, y=&quot;total_bill&quot;, hue=&quot;sex&quot;)</code></td>\n<td><img loading=\"lazy\" src=\"https://seaborn.pydata.org/_images/swarmplot_5_0.png\" alt=\"swarmplot\" /></td>\n</tr>\n<tr>\n<td><code>sns.catplot()</code></td>\n<td>分面绘制分类图（多功能）</td>\n<td><code>sns.catplot(data=tips, x=&quot;day&quot;, y=&quot;total_bill&quot;, col=&quot;sex&quot;, kind=&quot;box&quot;)</code></td>\n<td><img loading=\"lazy\" src=\"https://seaborn.pydata.org/_images/catplot_11_0.png\" alt=\"catplot\" /></td>\n</tr>\n</tbody>\n</table>\n<hr />\n<h3 id=\"4-回归型绘图regression-plots\"><a class=\"anchor\" href=\"#4-回归型绘图regression-plots\">#</a> 4. <strong>回归型绘图（Regression Plots）</strong></h3>\n<p>用于展示变量间的统计关系（含回归线）。</p>\n<table>\n<thead>\n<tr>\n<th>函数</th>\n<th>描述</th>\n<th>示例代码</th>\n<th>示例图</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>sns.regplot()</code></td>\n<td>回归散点图（单次拟合）</td>\n<td><code>sns.regplot(data=tips, x=&quot;total_bill&quot;, y=&quot;tip&quot;, ci=95)</code></td>\n<td><img loading=\"lazy\" src=\"https://seaborn.pydata.org/_images/regplot_5_0.png\" alt=\"regplot\" /></td>\n</tr>\n<tr>\n<td><code>sns.lmplot()</code></td>\n<td>分面回归图（多功能）</td>\n<td><code>sns.lmplot(data=tips, x=&quot;total_bill&quot;, y=&quot;tip&quot;, col=&quot;time&quot;, order=2)</code></td>\n<td><img loading=\"lazy\" src=\"https://seaborn.pydata.org/_images/lmplot_12_0.png\" alt=\"lmplot\" /></td>\n</tr>\n</tbody>\n</table>\n<hr />\n<h3 id=\"5-矩阵型绘图matrix-plots\"><a class=\"anchor\" href=\"#5-矩阵型绘图matrix-plots\">#</a> 5. <strong>矩阵型绘图（Matrix Plots）</strong></h3>\n<p>用于矩阵数据的可视化（如相关性、聚类）。</p>\n<table>\n<thead>\n<tr>\n<th>函数</th>\n<th>描述</th>\n<th>示例代码</th>\n<th>示例图</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>sns.heatmap()</code></td>\n<td>热力图（矩阵值颜色映射）</td>\n<td><code>sns.heatmap(data.corr(), annot=True, cmap=&quot;coolwarm&quot;)</code></td>\n<td><img loading=\"lazy\" src=\"https://seaborn.pydata.org/_images/heatmap_2_0.png\" alt=\"heatmap\" /></td>\n</tr>\n<tr>\n<td><code>sns.clustermap()</code></td>\n<td>聚类热力图（行列聚类）</td>\n<td><code>sns.clustermap(data.corr(), method=&quot;ward&quot;, cmap=&quot;vlag&quot;)</code></td>\n<td><img loading=\"lazy\" src=\"https://seaborn.pydata.org/_images/clustermap_1_0.png\" alt=\"clustermap\" /></td>\n</tr>\n</tbody>\n</table>\n<hr />\n<h3 id=\"6-其他辅助函数\"><a class=\"anchor\" href=\"#6-其他辅助函数\">#</a> 6. <strong>其他辅助函数</strong></h3>\n<table>\n<thead>\n<tr>\n<th>函数</th>\n<th>描述</th>\n<th>示例代码</th>\n<th>示例图</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>sns.pairplot()</code></td>\n<td>变量两两关系矩阵</td>\n<td><code>sns.pairplot(data=iris, hue=&quot;species&quot;, diag_kind=&quot;kde&quot;)</code></td>\n<td><img loading=\"lazy\" src=\"https://seaborn.pydata.org/_images/pairplot_6_0.png\" alt=\"pairplot\" /></td>\n</tr>\n<tr>\n<td><code>sns.jointplot()</code></td>\n<td>双变量联合分布图</td>\n<td><code>sns.jointplot(data=tips, x=&quot;total_bill&quot;, y=&quot;tip&quot;, kind=&quot;hex&quot;)</code></td>\n<td><img loading=\"lazy\" src=\"https://seaborn.pydata.org/_images/jointplot_9_0.png\" alt=\"jointplot\" /></td>\n</tr>\n<tr>\n<td><code>sns.FacetGrid()</code></td>\n<td>自定义分面网格（底层控制）</td>\n<td><code>g = sns.FacetGrid(tips, col=&quot;time&quot;); g.map(sns.scatterplot, &quot;total_bill&quot;, &quot;tip&quot;)</code></td>\n<td><img loading=\"lazy\" src=\"https://seaborn.pydata.org/_images/facetgrid_3_0.png\" alt=\"FacetGrid\" /></td>\n</tr>\n</tbody>\n</table>\n<hr />\n<h3 id=\"关键区别\"><a class=\"anchor\" href=\"#关键区别\">#</a> 关键区别：</h3>\n<ul>\n<li><strong>基础函数</strong>（如 <code>scatterplot</code>） vs <strong>分面函数</strong>（如 <code>relplot/catplot</code>）：\n<ul>\n<li>基础函数直接绘图，分面函数通过 <code>col/row</code> 参数分面。</li>\n</ul>\n</li>\n<li><strong>通用参数</strong>：\n<ul>\n<li><code>data</code>：DataFrame 数据源。</li>\n<li><code>x/y</code>：轴变量。</li>\n<li><code>hue</code>：颜色分组。</li>\n<li><code>style</code>：标记样式分组。</li>\n<li><code>size</code>：大小分组。</li>\n</ul>\n</li>\n</ul>\n<hr />\n<h3 id=\"示例分面绘图catplot\"><a class=\"anchor\" href=\"#示例分面绘图catplot\">#</a> 示例：分面绘图（<code>catplot</code>）</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> seaborn </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">as</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> sns</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">tips </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> sns</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">load_dataset</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">tips</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 分面绘制箱线图（按 day 分组，按 sex 分面）</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">sns</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">catplot</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    data</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">tips</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    x</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">day</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    y</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">total_bill</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">  </span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    col</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">sex</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    kind</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">box</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    height</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">4</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    aspect</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0.7</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">plt</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">show</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<h2 id=\"三-结合-matplotlib-细化\"><a class=\"anchor\" href=\"#三-结合-matplotlib-细化\">#</a> 三、结合 Matplotlib 细化</h2>\n<p>Seaborn 虽然提供了简洁的高级 API，但底层仍基于 Matplotlib。通过 <code>matplotlib.pyplot</code>（通常缩写为 <code>plt</code>）可以对 Seaborn 生成的图表进行精细化调整。以下是详细分类说明和实用技巧：</p>\n<hr />\n<h3 id=\"31基础调整\"><a class=\"anchor\" href=\"#31基础调整\">#</a> 3.1<strong>基础调整</strong></h3>\n<h4 id=\"311-标题与坐标轴标签\"><a class=\"anchor\" href=\"#311-标题与坐标轴标签\">#</a> 3.1.1 <strong>标题与坐标轴标签</strong></h4>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> matplotlib</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">pyplot </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">as</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> plt</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> seaborn </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">as</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> sns</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">tips </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> sns</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">load_dataset</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">tips</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">sns</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">boxplot</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">data</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">tips</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> x</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">day</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> y</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">total_bill</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 添加标题和标签</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">plt</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">title</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Daily Bill Distribution</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> fontsize</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">14</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> pad</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">20</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  # pad 控制标题距离</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">plt</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">xlabel</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Day of Week</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> fontsize</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">12</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">                    # X轴标签</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">plt</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">ylabel</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Total Bill ($)</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> fontsize</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">12</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">                 # Y轴标签</span></span></code></pre>\n<h4 id=\"312-刻度调整\"><a class=\"anchor\" href=\"#312-刻度调整\">#</a> 3.1.2 <strong>刻度调整</strong></h4>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 旋转刻度标签（解决重叠问题）</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">plt</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">xticks</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">rotation</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">45</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> ha</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">right</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  # ha: 旋转后对齐方式（right/center）</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 设置刻度范围和密度</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">plt</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">yticks</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ticks</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 20</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 40</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 60</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> fontsize</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">10</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  # 自定义Y轴刻度</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">plt</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">xlim</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0.5</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 3.5</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">                             # 设置X轴范围</span></span></code></pre>\n<hr />\n<h3 id=\"32-图例与颜色\"><a class=\"anchor\" href=\"#32-图例与颜色\">#</a> 3.2 <strong>图例与颜色</strong></h3>\n<h4 id=\"321-图例控制\"><a class=\"anchor\" href=\"#321-图例控制\">#</a> 3.2.1 <strong>图例控制</strong></h4>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">sns</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">scatterplot</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">data</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">tips</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> x</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">total_bill</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> y</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">tip</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> hue</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">time</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 调整图例</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">plt</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">legend</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    title</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Meal Time</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">           # 修改图例标题</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    loc</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">upper right</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">           # 位置（best, upper right, lower left等）</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    bbox_to_anchor</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1.3</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">     # 将图例移到图外（右侧）</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    frameon</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">False</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">                # 去掉图例边框</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<h4 id=\"322-颜色与样式\"><a class=\"anchor\" href=\"#322-颜色与样式\">#</a> 3.2.2 <strong>颜色与样式</strong></h4>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 修改单个元素的颜色（通过Matplotlib）</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">plt</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">setp</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">plt</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">gca</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">get_xticklabels</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> color</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">red</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  # 设置X轴刻度为红色</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 修改所有文本颜色（全局）</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">plt</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">rcParams</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">text.color</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">blue</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  # 影响标题、标签等</span></span></code></pre>\n<hr />\n<h3 id=\"33-布局与子图\"><a class=\"anchor\" href=\"#33-布局与子图\">#</a> 3.3 <strong>布局与子图</strong></h3>\n<h4 id=\"331-调整边距与布局\"><a class=\"anchor\" href=\"#331-调整边距与布局\">#</a> 3.3.1 <strong>调整边距与布局</strong></h4>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">plt</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">tight_layout</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">pad</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  # 自动调整子图间距（防止标签重叠）</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">plt</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">subplots_adjust</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    left</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0.1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">            # 左边距</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    right</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0.9</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">           # 右边距</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    top</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0.9</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">             # 上边距</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    bottom</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0.2</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">           # 下边距</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<h4 id=\"332-与matplotlib子图结合\"><a class=\"anchor\" href=\"#332-与matplotlib子图结合\">#</a> 3.3.2 <strong>与Matplotlib子图结合</strong></h4>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">fig</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> axes </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> plt</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">subplots</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> figsize</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">12</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 5</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  # 创建1行2列的子图</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 在第一个子图绘制</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">sns</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">histplot</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">data</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">tips</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> x</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">total_bill</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> ax</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">axes</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">axes</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">set_title</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Total Bill Distribution</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 在第二个子图绘制</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">sns</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">boxplot</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">data</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">tips</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> x</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">day</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> y</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">total_bill</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> ax</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">axes</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">axes</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">set_xticklabels</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Thu</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Fri</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Sat</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Sun</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  # 自定义刻度标签</span></span></code></pre>\n<hr />\n<h3 id=\"34-高级定制\"><a class=\"anchor\" href=\"#34-高级定制\">#</a> 3.4 <strong>高级定制</strong></h3>\n<h4 id=\"341-网格线与背景\"><a class=\"anchor\" href=\"#341-网格线与背景\">#</a> 3.4.1 <strong>网格线与背景</strong></h4>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">plt</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">grid</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">True</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> linestyle</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">--</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> alpha</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0.6</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  # 显示网格线（虚线，半透明）</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">plt</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">gca</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">set_facecolor</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">#f5f5f5</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">         # 设置图表背景色（灰色）</span></span></code></pre>\n<h4 id=\"342-注释与箭头\"><a class=\"anchor\" href=\"#342-注释与箭头\">#</a> 3.4.2 <strong>注释与箭头</strong></h4>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 添加文本注释</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">plt</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">text</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    x</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">30</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> y</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">10</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">                           # 坐标位置</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    s</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Outlier Point</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">                     # 文本内容</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    fontsize</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">12</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    color</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">red</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    bbox</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#998418;--shiki-dark:#B8A965\">dict</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">facecolor</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">white</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> alpha</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0.8</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> # 文本框样式</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 添加箭头</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">plt</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">annotate</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span></span>\n<span class=\"line\"><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">    \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">High Tip</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    xy</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">40</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 10</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">                          # 箭头指向的点</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    xytext</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">35</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 15</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">                      # 文本起始位置</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    arrowprops</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#998418;--shiki-dark:#B8A965\">dict</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">arrowstyle</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">-></span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> color</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">black</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<hr />\n<h3 id=\"35-保存图表\"><a class=\"anchor\" href=\"#35-保存图表\">#</a> 3.5 <strong>保存图表</strong></h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">plt</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">savefig</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span></span>\n<span class=\"line\"><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">    \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">plot.png</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    dpi</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">300</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">                   # 分辨率</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    bbox_inches</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">tight</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">       # 去除白边</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    transparent</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">True</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">           # 透明背景（适合PPT）</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<hr />\n<h3 id=\"36-调试技巧\"><a class=\"anchor\" href=\"#36-调试技巧\">#</a> 3.6 <strong>调试技巧</strong></h3>\n<ol>\n<li>\n<p><strong>获取当前Axes对象</strong>：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">ax </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> plt</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">gca</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  # 获取当前Axes</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">ax</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">spines</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">top</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">set_visible</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">False</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  # 隐藏顶部边框线</span></span></code></pre>\n</li>\n<li>\n<p><strong>批量设置样式</strong>：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">params </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">    \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">axes.labelsize</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 14</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">    \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">xtick.labelsize</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 12</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">    \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">ytick.labelsize</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 12</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">plt</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">rcParams</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">update</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">params</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  # 全局生效</span></span></code></pre>\n</li>\n</ol>\n<hr />\n<h3 id=\"完整示例\"><a class=\"anchor\" href=\"#完整示例\">#</a> 完整示例</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> seaborn </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">as</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> sns</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> matplotlib</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">pyplot </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">as</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> plt</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 数据准备</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">tips </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> sns</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">load_dataset</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">tips</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 1. 绘制基础图表</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">sns</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">boxplot</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">data</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">tips</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> x</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">day</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> y</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">total_bill</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> hue</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">sex</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 2. 使用Matplotlib调整</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">plt</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">title</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Bill Distribution by Day and Gender</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> fontsize</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">16</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">plt</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">xlabel</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Day</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> fontsize</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">14</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">plt</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">ylabel</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Total Bill (USD)</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> fontsize</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">14</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">plt</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">xticks</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">rotation</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">15</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">plt</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">legend</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">title</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Gender</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> bbox_to_anchor</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 3. 调整布局</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">plt</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">tight_layout</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 4. 保存或显示</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">plt</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">savefig</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">boxplot.png</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> dpi</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">200</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">plt</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">show</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<h2 id=\"四-显示或者保存图表格\"><a class=\"anchor\" href=\"#四-显示或者保存图表格\">#</a> 四、显示或者保存图表格</h2>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">plt.show</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">plt.savefig</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">\"plot.png\"</span><span style=\"color:#59873A;--shiki-dark:#80A665\">,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> dpi=300,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> bbox_inches=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">tight</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n",
            "tags": [
                "python",
                "saaborn"
            ]
        },
        {
            "id": "https://koen666.github.io/2025/07/29/electron/",
            "url": "https://koen666.github.io/2025/07/29/electron/",
            "title": "Electron 基本使用教程",
            "date_published": "2025-07-28T16:00:00.000Z",
            "content_html": "<blockquote>\n<p>以下以vue3为例结合electron实现跨平台开发</p>\n</blockquote>\n<hr />\n<h2 id=\"一-在项目根目录安装electorn-forge\"><a class=\"anchor\" href=\"#一-在项目根目录安装electorn-forge\">#</a> 一、在项目根目录安装electorn-forge</h2>\n<p>按照如下命令安装electron-forge</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">npm</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> install</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --save-dev</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> electron</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> @electron-forge/cli</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">npx</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> electron-forge</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> import</span></span></code></pre>\n<p>这一步会在你的项目中创建一个 electron 的基本目录结构，并配置打包命令。</p>\n<h2 id=\"二-新建mainjs\"><a class=\"anchor\" href=\"#二-新建mainjs\">#</a> 二、新建main.js</h2>\n<p>在根目录下新建/electron/main.js</p>\n<p>在main.js下复制如下代码</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">import</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> &#123;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> app,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> BrowserWindow</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> &#125;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">electron</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">import</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> path</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">path</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">import</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> &#123;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> fileURLToPath</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> &#125;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">url</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">//</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 解决</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ES</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Module</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 中没有</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> __dirname</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 的问题</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">const</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> __filename</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> fileURLToPath</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">import.meta.url</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">const</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> __dirname</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> path.dirname</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">__filename</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> createWindow</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">  const</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> win</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> new</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> BrowserWindow</span><span style=\"color:rgba(255, 18, 18, 0.8);--shiki-dark:rgba(255, 18, 18, 0.8)\">(</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    width:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 1200,</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    height:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 800,</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    webPreferences:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">      preload:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> path.join</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">__dirname,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">preload.js</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> //</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 可选，预加载脚本</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">  </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span><span style=\"color:rgba(255, 18, 18, 0.8);--shiki-dark:rgba(255, 18, 18, 0.8)\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">!</span><span style=\"color:#59873A;--shiki-dark:#80A665\">app.isPackaged</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    win.loadURL</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">'http://localhost:5173'</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> //</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> dev</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 模式加载</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> vite</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 前端</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> else</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    win.loadFile</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">path.join</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">__dirname,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">../dist/index.html</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> //</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> prod</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 模式加载打包页面</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:rgba(255, 18, 18, 0.8);--shiki-dark:rgba(255, 18, 18, 0.8)\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">app.whenReady</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">.then</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">  createWindow</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"></span></code></pre>\n<h2 id=\"三-修改packagejson\"><a class=\"anchor\" href=\"#三-修改packagejson\">#</a> 三、修改package.json</h2>\n<p>进入package.json文件，新增</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">\"main\"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">electron/main.js</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">,</span></span></code></pre>\n<p>注意scripts</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">\"scripts\"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">\"dev\"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">vite</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">,</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">\"build\"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">vite build</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">,</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">\"preview\"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">vite preview</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">,</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">\"start\"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">electron-forge start</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">,</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">\"package\"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">electron-forge package</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">,</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">\"make\"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">electron-forge make</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"color:rgba(255, 18, 18, 0.8);--shiki-dark:rgba(255, 18, 18, 0.8)\">&#125;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span></code></pre>\n<h2 id=\"四-开发测试流程\"><a class=\"anchor\" href=\"#四-开发测试流程\">#</a> 四、开发测试流程</h2>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 启动 Vite 前端</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">npm</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> run</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> dev</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 新开一个终端，启动 Electron</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">npm</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> start</span></span>\n<span class=\"line\"></span></code></pre>\n<h2 id=\"五-打包发布测试\"><a class=\"anchor\" href=\"#五-打包发布测试\">#</a> 五、打包发布测试</h2>\n<p>先构建前端项目</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">npm</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> run</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> build</span></span></code></pre>\n<p>修改main.js</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">win.loadFile</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">path.join</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">__dirname,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">../dist/index.html</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span></code></pre>\n<p>打包</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">npm</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> run</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> package</span></span></code></pre>\n<p>会在 out/ 目录生成你的桌面可执行程序（比如 Windows 下是 .exe 文件）</p>\n",
            "tags": [
                "electron",
                "web",
                "desk"
            ]
        },
        {
            "id": "https://koen666.github.io/2025/07/27/issue/",
            "url": "https://koen666.github.io/2025/07/27/issue/",
            "title": "常见BUG汇总",
            "date_published": "2025-07-27T00:29:00.000Z",
            "content_html": "<h2 id=\"一-markdown\"><a class=\"anchor\" href=\"#一-markdown\">#</a> 一、Markdown</h2>\n<h3 id=\"11-为什么vscode编辑md文件十分卡顿\"><a class=\"anchor\" href=\"#11-为什么vscode编辑md文件十分卡顿\">#</a> 1.1 为什么vscode编辑md文件十分卡顿</h3>\n<p>解决方法:禁用cpp extension pack扩展</p>\n<h2 id=\"二-hexo\"><a class=\"anchor\" href=\"#二-hexo\">#</a> 二、Hexo</h2>\n<h3 id=\"21-出现spawn-failed报错\"><a class=\"anchor\" href=\"#21-出现spawn-failed报错\">#</a> 2.1 出现Spawn Failed报错</h3>\n<p>首先尝试关机重启</p>\n<p>其次删除<code>.deploy_git</code>文件夹</p>\n<p>最后实在不行找到<code>.ssh</code>文件，先测试</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">ssh</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -T</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> git@github.com</span></span></code></pre>\n<p>如果出现22端口连接超时，改成443端口即可</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">Host</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> github.com</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">  HostName</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ssh.github.com</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">  Port</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 443</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">  User</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> git</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">  IdentityFile</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ~/.ssh/id_rsa</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">  IdentitiesOnly</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> yes</span></span></code></pre>\n",
            "tags": [
                "markdown"
            ]
        },
        {
            "id": "https://koen666.github.io/2025/07/27/latex/",
            "url": "https://koen666.github.io/2025/07/27/latex/",
            "title": "Latex常见数学公式",
            "date_published": "2025-07-27T00:29:00.000Z",
            "content_html": "<blockquote>\n<p>以下是常用的latex数学公式符号</p>\n</blockquote>\n<hr>\n<h2 id=\"一-基本结构\"><a class=\"anchor\" href=\"#一-基本结构\">#</a> 一、基本结构</h2>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-latex\"><span class=\"line\"><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\\</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> a</span><span style=\"color:#999999;--shiki-dark:#666666\">^</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"color:#999999;--shiki-dark:#666666\"> +</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> b</span><span style=\"color:#999999;--shiki-dark:#666666\">^</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> = c</span><span style=\"color:#999999;--shiki-dark:#666666\">^</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \\</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">           % 行内公式</span></span>\n<span class=\"line\"><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\\</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> a</span><span style=\"color:#999999;--shiki-dark:#666666\">^</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"color:#999999;--shiki-dark:#666666\"> +</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> b</span><span style=\"color:#999999;--shiki-dark:#666666\">^</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> = c</span><span style=\"color:#999999;--shiki-dark:#666666\">^</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \\</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">           % 单独一行公式</span></span></code></pre>\n<hr>\n<h2 id=\"二-基本数学符号\"><a class=\"anchor\" href=\"#二-基本数学符号\">#</a> 二、基本数学符号</h2>\n<table>\n<thead>\n<tr>\n<th>含义</th>\n<th>LaTeX</th>\n<th>显示</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>加法</td>\n<td><code>a + b</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mo>+</mo><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">a + b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span></td>\n</tr>\n<tr>\n<td>减法</td>\n<td><code>a - b</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mo>−</mo><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">a - b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span></td>\n</tr>\n<tr>\n<td>乘法</td>\n<td><code>a \\times b</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mo>×</mo><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">a \\times b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span></td>\n</tr>\n<tr>\n<td>除法</td>\n<td><code>a \\div b</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mo>÷</mo><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">a \\div b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">÷</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span></td>\n</tr>\n<tr>\n<td>分数</td>\n<td><code>\\frac{a}{b}</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mfrac><mi>a</mi><mi>b</mi></mfrac></mrow><annotation encoding=\"application/x-tex\">\\frac{a}{b}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0404em;vertical-align:-0.345em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6954em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">b</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">a</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></td>\n</tr>\n<tr>\n<td>次方</td>\n<td><code>a^n</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>a</mi><mi>n</mi></msup></mrow><annotation encoding=\"application/x-tex\">a^n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6644em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6644em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span></span></span></span></span></span></span></span></td>\n</tr>\n<tr>\n<td>开方</td>\n<td><code>\\sqrt{a}</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msqrt><mi>a</mi></msqrt></mrow><annotation encoding=\"application/x-tex\">\\sqrt{a}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.04em;vertical-align:-0.2397em;\"></span><span class=\"mord sqrt\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8003em;\"><span class=\"svg-align\" style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\" style=\"padding-left:0.833em;\"><span class=\"mord mathnormal\">a</span></span></span><span style=\"top:-2.7603em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"hide-tail\" style=\"min-width:0.853em;height:1.08em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"400em\" height=\"1.08em\" viewBox=\"0 0 400000 1080\" preserveAspectRatio=\"xMinYMin slice\"><path d=\"M95,702\nc-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14\nc0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54\nc44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10\ns173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429\nc69,-144,104.5,-217.7,106.5,-221\nl0 -0\nc5.3,-9.3,12,-14,20,-14\nH400000v40H845.2724\ns-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7\nc-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z\nM834 80h400000v40h-400000z\"></path></svg></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2397em;\"><span></span></span></span></span></span></span></span></span></td>\n</tr>\n<tr>\n<td>n次根</td>\n<td><code>\\sqrt[n]{a}</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mroot><mi>a</mi><mi>n</mi></mroot></mrow><annotation encoding=\"application/x-tex\">\\sqrt[n]{a}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.04em;vertical-align:-0.2397em;\"></span><span class=\"mord sqrt\"><span class=\"root\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.5516em;\"><span style=\"top:-2.8363em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size6 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span></span></span></span></span><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8003em;\"><span class=\"svg-align\" style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\" style=\"padding-left:0.833em;\"><span class=\"mord mathnormal\">a</span></span></span><span style=\"top:-2.7603em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"hide-tail\" style=\"min-width:0.853em;height:1.08em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"400em\" height=\"1.08em\" viewBox=\"0 0 400000 1080\" preserveAspectRatio=\"xMinYMin slice\"><path d=\"M95,702\nc-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14\nc0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54\nc44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10\ns173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429\nc69,-144,104.5,-217.7,106.5,-221\nl0 -0\nc5.3,-9.3,12,-14,20,-14\nH400000v40H845.2724\ns-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7\nc-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z\nM834 80h400000v40h-400000z\"></path></svg></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2397em;\"><span></span></span></span></span></span></span></span></span></td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h2 id=\"三-常用函数\"><a class=\"anchor\" href=\"#三-常用函数\">#</a> 三、常用函数</h2>\n<table>\n<thead>\n<tr>\n<th>函数</th>\n<th>LaTeX</th>\n<th>显示</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>正弦</td>\n<td><code>\\sin x</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>sin</mi><mo>⁡</mo><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">\\sin x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6679em;\"></span><span class=\"mop\">sin</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span></td>\n</tr>\n<tr>\n<td>余弦</td>\n<td><code>\\cos x</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>cos</mi><mo>⁡</mo><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">\\cos x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mop\">cos</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span></td>\n</tr>\n<tr>\n<td>正切</td>\n<td><code>\\tan x</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>tan</mi><mo>⁡</mo><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">\\tan x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6151em;\"></span><span class=\"mop\">tan</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span></td>\n</tr>\n<tr>\n<td>对数</td>\n<td><code>\\log x</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>log</mi><mo>⁡</mo><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">\\log x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span></td>\n</tr>\n<tr>\n<td>自然对数</td>\n<td><code>\\ln x</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>ln</mi><mo>⁡</mo><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">\\ln x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mop\">ln</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span></td>\n</tr>\n<tr>\n<td>指数函数</td>\n<td><code>e^x</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>e</mi><mi>x</mi></msup></mrow><annotation encoding=\"application/x-tex\">e^x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6644em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">e</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6644em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">x</span></span></span></span></span></span></span></span></span></span></span></td>\n</tr>\n<tr>\n<td>极限</td>\n<td><code>\\lim_{x\\to0}</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi>lim</mi><mo>⁡</mo></mrow><mrow><mi>x</mi><mo>→</mo><mn>0</mn></mrow></msub></mrow><annotation encoding=\"application/x-tex\">\\lim_{x\\to0}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"></span><span class=\"mop\"><span class=\"mop\">lim</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">x</span><span class=\"mrel mtight\">→</span><span class=\"mord mtight\">0</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h2 id=\"四-微积分符号\"><a class=\"anchor\" href=\"#四-微积分符号\">#</a> 四、微积分符号</h2>\n<table>\n<thead>\n<tr>\n<th>含义</th>\n<th>LaTeX</th>\n<th>显示</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>导数</td>\n<td><code>\\frac{dy}{dx}</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mfrac><mrow><mi>d</mi><mi>y</mi></mrow><mrow><mi>d</mi><mi>x</mi></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">\\frac{dy}{dx}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.2772em;vertical-align:-0.345em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9322em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">d</span><span class=\"mord mathnormal mtight\">x</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.4461em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">d</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">y</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></td>\n</tr>\n<tr>\n<td>偏导数</td>\n<td><code>\\frac{\\partial y}{\\partial x}</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mfrac><mrow><mi mathvariant=\"normal\">∂</mi><mi>y</mi></mrow><mrow><mi mathvariant=\"normal\">∂</mi><mi>x</mi></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">\\frac{\\partial y}{\\partial x}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.2772em;vertical-align:-0.345em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9322em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\" style=\"margin-right:0.05556em;\">∂</span><span class=\"mord mathnormal mtight\">x</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.4461em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\" style=\"margin-right:0.05556em;\">∂</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">y</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></td>\n</tr>\n<tr>\n<td>积分</td>\n<td><code>\\int_a^b f(x)dx</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msubsup><mo>∫</mo><mi>a</mi><mi>b</mi></msubsup><mi>f</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo><mtext> </mtext><mi>d</mi><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">\\int_a^b f(x)\\,dx</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.3998em;vertical-align:-0.3558em;\"></span><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"margin-right:0.19445em;position:relative;top:-0.0006em;\">∫</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.044em;\"><span style=\"top:-2.3442em;margin-left:-0.1945em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">a</span></span></span><span style=\"top:-3.2579em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">b</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3558em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">x</span></span></span></span></td>\n</tr>\n<tr>\n<td>多重积分</td>\n<td><code>\\iint</code>、<code>\\iiint</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>∬</mo><mspace width=\"1em\"></mspace><mo>∭</mo></mrow><annotation encoding=\"application/x-tex\">\\iint\\quad \\iiint</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.111em;vertical-align:-0.306em;\"></span><span class=\"mop op-symbol small-op\" style=\"margin-right:0.19445em;position:relative;top:-0.0005em;\">∬</span><span class=\"mspace\" style=\"margin-right:1em;\"></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop op-symbol small-op\" style=\"margin-right:0.19445em;position:relative;top:-0.0005em;\">∭</span></span></span></span></td>\n</tr>\n<tr>\n<td>无穷积分</td>\n<td><code>\\int_{-\\infty}^{\\infty}</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msubsup><mo>∫</mo><mrow><mo>−</mo><mi mathvariant=\"normal\">∞</mi></mrow><mi mathvariant=\"normal\">∞</mi></msubsup></mrow><annotation encoding=\"application/x-tex\">\\int_{-\\infty}^{\\infty}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.2734em;vertical-align:-0.4142em;\"></span><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"margin-right:0.19445em;position:relative;top:-0.0006em;\">∫</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8593em;\"><span style=\"top:-2.3442em;margin-left:-0.1945em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">−</span><span class=\"mord mtight\">∞</span></span></span></span><span style=\"top:-3.2579em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">∞</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.4142em;\"><span></span></span></span></span></span></span></span></span></span></td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h2 id=\"五-求和与乘积\"><a class=\"anchor\" href=\"#五-求和与乘积\">#</a> 五、求和与乘积</h2>\n<table>\n<thead>\n<tr>\n<th>含义</th>\n<th>LaTeX</th>\n<th>显示</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>求和</td>\n<td><code>\\sum_{i=1}^n a_i</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><msub><mi>a</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\sum_{i=1}^n a_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.104em;vertical-align:-0.2997em;\"></span><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"position:relative;top:0em;\">∑</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8043em;\"><span style=\"top:-2.4003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mrel mtight\">=</span><span class=\"mord mtight\">1</span></span></span></span><span style=\"top:-3.2029em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2997em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></td>\n</tr>\n<tr>\n<td>连乘积</td>\n<td><code>\\prod_{i=1}^n a_i</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msubsup><mo>∏</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><msub><mi>a</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\prod_{i=1}^n a_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.104em;vertical-align:-0.2997em;\"></span><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"position:relative;top:0em;\">∏</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8043em;\"><span style=\"top:-2.4003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mrel mtight\">=</span><span class=\"mord mtight\">1</span></span></span></span><span style=\"top:-3.2029em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2997em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></td>\n</tr>\n<tr>\n<td>上下限形式</td>\n<td><code>\\lim_{x\\to0}</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi>lim</mi><mo>⁡</mo></mrow><mrow><mi>x</mi><mo>→</mo><mn>0</mn></mrow></msub></mrow><annotation encoding=\"application/x-tex\">\\lim_{x\\to0}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"></span><span class=\"mop\"><span class=\"mop\">lim</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">x</span><span class=\"mrel mtight\">→</span><span class=\"mord mtight\">0</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h2 id=\"六-矩阵\"><a class=\"anchor\" href=\"#六-矩阵\">#</a> 六、矩阵</h2>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-latex\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">begin</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">bmatrix</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">a </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">&amp;</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> b </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">\\\\</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">c </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">&amp;</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> d</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">end</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">bmatrix</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span></code></pre>\n<p>显示为：</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mo fence=\"true\">[</mo><mtable rowspacing=\"0.16em\" columnalign=\"center center\" columnspacing=\"1em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi>a</mi></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi>b</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi>c</mi></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi>d</mi></mstyle></mtd></mtr></mtable><mo fence=\"true\">]</mo></mrow><annotation encoding=\"application/x-tex\">\\begin{bmatrix}\na &amp; b \\\\\nc &amp; d\n\\end{bmatrix}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:2.4em;vertical-align:-0.95em;\"></span><span class=\"minner\"><span class=\"mopen delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size3\">[</span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.45em;\"><span style=\"top:-3.61em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span></span></span><span style=\"top:-2.41em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">c</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.95em;\"><span></span></span></span></span></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.45em;\"><span style=\"top:-3.61em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span></span></span><span style=\"top:-2.41em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">d</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.95em;\"><span></span></span></span></span></span></span></span><span class=\"mclose delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size3\">]</span></span></span></span></span></span></span></p>\n<hr>\n<h2 id=\"七-逻辑与集合符号\"><a class=\"anchor\" href=\"#七-逻辑与集合符号\">#</a> 七、逻辑与集合符号</h2>\n<table>\n<thead>\n<tr>\n<th>含义</th>\n<th>LaTeX</th>\n<th>显示</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>属于</td>\n<td><code>\\in</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>∈</mo></mrow><annotation encoding=\"application/x-tex\">\\in</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mrel\">∈</span></span></span></span></td>\n</tr>\n<tr>\n<td>不属于</td>\n<td><code>\\notin</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo mathvariant=\"normal\">∉</mo></mrow><annotation encoding=\"application/x-tex\">\\notin</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mrel\"><span class=\"mord\"><span class=\"mrel\">∈</span></span><span class=\"mord vbox\"><span class=\"thinbox\"><span class=\"llap\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"inner\"><span class=\"mord\"><span class=\"mord\">/</span><span class=\"mspace\" style=\"margin-right:0.0556em;\"></span></span></span><span class=\"fix\"></span></span></span></span></span></span></span></span></td>\n</tr>\n<tr>\n<td>包含于</td>\n<td><code>\\subset</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>⊂</mo></mrow><annotation encoding=\"application/x-tex\">\\subset</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mrel\">⊂</span></span></span></span></td>\n</tr>\n<tr>\n<td>真包含</td>\n<td><code>\\subsetneq</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>⊊</mo></mrow><annotation encoding=\"application/x-tex\">\\subsetneq</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7719em;vertical-align:-0.136em;\"></span><span class=\"mrel amsrm\">⊊</span></span></span></span></td>\n</tr>\n<tr>\n<td>交集</td>\n<td><code>\\cap</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>∩</mo></mrow><annotation encoding=\"application/x-tex\">\\cap</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5556em;\"></span><span class=\"mord\">∩</span></span></span></span></td>\n</tr>\n<tr>\n<td>并集</td>\n<td><code>\\cup</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>∪</mo></mrow><annotation encoding=\"application/x-tex\">\\cup</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5556em;\"></span><span class=\"mord\">∪</span></span></span></span></td>\n</tr>\n<tr>\n<td>空集</td>\n<td><code>\\emptyset</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">∅</mi></mrow><annotation encoding=\"application/x-tex\">\\emptyset</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8056em;vertical-align:-0.0556em;\"></span><span class=\"mord\">∅</span></span></span></span></td>\n</tr>\n<tr>\n<td>全体实数</td>\n<td><code>\\mathbb{R}</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">R</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbb{R}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord mathbb\">R</span></span></span></span></td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h2 id=\"八-常见关系符号\"><a class=\"anchor\" href=\"#八-常见关系符号\">#</a> 八、常见关系符号</h2>\n<table>\n<thead>\n<tr>\n<th>含义</th>\n<th>LaTeX</th>\n<th>显示</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>大于</td>\n<td><code>&gt;</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>&gt;</mo></mrow><annotation encoding=\"application/x-tex\">&gt;</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mrel\">&gt;</span></span></span></span></td>\n</tr>\n<tr>\n<td>小于</td>\n<td><code>&lt;</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>&lt;</mo></mrow><annotation encoding=\"application/x-tex\">&lt;</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mrel\">&lt;</span></span></span></span></td>\n</tr>\n<tr>\n<td>大于等于</td>\n<td><code>\\ge</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>≥</mo></mrow><annotation encoding=\"application/x-tex\">\\ge</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7719em;vertical-align:-0.136em;\"></span><span class=\"mrel\">≥</span></span></span></span></td>\n</tr>\n<tr>\n<td>小于等于</td>\n<td><code>\\le</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>≤</mo></mrow><annotation encoding=\"application/x-tex\">\\le</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7719em;vertical-align:-0.136em;\"></span><span class=\"mrel\">≤</span></span></span></span></td>\n</tr>\n<tr>\n<td>不等于</td>\n<td><code>\\neq</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo mathvariant=\"normal\">≠</mo></mrow><annotation encoding=\"application/x-tex\">\\neq</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mrel\"><span class=\"mrel\"><span class=\"mord vbox\"><span class=\"thinbox\"><span class=\"rlap\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"inner\"><span class=\"mord\"><span class=\"mrel\"></span></span></span><span class=\"fix\"></span></span></span></span></span><span class=\"mrel\">=</span></span></span></span></span></td>\n</tr>\n<tr>\n<td>恒等于</td>\n<td><code>\\equiv</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>≡</mo></mrow><annotation encoding=\"application/x-tex\">\\equiv</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4637em;\"></span><span class=\"mrel\">≡</span></span></span></span></td>\n</tr>\n<tr>\n<td>约等于</td>\n<td><code>\\approx</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>≈</mo></mrow><annotation encoding=\"application/x-tex\">\\approx</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4831em;\"></span><span class=\"mrel\">≈</span></span></span></span></td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h2 id=\"九-其他符号\"><a class=\"anchor\" href=\"#九-其他符号\">#</a> 九、其他符号</h2>\n<table>\n<thead>\n<tr>\n<th>符号/用途</th>\n<th>LaTeX</th>\n<th>显示</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>向量</td>\n<td><code>\\vec{v}</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mover accent=\"true\"><mi>v</mi><mo>⃗</mo></mover></mrow><annotation encoding=\"application/x-tex\">\\vec{v}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.714em;\"></span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.714em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.2077em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"0.471em\" height=\"0.714em\" style=\"width:0.471em\" viewBox=\"0 0 471 714\" preserveAspectRatio=\"xMinYMin\"><path d=\"M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z\"></path></svg></span></span></span></span></span></span></span></span></span></span></td>\n</tr>\n<tr>\n<td>点积</td>\n<td><code>\\cdot</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mo>⋅</mo><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">a \\cdot b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4445em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span></td>\n</tr>\n<tr>\n<td>交叉乘积</td>\n<td><code>\\times</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mo>×</mo><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">a \\times b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span></td>\n</tr>\n<tr>\n<td>垂直</td>\n<td><code>\\perp</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>⊥</mo></mrow><annotation encoding=\"application/x-tex\">\\perp</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mrel\">⊥</span></span></span></span></td>\n</tr>\n<tr>\n<td>平行</td>\n<td><code>\\parallel</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>∥</mo></mrow><annotation encoding=\"application/x-tex\">\\parallel</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mrel\">∥</span></span></span></span></td>\n</tr>\n<tr>\n<td>推出</td>\n<td><code>\\Rightarrow</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>⇒</mo></mrow><annotation encoding=\"application/x-tex\">\\Rightarrow</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.3669em;\"></span><span class=\"mrel\">⇒</span></span></span></span></td>\n</tr>\n<tr>\n<td>等价</td>\n<td><code>\\Leftrightarrow</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>⇔</mo></mrow><annotation encoding=\"application/x-tex\">\\Leftrightarrow</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.3669em;\"></span><span class=\"mrel\">⇔</span></span></span></span></td>\n</tr>\n</tbody>\n</table>\n<hr>\n",
            "tags": [
                "math",
                "latex"
            ]
        }
    ]
}