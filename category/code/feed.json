{
    "version": "https://jsonfeed.org/version/1",
    "title": "木语 • All posts by \"code\" category",
    "description": "Spark!",
    "home_page_url": "http://example.com",
    "items": [
        {
            "id": "http://example.com/2025/11/28/pipenv/",
            "url": "http://example.com/2025/11/28/pipenv/",
            "title": "像前端package.json那样管理python依赖 (uv篇)",
            "date_published": "2025-11-27T16:00:00.000Z",
            "content_html": "<blockquote>\n<p><strong>Update 2025:</strong> 时代变了。虽然 Pipenv 曾经是很好的选择，但现在由 Rust 编写的 <code>uv</code> 才是版本答案。它比 pip 快 10-100 倍，且完美支持 <code>pyproject.toml</code> 标准。</p>\n</blockquote>\n<h3 id=\"1-安装-uv-the-new-standard\"><a class=\"anchor\" href=\"#1-安装-uv-the-new-standard\">#</a> 1. 安装 uv (The New Standard)</h3>\n<p>不需要先装 Python，uv甚至可以帮你管理 Python 版本。</p>\n<p><strong>Mac / Linux:</strong></p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">curl</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -LsSf</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">https://astral.sh/uv/install.sh</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">https://astral.sh/uv/install.sh</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">|</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> sh</span></span></code></pre>\n<p><strong>Windows (PowerShell):</strong></p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-powershell\"><span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">powershell </span><span style=\"color:#999999;--shiki-dark:#666666\">-</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">c </span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">irm [https://astral.sh/uv/install.ps1](https://astral.sh/uv/install.ps1) | iex</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span></code></pre>\n<h3 id=\"2-初始化项目-npm-init\"><a class=\"anchor\" href=\"#2-初始化项目-npm-init\">#</a> 2. 初始化项目 (npm init)</h3>\n<p>进入你的项目目录，执行初始化：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">uv</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> init</span></span></code></pre>\n<p>或者创建一个新项目：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">uv</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> init</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> my-project</span></span></code></pre>\n<p>你的目录下会出现两个核心文件，完美对应前端习惯：</p>\n<ul>\n<li><strong><code>pyproject.toml</code></strong> <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>≈</mo></mrow><annotation encoding=\"application/x-tex\">\\approx</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4831em;\"></span><span class=\"mrel\">≈</span></span></span></span>  <code>package.json</code> (定义项目元数据和依赖)</li>\n<li><strong><code>uv.lock</code></strong> <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>≈</mo></mrow><annotation encoding=\"application/x-tex\">\\approx</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4831em;\"></span><span class=\"mrel\">≈</span></span></span></span>  <code>package-lock.json</code> (锁定依赖具体版本)</li>\n</ul>\n<h3 id=\"3-安装依赖-npm-install-xxx\"><a class=\"anchor\" href=\"#3-安装依赖-npm-install-xxx\">#</a> 3. 安装依赖 (npm install xxx)</h3>\n<p>告别 <code>pip install</code>，现在我们用 <code>add</code>。</p>\n<p><strong>安装普通依赖：</strong></p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">uv</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> add</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> requests</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 甚至可以指定版本</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">uv</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> add</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">flask&gt;=2.0</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span></code></pre>\n<p><strong>安装开发依赖 (DevDependencies):</strong></p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">uv</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> add</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --dev</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> pytest</span></span></code></pre>\n<h3 id=\"4-迁移旧项目-requirementstxt\"><a class=\"anchor\" href=\"#4-迁移旧项目-requirementstxt\">#</a> 4. 迁移旧项目 (requirements.txt)</h3>\n<p>如果你有一个老的 <code>requirements.txt</code>，不需要像以前那样用 PowerShell 转码了，<code>uv</code> 对编码支持很好，直接读取并添加到 <code>pyproject.toml</code> 中：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">uv</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> add</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -r</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> requirements.txt</span></span></code></pre>\n<p>执行完这一步，你的旧项目就瞬间完成了“现代化”改造。</p>\n<h3 id=\"5-一键同步环境-npm-install\"><a class=\"anchor\" href=\"#5-一键同步环境-npm-install\">#</a> 5. 一键同步环境 (npm install)</h3>\n<p>当你把代码 clone 下来，或者拉取了队友的代码后，只需要一个命令就能把所有依赖（包括 Python 解释器本身）全部装好：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">uv</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> sync</span></span></code></pre>\n<p>它会自动创建虚拟环境（默认在 <code>.venv</code>），你无需手动配置。</p>\n<h3 id=\"6-运行代码-npm-run-start\"><a class=\"anchor\" href=\"#6-运行代码-npm-run-start\">#</a> 6. 运行代码 (npm run start)</h3>\n<p>不需要手动激活虚拟环境（<code>source venv/bin/activate</code> 已经是过去式了），直接用 <code>uv run</code>：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 运行脚本</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">uv</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> run</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> app.py</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 运行模块</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">uv</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> run</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> python</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -m</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> http.server</span></span></code></pre>\n<p>uv 会自动检测并使用项目环境中的 Python。</p>\n<hr>\n<h3 id=\"总结前端-vs-python-uv版-对照表\"><a class=\"anchor\" href=\"#总结前端-vs-python-uv版-对照表\">#</a> 总结：前端 vs Python (uv版) 对照表</h3>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">前端 (Node/NPM)</th>\n<th style=\"text-align:left\">Python (uv)</th>\n<th style=\"text-align:left\">说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><code>package.json</code></td>\n<td style=\"text-align:left\"><code>pyproject.toml</code></td>\n<td style=\"text-align:left\">项目配置文件</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>package-lock.json</code></td>\n<td style=\"text-align:left\"><code>uv.lock</code></td>\n<td style=\"text-align:left\">版本锁定文件</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>npm init</code></td>\n<td style=\"text-align:left\"><code>uv init</code></td>\n<td style=\"text-align:left\">初始化</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>npm install axios</code></td>\n<td style=\"text-align:left\"><code>uv add requests</code></td>\n<td style=\"text-align:left\">安装依赖</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>npm install</code></td>\n<td style=\"text-align:left\"><code>uv sync</code></td>\n<td style=\"text-align:left\"><strong>一键安装所有依赖</strong></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>npm run start</code></td>\n<td style=\"text-align:left\"><code>uv run app.py</code></td>\n<td style=\"text-align:left\">使用环境运行</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>nvm use 18</code></td>\n<td style=\"text-align:left\"><code>uv python pin 3.12</code></td>\n<td style=\"text-align:left\"><strong>管理语言版本</strong></td>\n</tr>\n</tbody>\n</table>\n",
            "tags": [
                "python",
                "uv",
                "environment"
            ]
        },
        {
            "id": "http://example.com/2025/08/25/Koa/",
            "url": "http://example.com/2025/08/25/Koa/",
            "title": "Koa 框架使用",
            "date_published": "2025-08-25T05:20:00.000Z",
            "content_html": "<h2 id=\"0-准备工作\"><a class=\"anchor\" href=\"#0-准备工作\">#</a> 0. 准备工作</h2>\n<h3 id=\"01-安装-nodejs建议-node-18\"><a class=\"anchor\" href=\"#01-安装-nodejs建议-node-18\">#</a> 0.1 安装 Node.js（建议 Node 18+）</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">node</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -v</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># v18.x 或更高</span></span></code></pre>\n<h3 id=\"02-新建项目目录并初始化\"><a class=\"anchor\" href=\"#02-新建项目目录并初始化\">#</a> 0.2 新建项目目录并初始化</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">mkdir</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> koa-step-by-step</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">cd</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> koa-step-by-step</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">npm</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> init</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -y</span></span></code></pre>\n<h3 id=\"03-esm-设置强烈建议\"><a class=\"anchor\" href=\"#03-esm-设置强烈建议\">#</a> 0.3 ESM 设置（强烈建议）</h3>\n<p>在 <code>package.json</code> 顶层加入：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-json\"><span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">  \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">type</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">module</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span></code></pre>\n<blockquote>\n<p>作用：让 Node 默认使用 ES 模块语法（<code>import</code>/<code>export</code>），并支持 <code>.mjs</code> 文件。</p>\n</blockquote>\n<h3 id=\"04-推荐本地开发脚本可热重载\"><a class=\"anchor\" href=\"#04-推荐本地开发脚本可热重载\">#</a> 0.4 推荐本地开发脚本（可热重载）</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">npm</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> i</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -D</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> nodemon</span></span></code></pre>\n<p>在 <code>package.json</code> 里加入：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-json\"><span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">  \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">scripts</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">    \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">dev</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">nodemon --ext mjs,js,json --watch . app.mjs</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#99841877;--shiki-dark:#B8A96577\">    \"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">start</span><span style=\"color:#99841877;--shiki-dark:#B8A96577\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">node app.mjs</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span></code></pre>\n<blockquote>\n<p>以后 <code>npm run dev</code> 就会自动重启，开发体验更好。</p>\n</blockquote>\n<hr>\n<h2 id=\"1-阶段-a最小可运行的-koa无路由-无中间件栈\"><a class=\"anchor\" href=\"#1-阶段-a最小可运行的-koa无路由-无中间件栈\">#</a> 1. 阶段 A：最小可运行的 Koa（无路由、无中间件栈）</h2>\n<h3 id=\"11-安装-koa\"><a class=\"anchor\" href=\"#11-安装-koa\">#</a> 1.1 安装 Koa</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">npm</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> i</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> koa</span></span></code></pre>\n<h3 id=\"12-新建-appmjs\"><a class=\"anchor\" href=\"#12-新建-appmjs\">#</a> 1.2 新建 <code>app.mjs</code></h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-js\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// app.mjs（阶段A）</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 目标：</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 1）启动一个最简单的 Koa 服务器</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 2）所有请求都返回 \"Hello Koa\" 文本</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> Koa</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">koa</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">   // 引入 Koa 主类</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> app</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> new</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Koa</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">   // 创建 Koa 实例</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// app.use() 注册一个中间件函数（每个请求都会走这里）</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 这是最简单的中间件：设置响应体即可</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">use</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">async</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  // ctx 是“上下文对象”，封装了 Request 和 Response 等常用属性</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Hello Koa</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 返回纯文本</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 启动 HTTP 服务，监听端口 3000</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">listen</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">3000</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  console</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">log</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">✅ Server running at http://localhost:3000</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  console</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">log</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">   当前阶段：A（最小可运行服务）</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span></code></pre>\n<h3 id=\"13-运行\"><a class=\"anchor\" href=\"#13-运行\">#</a> 1.3 运行</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">npm</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> run</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> start</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 或</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">npm</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> run</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> dev</span></span></code></pre>\n<p>浏览器打开 <a href=\"http://localhost:3000\">http://localhost:3000</a> ，能看到 <strong>Hello Koa</strong>。</p>\n<hr>\n<h2 id=\"2-阶段-b引入路由koa-router让不同路径走不同逻辑\"><a class=\"anchor\" href=\"#2-阶段-b引入路由koa-router让不同路径走不同逻辑\">#</a> 2. 阶段 B：引入路由（koa-router），让不同路径走不同逻辑</h2>\n<h3 id=\"21-安装路由中间件\"><a class=\"anchor\" href=\"#21-安装路由中间件\">#</a> 2.1 安装路由中间件</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">npm</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> i</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> koa-router</span></span></code></pre>\n<h3 id=\"22-新建-routesindexmjs\"><a class=\"anchor\" href=\"#22-新建-routesindexmjs\">#</a> 2.2 新建 <code>routes/index.mjs</code></h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-js\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// routes/index.mjs（阶段B）</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 目标：为不同 URL 配置不同处理函数</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> Router</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">koa-router</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 创建路由实例，并统一加上前缀（可选）</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> router</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> new</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Router</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> prefix</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/api</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// GET /api/hello -&gt; 返回简单文本</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">get</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/hello</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Hello from /api/hello</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// GET /api/user/:id -&gt; 返回路径参数</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">get</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/user/:id</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  // 通过 ctx.params 获取 :id 的值</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> id</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">params</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> message</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> `</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">你请求的用户ID是 </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">${</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">id</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">}</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">`</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> default</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> router</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span></code></pre>\n<h3 id=\"23-修改-appmjs-使用路由\"><a class=\"anchor\" href=\"#23-修改-appmjs-使用路由\">#</a> 2.3 修改 <code>app.mjs</code> 使用路由</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-js\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// app.mjs（阶段B）</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> Koa</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">koa</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> router</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">./routes/index.mjs</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 引入路由</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> app</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> new</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Koa</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 将路由注册到应用（注意两步：routes + allowedMethods）</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">use</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">routes</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">use</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">allowedMethods</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">listen</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">3000</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  console</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">log</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">✅ Server running at http://localhost:3000</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  console</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">log</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">   当前阶段：B（已加入路由）</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span></code></pre>\n<p>此时访问：</p>\n<ul>\n<li>GET <code>http://localhost:3000/api/hello</code></li>\n<li>GET <code>http://localhost:3000/api/user/123</code></li>\n</ul>\n<hr>\n<h2 id=\"3-阶段-c解析请求体koa-bodyparser并实现第一个-post-api\"><a class=\"anchor\" href=\"#3-阶段-c解析请求体koa-bodyparser并实现第一个-post-api\">#</a> 3. 阶段 C：解析请求体（koa-bodyparser）并实现第一个 POST API</h2>\n<h3 id=\"31-安装-body-解析中间件\"><a class=\"anchor\" href=\"#31-安装-body-解析中间件\">#</a> 3.1 安装 body 解析中间件</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">npm</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> i</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> koa-bodyparser</span></span></code></pre>\n<h3 id=\"32-在-appmjs-启用-bodyparser\"><a class=\"anchor\" href=\"#32-在-appmjs-启用-bodyparser\">#</a> 3.2 在 <code>app.mjs</code> 启用 bodyParser</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-js\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// app.mjs（阶段C）</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> Koa</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">koa</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> bodyParser</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">koa-bodyparser</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> router</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">./routes/index.mjs</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> app</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> new</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Koa</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 解析 JSON / x-www-form-urlencoded 请求体</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">use</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">bodyParser</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">use</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">routes</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">use</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">allowedMethods</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">listen</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">3000</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  console</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">log</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">✅ Server running at http://localhost:3000</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  console</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">log</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">   当前阶段：C（支持解析请求体 &amp; POST 请求）</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span></code></pre>\n<h3 id=\"33-在路由里加一个-post-示例\"><a class=\"anchor\" href=\"#33-在路由里加一个-post-示例\">#</a> 3.3 在路由里加一个 POST 示例</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-js\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// routes/index.mjs（阶段C，新增 POST 路由）</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> Router</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">koa-router</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> router</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> new</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Router</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> prefix</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/api</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">get</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/hello</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Hello from /api/hello</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">get</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/user/:id</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> id</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">params</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> message</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> `</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">你请求的用户ID是 </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">${</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">id</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">}</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">`</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// POST /api/echo -&gt; 回显请求体</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">post</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/echo</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  // 通过 ctx.request.body 获取 JSON 或表单提交的数据</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> body</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">request</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">    received</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> body</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  // 回显你发过来的数据</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">    tip</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">你已成功通过 POST 发送数据到 Koa 服务端</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> default</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> router</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span></code></pre>\n<p><strong>测试 POST：</strong></p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># Mac/Linux</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">curl</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -X</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> POST</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> http://localhost:3000/api/echo</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#A65E2B;--shiki-dark:#C99076\">  -H</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Content-Type: application/json</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#A65E2B;--shiki-dark:#C99076\">  -d</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">{\"name\":\"Alice\",\"age\":20}</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># Windows PowerShell（注意引号）</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">curl</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -X</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> POST</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> http://localhost:3000/api/echo</span><span style=\"color:#999999;--shiki-dark:#666666\"> `</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">  -H</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Content-Type: application/json</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\"> `</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">  -d</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">{</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">name</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Alice</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">age</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">:20}</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span></code></pre>\n<hr>\n<h2 id=\"4-阶段-d全局错误处理-日志打印理解洋葱模型\"><a class=\"anchor\" href=\"#4-阶段-d全局错误处理-日志打印理解洋葱模型\">#</a> 4. 阶段 D：全局错误处理 + 日志打印（理解“洋葱模型”）</h2>\n<h3 id=\"41-在-appmjs-添加错误捕获中间件\"><a class=\"anchor\" href=\"#41-在-appmjs-添加错误捕获中间件\">#</a> 4.1 在 <code>app.mjs</code> 添加错误捕获中间件</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-js\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// app.mjs（阶段D）</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> Koa</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">koa</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> bodyParser</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">koa-bodyparser</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> router</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">./routes/index.mjs</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> app</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> new</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Koa</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// ① 全局错误处理中间件（最外层）：try/catch 所有下游中间件的异常</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">use</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">async</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> next</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> start</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> Date</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">now</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 统计耗时</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  try</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    await</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> next</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">           // 交给下一个中间件</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> catch</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">err</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 统一错误响应格式</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">status</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> err</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">status</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ||</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 500</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> code</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">status</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> message</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> err</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">message</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ||</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Server Error</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 打印到控制台方便定位</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    console</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">error</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">❌ Error:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> err</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> finally</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> ms</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> Date</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">now</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> start</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 记录访问日志</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    console</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">log</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">`</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">${</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">method</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">}</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> ${</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">url</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">}</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> - </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">${</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">status </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">||</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 200</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">}</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> ${</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">ms</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">}</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">ms</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">`</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// ② 解析请求体</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">use</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">bodyParser</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// ③ 注册业务路由</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">use</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">routes</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">use</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">allowedMethods</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">listen</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">3000</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  console</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">log</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">✅ Server running at http://localhost:3000</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  console</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">log</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">   当前阶段：D（全局错误处理 &amp; 访问日志）</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span></code></pre>\n<p><strong>理解洋葱模型</strong>：最外层中间件先进入，<code>await next()</code> 后进入下一层；当下一层返回时，回到上一层继续执行 <code>finally</code> 等收尾逻辑。</p>\n<h3 id=\"42-在路由里人为抛错试试看\"><a class=\"anchor\" href=\"#42-在路由里人为抛错试试看\">#</a> 4.2 在路由里人为抛错试试看</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-js\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// routes/index.mjs（阶段D，增加一个错误示例）</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> Router</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">koa-router</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> router</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> new</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Router</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> prefix</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/api</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">get</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/boom</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  // 主动抛出一个错误，观察上文错误处理中间件如何工作</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> err</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> new</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Error</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">模拟服务端异常：/api/boom</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  err</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">status</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 418</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 仅演示，418是Teapot彩蛋状态码</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  throw</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> err</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> default</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> router</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span></code></pre>\n<p>访问 <code>GET /api/boom</code>，你会看到结构化的错误响应 + 控制台日志。</p>\n<hr>\n<h2 id=\"5-阶段-e静态资源与-favicon避免多次计数404\"><a class=\"anchor\" href=\"#5-阶段-e静态资源与-favicon避免多次计数404\">#</a> 5. 阶段 E：静态资源与 favicon（避免多次计数/404）</h2>\n<h3 id=\"51-安装-koa-static\"><a class=\"anchor\" href=\"#51-安装-koa-static\">#</a> 5.1 安装 koa-static</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">npm</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> i</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> koa-static</span></span></code></pre>\n<h3 id=\"52-在项目根目录建-public\"><a class=\"anchor\" href=\"#52-在项目根目录建-public\">#</a> 5.2 在项目根目录建 <code>public/</code></h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-text\"><span class=\"line\"><span>koa-step-by-step/</span></span>\n<span class=\"line\"><span>├─ app.mjs</span></span>\n<span class=\"line\"><span>├─ routes/</span></span>\n<span class=\"line\"><span>│  └─ index.mjs</span></span>\n<span class=\"line\"><span>└─ public/</span></span>\n<span class=\"line\"><span>   ├─ index.html</span></span>\n<span class=\"line\"><span>   └─ favicon.ico (可选)</span></span></code></pre>\n<p>简单写一个 <code>public/index.html</code>：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-html\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">&lt;!</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">doctype</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> html</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">&lt;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">html</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  &lt;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">head</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;&lt;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">meta</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> charset</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">utf-8</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;&lt;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">title</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Koa Static</span><span style=\"color:#999999;--shiki-dark:#666666\">&lt;/</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">title</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;&lt;/</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">head</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  &lt;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">body</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    &lt;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">h1</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Hello Static</span><span style=\"color:#999999;--shiki-dark:#666666\">&lt;/</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">h1</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    &lt;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">p</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">这是 public/index.html 静态页面。</span><span style=\"color:#999999;--shiki-dark:#666666\">&lt;/</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">p</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  &lt;/</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">body</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">&lt;/</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">html</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span></span></code></pre>\n<h3 id=\"53-修改-appmjs-启用静态资源\"><a class=\"anchor\" href=\"#53-修改-appmjs-启用静态资源\">#</a> 5.3 修改 <code>app.mjs</code> 启用静态资源</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-js\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// app.mjs（阶段E）</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> Koa</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">koa</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> bodyParser</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">koa-bodyparser</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> serve</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">koa-static</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> path</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">path</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> fileURLToPath</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">url</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> router</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">./routes/index.mjs</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> __filename</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> fileURLToPath</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#998418;--shiki-dark:#B8A965\">meta</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">url</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> __dirname</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> path</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">dirname</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">__filename</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> app</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> new</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Koa</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">use</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">async</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> next</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> start</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> Date</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">now</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  try</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    await</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> next</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> catch</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">err</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">status</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> err</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">status</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ||</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 500</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> code</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">status</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> message</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> err</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">message</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ||</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Server Error</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    console</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">error</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">❌ Error:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> err</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> finally</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> ms</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> Date</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">now</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> start</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    console</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">log</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">`</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">${</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">method</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">}</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> ${</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">url</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">}</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> - </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">${</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">status </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">||</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 200</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">}</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> ${</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">ms</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">}</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">ms</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">`</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">use</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">bodyParser</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 开放 public 目录为静态资源根目录：访问 / 即可打开 public/index.html</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">use</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">serve</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">path</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">join</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">__dirname</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">public</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">use</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">routes</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">use</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">allowedMethods</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">listen</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">3000</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  console</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">log</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">✅ Server running at http://localhost:3000</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  console</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">log</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">   当前阶段：E（支持静态资源与 favicon）</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span></code></pre>\n<p>现在访问 <code>http://localhost:3000/</code> 就能看到静态页面。</p>\n<blockquote>\n<p><strong>提示</strong>：许多浏览器会自动请求 <code>/favicon.ico</code>。如果没有图标，偶尔会触发两次访问等“小惊喜”。把 <code>favicon.ico</code> 放到 <code>public/</code> 里，可以避免这类困扰。</p>\n</blockquote>\n<hr>\n<h2 id=\"6-阶段-f可选模板渲染服务器端渲染一个简单页面\"><a class=\"anchor\" href=\"#6-阶段-f可选模板渲染服务器端渲染一个简单页面\">#</a> 6. 阶段 F（可选）：模板渲染（服务器端渲染一个简单页面）</h2>\n<blockquote>\n<p>如果你的服务只做 API，可跳过本节。这里展示如何用 <strong>EJS</strong> 渲染模板。</p>\n</blockquote>\n<h3 id=\"61-安装依赖\"><a class=\"anchor\" href=\"#61-安装依赖\">#</a> 6.1 安装依赖</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">npm</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> i</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> koa-views</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ejs</span></span></code></pre>\n<h3 id=\"62-目录结构新增-views\"><a class=\"anchor\" href=\"#62-目录结构新增-views\">#</a> 6.2 目录结构新增 <code>views/</code></h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-text\"><span class=\"line\"><span>koa-step-by-step/</span></span>\n<span class=\"line\"><span>├─ app.mjs</span></span>\n<span class=\"line\"><span>├─ routes/</span></span>\n<span class=\"line\"><span>│  └─ index.mjs</span></span>\n<span class=\"line\"><span>├─ public/</span></span>\n<span class=\"line\"><span>│  └─ index.html</span></span>\n<span class=\"line\"><span>└─ views/</span></span>\n<span class=\"line\"><span>   └─ home.ejs</span></span></code></pre>\n<p><code>views/home.ejs</code>：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-html\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">&lt;!</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">doctype</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> html</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">&lt;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">html</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  &lt;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">head</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;&lt;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">meta</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> charset</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">utf-8</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;&lt;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">title</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">EJS Demo</span><span style=\"color:#999999;--shiki-dark:#666666\">&lt;/</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">title</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;&lt;/</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">head</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  &lt;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">body</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    &lt;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">h1</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic\">&lt;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">%= title %&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\">&lt;/</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">h1</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    &lt;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">p</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">服务器时间：</span><span style=\"color:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic\">&lt;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">%= now %&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\">&lt;/</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">p</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  &lt;/</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">body</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">&lt;/</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">html</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span></span></code></pre>\n<h3 id=\"63-在-appmjs-配置视图中间件\"><a class=\"anchor\" href=\"#63-在-appmjs-配置视图中间件\">#</a> 6.3 在 <code>app.mjs</code> 配置视图中间件</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-js\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// app.mjs（阶段F）</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> Koa</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">koa</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> bodyParser</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">koa-bodyparser</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> serve</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">koa-static</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> views</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">koa-views</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> path</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">path</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> fileURLToPath</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">url</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> router</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">./routes/index.mjs</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> __filename</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> fileURLToPath</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#998418;--shiki-dark:#B8A965\">meta</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">url</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> __dirname</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> path</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">dirname</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">__filename</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> app</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> new</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Koa</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">use</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">async</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> next</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  try</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> next</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> catch</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">err</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">status</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> err</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">status</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ||</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 500</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> code</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">status</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> message</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> err</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">message</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ||</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Server Error</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">use</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">bodyParser</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">use</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">serve</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">path</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">join</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">__dirname</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">public</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 配置视图目录与模板引擎</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">use</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">views</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">path</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">join</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">__dirname</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">views</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> extension</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">ejs</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">use</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">routes</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">use</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">allowedMethods</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">listen</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">3000</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  console</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">log</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">✅ Server running at http://localhost:3000</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  console</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">log</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">   当前阶段：F（支持 EJS 模板渲染）</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span></code></pre>\n<h3 id=\"64-在路由中渲染一个页面\"><a class=\"anchor\" href=\"#64-在路由中渲染一个页面\">#</a> 6.4 在路由中渲染一个页面</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-js\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// routes/index.mjs（阶段F，新增 SSR 路由）</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> Router</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">koa-router</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> router</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> new</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Router</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> prefix</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/api</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// ...前面的接口保留</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// GET /page/home -&gt; 渲染 EJS 模板（注意：此路由无 /api 前缀更合适，这里仅演示）</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">get</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/page/home</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  await</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">render</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">home</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">{</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">    title</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">EJS 模板渲染示例</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">    now</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> new</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Date</span><span style=\"color:#bda437;--shiki-dark:#e6cc77\">(</span><span style=\"color:#bda437;--shiki-dark:#e6cc77\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">toLocaleString</span><span style=\"color:#bda437;--shiki-dark:#e6cc77\">(</span><span style=\"color:#bda437;--shiki-dark:#e6cc77\">)</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">}</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> default</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> router</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span></code></pre>\n<hr>\n<h2 id=\"7-阶段-g逐步rest-化-用内存数组先做-crud\"><a class=\"anchor\" href=\"#7-阶段-g逐步rest-化-用内存数组先做-crud\">#</a> 7. 阶段 G：逐步“REST 化” —— 用内存数组先做 CRUD</h2>\n<blockquote>\n<p>先<strong>不接数据库</strong>，用内存数组模拟数据源，把一套用户资源的 CRUD 接口打通，理解 REST 的路径与方法约定。</p>\n</blockquote>\n<h3 id=\"71-新建-routesusersmjs\"><a class=\"anchor\" href=\"#71-新建-routesusersmjs\">#</a> 7.1 新建 <code>routes/users.mjs</code></h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-js\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// routes/users.mjs（阶段G）</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 目标：实现 RESTful 风格的用户资源接口（内存模拟数据库）</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> Router</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">koa-router</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> router</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> new</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Router</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> prefix</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/api/users</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 用一个内存数组模拟“数据库表”</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> users</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> id</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> name</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Alice</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> age</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 20</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> id</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> name</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Bob</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#998418;--shiki-dark:#B8A965\">   age</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 22</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 工具：生成新ID（简单起见）</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> nextId</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">users</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#998418;--shiki-dark:#B8A965\">length</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ?</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> users</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">users</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#998418;--shiki-dark:#B8A965\">length</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> +</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> :</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// GET /api/users  -&gt; 列表</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">get</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">status</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 200</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> code</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 200</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> data</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> users</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// GET /api/users/:id  -&gt; 详情</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">get</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/:id</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> id</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Number</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">params</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> user</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> users</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">find</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">u</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> u</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ===</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> id</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">!</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">user</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">throw</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">404</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> `</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">用户 </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">${</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">id</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">}</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 不存在</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">`</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> code</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 200</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> data</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> user</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// POST /api/users  -&gt; 新增</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">post</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">request</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ||</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">!</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">name</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ||</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> typeof</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> !==</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">number</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">throw</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">400</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">参数不合法：需要 name(string) 与 age(number)</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> newUser</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> id</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> nextId</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  users</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">push</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">newUser</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">status</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 201</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 201：已创建</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> code</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 201</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> data</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> newUser</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// PUT /api/users/:id  -&gt; 全量更新</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">put</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/:id</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> id</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Number</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">params</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">request</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ||</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> idx</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> users</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">findIndex</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">u</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> u</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ===</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> id</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">idx</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ===</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">throw</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">404</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> `</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">用户 </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">${</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">id</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">}</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 不存在</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">`</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">!</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">name</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ||</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> typeof</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> !==</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">number</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">throw</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">400</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">参数不合法：需要 name 与 age</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  users</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">idx</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> id</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> code</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 200</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> data</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> users</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">[</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">idx</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">]</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// PATCH /api/users/:id -&gt; 部分更新（可选）</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">patch</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/:id</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> id</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Number</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">params</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> patch</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">request</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ||</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> user</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> users</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">find</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">u</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> u</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ===</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> id</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">!</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">user</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">throw</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">404</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> `</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">用户 </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">${</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">id</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">}</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 不存在</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">`</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  Object</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">assign</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">user</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> patch</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> code</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 200</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> data</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> user</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// DELETE /api/users/:id -&gt; 删除</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">delete</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/:id</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> id</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Number</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">params</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> idx</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> users</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">findIndex</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">u</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> u</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ===</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> id</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">idx</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ===</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">throw</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">404</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> `</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">用户 </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">${</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">id</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">}</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 不存在</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">`</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> deleted</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> users</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">splice</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">idx</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> code</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 200</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> data</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> deleted</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> default</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> router</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span></code></pre>\n<h3 id=\"72-在-appmjs-中注册新路由文件\"><a class=\"anchor\" href=\"#72-在-appmjs-中注册新路由文件\">#</a> 7.2 在 <code>app.mjs</code> 中注册新路由文件</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-js\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// app.mjs（阶段G）</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> Koa</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">koa</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> bodyParser</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">koa-bodyparser</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> serve</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">koa-static</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> path</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">path</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> fileURLToPath</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">url</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> baseRouter</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">./routes/index.mjs</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> usersRouter</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">./routes/users.mjs</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> __filename</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> fileURLToPath</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#998418;--shiki-dark:#B8A965\">meta</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">url</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> __dirname</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> path</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">dirname</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">__filename</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> app</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> new</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Koa</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">use</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">async</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> next</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  try</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> next</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> catch</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">err</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">status</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> err</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">status</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ||</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 500</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> code</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">status</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> message</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> err</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">message</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ||</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Server Error</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">use</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">bodyParser</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">use</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">serve</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">path</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">join</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">__dirname</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">public</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 注册多个路由模块</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">use</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">baseRouter</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">routes</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">use</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">baseRouter</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">allowedMethods</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">use</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">usersRouter</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">routes</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">use</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">usersRouter</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">allowedMethods</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">listen</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">3000</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  console</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">log</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">✅ Server running at http://localhost:3000</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  console</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">log</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">   当前阶段：G（RESTful 内存版 users 资源）</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span></code></pre>\n<p><strong>测试：</strong></p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 列表</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">curl</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> http://localhost:3000/api/users</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 详情</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">curl</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> http://localhost:3000/api/users/1</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 新增</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">curl</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -X</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> POST</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> http://localhost:3000/api/users</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#A65E2B;--shiki-dark:#C99076\">  -H</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Content-Type: application/json</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#A65E2B;--shiki-dark:#C99076\">  -d</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">{\"name\":\"Carol\",\"age\":28}</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 更新</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">curl</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -X</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> PUT</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> http://localhost:3000/api/users/1</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#A65E2B;--shiki-dark:#C99076\">  -H</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Content-Type: application/json</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> \\</span></span>\n<span class=\"line\"><span style=\"color:#A65E2B;--shiki-dark:#C99076\">  -d</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">{\"name\":\"Alice Updated\",\"age\":21}</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 删除</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">curl</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -X</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> DELETE</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> http://localhost:3000/api/users/2</span></span></code></pre>\n<blockquote>\n<p><strong>补充：CORS</strong><br>\n若前端与后端不在同一域名/端口，需开启 CORS：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">npm</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> i</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> @koa/cors</span></span></code></pre>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-js\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> cors</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">@koa/cors</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">use</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">cors</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span></code></pre>\n</blockquote>\n<h3 id=\"73-如何实现数据库的增删改查cura\"><a class=\"anchor\" href=\"#73-如何实现数据库的增删改查cura\">#</a> 7.3 如何实现数据库的增删改查(CURA)</h3>\n<p>数据库的四个基本功能</p>\n<table>\n<thead>\n<tr>\n<th>方法</th>\n<th>描述</th>\n<th>对应 SQL</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Create</td>\n<td>新增一条记录</td>\n<td>INSERT</td>\n</tr>\n<tr>\n<td>Read</td>\n<td>查询记录</td>\n<td>SELECT</td>\n</tr>\n<tr>\n<td>Update</td>\n<td>更新记录</td>\n<td>UPDATE</td>\n</tr>\n<tr>\n<td>Delete</td>\n<td>删除记录</td>\n<td>DELETE</td>\n</tr>\n</tbody>\n</table>\n<p>在 RESTful API 中，常用 HTTP 方法对应 CRUD：</p>\n<table>\n<thead>\n<tr>\n<th>HTTP 方法</th>\n<th>路径</th>\n<th>CRUD</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>GET</td>\n<td>/api/users</td>\n<td>查询所有用户</td>\n</tr>\n<tr>\n<td>GET</td>\n<td>/api/users/:id</td>\n<td>查询单个用户</td>\n</tr>\n<tr>\n<td>POST</td>\n<td>/api/users</td>\n<td>新增用户</td>\n</tr>\n<tr>\n<td>PUT</td>\n<td>/api/users/:id</td>\n<td>全量更新用户</td>\n</tr>\n<tr>\n<td>PATCH</td>\n<td>/api/users/:id</td>\n<td>部分更新用户</td>\n</tr>\n<tr>\n<td>DELETE</td>\n<td>/api/users/:id</td>\n<td>删除用户</td>\n</tr>\n</tbody>\n</table>\n<p>首先在根目录创建<code>.env</code>文件</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-ini\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">DB_HOST</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">localhost</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">DB_USER</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">root</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">DB_PASSWORD</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">123456</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">DB_NAME</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">testdb</span></span></code></pre>\n<p>创建数据库模块<code>database/mysqldb.mjs</code>:</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-js\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> mysql</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">mysql2/promise</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> dotenv</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">dotenv</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">dotenv</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">config</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 创建连接池</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> pool</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> mysql</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">createPool</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  host</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> process</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">env</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">DB_HOST</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  user</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> process</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">env</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">DB_USER</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  password</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> process</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">env</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">DB_PASSWORD</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  database</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> process</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">env</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">DB_NAME</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  waitForConnections</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> true</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  connectionLimit</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 10</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  queueLimit</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 通用 SQL 查询函数</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> query</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">sql</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> params</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">results</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> pool</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">execute</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">sql</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> params</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  return</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> results</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// ----------------- 用户增删改查 -----------------</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 获取所有用户</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> getAllUsers</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  return</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> query</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">SELECT * FROM users</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 根据 ID 获取用户</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> getUserById</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> results</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> query</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">SELECT * FROM users WHERE id = ?</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  return</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> results</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 新增用户</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> createUser</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> result</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> query</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">INSERT INTO users (name, age) VALUES (?, ?)</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  return</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> id</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> result</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">insertId</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 更新用户</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> updateUser</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  await</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> query</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">UPDATE users SET name = ?, age = ? WHERE id = ?</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> id</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  return</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> id</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 删除用户</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> deleteUser</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> result</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> query</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">DELETE FROM users WHERE id = ?</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  return</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> result</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">affectedRows</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"></span></code></pre>\n<hr>\n<h2 id=\"8-阶段-h重构为-mvcmodel-view-controller分层\"><a class=\"anchor\" href=\"#8-阶段-h重构为-mvcmodel-view-controller分层\">#</a> 8. 阶段 H：重构为 MVC（Model-View-Controller）分层</h2>\n<blockquote>\n<p>现在把“路由里写业务”的代码拆分：<strong>路由仅负责匹配路径</strong>、<strong>Controller 负责接入/出参与校验</strong>、<strong>Service 负责业务</strong>、<strong>Model 负责数据存储</strong>（此处先用内存/假数据，下一步再换 MySQL）。</p>\n</blockquote>\n<h3 id=\"81-目录调整\"><a class=\"anchor\" href=\"#81-目录调整\">#</a> 8.1 目录调整</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-text\"><span class=\"line\"><span>koa-step-by-step/</span></span>\n<span class=\"line\"><span>├─ app.mjs</span></span>\n<span class=\"line\"><span>├─ routes/</span></span>\n<span class=\"line\"><span>│  ├─ index.mjs</span></span>\n<span class=\"line\"><span>│  └─ users.mjs       # 现在只保留路径定义和与 controller 的绑定</span></span>\n<span class=\"line\"><span>├─ controllers/</span></span>\n<span class=\"line\"><span>│  └─ userController.mjs</span></span>\n<span class=\"line\"><span>├─ services/</span></span>\n<span class=\"line\"><span>│  └─ userService.mjs</span></span>\n<span class=\"line\"><span>├─ models/</span></span>\n<span class=\"line\"><span>│  └─ userModel.mjs   # 此阶段仍用内存数组模拟 DB</span></span>\n<span class=\"line\"><span>└─ public/</span></span></code></pre>\n<h3 id=\"82-modelsusermodelmjs数据访问层\"><a class=\"anchor\" href=\"#82-modelsusermodelmjs数据访问层\">#</a> 8.2 <code>models/userModel.mjs</code>（数据访问层）</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-js\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// models/userModel.mjs（阶段H - Model 层）</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">/**</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> * 此处仍然用内存数组模拟数据库。</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> * 下一阶段会把这里的实现换成 MySQL 版本，但对外暴露的方法名尽量保持一致，</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> * 这样 Controller/Service 基本不用改动，实现“可替换的数据层”。</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> */</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> users</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> id</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> name</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Alice</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> age</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 20</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> id</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> name</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Bob</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#998418;--shiki-dark:#B8A965\">   age</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 22</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> nextId</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">users</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#998418;--shiki-dark:#B8A965\">length</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ?</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> users</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">users</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#998418;--shiki-dark:#B8A965\">length</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> +</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> :</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> findAll</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  return</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> users</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> findById</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  return</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> users</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">find</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">u</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> u</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ===</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> id</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ||</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> null</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> create</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> user</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> id</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> nextId</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  users</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">push</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">user</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  return</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> user</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> update</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> idx</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> users</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">findIndex</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">u</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> u</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ===</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> id</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">idx</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ===</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> return</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> null</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  users</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">idx</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> id</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  return</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> users</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">idx</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> patch</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> patchObj</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> user</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> users</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">find</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">u</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> u</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ===</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> id</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">!</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">user</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> return</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> null</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  Object</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">assign</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">user</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> patchObj</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  return</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> user</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> remove</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> idx</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> users</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">findIndex</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">u</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> u</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ===</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> id</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">idx</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ===</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> return</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> null</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  return</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> users</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">splice</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">idx</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span></code></pre>\n<p>直接调用数据库增删改查函数，但保持原来的 RESTful API 路由结构：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-javascript\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// routes/users.mjs（阶段G -&gt; 数据库版）</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 目标：实现 RESTful 风格的用户资源接口，直接操作 MySQL 数据库</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> Router</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">koa-router</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 从 mysqldb.mjs 导入封装好的增删改查函数</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> getAllUsers</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> getUserById</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> createUser</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> updateUser</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> deleteUser</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">../database/mysqldb.mjs</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> router</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> new</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Router</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> prefix</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/api/users</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// ----------------- RESTful 路由 -----------------</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// GET /api/users  -&gt; 获取用户列表</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">get</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  try</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> users</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> getAllUsers</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 调用数据库查询所有用户</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">status</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 200</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> code</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 200</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> data</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> users</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> catch</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">err</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">throw</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">500</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> err</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">message</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// GET /api/users/:id  -&gt; 根据 ID 获取用户详情</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">get</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/:id</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> id</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Number</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">params</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  try</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> user</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> getUserById</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 调用数据库查询单个用户</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">!</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">user</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">{</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">      ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">throw</span><span style=\"color:#bda437;--shiki-dark:#e6cc77\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">404</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> `</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">用户 </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">${</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">id</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">}</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 不存在</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">`</span><span style=\"color:#bda437;--shiki-dark:#e6cc77\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">}</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">status</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 200</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> code</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 200</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> data</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> user</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> catch</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">err</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">throw</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">500</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> err</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">message</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// POST /api/users  -&gt; 新增用户</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">post</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">request</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ||</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">!</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">name</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ||</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> typeof</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> !==</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">number</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">throw</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">400</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">参数不合法：需要 name(string) 与 age(number)</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  try</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> newUser</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> createUser</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 调用数据库新增用户</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">status</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 201</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 201：已创建</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> code</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 201</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> data</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> newUser</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> catch</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">err</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">throw</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">500</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> err</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">message</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// PUT /api/users/:id  -&gt; 全量更新用户</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">put</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/:id</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> id</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Number</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">params</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">request</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ||</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">!</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">name</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ||</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> typeof</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> !==</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">number</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">throw</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">400</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">参数不合法：需要 name(string) 与 age(number)</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  try</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> updatedUser</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> updateUser</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 调用数据库更新</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">status</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 200</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> code</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 200</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> data</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> updatedUser</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> catch</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">err</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">throw</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">500</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> err</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">message</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// PATCH /api/users/:id  -&gt; 部分更新用户</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">patch</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/:id</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> id</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Number</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">params</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> patch</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">request</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ||</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  try</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> existingUser</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> getUserById</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">!</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">existingUser</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">throw</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">404</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> `</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">用户 </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">${</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">id</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">}</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 不存在</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">`</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    // 合并已有数据与更新数据</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> updatedUser</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> updateUser</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> patch</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">name</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ??</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> existingUser</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> patch</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">age</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ??</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> existingUser</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">age</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">status</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 200</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> code</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 200</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> data</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> updatedUser</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> catch</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">err</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">throw</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">500</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> err</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">message</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// DELETE /api/users/:id  -&gt; 删除用户</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">delete</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/:id</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\">&gt;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> id</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Number</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">params</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  try</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> success</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> deleteUser</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">!</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">success</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">throw</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">404</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> `</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">用户 </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">${</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">id</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">}</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 不存在</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">`</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">status</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 200</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> code</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 200</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> message</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> `</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">用户 </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">${</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">id</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">}</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 已删除</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">`</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a13865;--shiki-dark:#d9739f\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> catch</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">err</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">throw</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">500</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> err</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">message</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> default</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> router</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span></code></pre>\n<h3 id=\"83-servicesuserservicemjs业务层\"><a class=\"anchor\" href=\"#83-servicesuserservicemjs业务层\">#</a> 8.3 <code>services/userService.mjs</code>（业务层）</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-js\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// services/userService.mjs（阶段H - Service 层）</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">/**</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> * 业务层：进行业务规则校验（示例简单化），</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> * 将 Controller 的输入转为 Model 层所需格式；</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> * 对 Model 输出进行二次处理（如脱敏、聚合等）。</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> */</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> *</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> as</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> User</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">../models/userModel.mjs</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> listUsers</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  return</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> User</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">findAll</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> getUser</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> user</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> User</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">findById</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  return</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> user</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 可添加“脱敏”等处理</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> createUser</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">!</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">name</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ||</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> typeof</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> !==</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">number</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> err</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> new</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Error</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">参数不合法：需要 name(string) 与 age(number)</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    err</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">status</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 400</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    throw</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> err</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  return</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> User</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">create</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> updateUser</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">!</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">name</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ||</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> typeof</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> !==</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">number</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> err</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> new</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Error</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">参数不合法：需要 name 与 age</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    err</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">status</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 400</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    throw</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> err</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> updated</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> User</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">update</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">!</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">updated</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> err</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> new</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Error</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">`</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">用户 </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">${</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">id</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">}</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 不存在</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">`</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    err</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">status</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 404</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    throw</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> err</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  return</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> updated</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> patchUser</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> patchObj</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> updated</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> User</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">patch</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> patchObj</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">!</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">updated</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> err</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> new</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Error</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">`</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">用户 </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">${</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">id</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">}</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 不存在</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">`</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    err</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">status</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 404</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    throw</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> err</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  return</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> updated</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> removeUser</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> deleted</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> User</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">remove</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">!</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">deleted</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">    const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> err</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> new</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Error</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">`</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">用户 </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">${</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">id</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">}</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 不存在</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">`</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    err</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">status</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 404</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    throw</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> err</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  return</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> deleted</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span></code></pre>\n<h3 id=\"84-controllersusercontrollermjs控制器层\"><a class=\"anchor\" href=\"#84-controllersusercontrollermjs控制器层\">#</a> 8.4 <code>controllers/userController.mjs</code>（控制器层）</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-js\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// controllers/userController.mjs（阶段H - Controller 层）</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">/**</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> * 控制器：仅负责与 Koa 的 ctx 交互（取参、设响应、设状态码）。</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> * 真正的业务逻辑不写在这里，全部委托给 Service。</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> */</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> *</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> as</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> UserService</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">../services/userService.mjs</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> list</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> data</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> UserService</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">listUsers</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">status</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 200</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> code</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 200</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> data</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> detail</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> id</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Number</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">params</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> data</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> UserService</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">getUser</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">!</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">data</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">throw</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">404</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> `</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">用户 </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">${</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">id</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">}</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 不存在</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">`</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> code</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 200</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> data</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> create</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">request</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ||</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> data</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> UserService</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">createUser</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">status</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 201</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> code</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 201</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> data</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> update</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> id</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Number</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">params</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">request</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ||</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> data</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> UserService</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">updateUser</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> code</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 200</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> data</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> patch</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> id</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Number</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">params</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> patchObj</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">request</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ||</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> data</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> UserService</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">patchUser</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> patchObj</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> code</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 200</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> data</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> remove</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> id</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Number</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">params</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> data</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> UserService</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">removeUser</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  ctx</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">body</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> code</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 200</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> data</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span></code></pre>\n<h3 id=\"85-routesusersmjs只负责绑定路径到-controller\"><a class=\"anchor\" href=\"#85-routesusersmjs只负责绑定路径到-controller\">#</a> 8.5 <code>routes/users.mjs</code>（只负责绑定路径到 Controller）</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-js\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// routes/users.mjs（阶段H）</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> Router</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">koa-router</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> *</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> as</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> UserController</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">../controllers/userController.mjs</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> router</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> new</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> Router</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> prefix</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/api/users</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">get</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">     UserController</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">list</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">get</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/:id</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  UserController</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">detail</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">post</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    UserController</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">create</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">put</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/:id</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  UserController</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">update</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">patch</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/:id</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">UserController</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">patch</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">router</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">delete</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">/:id</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> UserController</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">remove</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> default</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> router</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span></code></pre>\n<blockquote>\n<p>至此，已经是一个<strong>结构清晰</strong>的 REST + MVC（无数据库版）。</p>\n</blockquote>\n<hr>\n<h2 id=\"9-阶段-i把-model-换成-mysqlmysql2promise-连接池\"><a class=\"anchor\" href=\"#9-阶段-i把-model-换成-mysqlmysql2promise-连接池\">#</a> 9. 阶段 I：把 Model 换成 MySQL（mysql2/promise + 连接池）</h2>\n<h3 id=\"91-安装依赖\"><a class=\"anchor\" href=\"#91-安装依赖\">#</a> 9.1 安装依赖</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">npm</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> i</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> mysql2</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> dotenv</span></span></code></pre>\n<h3 id=\"92-新增-databasemysqlmjs连接池与-query-封装\"><a class=\"anchor\" href=\"#92-新增-databasemysqlmjs连接池与-query-封装\">#</a> 9.2 新增 <code>database/mysql.mjs</code>（连接池与 query 封装）</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-js\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// database/mysql.mjs（阶段I - 数据库基础封装）</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> mysql</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">mysql2/promise</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> dotenv</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">dotenv</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">dotenv</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">config</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 读取 .env</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 创建连接池（推荐生产环境使用连接池，而非单连接）</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> pool</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> mysql</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">createPool</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  host</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">     process</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">env</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">DB_HOST</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ||</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">localhost</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  user</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">     process</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">env</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">DB_USER</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ||</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">root</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  password</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> process</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">env</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">DB_PASSWORD</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ||</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">123456</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  database</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> process</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">env</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">DB_NAME</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ||</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">testdb</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  port</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#59873A;--shiki-dark:#80A665\">     Number</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">process</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">env</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">DB_PORT</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ||</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 3306</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  waitForConnections</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> true</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  connectionLimit</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 10</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  queueLimit</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 统一的 SQL 执行函数：自动格式化参数，返回 rows</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> query</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">sql</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> params</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">rows</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> pool</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">execute</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">sql</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> params</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  return</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> rows</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span></code></pre>\n<h3 id=\"93-在项目根目录创建-env\"><a class=\"anchor\" href=\"#93-在项目根目录创建-env\">#</a> 9.3 在项目根目录创建 <code>.env</code></h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-text\"><span class=\"line\"><span>DB_HOST=localhost</span></span>\n<span class=\"line\"><span>DB_PORT=3306</span></span>\n<span class=\"line\"><span>DB_USER=root</span></span>\n<span class=\"line\"><span>DB_PASSWORD=123456</span></span>\n<span class=\"line\"><span>DB_NAME=testdb</span></span></code></pre>\n<h3 id=\"94-初始化数据表一次性\"><a class=\"anchor\" href=\"#94-初始化数据表一次性\">#</a> 9.4 初始化数据表（一次性）</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-sql\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">CREATE</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> TABLE</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> IF</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> NOT</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> EXISTS</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> users </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">  id   </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">INT</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> AUTO_INCREMENT </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">PRIMARY KEY</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  name</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> VARCHAR</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">50</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">NOT NULL</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">  age  </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">INT</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> NOT NULL</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">  created_at </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">TIMESTAMP</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> DEFAULT</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> CURRENT_TIMESTAMP</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span></code></pre>\n<h3 id=\"95-重写-modelsusermodelmjs-为-mysql-实现\"><a class=\"anchor\" href=\"#95-重写-modelsusermodelmjs-为-mysql-实现\">#</a> 9.5 重写 <code>models/userModel.mjs</code> 为 MySQL 实现</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-js\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// models/userModel.mjs（阶段I - MySQL 版本 Model 层）</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> query</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">../database/mysql.mjs</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> findAll</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  // 返回全部用户</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  return</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> query</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">SELECT id, name, age, created_at FROM users ORDER BY id ASC</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> findById</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> rows</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> query</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">SELECT id, name, age, created_at FROM users WHERE id = ?</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  return</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> rows</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ||</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> null</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> create</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  // 使用 ? 占位符防止 SQL 注入</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> result</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> query</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">INSERT INTO users (name, age) VALUES (?, ?)</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  // 插入成功后返回新记录</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> inserted</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> findById</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">result</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">insertId</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  return</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> inserted</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> update</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> result</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> query</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">UPDATE users SET name = ?, age = ? WHERE id = ?</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">name</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> age</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> id</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">result</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">affectedRows</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ===</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> return</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> null</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  return</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> findById</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> patch</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> patchObj</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  // 动态拼接字段（示例简化，仅允许 name/age）</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> fields</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> params</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">patchObj</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">name</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> !==</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> undefined</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> fields</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">push</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">name = ?</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> params</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">push</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">patchObj</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">name</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">patchObj</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">age</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> !==</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> undefined</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> fields</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">push</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">age = ?</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  params</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">push</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">patchObj</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">age</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">fields</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#998418;--shiki-dark:#B8A965\">length</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ===</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> return</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> findById</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 无变化</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">  params</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">push</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> sql</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> `</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">UPDATE users SET </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">${</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">fields</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">join</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">, </span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">}</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> WHERE id = ?</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">`</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> result</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> query</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">sql</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> params</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">result</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">affectedRows</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ===</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> return</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> null</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  return</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> findById</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> remove</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> toDelete</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> findById</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">!</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">toDelete</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> return</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> null</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> result</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> query</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">DELETE FROM users WHERE id = ?</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">id</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">result</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">affectedRows</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ===</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> return</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> null</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  return</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> toDelete</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span></code></pre>\n<blockquote>\n<p><strong>无感替换数据层</strong>：我们没有改 Controller/Service 的代码，因为它们的调用接口未变。这就是解耦的好处。</p>\n</blockquote>\n<h3 id=\"96-运行与测试\"><a class=\"anchor\" href=\"#96-运行与测试\">#</a> 9.6 运行与测试</h3>\n<ol>\n<li>确认本机 MySQL 已启动，并在 <code>.env</code> 中配置正确；</li>\n<li>执行上面的建表 SQL；</li>\n<li>启动服务：<code>npm run dev</code>；</li>\n<li>使用前文的 <code>curl</code> 测试 CRUD 接口；现在数据真实写入 MySQL！</li>\n</ol>\n<hr>\n<h2 id=\"10-阶段-j额外增强可选但常用\"><a class=\"anchor\" href=\"#10-阶段-j额外增强可选但常用\">#</a> 10. 阶段 J：额外增强（可选但常用）</h2>\n<h3 id=\"101-cors跨域\"><a class=\"anchor\" href=\"#101-cors跨域\">#</a> 10.1 CORS（跨域）</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">npm</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> i</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> @koa/cors</span></span></code></pre>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-js\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> cors</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">@koa/cors</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">app</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#59873A;--shiki-dark:#80A665\">use</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">cors</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> origin</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">*</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">}</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> // 生产建议更精细控制</span></span></code></pre>\n<h3 id=\"102-请求参数校验轻量示例\"><a class=\"anchor\" href=\"#102-请求参数校验轻量示例\">#</a> 10.2 请求参数校验（轻量示例）</h3>\n<blockquote>\n<p>在 Service 层已经有简单校验；进一步可以使用 <code>zod</code>, <code>joi</code>, <code>yup</code> 等库统一校验。</p>\n</blockquote>\n<h3 id=\"103-分页-模糊查询以-mysql-为例改造-model\"><a class=\"anchor\" href=\"#103-分页-模糊查询以-mysql-为例改造-model\">#</a> 10.3 分页 &amp; 模糊查询（以 MySQL 为例，改造 Model）</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-js\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">// 示例：分页查询（page 从 1 开始）</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">export</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> async</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> findPaged</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> page</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> pageSize</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 10</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> keyword</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> ''</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> offset</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">page</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> pageSize</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> where</span><span style=\"color:#999999;--shiki-dark:#666666\">  =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> keyword</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ?</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">WHERE name LIKE ?</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> :</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> ''</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> params</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> keyword</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ?</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">`</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">%</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">${</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">keyword</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">}</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">%</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">`</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> pageSize</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> offset</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> :</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">pageSize</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> offset</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> rows</span><span style=\"color:#999999;--shiki-dark:#666666\">   =</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> query</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span></span>\n<span class=\"line\"><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">    `</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">SELECT id, name, age, created_at FROM users </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">${</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">where</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">}</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ORDER BY id ASC LIMIT ? OFFSET ?</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">`</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    params</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">  const</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> totalRows</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> await</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> query</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span></span>\n<span class=\"line\"><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">    `</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">SELECT COUNT(*) AS c FROM users </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">${</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">keyword </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">?</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">WHERE name LIKE ?</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> :</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> ''</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">}</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">`</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    keyword</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> ?</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">`</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">%</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">${</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">keyword</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">}</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">%</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">`</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> :</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  return</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> list</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> rows</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> total</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> totalRows</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">c</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> page</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> pageSize</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span></code></pre>\n<hr>\n<h2 id=\"11-常见坑位排查faq\"><a class=\"anchor\" href=\"#11-常见坑位排查faq\">#</a> 11. 常见坑位排查（FAQ）</h2>\n<ul>\n<li><strong><code>SyntaxError: Cannot use import statement outside a module</code></strong>\n<ul>\n<li><code>package.json</code> 是否含 <code>\"type\":\"module\"</code>？或者文件是否使用 <code>.mjs</code>？</li>\n</ul>\n</li>\n<li><strong><code>Error: Cannot find module 'xxx'</code></strong>\n<ul>\n<li>依赖没装或装在了错误目录：执行 <code>npm i xxx</code>，确保命令行的当前目录正确。</li>\n</ul>\n</li>\n<li><strong><code>ctx.request.body</code> 是 <code>undefined</code></strong>\n<ul>\n<li>是否 <code>app.use(bodyParser())</code> 放在了路由前面？是否设置了正确的 <code>Content-Type</code>？</li>\n</ul>\n</li>\n<li><strong>中文乱码</strong>\n<ul>\n<li>前端/客户端请求与响应头编码问题；确保响应头 <code>Content-Type</code> 与实际内容一致（Koa 会自动根据 <code>ctx.body</code> 设定）。</li>\n</ul>\n</li>\n<li><strong>MySQL 连接失败</strong>\n<ul>\n<li>检查 <code>.env</code> 配置、数据库是否启动、端口是否被占用、防火墙、权限是否允许远程连接。</li>\n</ul>\n</li>\n</ul>\n<hr>\n<h2 id=\"12-最终项目结构参考到阶段-i-为止\"><a class=\"anchor\" href=\"#12-最终项目结构参考到阶段-i-为止\">#</a> 12. 最终项目结构参考（到阶段 I 为止）</h2>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-text\"><span class=\"line\"><span>koa-step-by-step/</span></span>\n<span class=\"line\"><span>├─ app.mjs</span></span>\n<span class=\"line\"><span>├─ public/</span></span>\n<span class=\"line\"><span>│  └─ index.html</span></span>\n<span class=\"line\"><span>├─ views/                # 若使用模板渲染</span></span>\n<span class=\"line\"><span>│  └─ home.ejs</span></span>\n<span class=\"line\"><span>├─ routes/</span></span>\n<span class=\"line\"><span>│  ├─ index.mjs</span></span>\n<span class=\"line\"><span>│  ├─ users.mjs</span></span>\n<span class=\"line\"><span>├─ controllers/</span></span>\n<span class=\"line\"><span>│  └─ userController.mjs</span></span>\n<span class=\"line\"><span>├─ services/</span></span>\n<span class=\"line\"><span>│  └─ userService.mjs</span></span>\n<span class=\"line\"><span>├─ models/</span></span>\n<span class=\"line\"><span>│  └─ userModel.mjs      # 阶段H：内存; 阶段I：MySQL</span></span>\n<span class=\"line\"><span>├─ database/</span></span>\n<span class=\"line\"><span>│  └─ mysql.mjs</span></span>\n<span class=\"line\"><span>├─ .env</span></span>\n<span class=\"line\"><span>└─ package.json</span></span></code></pre>\n<hr>\n<h2 id=\"13-一句话回顾每个阶段\"><a class=\"anchor\" href=\"#13-一句话回顾每个阶段\">#</a> 13. 一句话回顾每个阶段</h2>\n<ul>\n<li><strong>A</strong>：只有一个文件的“Hello Koa”</li>\n<li><strong>B</strong>：加上 <code>koa-router</code>，不同路径返回不同内容</li>\n<li><strong>C</strong>：解析请求体，拥有第一个 POST 接口</li>\n<li><strong>D</strong>：全局错误处理 + 访问日志，理解“洋葱模型”</li>\n<li><strong>E</strong>：静态资源与 favicon</li>\n<li><strong>F</strong>：（可选）EJS 模板渲染</li>\n<li><strong>G</strong>：RESTful 内存版 users 资源（CRUD）</li>\n<li><strong>H</strong>：重构为 MVC（Controller/Service/Model 分层）</li>\n<li><strong>I</strong>：替换 Model → MySQL（真实落库）</li>\n<li><strong>J</strong>：加强：CORS、校验、分页等</li>\n</ul>\n",
            "tags": [
                "Koa",
                "backen",
                "nodejs"
            ]
        },
        {
            "id": "http://example.com/2025/08/18/latex_2/",
            "url": "http://example.com/2025/08/18/latex_2/",
            "title": "Latex全语法使用",
            "date_published": "2025-08-18T09:20:00.000Z",
            "content_html": "<h2 id=\"1-latex-文档基本格式\"><a class=\"anchor\" href=\"#1-latex-文档基本格式\">#</a> 1. LaTeX 文档基本格式</h2>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-latex\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">documentclass</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\">article</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">   % 文档类型：article, report, book, beamer 等</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">usepackage</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">utf8</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\">inputenc</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> % 支持中文时建议用 ctex 包</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">usepackage</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\">amsmath, amssymb</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> % 数学符号扩展</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">usepackage</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\">graphicx</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> % 插入图片</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">usepackage</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\">listings</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> % 插入代码</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">usepackage</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\">xcolor</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">   % 代码高亮需要颜色</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">usepackage</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\">hyperref</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> % 超链接</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">title</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">LaTeX 学习示例</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">author</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">你的名字</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">date</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">today</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">begin</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">document</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  % 正文开始</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">maketitle</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  % 输出标题</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">section</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#59873A;--shiki-dark:#80A665\">引言</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">这是 LaTeX 的一个简单示例。</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">end</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">document</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span></code></pre>\n<blockquote>\n<p><strong>说明</strong>：</p>\n</blockquote>\n<ul>\n<li><code>\\documentclass{article}</code> 定义了文档类型。</li>\n<li><code>\\usepackage{}</code> 用来导入扩展包。</li>\n<li><code>\\section{}</code> 表示章节。</li>\n<li><code>\\maketitle</code> 会根据上面 <code>\\title</code>、<code>\\author</code>、<code>\\date</code> 生成标题页。</li>\n</ul>\n<hr>\n<h2 id=\"2-数学公式\"><a class=\"anchor\" href=\"#2-数学公式\">#</a> 2. 数学公式</h2>\n<p>LaTeX 在数学公式排版方面很强大。</p>\n<h3 id=\"21-行内公式\"><a class=\"anchor\" href=\"#21-行内公式\">#</a> 2.1 行内公式</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-latex\"><span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">这是一个行内公式：</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">$</span><span style=\"color:#998418;--shiki-dark:#B8A965\">E=mc</span><span style=\"color:#999999;--shiki-dark:#666666\">^</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">$</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">。</span></span></code></pre>\n<h3 id=\"22-独立公式\"><a class=\"anchor\" href=\"#22-独立公式\">#</a> 2.2 独立公式</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-latex\"><span class=\"line\"><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\\</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">E = mc</span><span style=\"color:#999999;--shiki-dark:#666666\">^</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">2</span></span>\n<span class=\"line\"><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\\</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span></span></code></pre>\n<h3 id=\"23-多行公式-amsmath-提供\"><a class=\"anchor\" href=\"#23-多行公式-amsmath-提供\">#</a> 2.3 多行公式 (amsmath 提供)</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-latex\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">begin</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">align</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">a</span><span style=\"color:#999999;--shiki-dark:#666666\">^</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"color:#999999;--shiki-dark:#666666\"> +</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> b</span><span style=\"color:#999999;--shiki-dark:#666666\">^</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> &amp;</span><span style=\"color:#998418;--shiki-dark:#B8A965\">= c</span><span style=\"color:#999999;--shiki-dark:#666666\">^</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> \\\\</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">e</span><span style=\"color:#999999;--shiki-dark:#666666\">^</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\">i</span><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">pi</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span><span style=\"color:#999999;--shiki-dark:#666666\"> +</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> &amp;</span><span style=\"color:#998418;--shiki-dark:#B8A965\">= </span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">end</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">align</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span></code></pre>\n<hr>\n<h2 id=\"3-插入图片\"><a class=\"anchor\" href=\"#3-插入图片\">#</a> 3. 插入图片</h2>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-latex\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">begin</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">figure</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">h</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    \\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">centering</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    \\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">includegraphics</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">width=0.5</span><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">textwidth</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">example.png</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    \\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">caption</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">这是一个示例图片</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    \\</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">label</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">fig:example</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">end</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">figure</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span></code></pre>\n<blockquote>\n<p><strong>说明</strong>：</p>\n</blockquote>\n<ul>\n<li><code>example.png</code> 必须和 <code>.tex</code> 文件在同一目录。</li>\n<li><code>width=0.5\\textwidth</code> 控制大小。</li>\n<li><code>\\caption</code> 是图注，<code>\\label</code> 用来引用。</li>\n<li>之后可用 <code>见图~\\ref{fig:example}</code> 来自动编号。</li>\n</ul>\n<hr>\n<h2 id=\"4-插入代码\"><a class=\"anchor\" href=\"#4-插入代码\">#</a> 4. 插入代码</h2>\n<p>LaTeX 用 <code>listings</code> 包来展示代码：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-latex\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">begin</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">lstlisting</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">language=Python, caption=Python 示例, label=</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">lst:py</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">def hello</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">:</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    print</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">\"Hello, LaTeX!\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">end</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">lstlisting</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span></code></pre>\n<blockquote>\n<p><strong>说明</strong>：</p>\n</blockquote>\n<ul>\n<li><code>language=Python</code> 可以换成 <code>C</code>, <code>C++</code>, <code>Java</code> 等。</li>\n<li><code>caption</code> 给代码块加标题，<code>label</code> 方便引用。</li>\n</ul>\n<p>还可以加颜色主题：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-latex\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">lstset</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">  basicstyle=</span><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">ttfamily</span><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">small</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">  keywordstyle=</span><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">color</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">blue</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">  commentstyle=</span><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">color</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">green!50!black</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">  stringstyle=</span><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">color</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">red</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">  numbers=left,</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">  numberstyle=</span><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">tiny</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">  frame=single,</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">  breaklines=true</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span></code></pre>\n<hr>\n<h2 id=\"5-表格\"><a class=\"anchor\" href=\"#5-表格\">#</a> 5. 表格</h2>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-latex\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">begin</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">table</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">h</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    \\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">centering</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    \\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">begin</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">tabular</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">|c|c|c|</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">        \\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">hline</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">        姓名 </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">&amp;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> 年龄 </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">&amp;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> 成绩 </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">\\\\</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">        \\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">hline</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">        张三 </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">&amp;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> 18 </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">&amp;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> 95 </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">\\\\</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">        李四 </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">&amp;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> 19 </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">&amp;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> 88 </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">\\\\</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">        \\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">hline</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    \\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">end</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">tabular</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    \\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">caption</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">学生信息表</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    \\</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">label</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">tab:student</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">end</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">table</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span></code></pre>\n<hr>\n<h2 id=\"6-超链接\"><a class=\"anchor\" href=\"#6-超链接\">#</a> 6. 超链接</h2>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-latex\"><span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">\\href</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">https://www.latex-project.org</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">LaTeX 官网</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span></code></pre>\n<hr>\n<h2 id=\"7-中文支持\"><a class=\"anchor\" href=\"#7-中文支持\">#</a> 7. 中文支持</h2>\n<p>如果你写中文文档，建议用 <code>ctex</code> 包：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-latex\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">documentclass</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\">ctexart</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  % 代替 article，更好支持中文</span></span></code></pre>\n<p>这样就能直接写中文了。</p>\n<hr>\n<h2 id=\"8有序列表和无序列表\"><a class=\"anchor\" href=\"#8有序列表和无序列表\">#</a> 8.有序列表和无序列表</h2>\n<h3 id=\"81-无序列表itemize\"><a class=\"anchor\" href=\"#81-无序列表itemize\">#</a> 8.1 无序列表（itemize）</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-latex\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">begin</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">itemize</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    \\</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">item</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> 这是第一点</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    \\</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">item</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> 这是第二点</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    \\</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">item</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> 这是第三点</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">end</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">itemize</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span></code></pre>\n<p>默认显示为黑色小圆点：</p>\n<ul>\n<li>这是第一点</li>\n<li>这是第二点</li>\n<li>这是第三点</li>\n</ul>\n<h3 id=\"82-有序列表enumerate\"><a class=\"anchor\" href=\"#82-有序列表enumerate\">#</a> 8.2 有序列表（enumerate）</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-latex\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">begin</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">enumerate</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    \\</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">item</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> 这是第一点</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    \\</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">item</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> 这是第二点</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    \\</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">item</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> 这是第三点</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">end</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">enumerate</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span></code></pre>\n<p>默认显示为数字编号：</p>\n<ol>\n<li>这是第一点</li>\n<li>这是第二点</li>\n<li>这是第三点</li>\n</ol>\n<h3 id=\"83-自定义编号样式\"><a class=\"anchor\" href=\"#83-自定义编号样式\">#</a> 8.3 自定义编号样式</h3>\n<p>借助 <code>enumitem</code> 包可以更灵活：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-latex\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">usepackage</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\">enumitem</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">begin</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">enumerate</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">label=</span><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">roman</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">*.</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  % 罗马数字</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    \\</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">item</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> 第一条</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    \\</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">item</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> 第二条</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">end</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">enumerate</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">begin</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">enumerate</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">label=</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">alph</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">*</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  % 小写字母</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    \\</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">item</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> 第一条</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    \\</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">item</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> 第二条</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">end</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">enumerate</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span></code></pre>\n<p>结果会变成：</p>\n<ul>\n<li>(i), (ii), (iii)...</li>\n<li>(a), (b), (c)...</li>\n</ul>\n<h3 id=\"84-无编号列表只换行没有点数字\"><a class=\"anchor\" href=\"#84-无编号列表只换行没有点数字\">#</a> 8.4 无编号列表（只换行，没有点/数字）</h3>\n<p>如果你只是想 <strong>逐行列出</strong>，但不要前面的符号，可以用 <code>description</code> 或者自定义环境：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-latex\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">begin</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">itemize</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">label=</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> % label={} 表示不要符号</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    \\</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">item</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> 第一行</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    \\</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">item</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> 第二行</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">    \\</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">item</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> 第三行</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">end</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">itemize</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span></code></pre>\n<p>或者更简单：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-latex\"><span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">第一点 </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">\\\\</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">第二点 </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">\\\\</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">第三点</span></span></code></pre>\n<p>（这里 <code>\\\\</code> 表示换行）</p>\n<h2 id=\"9-bibtex-使用\"><a class=\"anchor\" href=\"#9-bibtex-使用\">#</a> 9. BibTeX 使用</h2>\n<p>在学术写作中，<strong>参考文献管理</strong>是必不可少的。LaTeX 提供了 <code>BibTeX</code> 来管理参考文献，它的好处是：</p>\n<ul>\n<li>文献集中存放在一个 <code>.bib</code> 文件里，方便复用；</li>\n<li>可以自动格式化（APA, IEEE, GB/T 7714 等）；</li>\n<li>引用时只需 <code>\\cite{}</code> 即可，省去手动编号。</li>\n</ul>\n<h3 id=\"91-建立-bib-文件\"><a class=\"anchor\" href=\"#91-建立-bib-文件\">#</a> 9.1 建立 <code>.bib</code> 文件</h3>\n<p>新建一个 <code>refs.bib</code> 文件，里面存放参考文献信息。常见条目类型有：</p>\n<ul>\n<li><code>@article</code>：期刊文章</li>\n<li><code>@book</code>：书籍</li>\n<li><code>@inproceedings</code>：会议论文</li>\n<li><code>@misc</code>：其他（网页、报JavaScript (ES6) code snippets告等）</li>\n</ul>\n<p><strong>示例：refs.bib</strong></p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bibtex\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">@</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">article</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">einstein1905</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  author</span><span style=\"color:#999999;--shiki-dark:#666666\">    =</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Albert Einstein</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  title</span><span style=\"color:#999999;--shiki-dark:#666666\">     =</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Zur Elektrodynamik bewegter Körper</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  journal</span><span style=\"color:#999999;--shiki-dark:#666666\">   =</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Annalen der Physik</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  volume</span><span style=\"color:#999999;--shiki-dark:#666666\">    =</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">17</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  number</span><span style=\"color:#999999;--shiki-dark:#666666\">    =</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">10</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  pages</span><span style=\"color:#999999;--shiki-dark:#666666\">     =</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">891--921</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  year</span><span style=\"color:#999999;--shiki-dark:#666666\">      =</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">1905</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  publisher</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Wiley</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">@</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">book</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">knuth1984</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  author</span><span style=\"color:#999999;--shiki-dark:#666666\">    =</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Donald E. Knuth</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  title</span><span style=\"color:#999999;--shiki-dark:#666666\">     =</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">The TeXbook</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  year</span><span style=\"color:#999999;--shiki-dark:#666666\">      =</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">1984</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  publisher</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">Addison-Wesley</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">@</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">misc</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">latexproject</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  author</span><span style=\"color:#999999;--shiki-dark:#666666\">    =</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">LaTeX Project</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  title</span><span style=\"color:#999999;--shiki-dark:#666666\">     =</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">LaTeX Project Website</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  year</span><span style=\"color:#999999;--shiki-dark:#666666\">      =</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">2025</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  url</span><span style=\"color:#999999;--shiki-dark:#666666\">       =</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">https://www.latex-project.org/</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span></code></pre>\n<h3 id=\"92-在主-tex-文件中引用\"><a class=\"anchor\" href=\"#92-在主-tex-文件中引用\">#</a> 9.2 在主 <code>.tex</code> 文件中引用</h3>\n<p>在你的 <code>main.tex</code> 中：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-latex\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">documentclass</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\">article</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">usepackage</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">utf8</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\">inputenc</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">usepackage</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\">cite</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">   % 文献引用宏包</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">usepackage</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\">hyperref</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> % 让文献引用可点击</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">begin</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">document</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">爱因斯坦的相对论论文发表于1905年~</span><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">cite</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">einstein1905</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">。</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">LaTeX</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> 的官方文档在~</span><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">cite</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">latexproject</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> 可以找到。</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">% 生成参考文献</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">bibliographystyle</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">plain</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">   </span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">% 参考文献格式：plain, unsrt, abbrv, ieeetr 等</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">bibliography</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">refs</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">         </span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">% refs.bib 文件名，不要写扩展名</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">end</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">document</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span></code></pre>\n<h3 id=\"93-编译流程\"><a class=\"anchor\" href=\"#93-编译流程\">#</a> 9.3 编译流程</h3>\n<p>和普通 <code>.tex</code> 不同，使用 <code>bibtex</code> 时要多一步：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">pdflatex</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> main.tex</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">bibtex</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> main</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">pdflatex</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> main.tex</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">pdflatex</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> main.tex</span></span></code></pre>\n<p>解释：</p>\n<ol>\n<li>第一次 <code>pdflatex</code> 会扫描引用并生成 <code>.aux</code> 文件；</li>\n<li><code>bibtex main</code> 会读取 <code>.aux</code> 文件，从 <code>refs.bib</code> 抽取对应条目生成 <code>.bbl</code> 文件；</li>\n<li>再跑两次 <code>pdflatex</code> 让引用编号和文献列表都正确显示。</li>\n</ol>\n<h3 id=\"94-常见参考文献样式\"><a class=\"anchor\" href=\"#94-常见参考文献样式\">#</a> 9.4 常见参考文献样式</h3>\n<ul>\n<li><code>plain</code>：作者字母顺序，数字编号</li>\n<li><code>unsrt</code>：按引用顺序编号</li>\n<li><code>abbrv</code>：作者名缩写</li>\n<li><code>ieeetr</code>：IEEE 风格</li>\n<li><code>apalike</code>：APA 风格</li>\n</ul>\n<p>例如：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-latex\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">bibliographystyle</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">ieeetr</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span></code></pre>\n<h3 id=\"95-中文参考文献\"><a class=\"anchor\" href=\"#95-中文参考文献\">#</a> 9.5 中文参考文献</h3>\n<p>中文参考文献推荐用 <strong>GB/T 7714 样式</strong>（国标）：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-latex\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">usepackage</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">backend=bibtex,style=gb7714-2015</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#998418;--shiki-dark:#B8A965\">biblatex</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">bibliography</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">refs</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span></code></pre>\n<p>然后在 <code>.bib</code> 文件里可以写中文，例如：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bibtex\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">@</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">book</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#2E8F82;--shiki-dark:#5DA994\">li2020</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  author</span><span style=\"color:#999999;--shiki-dark:#666666\">    =</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">李四 and 张三</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  title</span><span style=\"color:#999999;--shiki-dark:#666666\">     =</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">深度学习导论</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  year</span><span style=\"color:#999999;--shiki-dark:#666666\">      =</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">2020</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">  publisher</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">清华大学出版社</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">}</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span></code></pre>\n<p>这样就能自动生成符合国标的中文参考文献。</p>\n",
            "tags": [
                "math",
                "latex"
            ]
        },
        {
            "id": "http://example.com/2025/08/11/scipy/",
            "url": "http://example.com/2025/08/11/scipy/",
            "title": "scipy基本模块及其使用",
            "date_published": "2025-08-11T05:50:14.009Z",
            "content_html": "<h2 id=\"一-常量模块constants\"><a class=\"anchor\" href=\"#一-常量模块constants\">#</a> 一、常量模块(constants)</h2>\n<p>以下是 <code>scipy.constants</code> 模块中主要常量的分类表格：</p>\n<hr>\n<h3 id=\"11-数学常数\"><a class=\"anchor\" href=\"#11-数学常数\">#</a> <strong>1.1 数学常数</strong></h3>\n<table>\n<thead>\n<tr>\n<th>常量名</th>\n<th>描述</th>\n<th>值 (近似)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>pi</code></td>\n<td>圆周率 π</td>\n<td>3.141592653589793</td>\n</tr>\n<tr>\n<td><code>golden</code></td>\n<td>黄金比例 (φ)</td>\n<td>1.618033988749895</td>\n</tr>\n<tr>\n<td><code>e</code></td>\n<td>自然对数的底 (e)</td>\n<td>2.718281828459045</td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h3 id=\"12-通用物理常数\"><a class=\"anchor\" href=\"#12-通用物理常数\">#</a> <strong>1.2 通用物理常数</strong></h3>\n<table>\n<thead>\n<tr>\n<th>常量名</th>\n<th>描述</th>\n<th>值 (单位)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>c</code></td>\n<td>真空光速</td>\n<td>299792458.0 m/s</td>\n</tr>\n<tr>\n<td><code>h</code></td>\n<td>普朗克常数</td>\n<td>6.62607015e-34 J·s</td>\n</tr>\n<tr>\n<td><code>hbar</code></td>\n<td>约化普朗克常数 (h/2π)</td>\n<td>1.054571817e-34 J·s</td>\n</tr>\n<tr>\n<td><code>G</code></td>\n<td>万有引力常数</td>\n<td>6.67430e-11 m³/(kg·s²)</td>\n</tr>\n<tr>\n<td><code>g</code></td>\n<td>标准重力加速度</td>\n<td>9.80665 m/s²</td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h3 id=\"13-电磁学常数\"><a class=\"anchor\" href=\"#13-电磁学常数\">#</a> <strong>1.3 电磁学常数</strong></h3>\n<table>\n<thead>\n<tr>\n<th>常量名</th>\n<th>描述</th>\n<th>值 (单位)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>mu_0</code></td>\n<td>真空磁导率</td>\n<td>1.25663706212e-6 N/A²</td>\n</tr>\n<tr>\n<td><code>epsilon_0</code></td>\n<td>真空电容率</td>\n<td>8.8541878128e-12 F/m</td>\n</tr>\n<tr>\n<td><code>e</code> (或 <code>elementary_charge</code>)</td>\n<td>元电荷</td>\n<td>1.602176634e-19 C</td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h3 id=\"14-原子与核物理常数\"><a class=\"anchor\" href=\"#14-原子与核物理常数\">#</a> <strong>1.4 原子与核物理常数</strong></h3>\n<table>\n<thead>\n<tr>\n<th>常量名</th>\n<th>描述</th>\n<th>值 (单位)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>m_e</code></td>\n<td>电子质量</td>\n<td>9.1093837015e-31 kg</td>\n</tr>\n<tr>\n<td><code>m_p</code></td>\n<td>质子质量</td>\n<td>1.67262192369e-27 kg</td>\n</tr>\n<tr>\n<td><code>m_n</code></td>\n<td>中子质量</td>\n<td>1.67492749804e-27 kg</td>\n</tr>\n<tr>\n<td><code>Rydberg</code></td>\n<td>里德伯常数</td>\n<td>10973731.568160 1/m</td>\n</tr>\n<tr>\n<td><code>alpha</code></td>\n<td>精细结构常数</td>\n<td>0.0072973525693</td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h3 id=\"15-化学相关常数\"><a class=\"anchor\" href=\"#15-化学相关常数\">#</a> <strong>1.5 化学相关常数</strong></h3>\n<table>\n<thead>\n<tr>\n<th>常量名</th>\n<th>描述</th>\n<th>值 (单位)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>N_A</code></td>\n<td>阿伏伽德罗常数</td>\n<td>6.02214076e23 1/mol</td>\n</tr>\n<tr>\n<td><code>R</code></td>\n<td>通用气体常数</td>\n<td>8.314462618 J/(mol·K)</td>\n</tr>\n<tr>\n<td><code>atomic_mass</code></td>\n<td>原子质量单位 (u)</td>\n<td>1.66053906660e-27 kg</td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h3 id=\"16-常用单位换算因子\"><a class=\"anchor\" href=\"#16-常用单位换算因子\">#</a> <strong>1.6 常用单位换算因子</strong></h3>\n<table>\n<thead>\n<tr>\n<th>常量名</th>\n<th>描述</th>\n<th>换算关系</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>inch</code></td>\n<td>英寸 → 米</td>\n<td>0.0254 m</td>\n</tr>\n<tr>\n<td><code>foot</code></td>\n<td>英尺 → 米</td>\n<td>0.3048 m</td>\n</tr>\n<tr>\n<td><code>mile</code></td>\n<td>英里 → 米</td>\n<td>1609.344 m</td>\n</tr>\n<tr>\n<td><code>lb</code></td>\n<td>磅 → 千克</td>\n<td>0.45359237 kg</td>\n</tr>\n<tr>\n<td><code>eV</code></td>\n<td>电子伏特 → 焦耳</td>\n<td>1.602176634e-19 J</td>\n</tr>\n<tr>\n<td><code>atm</code></td>\n<td>标准大气压 → 帕斯卡</td>\n<td>101325.0 Pa</td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h3 id=\"17-温度相关\"><a class=\"anchor\" href=\"#17-温度相关\">#</a> <strong>1.7 温度相关</strong></h3>\n<table>\n<thead>\n<tr>\n<th>常量名</th>\n<th>描述</th>\n<th>值</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>zero_Celsius</code></td>\n<td>0°C 对应的开尔文温度</td>\n<td>273.15 K</td>\n</tr>\n<tr>\n<td><code>degree_Fahrenheit</code></td>\n<td>1°F 对应的开尔文间隔</td>\n<td>0.555555... K</td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h3 id=\"查找所有常量的方法\"><a class=\"anchor\" href=\"#查找所有常量的方法\">#</a> <strong>查找所有常量的方法</strong></h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">from</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> scipy </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> constants</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 列出所有常量</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">print</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#998418;--shiki-dark:#B8A965\">dir</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">constants</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 搜索包含关键词的常量（例如 'mass'）</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">print</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">constants</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">find</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">mass</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<h2 id=\"二-优化器optimize\"><a class=\"anchor\" href=\"#二-优化器optimize\">#</a> 二、优化器(optimize)</h2>\n<p>scipy的优化器是数学建模的工具，它的核心目标是 寻找函数的最小值（或最大值）、拟合模型、求解方程或系统，适用于传统数学问题<code>而非深度学习</code>(注意和pytorch这些的优化器函数区分开来)</p>\n<h3 id=\"21-无约束优化\"><a class=\"anchor\" href=\"#21-无约束优化\">#</a> <strong>2.1 无约束优化</strong></h3>\n<ul>\n<li>用途:实现查找给定区间内函数的最小值</li>\n<li>实现：</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">minimize_scalar</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> #单变量函数</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">minimize</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">        #多变量函数</span></span></code></pre>\n<ul>\n<li>\n<p>查找方法：</p>\n<ul>\n<li>单变量：<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">brent:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 使用Brent方法（结合抛物线插值和黄金分割法）</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">bounded:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 在有界区间内搜索</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">golden:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 黄金分割法</span></span></code></pre>\n</li>\n<li>多变量<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">Nelder-Mead:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 单纯形法，不需要梯度</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">BFGS:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 拟牛顿法，需要梯度</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">CG:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 共轭梯度法</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">L-BFGS-B:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 有限内存BFGS，适用于大规模问题</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">TNC:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 截断牛顿法</span></span></code></pre>\n</li>\n</ul>\n</li>\n<li>\n<p>实现实例：</p>\n</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">from</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> scipy.optimize</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> import</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> minimize</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">def</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> rosen</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">x</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">:</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    \"\"\"Rosenbrock函数\"\"\"</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    return</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> sum</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">100.0*</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">x</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#59873A;--shiki-dark:#80A665\">1:</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#59873A;--shiki-dark:#80A665\">-x</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#59873A;--shiki-dark:#80A665\">:-1</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#59873A;--shiki-dark:#80A665\">**2.0</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\">**</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">2.0</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> +</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">1-x</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">:-1</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">**</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">2.0</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">x0</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:rgba(255, 18, 18, 0.8);--shiki-dark:rgba(255, 18, 18, 0.8)\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">1.3, </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">0.7,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 0.8,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 1.9,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 1.2]</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> #x0 是多维优化问题（如 minimize）的 初始猜测值（initial guess）。优化算法需要一个起点开始搜索最小值。</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">res</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> minimize</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">rosen,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> x0,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> method=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">BFGS</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> options={</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">disp</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> True}</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> #res 是 minimize 或 minimize_scalar 函数的返回结果，它是一个 OptimizeResult 对象 </span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">print</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">res.x</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span></span></code></pre>\n<p>其中res的解有如下内容</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># res 包含的重要属性：</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">res.x</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">       # 最优解（最小值点）</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">res.fun</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">     # 最优解处的函数值</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">res.nfev</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    # 函数评估次数</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">res.nit</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">     # 迭代次数</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">res.success</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> # 是否成功收敛</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">res.message</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> # 状态描述（如收敛信息）</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">res.jac</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">     # 最优解处的梯度（一阶导数）</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">res.hess</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    # 最优解处的Hessian矩阵（二阶导数，如果可用）</span></span></code></pre>\n<h3 id=\"22-全局优化\"><a class=\"anchor\" href=\"#22-全局优化\">#</a> <strong>2.2 全局优化</strong></h3>\n<ul>\n<li>用途：避免传统优化算法（如 minimize）陷入局部最优解，转而寻找 全局最优解。</li>\n<li>实现函数：</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">basinhopping</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">: </span><span style=\"color:#59873A;--shiki-dark:#80A665\">盆地跳跃算法basinhopping</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">: 盆地跳跃算法</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">shgo</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">: 单纯形同伦全局优化</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">differential_evolution</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">: 差分进化算法</span></span></code></pre>\n<ul>\n<li>实例：</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">from</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> scipy.optimize</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> import</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> basinhopping</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">def</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> func</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">x</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">:</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    return</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> np.cos</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">14.5</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> x</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0.3</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> +</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">x </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">+</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0.2</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> x</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">res</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> basinhopping</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">func,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> x0=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1.0</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">print</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">\"全局最小值：x = %.4f, f(x) = %.4f\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> %</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">res.x, </span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">res.fun</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<h3 id=\"23-最小二乘拟合\"><a class=\"anchor\" href=\"#23-最小二乘拟合\">#</a> <strong>2.3 最小二乘拟合</strong></h3>\n<ul>\n<li>\n<p>用途：解决非线性最小二乘问题，常用于曲线拟合。</p>\n</li>\n<li>\n<p>实现函数：</p>\n</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">least_squares</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">: 解决非线性最小二乘问题</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">curve_fit</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">: 使用最小二乘法拟合曲线</span></span></code></pre>\n<ul>\n<li>实例：</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">from</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> scipy.optimize</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> import</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> curve_fit</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">import</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> numpy</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> as</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> np</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 定义模型函数</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">def</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> func</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">x,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> a,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> b,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> c</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">:</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    return</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> a</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> np.exp</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">-b</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> x</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> +</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> c</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 生成带噪声的数据</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">xdata</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> np.linspace</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">0,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 4,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 50</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">y</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> func</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">xdata,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 2.5,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 1.3,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0.5</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">ydata</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> y</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> +</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0.2</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> *</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> np.random.normal</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">size</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">len</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">xdata</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 拟合数据</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">popt,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> pcov</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> curve_fit</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">func,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> xdata,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ydata</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">print</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">\"拟合参数：\"</span><span style=\"color:#59873A;--shiki-dark:#80A665\">,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> popt</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">#返回[a,b,c]</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">print</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">\"协方差矩阵\"</span><span style=\"color:#59873A;--shiki-dark:#80A665\">,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> pcov</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">#评估可靠性</span></span></code></pre>\n<p>[a,b,c]-&gt; <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mi>a</mi><msup><mi>e</mi><mrow><mo>−</mo><mi>b</mi><mi>x</mi></mrow></msup><mo>+</mo><mi>c</mi></mrow><annotation encoding=\"application/x-tex\">f(x)=ae^{-bx}+c</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.9324em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mord\"><span class=\"mord mathnormal\">e</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8491em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">−</span><span class=\"mord mathnormal mtight\">b</span><span class=\"mord mathnormal mtight\">x</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">c</span></span></span></span></p>\n<h3 id=\"24-方程求根\"><a class=\"anchor\" href=\"#24-方程求根\">#</a> <strong>2.4 方程求根</strong></h3>\n<ul>\n<li>方法：</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">root_scalar</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">: 单变量方程求根 </span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">#brentq, brenth, ridder, bisect, newton: 特定算法</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">root</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">: 多变量方程组求根</span></span></code></pre>\n<ul>\n<li>实现：</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">from</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> scipy</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">optimize </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> root_scalar</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">def</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> f</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    return</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> x</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">**</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  # 寻找x^3 = 1的解</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">sol </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> root_scalar</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">f</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> bracket</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> method</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">brentq</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">print</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">方程的根：</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> sol</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">root</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">from</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> scipy</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">optimize </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> root</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">def</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> func</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    return</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> +</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0.5</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> x</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">**</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1.0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">            0.5</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> *</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> x</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">**</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> +</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> x</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">sol </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> root</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">func</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">print</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">方程组的解：</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> sol</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<h3 id=\"25-线性规划\"><a class=\"anchor\" href=\"#25-线性规划\">#</a> <strong>2.5 线性规划</strong></h3>\n<ul>\n<li>什么是线性规划：结构化决策框架，其核心是在一个由线性关系定义的几何空间中，寻找最优的\"角落\"解。比如如下这个问题</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">想象你是一个工厂经理，需要决定生产两种产品A和B的数量：</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">生产A每个利润100元，B每个利润150元</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">但受限于：</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">原材料X：生产A消耗3kg，B消耗2kg，总共只有120kg</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">工时：生产A需要2小时，B需要4小时，总共只有160小时</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">线性规划就是帮你找到在资源限制下能获得最大利润的生产方案</span></span>\n<span class=\"line\"></span></code></pre>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>p</mi><mi>r</mi><mi>o</mi><mi>f</mi><mi>i</mi><mi>t</mi><mo>=</mo><mo>−</mo><mn>100</mn><mi>x</mi><mo>−</mo><mn>150</mn><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">profit=-100x-150y\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\">p</span><span class=\"mord mathnormal\">ro</span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">−</span><span class=\"mord\">100</span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8389em;vertical-align:-0.1944em;\"></span><span class=\"mord\">150</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span></span></p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mrow><mo fence=\"true\">[</mo><mtable rowspacing=\"0.16em\" columnalign=\"center center\" columnspacing=\"1em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>3</mn></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>2</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>2</mn></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>4</mn></mstyle></mtd></mtr></mtable><mo fence=\"true\">]</mo></mrow><mrow><mo fence=\"true\">[</mo><mtable rowspacing=\"0.16em\" columnalign=\"center\" columnspacing=\"1em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi>x</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi>y</mi></mstyle></mtd></mtr></mtable><mo fence=\"true\">]</mo></mrow><mo>≤</mo><mrow><mo fence=\"true\">[</mo><mtable rowspacing=\"0.16em\" columnalign=\"center\" columnspacing=\"1em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>120</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>160</mn></mstyle></mtd></mtr></mtable><mo fence=\"true\">]</mo></mrow></mrow><annotation encoding=\"application/x-tex\">\\begin{bmatrix}\n3 &amp; 2 \\\\\n2 &amp; 4\n\\end{bmatrix}\n\\begin{bmatrix}\nx \\\\\ny\n\\end{bmatrix}\n\\le\n\\begin{bmatrix}\n120 \\\\\n160\n\\end{bmatrix}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:2.4em;vertical-align:-0.95em;\"></span><span class=\"minner\"><span class=\"mopen delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size3\">[</span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.45em;\"><span style=\"top:-3.61em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">3</span></span></span><span style=\"top:-2.41em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.95em;\"><span></span></span></span></span></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.45em;\"><span style=\"top:-3.61em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">2</span></span></span><span style=\"top:-2.41em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">4</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.95em;\"><span></span></span></span></span></span></span></span><span class=\"mclose delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size3\">]</span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"minner\"><span class=\"mopen delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size3\">[</span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.45em;\"><span style=\"top:-3.61em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">x</span></span></span><span style=\"top:-2.41em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.95em;\"><span></span></span></span></span></span></span></span><span class=\"mclose delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size3\">]</span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">≤</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:2.4em;vertical-align:-0.95em;\"></span><span class=\"minner\"><span class=\"mopen delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size3\">[</span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.45em;\"><span style=\"top:-3.61em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">120</span></span></span><span style=\"top:-2.41em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">160</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.95em;\"><span></span></span></span></span></span></span></span><span class=\"mclose delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size3\">]</span></span></span></span></span></span></span></p>\n<p>抽象一下就是：<br>\n输入: (A, b, c) → 处理: 代数变换 → 输出: x*</p>\n<p>其中：</p>\n<p>A 是约束矩阵（系统限制的编码）=&gt;不等式左侧系数 A=<br>\n<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo fence=\"true\">[</mo><mtable rowspacing=\"0.16em\" columnalign=\"center center\" columnspacing=\"1em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>3</mn></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>2</mn></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>2</mn></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mn>4</mn></mstyle></mtd></mtr></mtable><mo fence=\"true\">]</mo></mrow><annotation encoding=\"application/x-tex\">\n\\begin{bmatrix}\n3 &amp; 2 \\\\\n2 &amp; 4\n\\end{bmatrix}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:2.4em;vertical-align:-0.95em;\"></span><span class=\"minner\"><span class=\"mopen delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size3\">[</span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.45em;\"><span style=\"top:-3.61em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">3</span></span></span><span style=\"top:-2.41em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.95em;\"><span></span></span></span></span></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.45em;\"><span style=\"top:-3.61em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">2</span></span></span><span style=\"top:-2.41em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord\">4</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.95em;\"><span></span></span></span></span></span></span></span><span class=\"mclose delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size3\">]</span></span></span></span></span></span></p>\n<p>b 是资源向量（约束条件的量化）=&gt;不等式右侧系数 b=[120,160]</p>\n<p>c 是价值向量（目标函数的权重）=&gt;利润最大化 c=[-100,-150] (线性规划默认求最小值问题) <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>f</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo><mo>=</mo><mo>−</mo><mn>100</mn><mi>x</mi><mo>−</mo><mn>150</mn><mi>y</mi></mrow><annotation encoding=\"application/x-tex\">f(x)=-100x-150y</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">−</span><span class=\"mord\">100</span><span class=\"mord mathnormal\">x</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8389em;vertical-align:-0.1944em;\"></span><span class=\"mord\">150</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span></span></span></span></p>\n<p>x* 是最优决策（系统输出的解决方案）</p>\n<ul>\n<li>实现实例:</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">from</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> scipy</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">optimize </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> linprog</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 最小化 c^T x</span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 约束条件: A_ub x &lt;= b_ub, A_eq x = b_eq</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">c </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 4</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  # 目标函数系数</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">A_ub </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  # 不等式约束矩阵</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">b_ub </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">6</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 4</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">             # 不等式约束右侧</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">res </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> linprog</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">c</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> A_ub</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">A_ub</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> b_ub</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">b_ub</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> bounds</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">None</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> None</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">print</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">最优解：</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> res</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">print</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">最优值：</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> res</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">fun</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<h3 id=\"26-约束优化\"><a class=\"anchor\" href=\"#26-约束优化\">#</a> <strong>2.6 约束优化</strong></h3>\n<ul>\n<li>用途：在有等式或不等式约束条件下优化目标函数。</li>\n<li>方法：</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">minimize</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> 配合约束参数</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">SLSQP:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 序列二次规划算法</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">trust-constr:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 信赖域算法</span></span></code></pre>\n<ul>\n<li>实现：</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">from</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> scipy</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">optimize </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> minimize</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 目标函数</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">def</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> objective</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    return</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> x</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">+</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 约束条件</span></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">def</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> constraint1</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    return</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> x</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">*</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">3</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">25.0</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">def</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> constraint2</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">    return</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> sum</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">**</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">40.0</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 初始猜测</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">x0 </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">5</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">5</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 设置约束</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">con1 </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">type</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">ineq</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">fun</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> constraint1</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">con2 </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">type</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">eq</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">fun</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> constraint2</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">cons </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">con1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">con2</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 优化</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">sol </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> minimize</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">objective</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">x0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">method</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">SLSQP</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">constraints</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">cons</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">print</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">最优解：</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> sol</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">x</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<h2 id=\"三-稀疏矩阵sparse\"><a class=\"anchor\" href=\"#三-稀疏矩阵sparse\">#</a> 三、稀疏矩阵(sparse)</h2>\n<p>专门针对那些绝大多数元素为零的矩阵数据结构</p>\n<h3 id=\"31-处理稀疏矩阵\"><a class=\"anchor\" href=\"#31-处理稀疏矩阵\">#</a> <strong>3.1 处理稀疏矩阵</strong></h3>\n<ul>\n<li>方法:</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">CSC</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 压缩稀疏列（Compressed</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Sparse</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Column），按列压缩。</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">CSR</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> -</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 压缩稀疏行（Compressed</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Sparse</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Row），按行压缩。</span></span></code></pre>\n<ul>\n<li>实现:</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> numpy </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">as</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> np</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">from</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> scipy</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">sparse </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> csr_matrix</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">arr </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> np</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">array</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">print</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">csr_matrix</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">arr</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span></code></pre>\n<p>输出:</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">0,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 5</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#59873A;--shiki-dark:#80A665\">        1</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">0,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 6</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#59873A;--shiki-dark:#80A665\">        1</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">0,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 8</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#59873A;--shiki-dark:#80A665\">        2</span></span></code></pre>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">print</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">csr_matrix</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">arr</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">data</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> #输出不为零的元素[1,1,2]</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">print</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">csr_matrix</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">arr</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">count_nonzero</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> #输出非0元素总数3</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">mat </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> csr_matrix</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">arr</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">mat</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">eliminate_zeros</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">print</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">mat</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> #删除矩阵中的0元素</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">mat </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> csr_matrix</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">arr</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">mat</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">sum_duplicates</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">print</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">mat</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> #删除重复项</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">newarr </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> csr_matrix</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">arr</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">tocsc</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> #将csr转为csc</span></span></code></pre>\n<h3 id=\"32图结构sparsecsgraph\"><a class=\"anchor\" href=\"#32图结构sparsecsgraph\">#</a> <strong>3.2图结构(sparse.csgraph)</strong></h3>\n<ul>\n<li>如何查看连接组件(连接组件是指图中所有互相连通的节点的集合)</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">connected_components</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> numpy </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">as</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> np</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">from</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> scipy</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">sparse</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">csgraph </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> connected_components</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">from</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> scipy</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">sparse </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> csr_matrix</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">arr </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> np</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">array</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">newarr </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> csr_matrix</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">arr</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">print</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">connected_components</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">newarr</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<p>输出:</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">1,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> array</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">0, 0, 0</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">, </span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">dtype</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">int32</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> #1代表一个连接组件，[0,0,0]代表每个元素属于哪个连接组件</span></span></code></pre>\n<ul>\n<li>Dijkstra 算法调用(用于计算一个节点到其他所有节点的最短路径)</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> numpy </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">as</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> np</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">from</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> scipy</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">sparse</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">csgraph </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> dijkstra</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">from</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> scipy</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">sparse </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> csr_matrix</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">arr </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> np</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">array</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">newarr </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> csr_matrix</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">arr</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">print</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">dijkstra</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">newarr</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> return_predecessors</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">True</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> indices</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<p>其中dijkstra的参数：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">return_predecessors:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 布尔值，设置</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> True，遍历所有路径，如果不想遍历所有路径可以设置为</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> False。</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">indices:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 元素的索引，返回该元素的所有路径。</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">limit:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 路径的最大权重。</span></span></code></pre>\n<ul>\n<li>Floyd Warshall -- 弗洛伊德算法(解决任意两点间的最短路径)</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> numpy </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">as</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> np</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">from</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> scipy</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">sparse</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">csgraph </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> floyd_warshall</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">from</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> scipy</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">sparse </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> csr_matrix</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">arr </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> np</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">array</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">newarr </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> csr_matrix</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">arr</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">print</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">floyd_warshall</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">newarr</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> return_predecessors</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">True</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<ul>\n<li>Bellman Ford -- 贝尔曼-福特算法(任意两点间的最短路径)</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> numpy </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">as</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> np</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">from</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> scipy</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">sparse</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">csgraph </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> bellman_ford</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">from</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> scipy</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">sparse </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> csr_matrix</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">arr </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> np</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">array</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> -</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">newarr </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> csr_matrix</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">arr</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">print</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">bellman_ford</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">newarr</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> return_predecessors</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">True</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> indices</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<ul>\n<li>dfs</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> numpy </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">as</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> np</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">from</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> scipy</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">sparse</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">csgraph </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> depth_first_order</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">from</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> scipy</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">sparse </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> csr_matrix</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">arr </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> np</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">array</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">newarr </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> csr_matrix</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">arr</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">print</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">depth_first_order</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">newarr</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> #传入邻接矩阵和起始遍历元素</span></span></code></pre>\n<ul>\n<li>bfs</li>\n</ul>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> numpy </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">as</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> np</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">from</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> scipy</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">sparse</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">csgraph </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> breadth_first_order</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">from</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> scipy</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">sparse </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> csr_matrix</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">arr </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> np</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">array</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">]</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">newarr </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> csr_matrix</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">arr</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">print</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">breadth_first_order</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">newarr</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n",
            "tags": [
                "math",
                "python",
                "scipy"
            ]
        },
        {
            "id": "http://example.com/2025/08/10/seaborn/",
            "url": "http://example.com/2025/08/10/seaborn/",
            "title": "seaborn实现统计图绘制",
            "date_published": "2025-08-10T06:50:00.000Z",
            "content_html": "<h2 id=\"一-设置主题和样式\"><a class=\"anchor\" href=\"#一-设置主题和样式\">#</a> 一、设置主题和样式</h2>\n<p>在进行图形绘制之前先设置好主题/样式</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 设置主题/样式（可选）</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">sns.set_theme</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">style</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">=</span><span style=\"color:#59873A;--shiki-dark:#80A665\">\"darkgrid\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">  </span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 可选风格：darkgrid, whitegrid, dark, white, ticks</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">sns.set_palette</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">\"husl\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">          </span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 设置调色板</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">sns.set_context</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">\"paper\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">         </span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 设置上下文（paper, notebook, talk, poster）</span></span></code></pre>\n<p>以下是 <code>sns.set_theme()</code>、<code>sns.set_palette()</code> 和 <code>sns.set_context()</code> 的可选参数整理成表格：</p>\n<h3 id=\"1-snsset_theme-的-style-参数图表风格\"><a class=\"anchor\" href=\"#1-snsset_theme-的-style-参数图表风格\">#</a> 1. <strong><code>sns.set_theme()</code> 的 <code>style</code> 参数（图表风格）</strong></h3>\n<table>\n<thead>\n<tr>\n<th>可选值</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>&quot;darkgrid&quot;</code></td>\n<td>默认值，灰色背景 + 白色网格线（适合大多数场景）</td>\n</tr>\n<tr>\n<td><code>&quot;whitegrid&quot;</code></td>\n<td>白色背景 + 深色网格线（适合强调数据精度）</td>\n</tr>\n<tr>\n<td><code>&quot;dark&quot;</code></td>\n<td>纯灰色背景，无网格线（简洁风格）</td>\n</tr>\n<tr>\n<td><code>&quot;white&quot;</code></td>\n<td>纯白色背景，无网格线（极简风格）</td>\n</tr>\n<tr>\n<td><code>&quot;ticks&quot;</code></td>\n<td>白色背景 + 坐标轴刻度（无网格线，类似 <code>&quot;white&quot;</code> 但更清晰的刻度）</td>\n</tr>\n</tbody>\n</table>\n<hr />\n<h3 id=\"2-snsset_palette-的调色板参数\"><a class=\"anchor\" href=\"#2-snsset_palette-的调色板参数\">#</a> 2. <strong><code>sns.set_palette()</code> 的调色板参数</strong></h3>\n<table>\n<thead>\n<tr>\n<th>类型</th>\n<th>可选值示例</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>Seaborn 内置名称</strong></td>\n<td><code>&quot;husl&quot;</code>, <code>&quot;deep&quot;</code>, <code>&quot;muted&quot;</code>, <code>&quot;bright&quot;</code>, <code>&quot;pastel&quot;</code>, <code>&quot;dark&quot;</code>, <code>&quot;colorblind&quot;</code></td>\n</tr>\n<tr>\n<td><strong>Matplotlib 色板</strong></td>\n<td><code>&quot;viridis&quot;</code>, <code>&quot;plasma&quot;</code>, <code>&quot;magma&quot;</code>, <code>&quot;cividis&quot;</code>（需安装 Matplotlib）</td>\n</tr>\n<tr>\n<td><strong>自定义颜色列表</strong></td>\n<td><code>[&quot;#FF5733&quot;, &quot;#33FF57&quot;, &quot;#3357FF&quot;]</code>（十六进制/RGB 颜色列表）</td>\n</tr>\n<tr>\n<td><strong>其他方法</strong></td>\n<td><code>sns.color_palette(&quot;hls&quot;, 8)</code> 或 <code>sns.husl_palette(10)</code> 生成动态调色板</td>\n</tr>\n</tbody>\n</table>\n<hr />\n<h3 id=\"3-snsset_context-的-context-参数图表比例\"><a class=\"anchor\" href=\"#3-snsset_context-的-context-参数图表比例\">#</a> 3. <strong><code>sns.set_context()</code> 的 <code>context</code> 参数（图表比例）</strong></h3>\n<table>\n<thead>\n<tr>\n<th>可选值</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>&quot;paper&quot;</code></td>\n<td>最小比例（适合论文或小图，字体和线条较细）</td>\n</tr>\n<tr>\n<td><code>&quot;notebook&quot;</code></td>\n<td>默认值（适合 Jupyter Notebook 或常规屏幕显示）</td>\n</tr>\n<tr>\n<td><code>&quot;talk&quot;</code></td>\n<td>较大比例（适合幻灯片演示，字体和线条加粗）</td>\n</tr>\n<tr>\n<td><code>&quot;poster&quot;</code></td>\n<td>最大比例（适合海报或大屏展示，元素显著放大）</td>\n</tr>\n</tbody>\n</table>\n<hr />\n<h3 id=\"附set_theme-的完整参数可选\"><a class=\"anchor\" href=\"#附set_theme-的完整参数可选\">#</a> 附：<code>set_theme()</code> 的完整参数（可选）</h3>\n<table>\n<thead>\n<tr>\n<th>参数</th>\n<th>类型</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>style</code></td>\n<td>str</td>\n<td>上述风格之一（如 <code>&quot;darkgrid&quot;</code>）</td>\n</tr>\n<tr>\n<td><code>palette</code></td>\n<td>str/list</td>\n<td>上述调色板之一</td>\n</tr>\n<tr>\n<td><code>context</code></td>\n<td>str/dict</td>\n<td>上述上下文之一或自定义字典</td>\n</tr>\n<tr>\n<td><code>font</code></td>\n<td>str</td>\n<td>字体（如 <code>&quot;sans-serif&quot;</code>）</td>\n</tr>\n<tr>\n<td><code>font_scale</code></td>\n<td>float</td>\n<td>字体缩放因子（默认 1）</td>\n</tr>\n<tr>\n<td><code>rc</code></td>\n<td>dict</td>\n<td>直接覆盖 Matplotlib 的 rcParams</td>\n</tr>\n</tbody>\n</table>\n<hr />\n<h3 id=\"示例代码\"><a class=\"anchor\" href=\"#示例代码\">#</a> 示例代码：</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> seaborn </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">as</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> sns</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 综合设置</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">sns</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">set_theme</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    style</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">whitegrid</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">      # 风格</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    palette</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">husl</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">         # 调色板</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    context</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">talk</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">         # 上下文</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    font</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Arial</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">           # 字体</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    font_scale</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1.2</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">          # 字体大小缩放</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 单独设置（等效于上面的 palette）</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">sns</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">set_palette</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">husl</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<p>如果需要更详细的参数（如自定义 <code>rc</code>），可以进一步参考 <a href=\"https://seaborn.pydata.org/generated/seaborn.set_theme.html\">Seaborn 官方文档</a>。</p>\n<h2 id=\"二-调用seaborn绘图函数\"><a class=\"anchor\" href=\"#二-调用seaborn绘图函数\">#</a> 二、调用seaborn绘图函数</h2>\n<p>Seaborn 提供了多种高级绘图函数，主要分为以下几类：<strong>关系型</strong>、<strong>分布型</strong>、<strong>分类型</strong>、<strong>回归型</strong>、<strong>矩阵型</strong> 和 <strong>其他辅助函数</strong>。以下是详细的分类说明和示例：</p>\n<hr />\n<h3 id=\"1-关系型绘图relational-plots\"><a class=\"anchor\" href=\"#1-关系型绘图relational-plots\">#</a> 1. <strong>关系型绘图（Relational Plots）</strong></h3>\n<p>用于展示变量之间的关系（通常用于连续数据）。</p>\n<table>\n<thead>\n<tr>\n<th>函数</th>\n<th>描述</th>\n<th>示例代码</th>\n<th>示例图</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>sns.scatterplot()</code></td>\n<td>散点图（基础）</td>\n<td><code>sns.scatterplot(data=tips, x=&quot;total_bill&quot;, y=&quot;tip&quot;, hue=&quot;time&quot;)</code></td>\n<td><img loading=\"lazy\" src=\"https://seaborn.pydata.org/_images/scatterplot_3_0.png\" alt=\"scatterplot\" /></td>\n</tr>\n<tr>\n<td><code>sns.lineplot()</code></td>\n<td>折线图（趋势展示）</td>\n<td><code>sns.lineplot(data=flights, x=&quot;year&quot;, y=&quot;passengers&quot;, hue=&quot;month&quot;)</code></td>\n<td><img loading=\"lazy\" src=\"https://seaborn.pydata.org/_images/lineplot_3_0.png\" alt=\"lineplot\" /></td>\n</tr>\n<tr>\n<td><code>sns.relplot()</code></td>\n<td>分面关系图（散点）</td>\n<td><code>sns.relplot(data=tips, x=&quot;total_bill&quot;, y=&quot;tip&quot;, col=&quot;time&quot;, kind=&quot;scatter&quot;)</code></td>\n<td><img loading=\"lazy\" src=\"https://seaborn.pydata.org/_images/scatterplot_29_0.png\" alt=\"relplot scatter\" /></td>\n</tr>\n</tbody>\n</table>\n<hr />\n<h3 id=\"2-分布型绘图distribution-plots\"><a class=\"anchor\" href=\"#2-分布型绘图distribution-plots\">#</a> 2. <strong>分布型绘图（Distribution Plots）</strong></h3>\n<p>用于展示数据的分布特征。</p>\n<table>\n<thead>\n<tr>\n<th>函数</th>\n<th>描述</th>\n<th>示例代码</th>\n<th>示例图</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>sns.histplot()</code></td>\n<td>直方图（单变量分布）</td>\n<td><code>sns.histplot(data=tips, x=&quot;total_bill&quot;, bins=20, kde=True)</code></td>\n<td><img loading=\"lazy\" src=\"https://seaborn.pydata.org/_images/histplot_13_0.png\" alt=\"histplot 示例\" /></td>\n</tr>\n<tr>\n<td><code>sns.kdeplot()</code></td>\n<td>核密度估计图（光滑分布）</td>\n<td><code>sns.kdeplot(data=tips, x=&quot;total_bill&quot;, hue=&quot;time&quot;, fill=True)</code></td>\n<td><img loading=\"lazy\" src=\"https://seaborn.pydata.org/_images/kdeplot_35_0.png\" alt=\"kdeplot 示例\" /></td>\n</tr>\n<tr>\n<td><code>sns.ecdfplot()</code></td>\n<td>经验累积分布函数图</td>\n<td><code>sns.ecdfplot(data=tips, x=&quot;total_bill&quot;, hue=&quot;time&quot;)</code></td>\n<td><img loading=\"lazy\" src=\"https://raw.githubusercontent.com/koen666/image/master/exp.png\" alt=\"ecdfplot 示例\" /> <em>(示意)</em></td>\n</tr>\n<tr>\n<td><code>sns.displot()</code></td>\n<td>分面分布图（直方/KDE）</td>\n<td><code>sns.displot(data=tips, x=&quot;total_bill&quot;, col=&quot;time&quot;, kind=&quot;hist&quot;)</code></td>\n<td><img loading=\"lazy\" src=\"https://seaborn.pydata.org/_images/distributions_31_0.png\" alt=\"displot 示例\" /></td>\n</tr>\n<tr>\n<td><code>sns.boxplot()</code></td>\n<td>箱线图（五数概括）</td>\n<td><code>sns.boxplot(data=tips, x=&quot;day&quot;, y=&quot;total_bill&quot;, hue=&quot;sex&quot;)</code></td>\n<td><img loading=\"lazy\" src=\"https://raw.githubusercontent.com/koen666/image/master/boxplot.png\" alt=\"boxplot 示例\" /> <em>(占位)</em> (<a href=\"https://docs.kanaries.net/topics/Seaborn/sns-boxplot?utm_source=chatgpt.com\" title=\"Seaborn Boxplot Tutorial: Create Custom Box Plots in Python\">Kanaries Docs</a>)</td>\n</tr>\n<tr>\n<td><code>sns.violinplot()</code></td>\n<td>小提琴图（分布+密度）</td>\n<td><code>sns.violinplot(data=tips, x=&quot;day&quot;, y=&quot;total_bill&quot;, hue=&quot;sex&quot;, split=True)</code></td>\n<td><img loading=\"lazy\" src=\"https://seaborn.pydata.org/_images/violinplot_5_0.png\" alt=\"violinplot 示例\" /> <em>(占位)</em> (<a href=\"https://www.geeksforgeeks.org/python/violinplot-using-seaborn-in-python/?utm_source=chatgpt.com\" title=\"Violinplot using Seaborn in Python - GeeksforGeeks\">GeeksforGeeks</a>)</td>\n</tr>\n</tbody>\n</table>\n<hr />\n<h3 id=\"3-分类型绘图categorical-plots\"><a class=\"anchor\" href=\"#3-分类型绘图categorical-plots\">#</a> 3. <strong>分类型绘图（Categorical Plots）</strong></h3>\n<p>用于分类变量的可视化。</p>\n<table>\n<thead>\n<tr>\n<th>函数</th>\n<th>描述</th>\n<th>示例代码</th>\n<th>示例图</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>sns.barplot()</code></td>\n<td>条形图（均值/置信区间）</td>\n<td><code>sns.barplot(data=tips, x=&quot;day&quot;, y=&quot;total_bill&quot;, hue=&quot;sex&quot;)</code></td>\n<td><img loading=\"lazy\" src=\"https://seaborn.pydata.org/_images/barplot_9_0.png\" alt=\"barplot\" /></td>\n</tr>\n<tr>\n<td><code>sns.countplot()</code></td>\n<td>计数条形图（频次）</td>\n<td><code>sns.countplot(data=tips, x=&quot;day&quot;, hue=&quot;sex&quot;)</code></td>\n<td><img loading=\"lazy\" src=\"https://seaborn.pydata.org/_images/countplot_1_0.png\" alt=\"countplot\" /></td>\n</tr>\n<tr>\n<td><code>sns.pointplot()</code></td>\n<td>点图（均值+置信区间）</td>\n<td><code>sns.pointplot(data=tips, x=&quot;day&quot;, y=&quot;total_bill&quot;, hue=&quot;sex&quot;)</code></td>\n<td><img loading=\"lazy\" src=\"https://seaborn.pydata.org/_images/pointplot_6_0.png\" alt=\"pointplot\" /></td>\n</tr>\n<tr>\n<td><code>sns.stripplot()</code></td>\n<td>散点图（分类+抖动）</td>\n<td><code>sns.stripplot(data=tips, x=&quot;day&quot;, y=&quot;total_bill&quot;, hue=&quot;sex&quot;, dodge=True)</code></td>\n<td><img loading=\"lazy\" src=\"https://seaborn.pydata.org/_images/stripplot_8_0.png\" alt=\"stripplot\" /></td>\n</tr>\n<tr>\n<td><code>sns.swarmplot()</code></td>\n<td>蜂群图（无重叠散点）</td>\n<td><code>sns.swarmplot(data=tips, x=&quot;day&quot;, y=&quot;total_bill&quot;, hue=&quot;sex&quot;)</code></td>\n<td><img loading=\"lazy\" src=\"https://seaborn.pydata.org/_images/swarmplot_5_0.png\" alt=\"swarmplot\" /></td>\n</tr>\n<tr>\n<td><code>sns.catplot()</code></td>\n<td>分面绘制分类图（多功能）</td>\n<td><code>sns.catplot(data=tips, x=&quot;day&quot;, y=&quot;total_bill&quot;, col=&quot;sex&quot;, kind=&quot;box&quot;)</code></td>\n<td><img loading=\"lazy\" src=\"https://seaborn.pydata.org/_images/catplot_11_0.png\" alt=\"catplot\" /></td>\n</tr>\n</tbody>\n</table>\n<hr />\n<h3 id=\"4-回归型绘图regression-plots\"><a class=\"anchor\" href=\"#4-回归型绘图regression-plots\">#</a> 4. <strong>回归型绘图（Regression Plots）</strong></h3>\n<p>用于展示变量间的统计关系（含回归线）。</p>\n<table>\n<thead>\n<tr>\n<th>函数</th>\n<th>描述</th>\n<th>示例代码</th>\n<th>示例图</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>sns.regplot()</code></td>\n<td>回归散点图（单次拟合）</td>\n<td><code>sns.regplot(data=tips, x=&quot;total_bill&quot;, y=&quot;tip&quot;, ci=95)</code></td>\n<td><img loading=\"lazy\" src=\"https://seaborn.pydata.org/_images/regplot_5_0.png\" alt=\"regplot\" /></td>\n</tr>\n<tr>\n<td><code>sns.lmplot()</code></td>\n<td>分面回归图（多功能）</td>\n<td><code>sns.lmplot(data=tips, x=&quot;total_bill&quot;, y=&quot;tip&quot;, col=&quot;time&quot;, order=2)</code></td>\n<td><img loading=\"lazy\" src=\"https://seaborn.pydata.org/_images/lmplot_12_0.png\" alt=\"lmplot\" /></td>\n</tr>\n</tbody>\n</table>\n<hr />\n<h3 id=\"5-矩阵型绘图matrix-plots\"><a class=\"anchor\" href=\"#5-矩阵型绘图matrix-plots\">#</a> 5. <strong>矩阵型绘图（Matrix Plots）</strong></h3>\n<p>用于矩阵数据的可视化（如相关性、聚类）。</p>\n<table>\n<thead>\n<tr>\n<th>函数</th>\n<th>描述</th>\n<th>示例代码</th>\n<th>示例图</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>sns.heatmap()</code></td>\n<td>热力图（矩阵值颜色映射）</td>\n<td><code>sns.heatmap(data.corr(), annot=True, cmap=&quot;coolwarm&quot;)</code></td>\n<td><img loading=\"lazy\" src=\"https://seaborn.pydata.org/_images/heatmap_2_0.png\" alt=\"heatmap\" /></td>\n</tr>\n<tr>\n<td><code>sns.clustermap()</code></td>\n<td>聚类热力图（行列聚类）</td>\n<td><code>sns.clustermap(data.corr(), method=&quot;ward&quot;, cmap=&quot;vlag&quot;)</code></td>\n<td><img loading=\"lazy\" src=\"https://seaborn.pydata.org/_images/clustermap_1_0.png\" alt=\"clustermap\" /></td>\n</tr>\n</tbody>\n</table>\n<hr />\n<h3 id=\"6-其他辅助函数\"><a class=\"anchor\" href=\"#6-其他辅助函数\">#</a> 6. <strong>其他辅助函数</strong></h3>\n<table>\n<thead>\n<tr>\n<th>函数</th>\n<th>描述</th>\n<th>示例代码</th>\n<th>示例图</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>sns.pairplot()</code></td>\n<td>变量两两关系矩阵</td>\n<td><code>sns.pairplot(data=iris, hue=&quot;species&quot;, diag_kind=&quot;kde&quot;)</code></td>\n<td><img loading=\"lazy\" src=\"https://seaborn.pydata.org/_images/pairplot_6_0.png\" alt=\"pairplot\" /></td>\n</tr>\n<tr>\n<td><code>sns.jointplot()</code></td>\n<td>双变量联合分布图</td>\n<td><code>sns.jointplot(data=tips, x=&quot;total_bill&quot;, y=&quot;tip&quot;, kind=&quot;hex&quot;)</code></td>\n<td><img loading=\"lazy\" src=\"https://seaborn.pydata.org/_images/jointplot_9_0.png\" alt=\"jointplot\" /></td>\n</tr>\n<tr>\n<td><code>sns.FacetGrid()</code></td>\n<td>自定义分面网格（底层控制）</td>\n<td><code>g = sns.FacetGrid(tips, col=&quot;time&quot;); g.map(sns.scatterplot, &quot;total_bill&quot;, &quot;tip&quot;)</code></td>\n<td><img loading=\"lazy\" src=\"https://seaborn.pydata.org/_images/facetgrid_3_0.png\" alt=\"FacetGrid\" /></td>\n</tr>\n</tbody>\n</table>\n<hr />\n<h3 id=\"关键区别\"><a class=\"anchor\" href=\"#关键区别\">#</a> 关键区别：</h3>\n<ul>\n<li><strong>基础函数</strong>（如 <code>scatterplot</code>） vs <strong>分面函数</strong>（如 <code>relplot/catplot</code>）：\n<ul>\n<li>基础函数直接绘图，分面函数通过 <code>col/row</code> 参数分面。</li>\n</ul>\n</li>\n<li><strong>通用参数</strong>：\n<ul>\n<li><code>data</code>：DataFrame 数据源。</li>\n<li><code>x/y</code>：轴变量。</li>\n<li><code>hue</code>：颜色分组。</li>\n<li><code>style</code>：标记样式分组。</li>\n<li><code>size</code>：大小分组。</li>\n</ul>\n</li>\n</ul>\n<hr />\n<h3 id=\"示例分面绘图catplot\"><a class=\"anchor\" href=\"#示例分面绘图catplot\">#</a> 示例：分面绘图（<code>catplot</code>）</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> seaborn </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">as</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> sns</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">tips </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> sns</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">load_dataset</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">tips</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 分面绘制箱线图（按 day 分组，按 sex 分面）</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">sns</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">catplot</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    data</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">tips</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    x</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">day</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    y</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">total_bill</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">  </span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    col</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">sex</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    kind</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">box</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    height</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">4</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    aspect</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0.7</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">plt</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">show</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<h2 id=\"三-结合-matplotlib-细化\"><a class=\"anchor\" href=\"#三-结合-matplotlib-细化\">#</a> 三、结合 Matplotlib 细化</h2>\n<p>Seaborn 虽然提供了简洁的高级 API，但底层仍基于 Matplotlib。通过 <code>matplotlib.pyplot</code>（通常缩写为 <code>plt</code>）可以对 Seaborn 生成的图表进行精细化调整。以下是详细分类说明和实用技巧：</p>\n<hr />\n<h3 id=\"31基础调整\"><a class=\"anchor\" href=\"#31基础调整\">#</a> 3.1<strong>基础调整</strong></h3>\n<h4 id=\"311-标题与坐标轴标签\"><a class=\"anchor\" href=\"#311-标题与坐标轴标签\">#</a> 3.1.1 <strong>标题与坐标轴标签</strong></h4>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> matplotlib</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">pyplot </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">as</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> plt</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> seaborn </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">as</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> sns</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">tips </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> sns</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">load_dataset</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">tips</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">sns</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">boxplot</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">data</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">tips</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> x</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">day</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> y</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">total_bill</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 添加标题和标签</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">plt</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">title</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Daily Bill Distribution</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> fontsize</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">14</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> pad</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">20</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  # pad 控制标题距离</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">plt</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">xlabel</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Day of Week</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> fontsize</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">12</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">                    # X轴标签</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">plt</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">ylabel</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Total Bill ($)</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> fontsize</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">12</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">                 # Y轴标签</span></span></code></pre>\n<h4 id=\"312-刻度调整\"><a class=\"anchor\" href=\"#312-刻度调整\">#</a> 3.1.2 <strong>刻度调整</strong></h4>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 旋转刻度标签（解决重叠问题）</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">plt</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">xticks</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">rotation</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">45</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> ha</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">right</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  # ha: 旋转后对齐方式（right/center）</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 设置刻度范围和密度</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">plt</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">yticks</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">ticks</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 20</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 40</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 60</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> fontsize</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">10</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  # 自定义Y轴刻度</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">plt</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">xlim</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">-</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0.5</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 3.5</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">                             # 设置X轴范围</span></span></code></pre>\n<hr />\n<h3 id=\"32-图例与颜色\"><a class=\"anchor\" href=\"#32-图例与颜色\">#</a> 3.2 <strong>图例与颜色</strong></h3>\n<h4 id=\"321-图例控制\"><a class=\"anchor\" href=\"#321-图例控制\">#</a> 3.2.1 <strong>图例控制</strong></h4>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">sns</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">scatterplot</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">data</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">tips</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> x</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">total_bill</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> y</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">tip</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> hue</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">time</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 调整图例</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">plt</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">legend</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    title</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Meal Time</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">           # 修改图例标题</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    loc</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">upper right</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">           # 位置（best, upper right, lower left等）</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    bbox_to_anchor</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1.3</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">     # 将图例移到图外（右侧）</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    frameon</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">False</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">                # 去掉图例边框</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<h4 id=\"322-颜色与样式\"><a class=\"anchor\" href=\"#322-颜色与样式\">#</a> 3.2.2 <strong>颜色与样式</strong></h4>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 修改单个元素的颜色（通过Matplotlib）</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">plt</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">setp</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">plt</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">gca</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">get_xticklabels</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> color</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">red</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  # 设置X轴刻度为红色</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 修改所有文本颜色（全局）</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">plt</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">rcParams</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">text.color</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#999999;--shiki-dark:#666666\"> =</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">blue</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  # 影响标题、标签等</span></span></code></pre>\n<hr />\n<h3 id=\"33-布局与子图\"><a class=\"anchor\" href=\"#33-布局与子图\">#</a> 3.3 <strong>布局与子图</strong></h3>\n<h4 id=\"331-调整边距与布局\"><a class=\"anchor\" href=\"#331-调整边距与布局\">#</a> 3.3.1 <strong>调整边距与布局</strong></h4>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">plt</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">tight_layout</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">pad</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  # 自动调整子图间距（防止标签重叠）</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">plt</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">subplots_adjust</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    left</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0.1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">            # 左边距</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    right</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0.9</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">           # 右边距</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    top</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0.9</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">             # 上边距</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    bottom</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0.2</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">           # 下边距</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<h4 id=\"332-与matplotlib子图结合\"><a class=\"anchor\" href=\"#332-与matplotlib子图结合\">#</a> 3.3.2 <strong>与Matplotlib子图结合</strong></h4>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">fig</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> axes </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> plt</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">subplots</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 2</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> figsize</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">12</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 5</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  # 创建1行2列的子图</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 在第一个子图绘制</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">sns</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">histplot</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">data</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">tips</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> x</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">total_bill</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> ax</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">axes</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">axes</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">set_title</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Total Bill Distribution</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 在第二个子图绘制</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">sns</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">boxplot</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">data</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">tips</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> x</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">day</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> y</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">total_bill</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> ax</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">axes</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">axes</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">set_xticklabels</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">[</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Thu</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Fri</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Sat</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Sun</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">]</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  # 自定义刻度标签</span></span></code></pre>\n<hr />\n<h3 id=\"34-高级定制\"><a class=\"anchor\" href=\"#34-高级定制\">#</a> 3.4 <strong>高级定制</strong></h3>\n<h4 id=\"341-网格线与背景\"><a class=\"anchor\" href=\"#341-网格线与背景\">#</a> 3.4.1 <strong>网格线与背景</strong></h4>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">plt</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">grid</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">True</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> linestyle</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">--</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> alpha</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0.6</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  # 显示网格线（虚线，半透明）</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">plt</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">gca</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">set_facecolor</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">#f5f5f5</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">         # 设置图表背景色（灰色）</span></span></code></pre>\n<h4 id=\"342-注释与箭头\"><a class=\"anchor\" href=\"#342-注释与箭头\">#</a> 3.4.2 <strong>注释与箭头</strong></h4>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 添加文本注释</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">plt</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">text</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    x</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">30</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> y</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">10</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">                           # 坐标位置</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    s</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Outlier Point</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">                     # 文本内容</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    fontsize</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">12</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    color</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">red</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    bbox</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#998418;--shiki-dark:#B8A965\">dict</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">facecolor</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">white</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> alpha</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">0.8</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"> # 文本框样式</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 添加箭头</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">plt</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">annotate</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span></span>\n<span class=\"line\"><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">    \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">High Tip</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    xy</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">40</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 10</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">                          # 箭头指向的点</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    xytext</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">35</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 15</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">                      # 文本起始位置</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    arrowprops</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#998418;--shiki-dark:#B8A965\">dict</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">arrowstyle</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">-></span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> color</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">black</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<hr />\n<h3 id=\"35-保存图表\"><a class=\"anchor\" href=\"#35-保存图表\">#</a> 3.5 <strong>保存图表</strong></h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">plt</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">savefig</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span></span>\n<span class=\"line\"><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">    \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">plot.png</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    dpi</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">300</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">                   # 分辨率</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    bbox_inches</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">tight</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">       # 去除白边</span></span>\n<span class=\"line\"><span style=\"color:#B07D48;--shiki-dark:#BD976A\">    transparent</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">True</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">           # 透明背景（适合PPT）</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<hr />\n<h3 id=\"36-调试技巧\"><a class=\"anchor\" href=\"#36-调试技巧\">#</a> 3.6 <strong>调试技巧</strong></h3>\n<ol>\n<li>\n<p><strong>获取当前Axes对象</strong>：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">ax </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> plt</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">gca</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  # 获取当前Axes</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">ax</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">spines</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">top</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">set_visible</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">False</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  # 隐藏顶部边框线</span></span></code></pre>\n</li>\n<li>\n<p><strong>批量设置样式</strong>：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">params </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">    \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">axes.labelsize</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 14</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">    \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">xtick.labelsize</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 12</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span></span>\n<span class=\"line\"><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">    \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">ytick.labelsize</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">:</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 12</span></span>\n<span class=\"line\"><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">plt</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">rcParams</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">update</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">params</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  # 全局生效</span></span></code></pre>\n</li>\n</ol>\n<hr />\n<h3 id=\"完整示例\"><a class=\"anchor\" href=\"#完整示例\">#</a> 完整示例</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-python\"><span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> seaborn </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">as</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> sns</span></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">import</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> matplotlib</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">pyplot </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">as</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> plt</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 数据准备</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">tips </span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> sns</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">load_dataset</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">tips</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 1. 绘制基础图表</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">sns</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">boxplot</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">data</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">tips</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> x</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">day</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> y</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">total_bill</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> hue</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">sex</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 2. 使用Matplotlib调整</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">plt</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">title</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Bill Distribution by Day and Gender</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> fontsize</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">16</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">plt</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">xlabel</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Day</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> fontsize</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">14</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">plt</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">ylabel</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Total Bill (USD)</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> fontsize</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">14</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">plt</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">xticks</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">rotation</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">15</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">plt</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">legend</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\">title</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">Gender</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> bbox_to_anchor</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">1</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 1</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 3. 调整布局</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">plt</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">tight_layout</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 4. 保存或显示</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">plt</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">savefig</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">boxplot.png</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#999999;--shiki-dark:#666666\">,</span><span style=\"color:#B07D48;--shiki-dark:#BD976A\"> dpi</span><span style=\"color:#999999;--shiki-dark:#666666\">=</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">200</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">plt</span><span style=\"color:#999999;--shiki-dark:#666666\">.</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">show</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n<h2 id=\"四-显示或者保存图表格\"><a class=\"anchor\" href=\"#四-显示或者保存图表格\">#</a> 四、显示或者保存图表格</h2>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">plt.show</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">plt.savefig</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">\"plot.png\"</span><span style=\"color:#59873A;--shiki-dark:#80A665\">,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> dpi=300,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> bbox_inches=</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">tight</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span></span></code></pre>\n",
            "tags": [
                "python",
                "saaborn"
            ]
        },
        {
            "id": "http://example.com/2025/07/29/electron/",
            "url": "http://example.com/2025/07/29/electron/",
            "title": "Electron 基本使用教程",
            "date_published": "2025-07-29T01:20:04.426Z",
            "content_html": "<blockquote>\n<p>以下以vue3为例结合electron实现跨平台开发</p>\n</blockquote>\n<hr />\n<h2 id=\"一-在项目根目录安装electorn-forge\"><a class=\"anchor\" href=\"#一-在项目根目录安装electorn-forge\">#</a> 一、在项目根目录安装electorn-forge</h2>\n<p>按照如下命令安装electron-forge</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">npm</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> install</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --save-dev</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> electron</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> @electron-forge/cli</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">npx</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> electron-forge</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> import</span></span></code></pre>\n<p>这一步会在你的项目中创建一个 electron 的基本目录结构，并配置打包命令。</p>\n<h2 id=\"二-新建mainjs\"><a class=\"anchor\" href=\"#二-新建mainjs\">#</a> 二、新建main.js</h2>\n<p>在根目录下新建/electron/main.js</p>\n<p>在main.js下复制如下代码</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">import</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> &#123;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> app,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> BrowserWindow</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> &#125;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">electron</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">import</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> path</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">path</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">import</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> &#123;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> fileURLToPath</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> &#125;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> from</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">url</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">//</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 解决</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ES</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> Module</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 中没有</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> __dirname</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 的问题</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">const</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> __filename</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> fileURLToPath</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">import.meta.url</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">const</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> __dirname</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> path.dirname</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">__filename</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#AB5959;--shiki-dark:#CB7676\">function</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> createWindow</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">  const</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> win</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> =</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> new</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> BrowserWindow</span><span style=\"color:rgba(255, 18, 18, 0.8);--shiki-dark:rgba(255, 18, 18, 0.8)\">(</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    width:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 1200,</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    height:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 800,</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    webPreferences:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">      preload:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> path.join</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">__dirname,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">preload.js</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a13865;--shiki-dark:#d9739f\">)</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">,</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> //</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 可选，预加载脚本</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">    </span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">  </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span><span style=\"color:rgba(255, 18, 18, 0.8);--shiki-dark:rgba(255, 18, 18, 0.8)\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#1E754F;--shiki-dark:#4D9375\">  if</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">!</span><span style=\"color:#59873A;--shiki-dark:#80A665\">app.isPackaged</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    win.loadURL</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">'http://localhost:5173'</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> //</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> dev</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 模式加载</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> vite</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 前端</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span><span style=\"color:#1E754F;--shiki-dark:#4D9375\"> else</span><span style=\"color:#999999;--shiki-dark:#666666\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">    win.loadFile</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">path.join</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">__dirname,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">../dist/index.html</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span><span style=\"color:#59873A;--shiki-dark:#80A665\"> //</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> prod</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 模式加载打包页面</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">  </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">&#125;</span></span>\n<span class=\"line\"><span style=\"color:rgba(255, 18, 18, 0.8);--shiki-dark:rgba(255, 18, 18, 0.8)\">&#125;</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">app.whenReady</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">.then</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">=</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#123;</span></span>\n<span class=\"line\"><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">  createWindow</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">(</span><span style=\"color:#a65e2b;--shiki-dark:#d4976c\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"><span style=\"color:#1e754f;--shiki-dark:#4d9375\">&#125;</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">;</span></span>\n<span class=\"line\"></span></code></pre>\n<h2 id=\"三-修改packagejson\"><a class=\"anchor\" href=\"#三-修改packagejson\">#</a> 三、修改package.json</h2>\n<p>进入package.json文件，新增</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">\"main\"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">electron/main.js</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">,</span></span></code></pre>\n<p>注意scripts</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">\"scripts\"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">:</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> &#123;</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">\"dev\"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">vite</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">,</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">\"build\"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">vite build</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">,</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">\"preview\"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">vite preview</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">,</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">\"start\"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">electron-forge start</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">,</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">\"package\"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">electron-forge package</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">,</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">\"make\"</span><span style=\"color:#998418;--shiki-dark:#B8A965\">:</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">electron-forge make</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span>\n<span class=\"line\"><span style=\"color:rgba(255, 18, 18, 0.8);--shiki-dark:rgba(255, 18, 18, 0.8)\">&#125;</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">,</span></span></code></pre>\n<h2 id=\"四-开发测试流程\"><a class=\"anchor\" href=\"#四-开发测试流程\">#</a> 四、开发测试流程</h2>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 启动 Vite 前端</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">npm</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> run</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> dev</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 新开一个终端，启动 Electron</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">npm</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> start</span></span>\n<span class=\"line\"></span></code></pre>\n<h2 id=\"五-打包发布测试\"><a class=\"anchor\" href=\"#五-打包发布测试\">#</a> 五、打包发布测试</h2>\n<p>先构建前端项目</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">npm</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> run</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> build</span></span></code></pre>\n<p>修改main.js</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">win.loadFile</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">path.join</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">(</span><span style=\"color:#59873A;--shiki-dark:#80A665\">__dirname,</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> '</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">../dist/index.html</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">'</span><span style=\"color:#1e754f;--shiki-dark:#4d9375\">)</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#999999;--shiki-dark:#666666\">;</span></span></code></pre>\n<p>打包</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">npm</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> run</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> package</span></span></code></pre>\n<p>会在 out/ 目录生成你的桌面可执行程序（比如 Windows 下是 .exe 文件）</p>\n",
            "tags": [
                "electron",
                "web",
                "desk"
            ]
        },
        {
            "id": "http://example.com/2025/07/27/issue/",
            "url": "http://example.com/2025/07/27/issue/",
            "title": "常见BUG汇总",
            "date_published": "2025-07-27T00:29:00.000Z",
            "content_html": "<h2 id=\"一-markdown\"><a class=\"anchor\" href=\"#一-markdown\">#</a> 一、Markdown</h2>\n<h3 id=\"11-为什么vscode编辑md文件十分卡顿\"><a class=\"anchor\" href=\"#11-为什么vscode编辑md文件十分卡顿\">#</a> 1.1 为什么vscode编辑md文件十分卡顿</h3>\n<p>解决方法:禁用cpp extension pack扩展</p>\n<h2 id=\"二-hexo\"><a class=\"anchor\" href=\"#二-hexo\">#</a> 二、Hexo</h2>\n<h3 id=\"21-出现spawn-failed报错\"><a class=\"anchor\" href=\"#21-出现spawn-failed报错\">#</a> 2.1 出现Spawn Failed报错</h3>\n<p>首先尝试关机重启</p>\n<p>其次删除<code>.deploy_git</code>文件夹</p>\n<p>最后实在不行找到<code>.ssh</code>文件，先测试</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">ssh</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -T</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> git@github.com</span></span></code></pre>\n<p>如果出现22端口连接超时，改成443端口即可</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">Host</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> github.com</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">  HostName</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ssh.github.com</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">  Port</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\"> 443</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">  User</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> git</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">  IdentityFile</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ~/.ssh/id_rsa</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">  IdentitiesOnly</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> yes</span></span></code></pre>\n",
            "tags": [
                "markdown"
            ]
        },
        {
            "id": "http://example.com/2025/07/27/latex/",
            "url": "http://example.com/2025/07/27/latex/",
            "title": "Latex常见数学公式",
            "date_published": "2025-07-27T00:29:00.000Z",
            "content_html": "<blockquote>\n<p>以下是常用的latex数学公式符号</p>\n</blockquote>\n<hr>\n<h2 id=\"一-基本结构\"><a class=\"anchor\" href=\"#一-基本结构\">#</a> 一、基本结构</h2>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-latex\"><span class=\"line\"><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\\</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">(</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> a</span><span style=\"color:#999999;--shiki-dark:#666666\">^</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"color:#999999;--shiki-dark:#666666\"> +</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> b</span><span style=\"color:#999999;--shiki-dark:#666666\">^</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> = c</span><span style=\"color:#999999;--shiki-dark:#666666\">^</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \\</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">)</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">           % 行内公式</span></span>\n<span class=\"line\"><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\\</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> a</span><span style=\"color:#999999;--shiki-dark:#666666\">^</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"color:#999999;--shiki-dark:#666666\"> +</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> b</span><span style=\"color:#999999;--shiki-dark:#666666\">^</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> = c</span><span style=\"color:#999999;--shiki-dark:#666666\">^</span><span style=\"color:#2F798A;--shiki-dark:#4C9A91\">2</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \\</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">           % 单独一行公式</span></span></code></pre>\n<hr>\n<h2 id=\"二-基本数学符号\"><a class=\"anchor\" href=\"#二-基本数学符号\">#</a> 二、基本数学符号</h2>\n<table>\n<thead>\n<tr>\n<th>含义</th>\n<th>LaTeX</th>\n<th>显示</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>加法</td>\n<td><code>a + b</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mo>+</mo><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">a + b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span></td>\n</tr>\n<tr>\n<td>减法</td>\n<td><code>a - b</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mo>−</mo><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">a - b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span></td>\n</tr>\n<tr>\n<td>乘法</td>\n<td><code>a \\times b</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mo>×</mo><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">a \\times b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span></td>\n</tr>\n<tr>\n<td>除法</td>\n<td><code>a \\div b</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mo>÷</mo><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">a \\div b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">÷</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span></td>\n</tr>\n<tr>\n<td>分数</td>\n<td><code>\\frac{a}{b}</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mfrac><mi>a</mi><mi>b</mi></mfrac></mrow><annotation encoding=\"application/x-tex\">\\frac{a}{b}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.0404em;vertical-align:-0.345em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6954em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">b</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.394em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">a</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></td>\n</tr>\n<tr>\n<td>次方</td>\n<td><code>a^n</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>a</mi><mi>n</mi></msup></mrow><annotation encoding=\"application/x-tex\">a^n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6644em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6644em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span></span></span></span></span></span></span></span></td>\n</tr>\n<tr>\n<td>开方</td>\n<td><code>\\sqrt{a}</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msqrt><mi>a</mi></msqrt></mrow><annotation encoding=\"application/x-tex\">\\sqrt{a}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.04em;vertical-align:-0.2397em;\"></span><span class=\"mord sqrt\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8003em;\"><span class=\"svg-align\" style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\" style=\"padding-left:0.833em;\"><span class=\"mord mathnormal\">a</span></span></span><span style=\"top:-2.7603em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"hide-tail\" style=\"min-width:0.853em;height:1.08em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"400em\" height=\"1.08em\" viewBox=\"0 0 400000 1080\" preserveAspectRatio=\"xMinYMin slice\"><path d=\"M95,702\nc-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14\nc0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54\nc44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10\ns173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429\nc69,-144,104.5,-217.7,106.5,-221\nl0 -0\nc5.3,-9.3,12,-14,20,-14\nH400000v40H845.2724\ns-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7\nc-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z\nM834 80h400000v40h-400000z\"></path></svg></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2397em;\"><span></span></span></span></span></span></span></span></span></td>\n</tr>\n<tr>\n<td>n次根</td>\n<td><code>\\sqrt[n]{a}</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mroot><mi>a</mi><mi>n</mi></mroot></mrow><annotation encoding=\"application/x-tex\">\\sqrt[n]{a}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.04em;vertical-align:-0.2397em;\"></span><span class=\"mord sqrt\"><span class=\"root\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.5516em;\"><span style=\"top:-2.8363em;\"><span class=\"pstrut\" style=\"height:2.5em;\"></span><span class=\"sizing reset-size6 size1 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span></span></span></span></span><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8003em;\"><span class=\"svg-align\" style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\" style=\"padding-left:0.833em;\"><span class=\"mord mathnormal\">a</span></span></span><span style=\"top:-2.7603em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"hide-tail\" style=\"min-width:0.853em;height:1.08em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"400em\" height=\"1.08em\" viewBox=\"0 0 400000 1080\" preserveAspectRatio=\"xMinYMin slice\"><path d=\"M95,702\nc-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14\nc0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54\nc44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10\ns173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429\nc69,-144,104.5,-217.7,106.5,-221\nl0 -0\nc5.3,-9.3,12,-14,20,-14\nH400000v40H845.2724\ns-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7\nc-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z\nM834 80h400000v40h-400000z\"></path></svg></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2397em;\"><span></span></span></span></span></span></span></span></span></td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h2 id=\"三-常用函数\"><a class=\"anchor\" href=\"#三-常用函数\">#</a> 三、常用函数</h2>\n<table>\n<thead>\n<tr>\n<th>函数</th>\n<th>LaTeX</th>\n<th>显示</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>正弦</td>\n<td><code>\\sin x</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>sin</mi><mo>⁡</mo><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">\\sin x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6679em;\"></span><span class=\"mop\">sin</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span></td>\n</tr>\n<tr>\n<td>余弦</td>\n<td><code>\\cos x</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>cos</mi><mo>⁡</mo><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">\\cos x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mop\">cos</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span></td>\n</tr>\n<tr>\n<td>正切</td>\n<td><code>\\tan x</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>tan</mi><mo>⁡</mo><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">\\tan x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6151em;\"></span><span class=\"mop\">tan</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span></td>\n</tr>\n<tr>\n<td>对数</td>\n<td><code>\\log x</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>log</mi><mo>⁡</mo><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">\\log x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mop\">lo<span style=\"margin-right:0.01389em;\">g</span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span></td>\n</tr>\n<tr>\n<td>自然对数</td>\n<td><code>\\ln x</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>ln</mi><mo>⁡</mo><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">\\ln x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mop\">ln</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">x</span></span></span></span></td>\n</tr>\n<tr>\n<td>指数函数</td>\n<td><code>e^x</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mi>e</mi><mi>x</mi></msup></mrow><annotation encoding=\"application/x-tex\">e^x</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6644em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">e</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.6644em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">x</span></span></span></span></span></span></span></span></span></span></span></td>\n</tr>\n<tr>\n<td>极限</td>\n<td><code>\\lim_{x\\to0}</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi>lim</mi><mo>⁡</mo></mrow><mrow><mi>x</mi><mo>→</mo><mn>0</mn></mrow></msub></mrow><annotation encoding=\"application/x-tex\">\\lim_{x\\to0}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"></span><span class=\"mop\"><span class=\"mop\">lim</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">x</span><span class=\"mrel mtight\">→</span><span class=\"mord mtight\">0</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h2 id=\"四-微积分符号\"><a class=\"anchor\" href=\"#四-微积分符号\">#</a> 四、微积分符号</h2>\n<table>\n<thead>\n<tr>\n<th>含义</th>\n<th>LaTeX</th>\n<th>显示</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>导数</td>\n<td><code>\\frac{dy}{dx}</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mfrac><mrow><mi>d</mi><mi>y</mi></mrow><mrow><mi>d</mi><mi>x</mi></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">\\frac{dy}{dx}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.2772em;vertical-align:-0.345em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9322em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">d</span><span class=\"mord mathnormal mtight\">x</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.4461em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">d</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">y</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></td>\n</tr>\n<tr>\n<td>偏导数</td>\n<td><code>\\frac{\\partial y}{\\partial x}</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mfrac><mrow><mi mathvariant=\"normal\">∂</mi><mi>y</mi></mrow><mrow><mi mathvariant=\"normal\">∂</mi><mi>x</mi></mrow></mfrac></mrow><annotation encoding=\"application/x-tex\">\\frac{\\partial y}{\\partial x}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.2772em;vertical-align:-0.345em;\"></span><span class=\"mord\"><span class=\"mopen nulldelimiter\"></span><span class=\"mfrac\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.9322em;\"><span style=\"top:-2.655em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\" style=\"margin-right:0.05556em;\">∂</span><span class=\"mord mathnormal mtight\">x</span></span></span></span><span style=\"top:-3.23em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"frac-line\" style=\"border-bottom-width:0.04em;\"></span></span><span style=\"top:-3.4461em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\" style=\"margin-right:0.05556em;\">∂</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">y</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.345em;\"><span></span></span></span></span></span><span class=\"mclose nulldelimiter\"></span></span></span></span></span></td>\n</tr>\n<tr>\n<td>积分</td>\n<td><code>\\int_a^b f(x)dx</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msubsup><mo>∫</mo><mi>a</mi><mi>b</mi></msubsup><mi>f</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo stretchy=\"false\">)</mo><mtext> </mtext><mi>d</mi><mi>x</mi></mrow><annotation encoding=\"application/x-tex\">\\int_a^b f(x)\\,dx</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.3998em;vertical-align:-0.3558em;\"></span><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"margin-right:0.19445em;position:relative;top:-0.0006em;\">∫</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.044em;\"><span style=\"top:-2.3442em;margin-left:-0.1945em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">a</span></span></span><span style=\"top:-3.2579em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">b</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3558em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">x</span></span></span></span></td>\n</tr>\n<tr>\n<td>多重积分</td>\n<td><code>\\iint</code>、<code>\\iiint</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>∬</mo><mspace width=\"1em\"></mspace><mo>∭</mo></mrow><annotation encoding=\"application/x-tex\">\\iint\\quad \\iiint</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.111em;vertical-align:-0.306em;\"></span><span class=\"mop op-symbol small-op\" style=\"margin-right:0.19445em;position:relative;top:-0.0005em;\">∬</span><span class=\"mspace\" style=\"margin-right:1em;\"></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mop op-symbol small-op\" style=\"margin-right:0.19445em;position:relative;top:-0.0005em;\">∭</span></span></span></span></td>\n</tr>\n<tr>\n<td>无穷积分</td>\n<td><code>\\int_{-\\infty}^{\\infty}</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msubsup><mo>∫</mo><mrow><mo>−</mo><mi mathvariant=\"normal\">∞</mi></mrow><mi mathvariant=\"normal\">∞</mi></msubsup></mrow><annotation encoding=\"application/x-tex\">\\int_{-\\infty}^{\\infty}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.2734em;vertical-align:-0.4142em;\"></span><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"margin-right:0.19445em;position:relative;top:-0.0006em;\">∫</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8593em;\"><span style=\"top:-2.3442em;margin-left:-0.1945em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">−</span><span class=\"mord mtight\">∞</span></span></span></span><span style=\"top:-3.2579em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">∞</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.4142em;\"><span></span></span></span></span></span></span></span></span></span></td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h2 id=\"五-求和与乘积\"><a class=\"anchor\" href=\"#五-求和与乘积\">#</a> 五、求和与乘积</h2>\n<table>\n<thead>\n<tr>\n<th>含义</th>\n<th>LaTeX</th>\n<th>显示</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>求和</td>\n<td><code>\\sum_{i=1}^n a_i</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msubsup><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><msub><mi>a</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\sum_{i=1}^n a_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.104em;vertical-align:-0.2997em;\"></span><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"position:relative;top:0em;\">∑</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8043em;\"><span style=\"top:-2.4003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mrel mtight\">=</span><span class=\"mord mtight\">1</span></span></span></span><span style=\"top:-3.2029em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2997em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></td>\n</tr>\n<tr>\n<td>连乘积</td>\n<td><code>\\prod_{i=1}^n a_i</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msubsup><mo>∏</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup><msub><mi>a</mi><mi>i</mi></msub></mrow><annotation encoding=\"application/x-tex\">\\prod_{i=1}^n a_i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1.104em;vertical-align:-0.2997em;\"></span><span class=\"mop\"><span class=\"mop op-symbol small-op\" style=\"position:relative;top:0em;\">∏</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8043em;\"><span style=\"top:-2.4003em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">i</span><span class=\"mrel mtight\">=</span><span class=\"mord mtight\">1</span></span></span></span><span style=\"top:-3.2029em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">n</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2997em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\">i</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></td>\n</tr>\n<tr>\n<td>上下限形式</td>\n<td><code>\\lim_{x\\to0}</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msub><mrow><mi>lim</mi><mo>⁡</mo></mrow><mrow><mi>x</mi><mo>→</mo><mn>0</mn></mrow></msub></mrow><annotation encoding=\"application/x-tex\">\\lim_{x\\to0}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"></span><span class=\"mop\"><span class=\"mop\">lim</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">x</span><span class=\"mrel mtight\">→</span><span class=\"mord mtight\">0</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span></span></span></span></td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h2 id=\"六-矩阵\"><a class=\"anchor\" href=\"#六-矩阵\">#</a> 六、矩阵</h2>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-latex\"><span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">begin</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">bmatrix</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">a </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">&amp;</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> b </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">\\\\</span></span>\n<span class=\"line\"><span style=\"color:#998418;--shiki-dark:#B8A965\">c </span><span style=\"color:#1E754F;--shiki-dark:#4D9375\">&amp;</span><span style=\"color:#998418;--shiki-dark:#B8A965\"> d</span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">\\</span><span style=\"color:#998418;--shiki-dark:#B8A965\">end</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">{</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">bmatrix</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">}</span></span></code></pre>\n<p>显示为：</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mo fence=\"true\">[</mo><mtable rowspacing=\"0.16em\" columnalign=\"center center\" columnspacing=\"1em\"><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi>a</mi></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi>b</mi></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi>c</mi></mstyle></mtd><mtd><mstyle scriptlevel=\"0\" displaystyle=\"false\"><mi>d</mi></mstyle></mtd></mtr></mtable><mo fence=\"true\">]</mo></mrow><annotation encoding=\"application/x-tex\">\\begin{bmatrix}\na &amp; b \\\\\nc &amp; d\n\\end{bmatrix}\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:2.4em;vertical-align:-0.95em;\"></span><span class=\"minner\"><span class=\"mopen delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size3\">[</span></span><span class=\"mord\"><span class=\"mtable\"><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.45em;\"><span style=\"top:-3.61em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">a</span></span></span><span style=\"top:-2.41em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">c</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.95em;\"><span></span></span></span></span></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"arraycolsep\" style=\"width:0.5em;\"></span><span class=\"col-align-c\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:1.45em;\"><span style=\"top:-3.61em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span></span></span><span style=\"top:-2.41em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">d</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.95em;\"><span></span></span></span></span></span></span></span><span class=\"mclose delimcenter\" style=\"top:0em;\"><span class=\"delimsizing size3\">]</span></span></span></span></span></span></span></p>\n<hr>\n<h2 id=\"七-逻辑与集合符号\"><a class=\"anchor\" href=\"#七-逻辑与集合符号\">#</a> 七、逻辑与集合符号</h2>\n<table>\n<thead>\n<tr>\n<th>含义</th>\n<th>LaTeX</th>\n<th>显示</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>属于</td>\n<td><code>\\in</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>∈</mo></mrow><annotation encoding=\"application/x-tex\">\\in</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mrel\">∈</span></span></span></span></td>\n</tr>\n<tr>\n<td>不属于</td>\n<td><code>\\notin</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo mathvariant=\"normal\">∉</mo></mrow><annotation encoding=\"application/x-tex\">\\notin</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mrel\"><span class=\"mord\"><span class=\"mrel\">∈</span></span><span class=\"mord vbox\"><span class=\"thinbox\"><span class=\"llap\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"inner\"><span class=\"mord\"><span class=\"mord\">/</span><span class=\"mspace\" style=\"margin-right:0.0556em;\"></span></span></span><span class=\"fix\"></span></span></span></span></span></span></span></span></td>\n</tr>\n<tr>\n<td>包含于</td>\n<td><code>\\subset</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>⊂</mo></mrow><annotation encoding=\"application/x-tex\">\\subset</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mrel\">⊂</span></span></span></span></td>\n</tr>\n<tr>\n<td>真包含</td>\n<td><code>\\subsetneq</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>⊊</mo></mrow><annotation encoding=\"application/x-tex\">\\subsetneq</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7719em;vertical-align:-0.136em;\"></span><span class=\"mrel amsrm\">⊊</span></span></span></span></td>\n</tr>\n<tr>\n<td>交集</td>\n<td><code>\\cap</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>∩</mo></mrow><annotation encoding=\"application/x-tex\">\\cap</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5556em;\"></span><span class=\"mord\">∩</span></span></span></span></td>\n</tr>\n<tr>\n<td>并集</td>\n<td><code>\\cup</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>∪</mo></mrow><annotation encoding=\"application/x-tex\">\\cup</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5556em;\"></span><span class=\"mord\">∪</span></span></span></span></td>\n</tr>\n<tr>\n<td>空集</td>\n<td><code>\\emptyset</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"normal\">∅</mi></mrow><annotation encoding=\"application/x-tex\">\\emptyset</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8056em;vertical-align:-0.0556em;\"></span><span class=\"mord\">∅</span></span></span></span></td>\n</tr>\n<tr>\n<td>全体实数</td>\n<td><code>\\mathbb{R}</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi mathvariant=\"double-struck\">R</mi></mrow><annotation encoding=\"application/x-tex\">\\mathbb{R}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6889em;\"></span><span class=\"mord mathbb\">R</span></span></span></span></td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h2 id=\"八-常见关系符号\"><a class=\"anchor\" href=\"#八-常见关系符号\">#</a> 八、常见关系符号</h2>\n<table>\n<thead>\n<tr>\n<th>含义</th>\n<th>LaTeX</th>\n<th>显示</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>大于</td>\n<td><code>&gt;</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>&gt;</mo></mrow><annotation encoding=\"application/x-tex\">&gt;</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mrel\">&gt;</span></span></span></span></td>\n</tr>\n<tr>\n<td>小于</td>\n<td><code>&lt;</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>&lt;</mo></mrow><annotation encoding=\"application/x-tex\">&lt;</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5782em;vertical-align:-0.0391em;\"></span><span class=\"mrel\">&lt;</span></span></span></span></td>\n</tr>\n<tr>\n<td>大于等于</td>\n<td><code>\\ge</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>≥</mo></mrow><annotation encoding=\"application/x-tex\">\\ge</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7719em;vertical-align:-0.136em;\"></span><span class=\"mrel\">≥</span></span></span></span></td>\n</tr>\n<tr>\n<td>小于等于</td>\n<td><code>\\le</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>≤</mo></mrow><annotation encoding=\"application/x-tex\">\\le</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7719em;vertical-align:-0.136em;\"></span><span class=\"mrel\">≤</span></span></span></span></td>\n</tr>\n<tr>\n<td>不等于</td>\n<td><code>\\neq</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo mathvariant=\"normal\">≠</mo></mrow><annotation encoding=\"application/x-tex\">\\neq</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mrel\"><span class=\"mrel\"><span class=\"mord vbox\"><span class=\"thinbox\"><span class=\"rlap\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"inner\"><span class=\"mord\"><span class=\"mrel\"></span></span></span><span class=\"fix\"></span></span></span></span></span><span class=\"mrel\">=</span></span></span></span></span></td>\n</tr>\n<tr>\n<td>恒等于</td>\n<td><code>\\equiv</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>≡</mo></mrow><annotation encoding=\"application/x-tex\">\\equiv</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4637em;\"></span><span class=\"mrel\">≡</span></span></span></span></td>\n</tr>\n<tr>\n<td>约等于</td>\n<td><code>\\approx</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>≈</mo></mrow><annotation encoding=\"application/x-tex\">\\approx</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4831em;\"></span><span class=\"mrel\">≈</span></span></span></span></td>\n</tr>\n</tbody>\n</table>\n<hr>\n<h2 id=\"九-其他符号\"><a class=\"anchor\" href=\"#九-其他符号\">#</a> 九、其他符号</h2>\n<table>\n<thead>\n<tr>\n<th>符号/用途</th>\n<th>LaTeX</th>\n<th>显示</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>向量</td>\n<td><code>\\vec{v}</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mover accent=\"true\"><mi>v</mi><mo>⃗</mo></mover></mrow><annotation encoding=\"application/x-tex\">\\vec{v}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.714em;\"></span><span class=\"mord accent\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.714em;\"><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span></span><span style=\"top:-3em;\"><span class=\"pstrut\" style=\"height:3em;\"></span><span class=\"accent-body\" style=\"left:-0.2077em;\"><span class=\"overlay\" style=\"height:0.714em;width:0.471em;\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"0.471em\" height=\"0.714em\" style=\"width:0.471em\" viewBox=\"0 0 471 714\" preserveAspectRatio=\"xMinYMin\"><path d=\"M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5\n3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11\n10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63\n-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1\n-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59\nH213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359\nc-16-25.333-24-45-24-59z\"></path></svg></span></span></span></span></span></span></span></span></span></span></td>\n</tr>\n<tr>\n<td>点积</td>\n<td><code>\\cdot</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mo>⋅</mo><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">a \\cdot b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4445em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">⋅</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span></td>\n</tr>\n<tr>\n<td>交叉乘积</td>\n<td><code>\\times</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mo>×</mo><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">a \\times b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span></td>\n</tr>\n<tr>\n<td>垂直</td>\n<td><code>\\perp</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>⊥</mo></mrow><annotation encoding=\"application/x-tex\">\\perp</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mrel\">⊥</span></span></span></span></td>\n</tr>\n<tr>\n<td>平行</td>\n<td><code>\\parallel</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>∥</mo></mrow><annotation encoding=\"application/x-tex\">\\parallel</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mrel\">∥</span></span></span></span></td>\n</tr>\n<tr>\n<td>推出</td>\n<td><code>\\Rightarrow</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>⇒</mo></mrow><annotation encoding=\"application/x-tex\">\\Rightarrow</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.3669em;\"></span><span class=\"mrel\">⇒</span></span></span></span></td>\n</tr>\n<tr>\n<td>等价</td>\n<td><code>\\Leftrightarrow</code></td>\n<td><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>⇔</mo></mrow><annotation encoding=\"application/x-tex\">\\Leftrightarrow</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.3669em;\"></span><span class=\"mrel\">⇔</span></span></span></span></td>\n</tr>\n</tbody>\n</table>\n<hr>\n",
            "tags": [
                "math",
                "latex"
            ]
        },
        {
            "id": "http://example.com/2025/07/26/docker-basic-usage/",
            "url": "http://example.com/2025/07/26/docker-basic-usage/",
            "title": "Docker 基本使用教程",
            "date_published": "2025-07-26T00:53:34.303Z",
            "content_html": "<blockquote>\n<p>Docker 可以让开发者打包他们的应用以及依赖包到一个轻量级、可移植的容器中，然后发布到任何流行的 Linux 机器上，也可以实现虚拟化。</p>\n</blockquote>\n<hr />\n<h2 id=\"一-docker的用途\"><a class=\"anchor\" href=\"#一-docker的用途\">#</a> 一、Docker的用途</h2>\n<p>Docker 的主要用途，目前有三大类。</p>\n<ol>\n<li>\n<p>提供一次性的环境。比如，本地测试他人的软件、持续集成的时候提供单元测试和构建的环境。</p>\n</li>\n<li>\n<p>提供弹性的云服务。因为 Docker 容器可以随开随关，很适合动态扩容和缩容。</p>\n</li>\n<li>\n<p>组建微服务架构。通过多个容器，一台机器可以跑多个服务，因此在本机就可以模拟出微服务架构。</p>\n</li>\n</ol>\n<hr />\n<h2 id=\"二-验证是否安装成功\"><a class=\"anchor\" href=\"#二-验证是否安装成功\">#</a> 二、验证是否安装成功</h2>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">docker</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> version</span></span></code></pre>\n<hr />\n<h2 id=\"三-image文件\"><a class=\"anchor\" href=\"#三-image文件\">#</a> 三、Image文件</h2>\n<p>Docker 把应用程序及其依赖，打包在 <strong>image 文件</strong>里面。只有通过这个文件，才能生成 Docker 容器。<br />\nimage 文件可以看作是容器的模板，Docker 根据 image 文件生成容器的实例。<br />\n同一个 image 文件，可以生成多个同时运行的容器实例。</p>\n<p>image 是一个 <strong>二进制文件</strong>。实际开发中，一个 image 文件往往通过继承另一个 image 文件，加上一些个性化设置而生成。<br />\n举例来说，你可以在 Ubuntu 的 image 基础上，往里面加入 Apache 服务器，形成你自己的 image。</p>\n<h3 id=\"列出本机的所有-image-文件\"><a class=\"anchor\" href=\"#列出本机的所有-image-文件\">#</a> 列出本机的所有 image 文件</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">$</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> docker</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> image</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ls</span></span></code></pre>\n<h4 id=\"️-删除-image-文件\"><a class=\"anchor\" href=\"#️-删除-image-文件\">#</a> 🗑️ 删除 image 文件</h4>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">$</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> docker</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> image</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> rm</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">imageName</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span></span></code></pre>\n<p>image 文件是通用的，一台机器的 image 文件拷贝到另一台机器，照样可以使用。</p>\n<p>一般来说，为了节省时间，我们应该尽量使用别人制作好的 image 文件，而不是自己制作。<br />\n即使要定制，也应该基于别人的 image 文件进行加工，而不是从零开始制作。</p>\n<h3 id=\"镜像仓库image-repository\"><a class=\"anchor\" href=\"#镜像仓库image-repository\">#</a> 镜像仓库（Image Repository）</h3>\n<p>为了方便共享，image 文件制作完成后，可以上传到网上的仓库。</p>\n<ul>\n<li>Docker 的官方仓库 <strong>Docker Hub</strong> 是最重要、最常用的 image 仓库。</li>\n<li>此外，你也可以使用国内的镜像仓库（如阿里云、腾讯云）或者搭建私有仓库。</li>\n<li>出售自己制作的 image 文件也是可以的。</li>\n</ul>\n<h3 id=\"imagecontainer\"><a class=\"anchor\" href=\"#imagecontainer\">#</a> image&amp;&amp;container</h3>\n<p>容器是镜像跑起来的实例，一个镜像可以有多个容器</p>\n<hr />\n<h2 id=\"四-如何跑起来呢\"><a class=\"anchor\" href=\"#四-如何跑起来呢\">#</a> 四、如何跑起来呢</h2>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">docker</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> image</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> pull</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">projec</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">t</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">       #将image文件从仓库抓取到本地</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">docker</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> container</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> run</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">projec</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">t</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">    #将image文件在你的电脑上跑起来，新建容器</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">docker</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> container</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> start</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">ID</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">       </span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">#将已有的容器跑起来</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">docker</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> container</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> kill</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">ID</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">        </span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">#手动终止容器的运行</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">docker</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> container</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ls</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">               #在你电脑上正在跑起来的容器</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">docker</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> container</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> ls</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -all</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">          #列出本机所有容器，包括终止运行的容器</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">docker</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> container</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> rm</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">[</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">containerID</span><span style=\"color:#2993a3;--shiki-dark:#5eaab5\">]</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\"> </span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">#删除停止运行的容器，防止占用硬盘空间</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">docker</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> exec</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -it</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> my-nginx</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> bash</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">     #在叫my-nginx的容器内，开启一个bash命令终端进去操作</span></span></code></pre>\n<h2 id=\"注意docker-container-run命令具有自动抓取-image-文件的功能-如果发现本地没有指定的-image-文件就会从仓库自动抓取-因此前面的docker-image-pull命令并不是必需的步骤\"><a class=\"anchor\" href=\"#注意docker-container-run命令具有自动抓取-image-文件的功能-如果发现本地没有指定的-image-文件就会从仓库自动抓取-因此前面的docker-image-pull命令并不是必需的步骤\">#</a> 注意，docker container run命令具有自动抓取 image 文件的功能。如果发现本地没有指定的 image 文件，就会从仓库自动抓取。因此，前面的docker image pull命令并不是必需的步骤。</h2>\n<h2 id=\"五-常见参数\"><a class=\"anchor\" href=\"#五-常见参数\">#</a> 五、常见参数</h2>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">参数</th>\n<th style=\"text-align:left\">全称</th>\n<th style=\"text-align:left\">作用</th>\n<th style=\"text-align:left\">示例</th>\n<th style=\"text-align:left\">说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><code>-d</code></td>\n<td style=\"text-align:left\"><code>--detach</code></td>\n<td style=\"text-align:left\">后台运行容器</td>\n<td style=\"text-align:left\"><code>docker run -d nginx</code></td>\n<td style=\"text-align:left\">容器启动后，终端不会附加到容器的输入/输出，返回一个容器ID。这是运行后台服务（如Web服务器、数据库）的标准模式。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-p</code></td>\n<td style=\"text-align:left\"><code>--publish</code></td>\n<td style=\"text-align:left\">映射容器端口到主机端口</td>\n<td style=\"text-align:left\"><code>docker run -p 8080:80 nginx</code></td>\n<td style=\"text-align:left\">格式为 <code>-p &lt;主机端口&gt;:&lt;容器端口&gt;</code>。将容器内部的端口暴露给主机，从而可以从外部访问容器内的服务。示例中将容器的80端口映射到主机的8080端口，通过 <code>http://localhost:8080</code> 即可访问Nginx。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-v</code></td>\n<td style=\"text-align:left\"><code>--volume</code></td>\n<td style=\"text-align:left\">挂载数据卷</td>\n<td style=\"text-align:left\"><code>docker run -v /host/data:/container/data app</code></td>\n<td style=\"text-align:left\">格式为 <code>-v &lt;主机路径&gt;:&lt;容器路径&gt;</code>。用于在主机和容器之间共享数据或持久化容器内的数据。即使容器被删除，主机上的数据仍然存在。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-e</code></td>\n<td style=\"text-align:left\"><code>--env</code></td>\n<td style=\"text-align:left\">设置环境变量</td>\n<td style=\"text-align:left\"><code>docker run -e MY_VAR=value -e DB_HOST=db app</code></td>\n<td style=\"text-align:left\">向容器内部传递配置信息，如数据库连接字符串、密码、运行模式等。应用程序在容器内可以通过读取这些环境变量来改变其行为。</td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>--name</code></td>\n<td style=\"text-align:left\"><code>--name</code></td>\n<td style=\"text-align:left\">为容器指定一个名称</td>\n<td style=\"text-align:left\"><code>docker run --name my_nginx nginx</code></td>\n<td style=\"text-align:left\">为创建的容器赋予一个易读的唯一名称，方便后续的管理（如启动、停止、查看日志），而不必使用冗长且难记的容器ID。</td>\n</tr>\n</tbody>\n</table>\n<p>一个典型的 <code>docker run</code> 命令会组合使用这些参数来定义一个功能完整的容器：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 运行一个名为 'my-web-app' 的 WordPress 容器</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">docker</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> run</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -d</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> \\ </span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">                   # 在后台运行</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">  --name</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> my-web-app</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> \\ </span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">             # 容器命名为 my-web-app</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">  -p</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 8080:80</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> \\ </span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">                    # 将主机的8080端口映射到容器的80端口</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">  -e</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> WORDPRESS_DB_HOST=db:3306</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> \\ </span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">  # 设置环境变量：数据库地址</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">  -e</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> WORDPRESS_DB_USER=root</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> \\ </span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">     # 设置环境变量：数据库用户</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">  -e</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> WORDPRESS_DB_PASSWORD=secret</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> \\#</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 设置环境变量：数据库密码</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">  -v</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> wordpress_data:/var/www/html</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> \\#</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> 挂载命名卷，持久化网站数据</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">  wordpress:latest</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">                 # 使用的镜像</span></span></code></pre>\n<h3 id=\"其他常用参数补充\"><a class=\"anchor\" href=\"#其他常用参数补充\">#</a> 其他常用参数补充</h3>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">参数</th>\n<th style=\"text-align:left\">全称</th>\n<th style=\"text-align:left\">作用</th>\n<th style=\"text-align:left\">示例</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\"><code>-it</code></td>\n<td style=\"text-align:left\"><code>--interactive</code> + <code>--tty</code></td>\n<td style=\"text-align:left\">以交互模式运行容器</td>\n<td style=\"text-align:left\"><code>docker run -it ubuntu /bin/bash</code></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>--rm</code></td>\n<td style=\"text-align:left\"><code>--rm</code></td>\n<td style=\"text-align:left\">容器退出时自动清理</td>\n<td style=\"text-align:left\"><code>docker run --rm alpine echo &quot;hello&quot;</code></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>-u</code></td>\n<td style=\"text-align:left\"><code>--user</code></td>\n<td style=\"text-align:left\">指定运行容器的用户</td>\n<td style=\"text-align:left\"><code>docker run -u 1000 myapp</code></td>\n</tr>\n<tr>\n<td style=\"text-align:left\"><code>--network</code></td>\n<td style=\"text-align:left\"><code>--network</code></td>\n<td style=\"text-align:left\">将容器连接到指定网络</td>\n<td style=\"text-align:left\"><code>docker run --network my_net nginx</code></td>\n</tr>\n</tbody>\n</table>\n",
            "tags": [
                "container",
                "docker",
                "learn",
                "linux",
                "virtual"
            ]
        },
        {
            "id": "http://example.com/2025/07/25/git-basic-usage/",
            "url": "http://example.com/2025/07/25/git-basic-usage/",
            "title": "Git 基本使用教程",
            "date_published": "2025-07-25T15:00:00.000Z",
            "content_html": "<blockquote>\n<p>Git 是一个分布式版本控制系统，适用于代码版本管理与团队协作开发。本文将简要介绍 Git 的一些常用操作命令，包括创建仓库、分支管理以及删除文件/分支的方法。</p>\n</blockquote>\n<hr />\n<h2 id=\"一-初始化仓库\"><a class=\"anchor\" href=\"#一-初始化仓库\">#</a> 一、初始化仓库</h2>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">git</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> init</span></span></code></pre>\n<ul>\n<li>在当前目录初始化一个 Git 仓库。</li>\n<li>会创建 <code>.git</code> 文件夹作为版本控制目录。</li>\n</ul>\n<hr />\n<h2 id=\"二-克隆远程仓库\"><a class=\"anchor\" href=\"#二-克隆远程仓库\">#</a> 二、克隆远程仓库</h2>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">git</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> clone</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">仓库地</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">址</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">```</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">****</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">示例：</span></span>\n<span class=\"line\"></span>\n<span class=\"line\"><span style=\"color:#999999;--shiki-dark:#666666\">```</span><span style=\"color:#59873A;--shiki-dark:#80A665\">bash</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">git</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> clone</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> https://github.com/username/repo.git</span></span></code></pre>\n<hr />\n<h2 id=\"三-添加与提交文件\"><a class=\"anchor\" href=\"#三-添加与提交文件\">#</a> 三、添加与提交文件</h2>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">git</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> add</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">文件或目</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">录</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">git</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> commit</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -m</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">提交说明</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span></code></pre>\n<p>示例：</p>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">git</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> add</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> .</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">git</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> commit</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -m</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">添加初始项目文件</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span></code></pre>\n<hr />\n<h2 id=\"四-查看状态与历史\"><a class=\"anchor\" href=\"#四-查看状态与历史\">#</a> 四、查看状态与历史</h2>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">git</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> status</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">        # 查看当前状态</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">git</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> log</span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">           # 查看提交历史</span></span></code></pre>\n<hr />\n<h2 id=\"五-分支操作\"><a class=\"anchor\" href=\"#五-分支操作\">#</a> 五、分支操作</h2>\n<h3 id=\"创建新分支\"><a class=\"anchor\" href=\"#创建新分支\">#</a> 创建新分支</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">git</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> branch</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">分支</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">名</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span></span></code></pre>\n<h3 id=\"切换分支\"><a class=\"anchor\" href=\"#切换分支\">#</a> 切换分支</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">git</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> switch</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">分支</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">名</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span></span>\n<span class=\"line\"><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\"># 或（旧写法）</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">git</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> checkout</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">分支</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">名</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span></span></code></pre>\n<h3 id=\"创建并切换新分支\"><a class=\"anchor\" href=\"#创建并切换新分支\">#</a> 创建并切换新分支</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">git</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> switch</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -c</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">分支</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">名</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span></span></code></pre>\n<h3 id=\"查看所有分支\"><a class=\"anchor\" href=\"#查看所有分支\">#</a> 查看所有分支</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">git</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> branch</span></span></code></pre>\n<hr />\n<h2 id=\"六-合并分支\"><a class=\"anchor\" href=\"#六-合并分支\">#</a> 六、合并分支</h2>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">git</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> merge</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">被合并的分</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">支</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span></span></code></pre>\n<blockquote>\n<p>注意：需要先切换到目标分支，再合并。</p>\n</blockquote>\n<hr />\n<h2 id=\"七-删除操作\"><a class=\"anchor\" href=\"#七-删除操作\">#</a> 七、删除操作</h2>\n<h3 id=\"删除文件\"><a class=\"anchor\" href=\"#删除文件\">#</a> 删除文件</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">git</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> rm</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">文件</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">名</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">git</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> commit</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -m</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\"> \"</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">删除了某个文件</span><span style=\"color:#B5695977;--shiki-dark:#C98A7D77\">\"</span></span></code></pre>\n<h3 id=\"撤销删除误删恢复\"><a class=\"anchor\" href=\"#撤销删除误删恢复\">#</a> 撤销删除（误删恢复）</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">git</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> checkout</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">文件</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">名</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span></span></code></pre>\n<hr />\n<h3 id=\"删除本地分支\"><a class=\"anchor\" href=\"#删除本地分支\">#</a> 删除本地分支</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">git</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> branch</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -d</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">分支</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">名</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span></span></code></pre>\n<ul>\n<li><code>-d</code> 是安全删除（合并过的才允许删）</li>\n<li><code>-D</code> 是强制删除（无论是否合并）</li>\n</ul>\n<h3 id=\"删除远程分支\"><a class=\"anchor\" href=\"#删除远程分支\">#</a> 删除远程分支</h3>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">git</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> push</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> origin</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> --delete</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">分支</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">名</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span></span></code></pre>\n<hr />\n<h2 id=\"八-推送与拉取\"><a class=\"anchor\" href=\"#八-推送与拉取\">#</a> 八、推送与拉取</h2>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">git</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> push</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> origin</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">分支</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">名</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">   # 推送到远程</span></span>\n<span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">git</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> pull</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> origin</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\"> </span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">&#x3C;</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\">分支</span><span style=\"color:#393A34;--shiki-dark:#DBD7CAEE\">名</span><span style=\"color:#AB5959;--shiki-dark:#CB7676\">></span><span style=\"color:#A0ADA0;--shiki-dark:#758575DD\">   # 拉取最新代码</span></span></code></pre>\n<hr />\n<h2 id=\"九-查看远程仓库\"><a class=\"anchor\" href=\"#九-查看远程仓库\">#</a> 九、查看远程仓库</h2>\n<pre class=\"shiki shiki-themes vitesse-light vitesse-dark\" style=\"background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee\" tabindex=\"0\"><code class=\"language-bash\"><span class=\"line\"><span style=\"color:#59873A;--shiki-dark:#80A665\">git</span><span style=\"color:#B56959;--shiki-dark:#C98A7D\"> remote</span><span style=\"color:#A65E2B;--shiki-dark:#C99076\"> -v</span></span></code></pre>\n<hr />\n<h2 id=\"十-总结\"><a class=\"anchor\" href=\"#十-总结\">#</a> 十、总结</h2>\n<p>Git 是开发者日常工作中不可或缺的工具，掌握它可以大大提升协作效率与版本管理能力。希望本文能帮助你快速上手 Git 的基本操作。</p>\n<hr />\n<blockquote>\n<p>如需进一步学习，可以参考 <a href=\"https://git-scm.com/book/zh/v2\">Pro Git 中文版</a>。</p>\n</blockquote>\n",
            "tags": [
                "learn",
                "repo",
                "git"
            ]
        }
    ]
}