<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>木语</title>
  
  <subtitle>技术是逻辑，木是自然，语是表达</subtitle>
  <link href="https://koen666.github.io/atom.xml" rel="self"/>
  
  <link href="https://koen666.github.io/"/>
  <updated>2026-02-01T04:37:46.365Z</updated>
  <id>https://koen666.github.io/</id>
  
  <author>
    <name>koen</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>React Native打包实战：配置 EAS Build 生成 APK</title>
    <link href="https://koen666.github.io/2026/02/01/react-native/"/>
    <id>https://koen666.github.io/2026/02/01/react-native/</id>
    <published>2026-01-31T16:00:00.000Z</published>
    <updated>2026-02-01T04:37:46.365Z</updated>
    
    <content type="html"><![CDATA[<p>在 React Native (Expo) 开发完成后，如何将代码变成可以在真机上安装的 <code>.apk</code> 文件？本文记录了使用 <strong>EAS Build (Expo Application Services)</strong> 进行云端打包的详细步骤。</p><h2 id="1-准备工作"><a class="anchor" href="#1-准备工作">#</a> 1. 准备工作</h2><p>首先，我们需要安装 Expo 提供的构建工具 <code>eas-cli</code> 并登录账号。若没有账号则需要注册 <a href="https://expo.dev/">https://expo.dev/</a></p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># 全局安装 EAS CLI</span></span><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">npm</span><span style="color:#B56959;--shiki-dark:#C98A7D"> install</span><span style="color:#A65E2B;--shiki-dark:#C99076"> -g</span><span style="color:#B56959;--shiki-dark:#C98A7D"> eas-cli</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># 登录 Expo 账号</span></span><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">eas</span><span style="color:#B56959;--shiki-dark:#C98A7D"> login</span></span></code></pre><h2 id="2-项目标识配置-appjson"><a class="anchor" href="#2-项目标识配置-appjson">#</a> 2. 项目标识配置 (app.json)</h2><p>在打包前，必须确定 App 的名称和唯一的包名（Package Name）。打开项目根目录下的 app.json 进行修改：</p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-json"><span class="line"></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">JSON</span></span><span class="line"><span style="color:#2993a3;--shiki-dark:#5eaab5">{</span></span><span class="line"><span style="color:#99841877;--shiki-dark:#B8A96577">  "</span><span style="color:#998418;--shiki-dark:#B8A965">expo</span><span style="color:#99841877;--shiki-dark:#B8A96577">"</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#1e754f;--shiki-dark:#4d9375">{</span></span><span class="line"><span style="color:#99841877;--shiki-dark:#B8A96577">    "</span><span style="color:#998418;--shiki-dark:#B8A965">name</span><span style="color:#99841877;--shiki-dark:#B8A96577">"</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">中医智能面诊</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#A0ADA0;--shiki-dark:#758575DD">        // App 在手机桌面上显示的名字</span></span><span class="line"><span style="color:#99841877;--shiki-dark:#B8A96577">    "</span><span style="color:#998418;--shiki-dark:#B8A965">slug</span><span style="color:#99841877;--shiki-dark:#B8A96577">"</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">tcm-face-diagnosis</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#A0ADA0;--shiki-dark:#758575DD"> // Expo 项目标识（英文）</span></span><span class="line"><span style="color:#99841877;--shiki-dark:#B8A96577">    "</span><span style="color:#998418;--shiki-dark:#B8A965">version</span><span style="color:#99841877;--shiki-dark:#B8A96577">"</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">1.0.0</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#99841877;--shiki-dark:#B8A96577">    "</span><span style="color:#998418;--shiki-dark:#B8A965">android</span><span style="color:#99841877;--shiki-dark:#B8A96577">"</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#a65e2b;--shiki-dark:#d4976c">{</span></span><span class="line"><span style="color:#99841877;--shiki-dark:#B8A96577">      "</span><span style="color:#998418;--shiki-dark:#B8A965">package</span><span style="color:#99841877;--shiki-dark:#B8A96577">"</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">com.koen.tcmface</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#A0ADA0;--shiki-dark:#758575DD"> // 【关键】安卓包名，必须唯一</span></span><span class="line"><span style="color:#99841877;--shiki-dark:#B8A96577">      "</span><span style="color:#998418;--shiki-dark:#B8A965">adaptiveIcon</span><span style="color:#99841877;--shiki-dark:#B8A96577">"</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#a13865;--shiki-dark:#d9739f">{</span></span><span class="line"><span style="color:#99841877;--shiki-dark:#B8A96577">        "</span><span style="color:#998418;--shiki-dark:#B8A965">foregroundImage</span><span style="color:#99841877;--shiki-dark:#B8A96577">"</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">./assets/adaptive-icon.png</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#99841877;--shiki-dark:#B8A96577">        "</span><span style="color:#998418;--shiki-dark:#B8A965">backgroundColor</span><span style="color:#99841877;--shiki-dark:#B8A96577">"</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">#ffffff</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">      </span><span style="color:#a13865;--shiki-dark:#d9739f">}</span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">    </span><span style="color:#a65e2b;--shiki-dark:#d4976c">}</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#99841877;--shiki-dark:#B8A96577">    "</span><span style="color:#998418;--shiki-dark:#B8A965">ios</span><span style="color:#99841877;--shiki-dark:#B8A96577">"</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#a65e2b;--shiki-dark:#d4976c">{</span></span><span class="line"><span style="color:#99841877;--shiki-dark:#B8A96577">      "</span><span style="color:#998418;--shiki-dark:#B8A965">bundleIdentifier</span><span style="color:#99841877;--shiki-dark:#B8A96577">"</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">com.koen.tcmface</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#A0ADA0;--shiki-dark:#758575DD"> // iOS 包名</span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">    </span><span style="color:#a65e2b;--shiki-dark:#d4976c">}</span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">  </span><span style="color:#1e754f;--shiki-dark:#4d9375">}</span></span><span class="line"><span style="color:#2993a3;--shiki-dark:#5eaab5">}</span></span></code></pre><h2 id="3-构建配置-easjson"><a class="anchor" href="#3-构建配置-easjson">#</a> 3. 构建配置 (eas.json)</h2><p>默认情况下，EAS Build 会生成 .aab 文件（用于上架 Google Play）。如果我们想直接生成可安装的 .apk 文件，需要修改 eas.json。</p><p>运行初始化命令：</p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">eas</span><span style="color:#B56959;--shiki-dark:#C98A7D"> build:configure</span></span></code></pre><p>然后修改生成的 eas.json，重点是添加 preview 字段中的 buildType: "apk"：</p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-json"><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">JSON</span></span><span class="line"><span style="color:#2993a3;--shiki-dark:#5eaab5">{</span></span><span class="line"><span style="color:#99841877;--shiki-dark:#B8A96577">  "</span><span style="color:#998418;--shiki-dark:#B8A965">cli</span><span style="color:#99841877;--shiki-dark:#B8A96577">"</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#1e754f;--shiki-dark:#4d9375">{</span></span><span class="line"><span style="color:#99841877;--shiki-dark:#B8A96577">    "</span><span style="color:#998418;--shiki-dark:#B8A965">version</span><span style="color:#99841877;--shiki-dark:#B8A96577">"</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">&gt;= 7.0.0</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">  </span><span style="color:#1e754f;--shiki-dark:#4d9375">}</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#99841877;--shiki-dark:#B8A96577">  "</span><span style="color:#998418;--shiki-dark:#B8A965">build</span><span style="color:#99841877;--shiki-dark:#B8A96577">"</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#1e754f;--shiki-dark:#4d9375">{</span></span><span class="line"><span style="color:#99841877;--shiki-dark:#B8A96577">    "</span><span style="color:#998418;--shiki-dark:#B8A965">development</span><span style="color:#99841877;--shiki-dark:#B8A96577">"</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#a65e2b;--shiki-dark:#d4976c">{</span></span><span class="line"><span style="color:#99841877;--shiki-dark:#B8A96577">      "</span><span style="color:#998418;--shiki-dark:#B8A965">developmentClient</span><span style="color:#99841877;--shiki-dark:#B8A96577">"</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#1E754F;--shiki-dark:#4D9375"> true</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#99841877;--shiki-dark:#B8A96577">      "</span><span style="color:#998418;--shiki-dark:#B8A965">distribution</span><span style="color:#99841877;--shiki-dark:#B8A96577">"</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">internal</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">    </span><span style="color:#a65e2b;--shiki-dark:#d4976c">}</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#99841877;--shiki-dark:#B8A96577">    "</span><span style="color:#998418;--shiki-dark:#B8A965">preview</span><span style="color:#99841877;--shiki-dark:#B8A96577">"</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#a65e2b;--shiki-dark:#d4976c">{</span></span><span class="line"><span style="color:#99841877;--shiki-dark:#B8A96577">      "</span><span style="color:#998418;--shiki-dark:#B8A965">android</span><span style="color:#99841877;--shiki-dark:#B8A96577">"</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#a13865;--shiki-dark:#d9739f">{</span></span><span class="line"><span style="color:#99841877;--shiki-dark:#B8A96577">        "</span><span style="color:#998418;--shiki-dark:#B8A965">buildType</span><span style="color:#99841877;--shiki-dark:#B8A96577">"</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">apk</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> </span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">      </span><span style="color:#a13865;--shiki-dark:#d9739f">}</span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">    </span><span style="color:#a65e2b;--shiki-dark:#d4976c">}</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#99841877;--shiki-dark:#B8A96577">    "</span><span style="color:#998418;--shiki-dark:#B8A965">production</span><span style="color:#99841877;--shiki-dark:#B8A96577">"</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#a65e2b;--shiki-dark:#d4976c">{</span></span><span class="line"><span style="color:#99841877;--shiki-dark:#B8A96577">      "</span><span style="color:#998418;--shiki-dark:#B8A965">android</span><span style="color:#99841877;--shiki-dark:#B8A96577">"</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#a13865;--shiki-dark:#d9739f">{</span></span><span class="line"><span style="color:#99841877;--shiki-dark:#B8A96577">        "</span><span style="color:#998418;--shiki-dark:#B8A965">buildType</span><span style="color:#99841877;--shiki-dark:#B8A96577">"</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">app-bundle</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">      </span><span style="color:#a13865;--shiki-dark:#d9739f">}</span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">    </span><span style="color:#a65e2b;--shiki-dark:#d4976c">}</span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">  </span><span style="color:#1e754f;--shiki-dark:#4d9375">}</span></span><span class="line"><span style="color:#2993a3;--shiki-dark:#5eaab5">}</span></span></code></pre><h2 id="4-执行打包"><a class="anchor" href="#4-执行打包">#</a> 4. 执行打包</h2><p>一切准备就绪后，运行以下命令开始云端构建：</p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">eas</span><span style="color:#B56959;--shiki-dark:#C98A7D"> build</span><span style="color:#A65E2B;--shiki-dark:#C99076"> -p</span><span style="color:#B56959;--shiki-dark:#C98A7D"> android</span><span style="color:#A65E2B;--shiki-dark:#C99076"> --profile</span><span style="color:#B56959;--shiki-dark:#C98A7D"> preview</span></span><span class="line"></span><span class="line"></span><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">-p</span><span style="color:#B56959;--shiki-dark:#C98A7D"> android:</span><span style="color:#A0ADA0;--shiki-dark:#758575DD"> #指定打包安卓平台。</span></span><span class="line"></span><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">--profile</span><span style="color:#B56959;--shiki-dark:#C98A7D"> preview:</span><span style="color:#A0ADA0;--shiki-dark:#758575DD"> #使用我们刚才配置的 preview 模式（生成 APK）。</span></span><span class="line"></span></code></pre><p>构建完成后，终端会生成一个二维码和下载链接，直接下载安装即可。</p>]]></content>
    
    
    <summary type="html">记录使用 Expo EAS Build 服务将 React Native 项目打包成 Android APK 的完整流程，包含自定义包名配置及 Python 辅助脚本。</summary>
    
    
    
    <category term="frontend" scheme="https://koen666.github.io/categories/frontend/"/>
    
    
    <category term="python" scheme="https://koen666.github.io/tags/python/"/>
    
    <category term="react-native" scheme="https://koen666.github.io/tags/react-native/"/>
    
    <category term="expo" scheme="https://koen666.github.io/tags/expo/"/>
    
  </entry>
  
  <entry>
    <title>扩散模型 (Diffusion Model)原理详解</title>
    <link href="https://koen666.github.io/2026/01/30/%E6%89%A9%E6%95%A3%E6%A8%A1%E5%9E%8B/"/>
    <id>https://koen666.github.io/2026/01/30/%E6%89%A9%E6%95%A3%E6%A8%A1%E5%9E%8B/</id>
    <published>2026-01-29T16:00:00.000Z</published>
    <updated>2026-01-30T08:34:54.339Z</updated>
    
    <content type="html"><![CDATA[<p>在 AI 绘画（如 Midjourney, Stable Diffusion）和视频生成（如 Sora）大火的今天，<strong>扩散模型 (Diffusion Models)</strong> 已经成为了生成式 AI 的绝对皇冠。</p><p>但对于很多开发者来说，扩散模型的数学门槛似乎很高：变分推断、马尔可夫链、高斯分布……别担心，本文将拨开复杂的数学迷雾，带你从零推导扩散模型的本质原理。</p><h2 id="1-核心直觉搞破坏-vs-搞修复"><a class="anchor" href="#1-核心直觉搞破坏-vs-搞修复">#</a> 1. 核心直觉：搞破坏 vs. 搞修复</h2><p>扩散模型的灵感来源于非平衡热力学。我们可以把它想象成一个“墨水扩散”的过程。</p><h3 id="前向过程-forward-process毁灭"><a class="anchor" href="#前向过程-forward-process毁灭">#</a> 前向过程 (Forward Process)：毁灭</h3><p>想象你往一杯清水里滴入一滴墨水。随着时间的推移，墨水分子会逐渐扩散，直到整杯水变成均匀的浑浊状态。在图像处理中，这个过程等同于：<strong>不断地向一张清晰的图片中添加高斯噪声，直到它变成一张完全随机的雪花屏。</strong></p><h3 id="逆向过程-reverse-process创造"><a class="anchor" href="#逆向过程-reverse-process创造">#</a> 逆向过程 (Reverse Process)：创造</h3><p>如果我们能把时间倒流呢？如果我们能从那一杯浑浊的墨水中，精准地把每一个墨水分子还原回最初的那一滴形状呢？<br>这就是扩散模型要做的事：<strong>从纯噪声（雪花屏）开始，一步步去除噪声，最终“无中生有”地变出一张清晰的图像。</strong></p><hr><h2 id="2-数学推导前向过程-q"><a class="anchor" href="#2-数学推导前向过程-q">#</a> 2. 数学推导：前向过程 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>q</mi></mrow><annotation encoding="application/x-tex">q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span></span></span></h2><p>前向过程是一个固定的<strong>马尔可夫链 (Markov Chain)</strong>。我们规定每一步都加入微小的高斯噪声。</p><p>给定真实数据 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">x_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，我们在 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span> 时刻加入噪声得到 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">x_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>。</p><h3 id="单步加噪公式"><a class="anchor" href="#单步加噪公式">#</a> 单步加噪公式</h3><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>x</mi><mi>t</mi></msub><mo>=</mo><msqrt><mrow><mn>1</mn><mo>−</mo><msub><mi>β</mi><mi>t</mi></msub></mrow></msqrt><msub><mi>x</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>+</mo><msqrt><msub><mi>β</mi><mi>t</mi></msub></msqrt><msub><mi>ϵ</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><mspace width="1em"></mspace><mi>ϵ</mi><mo>∼</mo><mi mathvariant="script">N</mi><mo stretchy="false">(</mo><mn>0</mn><mo separator="true">,</mo><mi mathvariant="bold">I</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">x_t = \sqrt{1 - \beta_t} x_{t-1} + \sqrt{\beta_t} \epsilon_{t-1}, \quad \epsilon \sim \mathcal{N}(0, \mathbf{I})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.24em;vertical-align:-0.2561em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9839em;"><span class="svg-align" style="top:-3.2em;"><span class="pstrut" style="height:3.2em;"></span><span class="mord" style="padding-left:1em;"><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05278em;">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0528em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.9439em;"><span class="pstrut" style="height:3.2em;"></span><span class="hide-tail" style="min-width:1.02em;height:1.28em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.28em" viewBox="0 0 400000 1296" preserveAspectRatio="xMinYMin slice"><path d="M263,681c0.7,0,18,39.7,52,119c34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120c340,-704.7,510.7,-1060.3,512,-1067l0 -0c4.7,-7.3,11,-11,19,-11H40000v40H1012.3s-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232c-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1s-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60zM1001 80h400000v40h-400000z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2561em;"><span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.24em;vertical-align:-0.2561em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9839em;"><span class="svg-align" style="top:-3.2em;"><span class="pstrut" style="height:3.2em;"></span><span class="mord" style="padding-left:1em;"><span class="mord"><span class="mord mathnormal" style="margin-right:0.05278em;">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0528em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.9439em;"><span class="pstrut" style="height:3.2em;"></span><span class="hide-tail" style="min-width:1.02em;height:1.28em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.28em" viewBox="0 0 400000 1296" preserveAspectRatio="xMinYMin slice"><path d="M263,681c0.7,0,18,39.7,52,119c34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120c340,-704.7,510.7,-1060.3,512,-1067l0 -0c4.7,-7.3,11,-11,19,-11H40000v40H1012.3s-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232c-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1s-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60zM1001 80h400000v40h-400000z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2561em;"><span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">ϵ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:1em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">ϵ</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∼</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathcal" style="margin-right:0.14736em;">N</span><span class="mopen">(</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathbf">I</span><span class="mclose">)</span></span></span></span></span></p><ul><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>β</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">\beta_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05278em;">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0528em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>：预先设定的<strong>方差调度 (Variance Schedule)</strong>，控制每一步加多少噪声（通常很小）。</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msqrt><mrow><mn>1</mn><mo>−</mo><msub><mi>β</mi><mi>t</mi></msub></mrow></msqrt></mrow><annotation encoding="application/x-tex">\sqrt{1-\beta_t}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.04em;vertical-align:-0.205em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.835em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05278em;">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0528em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.795em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.08em" viewBox="0 0 400000 1080" preserveAspectRatio="xMinYMin slice"><path d="M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,-221l0 -0c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47zM834 80h400000v40h-400000z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.205em;"><span></span></span></span></span></span></span></span></span>：为了保持数据分布的方差稳定而加的系数。</li></ul><h3 id="任意步加噪重参数化技巧"><a class="anchor" href="#任意步加噪重参数化技巧">#</a> 任意步加噪（重参数化技巧）</h3><p>如果我们想求第 100 步的状态 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>100</mn></msub></mrow><annotation encoding="application/x-tex">x_{100}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">100</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，不需要一步步迭代。令 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>α</mi><mi>t</mi></msub><mo>=</mo><mn>1</mn><mo>−</mo><msub><mi>β</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">\alpha_t = 1 - \beta_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0037em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05278em;">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0528em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover accent="true"><mi>α</mi><mo>ˉ</mo></mover><mi>t</mi></msub><mo>=</mo><msubsup><mo>∏</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>t</mi></msubsup><msub><mi>α</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\bar{\alpha}_t = \prod_{i=1}^t \alpha_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7178em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5678em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0037em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.2332em;vertical-align:-0.2997em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∏</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9335em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2997em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:-0.0037em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，我们可以直接得出：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>x</mi><mi>t</mi></msub><mo>=</mo><msqrt><msub><mover accent="true"><mi>α</mi><mo>ˉ</mo></mover><mi>t</mi></msub></msqrt><msub><mi>x</mi><mn>0</mn></msub><mo>+</mo><msqrt><mrow><mn>1</mn><mo>−</mo><msub><mover accent="true"><mi>α</mi><mo>ˉ</mo></mover><mi>t</mi></msub></mrow></msqrt><mi>ϵ</mi></mrow><annotation encoding="application/x-tex">x_t = \sqrt{\bar{\alpha}_t} x_0 + \sqrt{1 - \bar{\alpha}_t} \epsilon</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.04em;vertical-align:-0.1972em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8428em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5678em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0037em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.8028em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.08em" viewBox="0 0 400000 1080" preserveAspectRatio="xMinYMin slice"><path d="M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,-221l0 -0c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47zM834 80h400000v40h-400000z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1972em;"><span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1.04em;vertical-align:-0.1589em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8811em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5678em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0037em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.8411em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.08em" viewBox="0 0 400000 1080" preserveAspectRatio="xMinYMin slice"><path d="M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,-221l0 -0c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47zM834 80h400000v40h-400000z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1589em;"><span></span></span></span></span></span><span class="mord mathnormal">ϵ</span></span></span></span></span></p><p>这意味着：<strong>任何时刻的图像 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">x_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，都可以看作是原图 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">x_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 和纯噪声 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϵ</mi></mrow><annotation encoding="application/x-tex">\epsilon</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">ϵ</span></span></span></span> 的线性组合。</strong></p><hr><h2 id="3-数学推导逆向过程-p_theta"><a class="anchor" href="#3-数学推导逆向过程-p_theta">#</a> 3. 数学推导：逆向过程 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mi>θ</mi></msub></mrow><annotation encoding="application/x-tex">p_\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></h2><p>这是 AI 发挥作用的地方。我们要把 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>T</mi></msub></mrow><annotation encoding="application/x-tex">x_T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 变回 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">x_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>。</p><p>理论上，如果前向过程的步长 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>β</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">\beta_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.05278em;">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0528em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 足够小，那么逆向过程 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mi mathvariant="normal">∣</mi><msub><mi>x</mi><mi>t</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">p(x_{t-1}|x_t)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mord">∣</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span> 也近似于一个<strong>高斯分布</strong>。</p><p>由于我们无法直接算出这个分布，我们训练一个神经网络 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">θ</span></span></span></span> 来近似它：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>p</mi><mi>θ</mi></msub><mo stretchy="false">(</mo><msub><mi>x</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mi mathvariant="normal">∣</mi><msub><mi>x</mi><mi>t</mi></msub><mo stretchy="false">)</mo><mo>=</mo><mi mathvariant="script">N</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo separator="true">;</mo><msub><mi mathvariant="bold-italic">μ</mi><mi>θ</mi></msub><mo stretchy="false">(</mo><msub><mi>x</mi><mi>t</mi></msub><mo separator="true">,</mo><mi>t</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><msub><mi mathvariant="bold">Σ</mi><mi>θ</mi></msub><mo stretchy="false">(</mo><msub><mi>x</mi><mi>t</mi></msub><mo separator="true">,</mo><mi>t</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">p_\theta(x_{t-1} | x_t) = \mathcal{N}(x_{t-1}; \boldsymbol{\mu}_\theta(x_t, t), \boldsymbol{\Sigma}_\theta(x_t, t))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mord">∣</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathcal" style="margin-right:0.14736em;">N</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mpunct">;</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol">μ</span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.242em;"><span style="top:-2.4559em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2441em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">t</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathbf">Σ</span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">t</span><span class="mclose">))</span></span></span></span></span></p><p>这里有两个未知数：</p><ol><li><strong>均值 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="bold-italic">μ</mi><mi>θ</mi></msub></mrow><annotation encoding="application/x-tex">\boldsymbol{\mu}_\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6886em;vertical-align:-0.2441em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord boldsymbol">μ</span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.242em;"><span style="top:-2.4559em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2441em;"><span></span></span></span></span></span></span></span></span></span></strong>：去噪后的图像中心在哪里？（这是核心难点）</li><li><strong>方差 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="bold">Σ</mi><mi>θ</mi></msub></mrow><annotation encoding="application/x-tex">\boldsymbol{\Sigma}_\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8361em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord"><span class="mord"><span class="mord mathbf">Σ</span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></strong>：通常固定为常数，不进行学习。</li></ol><p><em>通常使用 U-Net 结构的神经网络来预测噪声。</em></p><hr><h2 id="4-训练目标ai-到底在学什么"><a class="anchor" href="#4-训练目标ai-到底在学什么">#</a> 4. 训练目标：AI 到底在学什么？</h2><p>我们要让 AI 预测的分布 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>p</mi><mi>θ</mi></msub></mrow><annotation encoding="application/x-tex">p_\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 尽可能接近真实的逆向分布 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>q</mi></mrow><annotation encoding="application/x-tex">q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span></span></span></span>。<br>在数学上，这等价于最小化变分下界（ELBO），最终简化为<strong>最小化预测噪声的均方误差 (MSE)</strong>。</p><h3 id="核心发现"><a class="anchor" href="#核心发现">#</a> 核心发现</h3><p>经过复杂的贝叶斯公式推导，我们发现真实的后验均值 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover accent="true"><mi mathvariant="bold-italic">μ</mi><mo>~</mo></mover><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">\tilde{\boldsymbol{\mu}}_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9254em;vertical-align:-0.2441em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6813em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord boldsymbol">μ</span></span></span></span><span style="top:-3.3634em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.25em;"><span class="mord">~</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.1944em;"><span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1864em;"><span style="top:-2.4559em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2441em;"><span></span></span></span></span></span></span></span></span></span> 其实只取决于一个变量：<strong>当前时刻包含的噪声 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϵ</mi></mrow><annotation encoding="application/x-tex">\epsilon</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">ϵ</span></span></span></span></strong>。</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>Loss</mtext><mo>=</mo><msub><mi mathvariant="double-struck">E</mi><mrow><mi>t</mi><mo separator="true">,</mo><msub><mi>x</mi><mn>0</mn></msub><mo separator="true">,</mo><mi>ϵ</mi></mrow></msub><mrow><mo fence="true">[</mo><mi mathvariant="normal">∥</mi><mi>ϵ</mi><mo>−</mo><msub><mi>ϵ</mi><mi>θ</mi></msub><mo stretchy="false">(</mo><msub><mi>x</mi><mi>t</mi></msub><mo separator="true">,</mo><mi>t</mi><mo stretchy="false">)</mo><msup><mi mathvariant="normal">∥</mi><mn>2</mn></msup><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">\text{Loss} = \mathbb{E}_{t, x_0, \epsilon} \left[ \| \epsilon - \epsilon_\theta(x_t, t) \|^2 \right]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord text"><span class="mord">Loss</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.2141em;vertical-align:-0.35em;"></span><span class="mord"><span class="mord mathbb">E</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3173em;"><span style="top:-2.357em;margin-left:0em;margin-right:0.0714em;"><span class="pstrut" style="height:2.5em;"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.143em;"><span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">ϵ</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">[</span></span><span class="mord">∥</span><span class="mord mathnormal">ϵ</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">ϵ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">t</span><span class="mclose">)</span><span class="mord"><span class="mord">∥</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">]</span></span></span></span></span></span></span></p><p><strong>这是扩散模型最反直觉也最精妙的地方：</strong><br>神经网络<strong>不需要</strong>学会画图，它只需要学会**“找茬”**。</p><ul><li><strong>输入</strong>：一张带噪点的图 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">x_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>。</li><li><strong>输出</strong>：这张图里包含的噪声 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ϵ</mi><mi>θ</mi></msub></mrow><annotation encoding="application/x-tex">\epsilon_\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">ϵ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 是多少。</li><li><strong>Label</strong>：前向过程中实际加入的真噪声 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϵ</mi></mrow><annotation encoding="application/x-tex">\epsilon</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">ϵ</span></span></span></span>。</li></ul><hr><h2 id="5-采样过程从-0-到-1-的生成"><a class="anchor" href="#5-采样过程从-0-到-1-的生成">#</a> 5. 采样过程：从 0 到 1 的生成</h2><p>一旦模型训练好（能准确预测噪声了），我们就可以开始生成图像了。这是一个迭代的“去噪”过程。</p><h3 id="采样算法-sampling-algorithm"><a class="anchor" href="#采样算法-sampling-algorithm">#</a> 采样算法 (Sampling Algorithm)</h3><ol><li><p><strong>从混沌开始</strong>：随机采样一个标准正态分布噪声 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>T</mi></msub><mo>∼</mo><mi mathvariant="script">N</mi><mo stretchy="false">(</mo><mn>0</mn><mo separator="true">,</mo><mi mathvariant="bold">I</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">x_T \sim \mathcal{N}(0, \mathbf{I})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∼</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathcal" style="margin-right:0.14736em;">N</span><span class="mopen">(</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathbf">I</span><span class="mclose">)</span></span></span></span>。</p></li><li><p><strong>循环迭代</strong>：从 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>=</mo><mi>T</mi></mrow><annotation encoding="application/x-tex">t = T</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span></span></span></span> 到 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn></mrow><annotation encoding="application/x-tex">1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">1</span></span></span></span>：</p><ul><li>让模型看着 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex">x_t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，预测噪声 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ϵ</mi><mi>θ</mi></msub></mrow><annotation encoding="application/x-tex">\epsilon_\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">ϵ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>。</li><li>根据预测的噪声，计算出上一时刻的均值。</li><li>加上一点点随机扰动 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>z</mi></mrow><annotation encoding="application/x-tex">z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span></span></span></span>（Langevin 动力学），防止生成的图像过于死板。</li></ul><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>x</mi><mrow><mi>t</mi><mo>−</mo><mn>1</mn></mrow></msub><mo>=</mo><mfrac><mn>1</mn><msqrt><msub><mi>α</mi><mi>t</mi></msub></msqrt></mfrac><mrow><mo fence="true">(</mo><msub><mi>x</mi><mi>t</mi></msub><mo>−</mo><mfrac><msub><mi>β</mi><mi>t</mi></msub><msqrt><mrow><mn>1</mn><mo>−</mo><msub><mover accent="true"><mi>α</mi><mo>ˉ</mo></mover><mi>t</mi></msub></mrow></msqrt></mfrac><msub><mi>ϵ</mi><mi>θ</mi></msub><mo stretchy="false">(</mo><msub><mi>x</mi><mi>t</mi></msub><mo separator="true">,</mo><mi>t</mi><mo stretchy="false">)</mo><mo fence="true">)</mo></mrow><mo>+</mo><msub><mi>σ</mi><mi>t</mi></msub><mi>z</mi></mrow><annotation encoding="application/x-tex">x_{t-1} = \frac{1}{\sqrt{\alpha_t}} \left( x_t - \frac{\beta_t}{\sqrt{1 - \bar{\alpha}_t}} \epsilon_\theta(x_t, t) \right) + \sigma_t z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6389em;vertical-align:-0.2083em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">t</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2083em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.4507em;vertical-align:-1.0007em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7253em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord"><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0037em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.6853em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.08em" viewBox="0 0 400000 1080" preserveAspectRatio="xMinYMin slice"><path d="M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,-221l0 -0c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47zM834 80h400000v40h-400000z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3147em;"><span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.0007em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size3">(</span></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3714em;"><span style="top:-2.2778em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.8322em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord" style="padding-left:0.833em;"><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.5678em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body" style="left:-0.2222em;"><span class="mord">ˉ</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0037em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.7922em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail" style="min-width:0.853em;height:1.08em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="1.08em" viewBox="0 0 400000 1080" preserveAspectRatio="xMinYMin slice"><path d="M95,702c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429c69,-144,104.5,-217.7,106.5,-221l0 -0c5.3,-9.3,12,-14,20,-14H400000v40H845.2724s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47zM834 80h400000v40h-400000z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2078em;"><span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal" style="margin-right:0.05278em;">β</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0528em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.93em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord"><span class="mord mathnormal">ϵ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em;">θ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">t</span><span class="mclose">)</span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size3">)</span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span></span></span></span></span></p></li><li><p><strong>最终结果</strong>：当循环结束得到 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">x_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，就是一张清晰的图片。</p></li></ol><p><em>如上图所示，随着步数 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span> 的减小，纯噪声逐渐显现出清晰的数字轮廓。</em></p><hr><h2 id="6-总结"><a class="anchor" href="#6-总结">#</a> 6. 总结</h2><p>扩散模型之所以强大，是因为它放弃了 GAN 那种“一步到位”的生成方式，而是选择了“慢工出细活”。</p><ol><li><strong>前向 (Forward)</strong>：物理过程，把数据变成噪声。</li><li><strong>逆向 (Reverse)</strong>：AI 过程，通过预测噪声，把数据一步步还原。</li><li><strong>训练 (Training)</strong>：本质是在训练一个“去噪器”，计算 Loss 只需简单的 MSE。</li></ol><p>正是这种迭代式的生成过程，让扩散模型拥有了捕捉极其复杂数据分布的能力，从而诞生了今天令人惊叹的 AIGC 时代。</p>]]></content>
    
    
    <summary type="html">从直观的“墨水扩散”比喻出发，深入浅出地推导去噪扩散概率模型 (DDPM) 的前向过程、逆向生成及训练目标，揭秘 AI 如何从纯噪声中“无中生有”。</summary>
    
    
    
    <category term="deeplearning" scheme="https://koen666.github.io/categories/deeplearning/"/>
    
    
    <category term="diffusionmodel" scheme="https://koen666.github.io/tags/diffusionmodel/"/>
    
    <category term="generative-ai" scheme="https://koen666.github.io/tags/generative-ai/"/>
    
  </entry>
  
  <entry>
    <title>一文讲通贝叶斯理论：从概率公式到贝叶斯神经网络</title>
    <link href="https://koen666.github.io/2026/01/29/%E8%B4%9D%E5%8F%B6%E6%96%AF%E6%A8%A1%E5%9E%8B/"/>
    <id>https://koen666.github.io/2026/01/29/%E8%B4%9D%E5%8F%B6%E6%96%AF%E6%A8%A1%E5%9E%8B/</id>
    <published>2026-01-28T16:00:00.000Z</published>
    <updated>2026-01-29T07:59:32.585Z</updated>
    
    <content type="html"><![CDATA[<p>在这个由数据驱动的时代，传统的确定性算法习惯告诉我们“是”或“否”。但在真实世界，尤其是复杂的物理系统或灾害推演中，充满了<strong>不确定性</strong>。</p><p><strong>贝叶斯理论（Bayesian Theory）</strong> 提供了一种从不确定性中寻找真理的数学框架。它不只是一组公式，更是一种思维方式：<strong>根据新的证据，不断更新我们对世界的认知。</strong></p><p>本文将带你走过一条从经典统计学通往现代深度学习的演进之路：</p><ol><li><strong>贝叶斯定理</strong>：一切的起源。</li><li><strong>朴素贝叶斯</strong>：为了计算效率的“独立性妥协”。</li><li><strong>贝叶斯网络 (PGM)</strong>：描述万物因果的复杂图谱。</li><li><strong>贝叶斯神经网络 (BNN)</strong>：给深度学习装上“懂得怀疑”的大脑。</li></ol><hr /><h2 id="1-一切的起点贝叶斯定理"><a class="anchor" href="#1-一切的起点贝叶斯定理">#</a> 1. 一切的起点：贝叶斯定理</h2><p>如果你只能记住一个概率公式，那必须是贝叶斯公式。它的核心逻辑是：<strong>后验概率 = (似然性 × 先验概率) / 标准化常数</strong>。</p><h3 id="11-数学形式与物理含义"><a class="anchor" href="#11-数学形式与物理含义">#</a> 1.1 数学形式与物理含义</h3><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>H</mi><mi mathvariant="normal">∣</mi><mi>E</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>E</mi><mi mathvariant="normal">∣</mi><mi>H</mi><mo stretchy="false">)</mo><mo>⋅</mo><mi>P</mi><mo stretchy="false">(</mo><mi>H</mi><mo stretchy="false">)</mo></mrow><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>E</mi><mo stretchy="false">)</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">P(H|E) = \frac{P(E|H) \cdot P(H)}{P(E)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mord">∣</span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.363em;vertical-align:-0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord">∣</span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><ul><li><strong><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi></mrow><annotation encoding="application/x-tex">H</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span></span></span></span> (Hypothesis，假设)</strong>：我们想要验证的结论（例如：发生了山洪）。</li><li><strong><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi></mrow><annotation encoding="application/x-tex">E</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span></span></span></span> (Evidence，证据)</strong>：我们观测到的事实（例如：降雨量超过 100mm）。</li></ul><p>这个公式告诉我们如何通过观测来修正信念：</p><ul><li><strong><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>H</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">P(H)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mclose">)</span></span></span></span> 先验概率</strong>：在拿到数据之前，根据历史经验，山洪发生的概率是多少？</li><li><strong><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>E</mi><mi mathvariant="normal">∣</mi><mi>H</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">P(E|H)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord">∣</span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mclose">)</span></span></span></span> 似然概率</strong>：如果真的发生了山洪（假设成立），那么出现“降雨量&gt;100mm”这种现象的概率有多大？</li><li><strong><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>H</mi><mi mathvariant="normal">∣</mi><mi>E</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">P(H|E)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mord">∣</span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mclose">)</span></span></span></span> 后验概率</strong>：<strong>在观测到暴雨后</strong>，我们要把“发生山洪”的概率修正到多少？</li></ul><h3 id="12-直观理解逆向推断"><a class="anchor" href="#12-直观理解逆向推断">#</a> 1.2 直观理解：逆向推断</h3><p>贝叶斯定理之所以强大，是因为它允许我们进行<strong>逆向概率推断</strong>。</p><p>通常我们容易获得“正向数据”（比如统计过去所有山洪事件中，有多少次是暴雨引发的）。但我们在应用中往往面临的是反向问题：现在正在下暴雨，未来发生山洪的几率有多大？贝叶斯公式就是连接这两者的桥梁。</p><hr /><h2 id="2-工程的妥协朴素贝叶斯-naive-bayes"><a class="anchor" href="#2-工程的妥协朴素贝叶斯-naive-bayes">#</a> 2. 工程的妥协：朴素贝叶斯 (Naive Bayes)</h2><p>当我们需要处理的特征非常多时（例如：判断灾害需要考虑降雨、坡度、植被、土壤湿度等几十个维度），计算所有特征的<strong>联合分布</strong>会变得异常困难。</p><p>为了让计算变得可行，数学家做了一个“天真（Naive）”的假设。</p><h3 id="21-朴素在哪里"><a class="anchor" href="#21-朴素在哪里">#</a> 2.1 “朴素”在哪里？</h3><p>朴素贝叶斯假设：<strong>所有的特征 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>x</mi><mn>2</mn></msub><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><msub><mi>x</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">x_1, x_2, ..., x_n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">...</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 之间是相互独立的</strong>。</p><p>这意味着，它认为“降雨量”和“土壤湿度”之间没有关系（虽然这在物理学上显然是错的）。但这个假设将复杂的联合概率简化为了简单的连乘：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>y</mi><mi mathvariant="normal">∣</mi><msub><mi>x</mi><mn>1</mn></msub><mo separator="true">,</mo><mo>…</mo><mo separator="true">,</mo><msub><mi>x</mi><mi>n</mi></msub><mo stretchy="false">)</mo><mo>∝</mo><mi>P</mi><mo stretchy="false">(</mo><mi>y</mi><mo stretchy="false">)</mo><munderover><mo>∏</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mi>P</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mi mathvariant="normal">∣</mi><mi>y</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">P(y|x_1, \dots, x_n) \propto P(y) \prod_{i=1}^{n} P(x_i|y)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord">∣</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">…</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∝</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.9291em;vertical-align:-1.2777em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.6514em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∏</span></span></span><span style="top:-4.3em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.2777em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">∣</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span></span></span></span></span></p><h3 id="22-为什么它依然有效"><a class="anchor" href="#22-为什么它依然有效">#</a> 2.2 为什么它依然有效？</h3><p>尽管独立性假设不符合物理直觉，但在高维分类任务（如垃圾邮件识别、简单的文本分类）中，朴素贝叶斯依然表现出色。这是因为我们主要关注的是<strong>哪个类别的概率最大</strong>，而不是精确的概率值。只要各特征对分类的“投票方向”一致，独立性假设带来的偏差就不会改变最终的分类结果。</p><hr /><h2 id="3-结构化的因果概率图模型-pgm-贝叶斯网络"><a class="anchor" href="#3-结构化的因果概率图模型-pgm-贝叶斯网络">#</a> 3. 结构化的因果：概率图模型 (PGM) / 贝叶斯网络</h2><p>但是在很多场景中，不能容忍“特征独立”这种天真的假设。我们需要描述<strong>因果链条</strong>。</p><h3 id="31-经典的洒水车-下雨模型"><a class="anchor" href="#31-经典的洒水车-下雨模型">#</a> 3.1 经典的“洒水车-下雨”模型</h3><p><img loading="lazy" src="https://upload.wikimedia.org/wikipedia/commons/thumb/0/0e/SimpleBayesNet.svg/600px-SimpleBayesNet.svg.png" alt="简单的贝叶斯网络DAG" /></p><p><em>(图源：Wikimedia Commons. 这是一个经典的有向无环图 (DAG)。草湿了 (Grass Wet) 既可能是因为下雨 (Rain)，也可能是因为洒水车 (Sprinkler))</em></p><h3 id="32-灾害链中的应用"><a class="anchor" href="#32-灾害链中的应用">#</a> 3.2 灾害链中的应用</h3><p>给出一个博主正在做的灾害链推演模型，这个图的结构可能变成：<br /><strong>[暴雨] <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>→</mo></mrow><annotation encoding="application/x-tex">\rightarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"></span><span class="mrel">→</span></span></span></span> [山洪] <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>→</mo></mrow><annotation encoding="application/x-tex">\rightarrow</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"></span><span class="mrel">→</span></span></span></span> [泥石流]</strong></p><p>我们利用这种结构进行<strong>阈值反演</strong>：</p><ul><li><strong>正向</strong>：暴雨导致泥石流的概率是多少？</li><li><strong>反向</strong>：如果要求泥石流发生概率低于 1%，那么暴雨强度的<strong>警戒阈值</strong>应该设为多少？</li></ul><hr /><h2 id="4-深度学习的进化贝叶斯神经网络-bnn"><a class="anchor" href="#4-深度学习的进化贝叶斯神经网络-bnn">#</a> 4. 深度学习的进化：贝叶斯神经网络 (BNN)</h2><p>传统的深度神经网络（DNN）虽然在拟合能力上远超上述模型，但它有一个致命弱点：<strong>盲目自信</strong>。</p><p>传统神经网络是<strong>确定性</strong>的：输入数据，经过固定的权重计算，给出一个确定的分数。即使输入一张完全无关的噪声图，模型也可能以 99% 的置信度将其分类为“猫”。这在自动驾驶或灾害预警中是极度危险的。</p><h3 id="41-从点到分布"><a class="anchor" href="#41-从点到分布">#</a> 4.1 从“点”到“分布”</h3><p><strong>贝叶斯神经网络 (BNN)</strong> 将贝叶斯概率论引入了深度学习。它的核心改变在于<strong>权重 (Weights)</strong>。</p><ul><li><strong>传统 NN</strong>：权重 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>w</mi><mo>=</mo><mn>0.5</mn></mrow><annotation encoding="application/x-tex">w = 0.5</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0.5</span></span></span></span>（每个神经元连接是一个固定的数字）。</li><li><strong>贝叶斯 NN</strong>：权重 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>w</mi><mo>∼</mo><mi>N</mi><mo stretchy="false">(</mo><mi>μ</mi><mo separator="true">,</mo><msup><mi>σ</mi><mn>2</mn></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">w \sim N(\mu, \sigma^2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∼</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.0641em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mopen">(</span><span class="mord mathnormal">μ</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>（每个神经元连接是一个<strong>高斯分布</strong>）。</li></ul><p><img loading="lazy" src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e4/Artificial_neural_network.svg/600px-Artificial_neural_network.svg.png" alt="神经网络结构" /></p><p><em>(图源：Wikimedia Commons. 在 BNN 中，图中每一条连接线的权重 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>w</mi></mrow><annotation encoding="application/x-tex">w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span></span></span></span> 不再是一个固定的数字，而是一个<strong>高斯分布</strong> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mo stretchy="false">(</mo><mi>μ</mi><mo separator="true">,</mo><mi>σ</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">N(\mu, \sigma)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mopen">(</span><span class="mord mathnormal">μ</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="mclose">)</span></span></span></span>)</em></p><p>这意味着，网络本身不再是一个死板的函数，而是一个<strong>概率分布系综</strong>。</p><h3 id="42-两种不确定性"><a class="anchor" href="#42-两种不确定性">#</a> 4.2 两种不确定性</h3><p>BNN 最强大的能力在于它能区分两种“不知道”：</p><ol><li><strong>偶然不确定性 (Aleatoric Uncertainty)</strong>：源于数据本身的噪声（如传感器误差）。即便增加数据也无法消除。</li><li><strong>认知不确定性 (Epistemic Uncertainty)</strong>：源于模型见识太少（如训练数据未覆盖的场景）。<strong>BNN 会通过权重的剧烈波动，给出平坦的预测分布，告诉人类“我没见过这个，我不确定”。</strong></li></ol><h3 id="43-推理机制变分推断-variational-inference"><a class="anchor" href="#43-推理机制变分推断-variational-inference">#</a> 4.3 推理机制：变分推断 (Variational Inference)</h3><p>由于 BNN 的后验分布极其复杂，无法直接计算。在实际工程中，我们通常采用<strong>变分推断</strong>或 <strong>MC Dropout</strong> 等方法进行近似。</p><p>简单来说，就是在预测时，不是只跑一次网络，而是让网络在权重的分布中随机采样多次（比如 50 次），得到 50 个不同的结果。</p><ul><li>如果这 50 个结果高度一致 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>→</mo></mrow><annotation encoding="application/x-tex">\to</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"></span><span class="mrel">→</span></span></span></span> <strong>高置信度</strong>。</li><li>如果这 50 个结果差异巨大 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>→</mo></mrow><annotation encoding="application/x-tex">\to</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"></span><span class="mrel">→</span></span></span></span> <strong>高不确定性（需要人工介入）</strong>。</li></ul><hr /><h2 id="5-总结"><a class="anchor" href="#5-总结">#</a> 5. 总结</h2><p>从最基础的<strong>贝叶斯公式</strong>，到为了计算妥协的<strong>朴素贝叶斯</strong>，再到能够刻画因果结构的<strong>贝叶斯网络</strong>，最后到融合了深度学习拟合能力的<strong>贝叶斯神经网络</strong>，这是一条从“规则”到“学习”，再回归到“理性怀疑”**的技术演进之路。</p><ul><li><strong>朴素贝叶斯</strong>告诉我们：有时候为了效率，可以忽略细节。</li><li><strong>贝叶斯网络</strong>告诉我们：世界的运作是有因果结构的，掌握结构就能反演阈值。</li><li><strong>BNN</strong>告诉我们：真正的智能，不仅是能给出答案，更是通过概率分布，诚实地表达自己对答案有多大把握。</li></ul><p>在未来的 <strong>AI + 科学计算（AI for Science）</strong> 领域，结合了物理机理约束（PGM思维）与深度表示学习（NN思维）的<strong>融合模型</strong>，将是解决复杂系统推演的关键钥匙。</p>]]></content>
    
    
    <summary type="html">本文从最基础的贝叶斯概型开始介绍，跨越朴素贝叶斯与概率图模型，最终深入探讨贝叶斯神经网络（BNN）的核心原理与不确定性建模。</summary>
    
    
    
    <category term="machinelearning" scheme="https://koen666.github.io/categories/machinelearning/"/>
    
    
    <category term="theory" scheme="https://koen666.github.io/tags/theory/"/>
    
    <category term="bayesian" scheme="https://koen666.github.io/tags/bayesian/"/>
    
  </entry>
  
  <entry>
    <title>让你在没有 root 权限的机子上跑镜像</title>
    <link href="https://koen666.github.io/2026/01/15/udocker/"/>
    <id>https://koen666.github.io/2026/01/15/udocker/</id>
    <published>2026-01-14T16:00:00.000Z</published>
    <updated>2026-01-15T15:42:35.407Z</updated>
    
    <content type="html"><![CDATA[<h2 id="背景为什么我们需要它"><a class="anchor" href="#背景为什么我们需要它">#</a> 背景：为什么我们需要它？</h2><p>在科研和开发过程中，我们经常遇到这样的死结：</p><ol><li><strong>环境依赖地狱</strong>：代码依赖特定的 CUDA 版本、Ubuntu 版本或一大堆 Python 库，手动配置极易冲突。</li><li><strong>没有 Root 权限</strong>：实验室的服务器、学校的 HPC 集群通常由管理员统一管理，普通学生账户没有 <code>sudo</code> 权限。</li><li><strong>Docker 无法使用</strong>：标准的 Docker 需要守护进程（Daemon）以 root 身份运行，没有权限意味着 <code>docker: command not found</code> 或 <code>permission denied</code>。</li></ol><p>虽然 <strong>Podman</strong> 是一个很好的无 Root 替代品，但它对 Linux 内核版本有要求（需要 User Namespaces 支持），且在某些老旧的超算系统上仍然难以安装。</p><p>这时候，<strong>udocker</strong> 就是一个非常实用的解决方案。</p><h2 id="什么是-udocker"><a class="anchor" href="#什么是-udocker">#</a> 什么是 udocker？</h2><p><code>udocker</code> 是一个专门为在用户空间运行 Docker 容器而设计的工具：</p><ul><li><strong>纯用户空间</strong>：不需要 root 权限，也不需要安装系统级守护进程。</li><li><strong>兼容性强</strong>：本质上是一个 Python 脚本，几乎可以在任何 Linux 发行版（CentOS 6/7、Ubuntu、Fedora 等）上运行。</li><li><strong>原理</strong>：通过 <strong>PRoot</strong>（利用 <code>ptrace</code> 机制）或 <strong>Fakechroot</strong> 等技术，模拟 root 环境和文件系统挂载，让容器“以为”自己运行在特权环境中。</li></ul><p>一句话总结：<strong>只要你能跑 Python，就能跑 udocker，进而跑 Docker 镜像。</strong></p><h2 id="1-安装-udocker"><a class="anchor" href="#1-安装-udocker">#</a> 1. 安装 udocker</h2><p>安装过程很简单：下载脚本并初始化。</p><h3 id="11-下载-udocker-脚本"><a class="anchor" href="#11-下载-udocker-脚本">#</a> 1.1 下载 udocker 脚本</h3><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">curl</span><span style="color:#A65E2B;--shiki-dark:#C99076"> -L</span><span style="color:#B56959;--shiki-dark:#C98A7D"> https://raw.githubusercontent.com/indigo-dc/udocker/master/udocker.py</span><span style="color:#AB5959;--shiki-dark:#CB7676"> </span><span style="color:#AB5959;--shiki-dark:#CB7676">></span><span style="color:#B56959;--shiki-dark:#C98A7D"> udocker</span></span></code></pre><h3 id="12-赋予执行权限"><a class="anchor" href="#12-赋予执行权限">#</a> 1.2 赋予执行权限</h3><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">chmod</span><span style="color:#B56959;--shiki-dark:#C98A7D"> +x</span><span style="color:#B56959;--shiki-dark:#C98A7D"> udocker</span></span></code></pre><h3 id="13-移动到你的-bin-目录可选"><a class="anchor" href="#13-移动到你的-bin-目录可选">#</a> 1.3 移动到你的 bin 目录（可选）</h3><p>前提：<code>~/.local/bin</code> 已在 <code>PATH</code> 中。</p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">mv</span><span style="color:#B56959;--shiki-dark:#C98A7D"> udocker</span><span style="color:#B56959;--shiki-dark:#C98A7D"> ~/.local/bin/</span></span></code></pre><h3 id="14-初始化"><a class="anchor" href="#14-初始化">#</a> 1.4 初始化</h3><p>这会自动下载所需的引擎二进制文件到 <code>~/.udocker</code> 目录。</p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">udocker</span><span style="color:#B56959;--shiki-dark:#C98A7D"> install</span></span></code></pre><h3 id="15-验证安装"><a class="anchor" href="#15-验证安装">#</a> 1.5 验证安装</h3><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">udocker</span><span style="color:#B56959;--shiki-dark:#C98A7D"> version</span></span></code></pre><h2 id="2-基本使用像-docker-一样操作"><a class="anchor" href="#2-基本使用像-docker-一样操作">#</a> 2. 基本使用：像 Docker 一样操作</h2><p>udocker 的命令设计上尽量模仿 Docker，但有一个关键区别：<strong>udocker 严格区分“容器创建”和“容器运行”。</strong></p><h3 id="21-拉取镜像pull"><a class="anchor" href="#21-拉取镜像pull">#</a> 2.1 拉取镜像（pull）</h3><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># 拉取 PyTorch 镜像</span></span><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">udocker</span><span style="color:#B56959;--shiki-dark:#C98A7D"> pull</span><span style="color:#B56959;--shiki-dark:#C98A7D"> pytorch/pytorch:1.13.0-cuda11.6-cudnn8-runtime</span></span></code></pre><h3 id="22-创建容器create"><a class="anchor" href="#22-创建容器create">#</a> 2.2 创建容器（create）</h3><p>在 Docker 中，<code>docker run</code> 常同时完成创建和启动；在 udocker 中，更推荐先显式创建容器。</p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># 从镜像创建一个名为 "my_experiment" 的容器</span></span><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">udocker</span><span style="color:#B56959;--shiki-dark:#C98A7D"> create</span><span style="color:#A65E2B;--shiki-dark:#C99076"> --name=my_experiment</span><span style="color:#B56959;--shiki-dark:#C98A7D"> pytorch/pytorch:1.13.0-cuda11.6-cudnn8-runtime</span></span></code></pre><h3 id="23-运行容器run"><a class="anchor" href="#23-运行容器run">#</a> 2.3 运行容器（run）</h3><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># 运行容器并进入交互式终端</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># -v 挂载目录：将宿主机当前目录挂载到容器的 /workspace</span></span><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">udocker</span><span style="color:#B56959;--shiki-dark:#C98A7D"> run</span><span style="color:#A65E2B;--shiki-dark:#C99076"> -v</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#999999;--shiki-dark:#666666">$(</span><span style="color:#998418;--shiki-dark:#B8A965">pwd</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">:/workspace</span><span style="color:#B56959;--shiki-dark:#C98A7D"> my_experiment</span><span style="color:#B56959;--shiki-dark:#C98A7D"> /bin/bash</span></span></code></pre><p>进入容器后，你会看到自己是 root（容器内部视角）。你可以 <code>apt-get install</code> 或 <code>pip install</code>，但这些改动只影响容器文件系统，不会影响宿主机。</p><h2 id="3-进阶技巧科研场景专用"><a class="anchor" href="#3-进阶技巧科研场景专用">#</a> 3. 进阶技巧：科研场景专用</h2><h3 id="31-启用-gpu-支持nvidia"><a class="anchor" href="#31-启用-gpu-支持nvidia">#</a> 3.1 启用 GPU 支持（NVIDIA）</h3><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># 使用 --nvidia 标志启用 GPU 支持</span></span><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">udocker</span><span style="color:#B56959;--shiki-dark:#C98A7D"> run</span><span style="color:#A65E2B;--shiki-dark:#C99076"> --nvidia</span><span style="color:#B56959;--shiki-dark:#C98A7D"> my_experiment</span><span style="color:#B56959;--shiki-dark:#C98A7D"> nvidia-smi</span></span></code></pre><p>注意：udocker <strong>不包含</strong>驱动程序，它只是将宿主机的 <code>/dev/nvidia*</code> 设备和相关库映射进容器。请确保宿主机已正确安装显卡驱动。</p><h3 id="32-更改运行模式execmode"><a class="anchor" href="#32-更改运行模式execmode">#</a> 3.2 更改运行模式（execmode）</h3><p>如果遇到 <code>Segmentation fault</code> 或某些程序跑不起来，可以尝试更改执行模式。udocker 提供多种模式（不同版本的可用项可能略有差异）：</p><ul><li><strong>P1/P2（PRoot）</strong>：默认模式，兼容性最好，但 I/O 密集任务可能有性能损耗。</li><li><strong>F1/F2/F3（Fakechroot）</strong>：性能更好，但兼容性可能稍差。</li><li><strong>R1（RunC）</strong>：若内核/环境满足条件，性能接近原生 Docker。</li></ul><p>查看当前模式：</p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">udocker</span><span style="color:#B56959;--shiki-dark:#C98A7D"> setup</span><span style="color:#A65E2B;--shiki-dark:#C99076"> --execmode</span><span style="color:#B56959;--shiki-dark:#C98A7D"> my_experiment</span></span></code></pre><p>切换为某个模式（示例：F3）：</p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">udocker</span><span style="color:#B56959;--shiki-dark:#C98A7D"> setup</span><span style="color:#A65E2B;--shiki-dark:#C99076"> --execmode=F3</span><span style="color:#B56959;--shiki-dark:#C98A7D"> my_experiment</span></span></code></pre><h2 id="4-常见问题与局限"><a class="anchor" href="#4-常见问题与局限">#</a> 4. 常见问题与局限</h2><h3 id="41-端口映射"><a class="anchor" href="#41-端口映射">#</a> 4.1 端口映射</h3><p>udocker 默认使用宿主机网络栈（Host Mode）。因此通常不能像 Docker 那样用 <code>-p 8080:80</code> 做 NAT 端口转发。</p><ul><li>如果容器内服务监听 <code>8000</code>，它往往就是在宿主机的 <code>8000</code> 上监听。</li></ul><h3 id="42-安全性"><a class="anchor" href="#42-安全性">#</a> 4.2 安全性</h3><p>udocker 的目标偏向“可用性”，而不是强隔离。不要在容器里运行不可信/恶意代码，因为它可能影响当前用户可访问的文件（例如你的 <code>HOME</code> 目录）。</p><h3 id="43-清理与空间占用"><a class="anchor" href="#43-清理与空间占用">#</a> 4.3 清理与空间占用</h3><p>容器文件默认存储在 <code>~/.udocker/containers</code> 下，不用的容器/镜像建议定期清理：</p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># 删除容器</span></span><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">udocker</span><span style="color:#B56959;--shiki-dark:#C98A7D"> rm</span><span style="color:#B56959;--shiki-dark:#C98A7D"> my_experiment</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># 删除镜像（按实际 tag 替换）</span></span><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">udocker</span><span style="color:#B56959;--shiki-dark:#C98A7D"> rmi</span><span style="color:#B56959;--shiki-dark:#C98A7D"> pytorch/pytorch:xxxx</span></span></code></pre><h2 id="总结"><a class="anchor" href="#总结">#</a> 总结</h2><p>在受限的服务器或 HPC 环境下，udocker 可以在<strong>无需 root 权限</strong>的前提下运行容器化环境，适合解决“在别人的机器上跑我的环境”这一类问题。</p><p>如果你在集群上装不上 Docker，又想复用 Docker Hub 上现成镜像，可以优先试试 udocker。</p>]]></content>
    
    
    <summary type="html">本文讲解 udocker，让你在没有虚拟环境的机子上跑镜像，解决实验室服务器无 root 权限无法安装 Docker 的痛点。</summary>
    
    
    
    <category term="docker" scheme="https://koen666.github.io/categories/docker/"/>
    
    
    <category term="docker" scheme="https://koen666.github.io/tags/docker/"/>
    
    <category term="images" scheme="https://koen666.github.io/tags/images/"/>
    
    <category term="hpc" scheme="https://koen666.github.io/tags/hpc/"/>
    
    <category term="tutorial" scheme="https://koen666.github.io/tags/tutorial/"/>
    
  </entry>
  
  <entry>
    <title>五种多agent编排方式</title>
    <link href="https://koen666.github.io/2025/12/02/%E5%A4%9A%E6%99%BA%E8%83%BD%E4%BD%93%E7%BC%96%E6%8E%92/"/>
    <id>https://koen666.github.io/2025/12/02/%E5%A4%9A%E6%99%BA%E8%83%BD%E4%BD%93%E7%BC%96%E6%8E%92/</id>
    <published>2025-12-01T16:00:00.000Z</published>
    <updated>2025-12-22T15:32:01.194Z</updated>
    
    <content type="html"><![CDATA[<h1 id="五种多agent编排方式详解"><a class="anchor" href="#五种多agent编排方式详解">#</a> 五种多Agent编排方式详解</h1><blockquote><p><strong>摘要</strong>：随着 AI 应用从单体 LLM 向多智能体（Multi-Agent）协作演进，如何高效协调这些智能体成为关键。本文深入浅出地介绍业界最主流的五种多Agent编排模式及其应用场景。</p></blockquote><h2 id="一-顺序编排-the-chain-sequential"><a class="anchor" href="#一-顺序编排-the-chain-sequential">#</a> 一、 顺序编排 (The Chain / Sequential)</h2><p>这是最直观、最基础的协作方式，常被称为“流水线模式”。</p><h3 id="核心逻辑"><a class="anchor" href="#核心逻辑">#</a> 核心逻辑</h3><p>就像现代工厂的装配流水线，任务沿着预定义好的路径单向流动。前一个智能体完成工作后的输出，直接作为下一个智能体的输入。各个环节环环相扣，依赖关系明确。</p><p>其工作流可以简单表示为：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>Input</mtext><mo>→</mo><mtext>Agent A</mtext><mo>→</mo><mtext>Agent B</mtext><mo>→</mo><mtext>Agent C</mtext><mo>→</mo><mtext>Output</mtext></mrow><annotation encoding="application/x-tex">\text{Input} \rightarrow \text{Agent A} \rightarrow \text{Agent B} \rightarrow \text{Agent C} \rightarrow \text{Output}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord text"><span class="mord">Input</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord text"><span class="mord">Agent A</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord text"><span class="mord">Agent B</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord text"><span class="mord">Agent C</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord text"><span class="mord">Output</span></span></span></span></span></span></p><h3 id="适用场景"><a class="anchor" href="#适用场景">#</a> 适用场景</h3><p>非常适用于步骤固定、确定性强、不需要回头修改的标准作业流程（SOP），例如数据处理管道或审批流程。</p><h3 id="实战案例自动化公众号文章生成器"><a class="anchor" href="#实战案例自动化公众号文章生成器">#</a> 实战案例：自动化公众号文章生成器</h3><p><strong>场景目标</strong>：建立一条自动化流水线，将用户提供的英文科技新闻链接，全自动转换为一篇符合中文阅读习惯、风格活泼的公众号推文。</p><p><strong>流程拆解</strong>：</p><ol><li><strong>输入层</strong>：用户提供一个目标文章的 URL 链接。</li><li><strong>第一环：信息获取（Agent A - 爬虫员）</strong></li></ol><ul><li><em>任务</em>：访问 URL，智能提取网页核心正文内容，清洗掉导航栏、广告和多余的 HTML 标签。</li><li>➡️ <em>交付成果</em>：纯净的英文文本素材。</li></ul><ol start="3"><li><strong>第二环：内容翻译（Agent B - 翻译员）</strong></li></ol><ul><li><em>任务</em>：接收英文素材，结合上下文将其翻译成流畅、准确的中文草稿。</li><li>➡️ <em>交付成果</em>：中文文章草稿。</li></ul><ol start="4"><li><strong>第三环：风格润色（Agent C - 编辑员）</strong></li></ol><ul><li><em>任务</em>：根据预设的公众号人设，对草稿进行二次加工：优化分段结构、加入符合语境的表情包、起一个吸引点击的标题。</li><li>➡️ <em>最终输出</em>：一篇可直接发布的成品推文。</li></ul><h3 id="模式特点"><a class="anchor" href="#模式特点">#</a> 模式特点</h3><ul><li><strong>优点</strong>：结构简单清晰，易于构建、理解和调试。</li><li><strong>缺点</strong>：鲁棒性较差。由于路径是单一线性的，存在严重的级联效应。如果源头的 Agent A 抓取内容失败或产生幻觉，后续所有环节都会基于错误信息进行加工，导致整个流程失败（Garbage in, garbage out）。</li></ul><hr><h2 id="二-并行编排-mapreduce"><a class="anchor" href="#二-并行编排-mapreduce">#</a> 二、 并行编排 (MapReduce)</h2><p>这种模式借鉴了分布式计算的思想，核心目的是“分而治之”，通过并行化突破单点能力或窗口限制。</p><h3 id="核心逻辑-2"><a class="anchor" href="#核心逻辑-2">#</a> 核心逻辑</h3><p>将一个巨大的复杂任务拆解为多个相互独立的子任务，分发给多个 Agent 并行处理（Map），最后将所有结果汇总整合（Reduce）。</p><p>其工作流可以简单表示为：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>Input</mtext><mover><mo stretchy="true" minsize="3.0em">→</mo><mpadded width="+0.6em" lspace="0.3em"><mtext>Split</mtext></mpadded></mover><mo stretchy="false">{</mo><msub><mi>d</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>d</mi><mn>2</mn></msub><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo stretchy="false">}</mo><mover><mo stretchy="true" minsize="3.0em">→</mo><mpadded width="+0.6em" lspace="0.3em"><mtext>Map</mtext></mpadded></mover><mo stretchy="false">{</mo><msub><mi>r</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>r</mi><mn>2</mn></msub><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo stretchy="false">}</mo><mover><mo stretchy="true" minsize="3.0em">→</mo><mpadded width="+0.6em" lspace="0.3em"><mtext>Reduce</mtext></mpadded></mover><mtext>Output</mtext></mrow><annotation encoding="application/x-tex">\text{Input} \xrightarrow{\text{Split}} \{d_1, d_2, ...\} \xrightarrow{\text{Map}} \{r_1, r_2, ...\} \xrightarrow{\text{Reduce}} \text{Output}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.3025em;vertical-align:-0.1944em;"></span><span class="mord text"><span class="mord">Input</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel x-arrow"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1081em;"><span style="top:-3.322em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight x-arrow-pad"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">Split</span></span></span></span></span><span class="svg-align" style="top:-2.689em;"><span class="pstrut" style="height:2.7em;"></span><span class="hide-tail" style="height:0.522em;min-width:1.469em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="0.522em" viewBox="0 0 400000 522" preserveAspectRatio="xMaxYMin slice"><path d="M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67 151.7 139 205zm0 0v40h399900v-40z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.011em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.3503em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">...</span><span class="mclose">}</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel x-arrow"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1003em;"><span style="top:-3.322em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight x-arrow-pad"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">Map</span></span></span></span></span><span class="svg-align" style="top:-2.689em;"><span class="pstrut" style="height:2.7em;"></span><span class="hide-tail" style="height:0.522em;min-width:1.469em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="0.522em" viewBox="0 0 400000 522" preserveAspectRatio="xMaxYMin slice"><path d="M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67 151.7 139 205zm0 0v40h399900v-40z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.011em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.3581em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">...</span><span class="mclose">}</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel x-arrow"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1081em;"><span style="top:-3.322em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight x-arrow-pad"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">Reduce</span></span></span></span></span><span class="svg-align" style="top:-2.689em;"><span class="pstrut" style="height:2.7em;"></span><span class="hide-tail" style="height:0.522em;min-width:1.469em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="0.522em" viewBox="0 0 400000 522" preserveAspectRatio="xMaxYMin slice"><path d="M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67 151.7 139 205zm0 0v40h399900v-40z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.011em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord text"><span class="mord">Output</span></span></span></span></span></span></p><h3 id="适用场景-2"><a class="anchor" href="#适用场景-2">#</a> 适用场景</h3><p>适用于需要处理的数据量巨大或文本超长（如整本书籍、长达数小时的会议记录、海量日志），且被切分的子任务之间相互独立、互不干扰的场景。</p><h3 id="实战案例万字用户反馈分析"><a class="anchor" href="#实战案例万字用户反馈分析">#</a> 实战案例：万字用户反馈分析</h3><p><strong>场景目标</strong>：作为产品经理，面对突然涌入的 10,000 条用户 Excel 评论，需要快速找出核心槽点，单次输入 LLM 会超出 Token 限制。</p><p><strong>流程拆解</strong>：</p><ol><li><strong>输入层</strong>：一个包含 1 万条用户评论的 Excel 文件。</li><li><strong>预处理环：切分（Splitting）</strong></li></ol><ul><li><em>任务</em>：系统将巨大的文件切分成 20 个小片段，每个片段包含 500 条评论。</li><li>➡️ <em>交付成果</em>：20 个独立的数据块。</li></ul><ol start="3"><li><strong>Map 阶段：并行分析（Agent A 组 - 分析员 x 20）</strong></li></ol><ul><li><em>任务</em>：并发启动 20 个相同能力的分析 Agent，每个 Agent 只负责阅读分配给它的 500 条评论，并总结出该片段中的“Top 3 问题”。</li><li>➡️ <em>交付成果</em>：20 份独立的局部总结报告。</li></ul><ol start="4"><li><strong>Reduce 阶段：全局汇总（Agent B - 汇总员）</strong></li></ol><ul><li><em>任务</em>：接收这 20 份局部报告，进行去重、合并同类项和统计分析。</li><li>➡️ <em>最终输出</em>：一份全局核心问题报告（例如：“核心槽点：1.登录失败(占比 60%); 2.UI 交互差(占比 20%)”）。</li></ul><h3 id="模式特点-2"><a class="anchor" href="#模式特点-2">#</a> 模式特点</h3><ul><li><strong>优点</strong>：极大提升效率，有效突破 LLM 的上下文窗口（Context Window）限制。</li><li><strong>缺点</strong>：信息割裂。在 Map 阶段，各 Agent 之间互不沟通，如果文档前后有强逻辑关联（如小说情节），切分后可能会丢失上下文线索。</li></ul><hr><h2 id="三-共识编排-consensus-voting"><a class="anchor" href="#三-共识编排-consensus-voting">#</a> 三、 共识编排 (Consensus / Voting)</h2><p>这种模式类似于“专家会诊”或“模型集成”，利用多个不同视角或设定的 Agent 来解决同一个问题。</p><h3 id="核心逻辑-3"><a class="anchor" href="#核心逻辑-3">#</a> 核心逻辑</h3><p>通过让多个 Agent 独立生成结果，然后引入一个“投票机制”或“法官 Agent”来裁决，从而过滤掉个体的幻觉和偏见，通过群体智慧提升准确度。</p><p>其工作流可以简单表示为：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mrow><mo fence="true">{</mo><mtable rowspacing="0.36em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mtext>Agent A</mtext><mo>→</mo><mtext>Result A</mtext></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mtext>Agent B</mtext><mo>→</mo><mtext>Result B</mtext></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mtext>Agent C</mtext><mo>→</mo><mtext>Result C</mtext></mrow></mstyle></mtd></mtr></mtable></mrow><mover><mo stretchy="true" minsize="3.0em">→</mo><mpadded width="+0.6em" lspace="0.3em"><mtext>Judge/Vote</mtext></mpadded></mover><mtext>Final Output</mtext></mrow><annotation encoding="application/x-tex">\begin{cases} \text{Agent A} \rightarrow \text{Result A} \\ \text{Agent B} \rightarrow \text{Result B} \\ \text{Agent C} \rightarrow \text{Result C} \end{cases} \xrightarrow{\text{Judge/Vote}} \text{Final Output}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:4.32em;vertical-align:-1.91em;"></span><span class="minner"><span class="mopen"><span class="delimsizing mult"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.35em;"><span style="top:-2.2em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎩</span></span></span><span style="top:-2.192em;"><span class="pstrut" style="height:3.15em;"></span><span style="height:0.316em;width:0.8889em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.8889em" height="0.316em" style="width:0.8889em" viewBox="0 0 888.89 316" preserveAspectRatio="xMinYMin"><path d="M384 0 H504 V316 H384z M384 0 H504 V316 H384z"></path></svg></span></span><span style="top:-3.15em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎨</span></span></span><span style="top:-4.292em;"><span class="pstrut" style="height:3.15em;"></span><span style="height:0.316em;width:0.8889em;"><svg xmlns="http://www.w3.org/2000/svg" width="0.8889em" height="0.316em" style="width:0.8889em" viewBox="0 0 888.89 316" preserveAspectRatio="xMinYMin"><path d="M384 0 H504 V316 H384z M384 0 H504 V316 H384z"></path></svg></span></span><span style="top:-4.6em;"><span class="pstrut" style="height:3.15em;"></span><span class="delimsizinginner delim-size4"><span>⎧</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.85em;"><span></span></span></span></span></span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.41em;"><span style="top:-4.41em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord text"><span class="mord">Agent A</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord text"><span class="mord">Result A</span></span></span></span><span style="top:-2.97em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord text"><span class="mord">Agent B</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord text"><span class="mord">Result B</span></span></span></span><span style="top:-1.53em;"><span class="pstrut" style="height:3.008em;"></span><span class="mord"><span class="mord text"><span class="mord">Agent C</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mord text"><span class="mord">Result C</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.91em;"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel x-arrow"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.147em;"><span style="top:-3.322em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight x-arrow-pad"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">Judge/Vote</span></span></span></span></span><span class="svg-align" style="top:-2.689em;"><span class="pstrut" style="height:2.7em;"></span><span class="hide-tail" style="height:0.522em;min-width:1.469em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="0.522em" viewBox="0 0 400000 522" preserveAspectRatio="xMaxYMin slice"><path d="M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67 151.7 139 205zm0 0v40h399900v-40z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.011em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord text"><span class="mord">Final Output</span></span></span></span></span></span></p><h3 id="适用场景-3"><a class="anchor" href="#适用场景-3">#</a> 适用场景</h3><p>适用于高风险决策、需要极高准确率、容错率低，或者容易产生幻觉的复杂判断场景（如医疗建议、金融风控、法律咨询）。</p><h3 id="实战案例股票投资顾问"><a class="anchor" href="#实战案例股票投资顾问">#</a> 实战案例：股票投资顾问</h3><p><strong>场景目标</strong>：用户询问是否应该买入某只波动剧烈的股票，系统需要给出全面且审慎的投资建议。</p><p><strong>流程拆解</strong>：</p><ol><li><strong>输入层</strong>：用户询问“我现在是否应该买入特斯拉股票？”</li><li><strong>并行生成环：多视角分析</strong></li></ol><ul><li><strong>Agent A (激进派技术分析师)</strong>：侧重分析 K 线图和 RSI 指标。➡️ <em>输出</em>：“买入，技术指标显示超卖。”</li><li><strong>Agent B (保守派宏观分析师)</strong>：侧重分析美联储政策和市场情绪。➡️ <em>输出</em>：“卖出，宏观环境风险极高。”</li><li><strong>Agent C (基本面分析师)</strong>：侧重分析财报和现金流。➡️ <em>输出</em>：“持有，估值合理但缺乏短期爆发力。”</li></ul><ol start="3"><li><strong>裁决环：综合决策（Agent D - 主裁决官）</strong></li></ol><ul><li><em>任务</em>：阅读并理解上述三种截然不同的观点及其论据，进行加权分析和权衡。</li><li>➡️ <em>最终输出</em>：一份综合建议报告（例如：“尽管技术面有反弹迹象，但考虑到宏观风险尚未释放，建议暂时观望（持有），不要大举加仓”）。</li></ul><h3 id="模式特点-3"><a class="anchor" href="#模式特点-3">#</a> 模式特点</h3><ul><li><strong>优点</strong>：高可靠性。通过引入“反对意见”和多样性视角，有效避免单一模型的盲目自信。</li><li><strong>缺点</strong>：成本高昂。需要多次调用模型，响应速度较慢，不适合实时对话场景。</li></ul><hr><h2 id="四-分层编排-hierarchical-supervisor"><a class="anchor" href="#四-分层编排-hierarchical-supervisor">#</a> 四、 分层编排 (Hierarchical / Supervisor)</h2><p>这是目前最接近人类公司组织架构的模式，包含动态路由和状态管理。</p><h3 id="核心逻辑-4"><a class="anchor" href="#核心逻辑-4">#</a> 核心逻辑</h3><p>引入一个“主管（Supervisor）”Agent，它不直接干活，而是负责理解意图、拆解任务、分发给 Worker Agent，并根据 Worker 的反馈动态决定下一步操作。这是一个有状态的循环图结构。</p><p>其工作流可以简单表示为：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>Supervisor</mtext><mo>⇆</mo><mo stretchy="false">{</mo><mtext>Worker A</mtext><mo separator="true">,</mo><mtext>Worker B</mtext><mo separator="true">,</mo><mtext>Worker C</mtext><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\text{Supervisor} \leftrightarrows \{ \text{Worker A}, \text{Worker B}, \text{Worker C} \}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord text"><span class="mord">Supervisor</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel amsrm">⇆</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord text"><span class="mord">Worker A</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord text"><span class="mord">Worker B</span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord text"><span class="mord">Worker C</span></span><span class="mclose">}</span></span></span></span></span></p><h3 id="适用场景-4"><a class="anchor" href="#适用场景-4">#</a> 适用场景</h3><p>适用于任务复杂庞大、执行步骤不确定、需要根据中间步骤的结果动态调整后续计划的场景（如复杂的助理任务、软件开发）。</p><h3 id="实战案例智能旅行行程规划"><a class="anchor" href="#实战案例智能旅行行程规划">#</a> 实战案例：智能旅行行程规划</h3><p><strong>场景目标</strong>：用户提出一个模糊且复杂的旅行需求，涉及机票、酒店、餐厅，且任务间存在强依赖关系（订不到房就不能订餐厅）。</p><p><strong>流程拆解</strong>：</p><ol><li><strong>输入层</strong>：用户需求“帮我订去东京的行程，要在富士山下住一晚，还要订个当地的米其林餐厅。”</li><li><strong>规划环：Supervisor（总管）介入</strong></li></ol><ul><li><em>任务</em>：总管分析需求，识别出需要调用航班、酒店、餐厅三个专业 Agent。它首先规划第一步：调用航班 Agent。</li></ul><ol start="3"><li><strong>执行环 1：航班预订（Worker A）</strong></li></ol><ul><li><em>反馈</em>：向总管汇报“已查询到 X 月 X 日的航班并锁定”。</li></ul><ol start="4"><li><strong>执行环 2：酒店预订（Worker B）</strong></li></ol><ul><li><em>反馈</em>：向总管汇报“失败，指定日期的富士山酒店已满房”。</li></ul><ol start="5"><li><strong>动态调整环：Supervisor 重规划</strong></li></ol><ul><li><em>任务</em>：接收到失败反馈，总管意识到原计划不可行。它不会报错退出，而是动态指令航班 Agent“改查下周的票”，随后再次尝试预定酒店。</li><li>➡️ <em>最终输出</em>：经过多轮动态调整，向用户输出一份完整的、闭环的行程单。</li></ul><h3 id="模式特点-4"><a class="anchor" href="#模式特点-4">#</a> 模式特点</h3><ul><li><strong>优点</strong>：极强的灵活性。只有 Supervisor 拥有全局视野和状态记忆，能够处理异常情况和复杂的依赖逻辑。</li><li><strong>缺点</strong>：单点瓶颈。系统的表现高度依赖 Supervisor 的推理能力，如果主管分配错误，可能导致死循环。</li></ul><hr><h2 id="五-制作者-检查者编排-producer-reviewer-reflexion"><a class="anchor" href="#五-制作者-检查者编排-producer-reviewer-reflexion">#</a> 五、 制作者-检查者编排 (Producer-Reviewer / Reflexion)</h2><p>这种模式建立了内容生成与质量控制的闭环反馈机制，是提升 LLM 输出质量性价比最高的方式。</p><h3 id="核心逻辑-5"><a class="anchor" href="#核心逻辑-5">#</a> 核心逻辑</h3><p>包含一个生成-评估的迭代循环。制作者负责生成内容，检查者负责挑刺和提建议。如果质量不达标，则将修改意见回传给制作者重写，直到满足条件。</p><p>其工作流可以简单表示为：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>Generate</mtext><mover><mo stretchy="true" minsize="3.0em">→</mo><mpadded width="+0.6em" lspace="0.3em"><mtext>Draft</mtext></mpadded></mover><mtext>Critique</mtext><mover><mo stretchy="true" minsize="3.0em">→</mo><mpadded width="+0.6em" lspace="0.3em"><mtext>Feedback</mtext></mpadded></mover><mtext>Refine</mtext><mover><mo stretchy="true" minsize="3.0em">→</mo><mpadded width="+0.6em" lspace="0.3em"><mtext>Loop...</mtext></mpadded></mover><mtext>Final Output</mtext></mrow><annotation encoding="application/x-tex">\text{Generate} \xrightarrow{\text{Draft}} \text{Critique} \xrightarrow{\text{Feedback}} \text{Refine} \xrightarrow{\text{Loop...}} \text{Final Output}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1191em;vertical-align:-0.011em;"></span><span class="mord text"><span class="mord">Generate</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel x-arrow"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1081em;"><span style="top:-3.322em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight x-arrow-pad"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">Draft</span></span></span></span></span><span class="svg-align" style="top:-2.689em;"><span class="pstrut" style="height:2.7em;"></span><span class="hide-tail" style="height:0.522em;min-width:1.469em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="0.522em" viewBox="0 0 400000 522" preserveAspectRatio="xMaxYMin slice"><path d="M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67 151.7 139 205zm0 0v40h399900v-40z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.011em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.3025em;vertical-align:-0.1944em;"></span><span class="mord text"><span class="mord">Critique</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel x-arrow"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1081em;"><span style="top:-3.322em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight x-arrow-pad"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">Feedback</span></span></span></span></span><span class="svg-align" style="top:-2.689em;"><span class="pstrut" style="height:2.7em;"></span><span class="hide-tail" style="height:0.522em;min-width:1.469em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="0.522em" viewBox="0 0 400000 522" preserveAspectRatio="xMaxYMin slice"><path d="M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67 151.7 139 205zm0 0v40h399900v-40z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.011em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1113em;vertical-align:-0.011em;"></span><span class="mord text"><span class="mord">Refine</span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel x-arrow"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.1003em;"><span style="top:-3.322em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight x-arrow-pad"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">Loop...</span></span></span></span></span><span class="svg-align" style="top:-2.689em;"><span class="pstrut" style="height:2.7em;"></span><span class="hide-tail" style="height:0.522em;min-width:1.469em;"><svg xmlns="http://www.w3.org/2000/svg" width="400em" height="0.522em" viewBox="0 0 400000 522" preserveAspectRatio="xMaxYMin slice"><path d="M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67 151.7 139 205zm0 0v40h399900v-40z"></path></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.011em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord text"><span class="mord">Final Output</span></span></span></span></span></span></p><h3 id="适用场景-5"><a class="anchor" href="#适用场景-5">#</a> 适用场景</h3><p>适用于对输出质量要求极高的场景，如代码生成（Coding）、数学解题、长篇小说创作或法律文书撰写。</p><h3 id="实战案例python-代码生成助手"><a class="anchor" href="#实战案例python-代码生成助手">#</a> 实战案例：Python 代码生成助手</h3><p><strong>场景目标</strong>：用户要求写一个贪吃蛇游戏的代码，一次性生成的代码往往无法直接运行。</p><p><strong>流程拆解</strong>：</p><ol><li><strong>输入层</strong>：用户需求“写一个 Python 贪吃蛇游戏”。</li><li><strong>第一环：生成（Agent A - 程序员）</strong></li></ol><ul><li><em>任务</em>：编写初始代码。➡️ <em>交付成果</em>：代码版本 V1。</li></ul><ol start="3"><li><strong>第二环：评估（Agent B - 测试员/编译器）</strong></li></ol><ul><li><em>任务</em>：模拟运行代码，进行静态分析或执行测试。</li><li>➡️ <em>反馈意见</em>：发现第 30 行存在索引越界错误，且蛇撞墙后游戏未结束。</li></ul><ol start="4"><li><strong>第三环：修正（Agent A - 程序员）</strong></li></ol><ul><li><em>任务</em>：读取测试员的反馈，针对性地修复 Bug。➡️ <em>交付成果</em>：代码版本 V2。</li></ul><ol start="5"><li><strong>循环终止</strong>：再次测试通过，或达到最大重试次数。</li></ol><ul><li>➡️ <em>最终输出</em>：一段无 Bug、可运行的贪吃蛇代码。</li></ul><h3 id="模式特点-5"><a class="anchor" href="#模式特点-5">#</a> 模式特点</h3><ul><li><strong>优点</strong>：自我修正。通过迭代反馈机制，让模型有机会“审视”自己的错误，显著提升最终产出的可用性。</li><li><strong>缺点</strong>：可能陷入死循环。如果制作者能力太差，怎么改都达不到检查者的标准，系统会无限运行。通常需要设置最大迭代次数（Max Iterations）。</li></ul>]]></content>
    
    
    <summary type="html">本文介绍五种最常见的多agent编排方式</summary>
    
    
    
    <category term="agent" scheme="https://koen666.github.io/categories/agent/"/>
    
    
    <category term="agent" scheme="https://koen666.github.io/tags/agent/"/>
    
  </entry>
  
  <entry>
    <title>像前端package.json那样管理python依赖 (uv篇)</title>
    <link href="https://koen666.github.io/2025/11/28/pipenv/"/>
    <id>https://koen666.github.io/2025/11/28/pipenv/</id>
    <published>2025-11-27T16:00:00.000Z</published>
    <updated>2025-11-28T01:12:17.059Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p><strong>Update 2025:</strong> 时代变了。虽然 Pipenv 曾经是很好的选择，但现在由 Rust 编写的 <code>uv</code> 才是版本答案。它比 pip 快 10-100 倍，且完美支持 <code>pyproject.toml</code> 标准。</p></blockquote><h3 id="1-安装-uv-the-new-standard"><a class="anchor" href="#1-安装-uv-the-new-standard">#</a> 1. 安装 uv (The New Standard)</h3><p>不需要先装 Python，uv甚至可以帮你管理 Python 版本。</p><p><strong>Mac / Linux:</strong></p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">curl</span><span style="color:#A65E2B;--shiki-dark:#C99076"> -LsSf</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> </span><span style="color:#2993a3;--shiki-dark:#5eaab5">[</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">https://astral.sh/uv/install.sh</span><span style="color:#2993a3;--shiki-dark:#5eaab5">]</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#59873A;--shiki-dark:#80A665">https://astral.sh/uv/install.sh</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> </span><span style="color:#AB5959;--shiki-dark:#CB7676">|</span><span style="color:#59873A;--shiki-dark:#80A665"> sh</span></span></code></pre><p><strong>Windows (PowerShell):</strong></p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-powershell"><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">powershell </span><span style="color:#999999;--shiki-dark:#666666">-</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">c </span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">irm [https://astral.sh/uv/install.ps1](https://astral.sh/uv/install.ps1) | iex</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span></span></code></pre><h3 id="2-初始化项目-npm-init"><a class="anchor" href="#2-初始化项目-npm-init">#</a> 2. 初始化项目 (npm init)</h3><p>进入你的项目目录，执行初始化：</p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">uv</span><span style="color:#B56959;--shiki-dark:#C98A7D"> init</span></span></code></pre><p>或者创建一个新项目：</p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">uv</span><span style="color:#B56959;--shiki-dark:#C98A7D"> init</span><span style="color:#B56959;--shiki-dark:#C98A7D"> my-project</span></span></code></pre><p>你的目录下会出现两个核心文件，完美对应前端习惯：</p><ul><li><strong><code>pyproject.toml</code></strong> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≈</mo></mrow><annotation encoding="application/x-tex">\approx</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4831em;"></span><span class="mrel">≈</span></span></span></span>  <code>package.json</code> (定义项目元数据和依赖)</li><li><strong><code>uv.lock</code></strong> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≈</mo></mrow><annotation encoding="application/x-tex">\approx</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4831em;"></span><span class="mrel">≈</span></span></span></span>  <code>package-lock.json</code> (锁定依赖具体版本)</li></ul><h3 id="3-安装依赖-npm-install-xxx"><a class="anchor" href="#3-安装依赖-npm-install-xxx">#</a> 3. 安装依赖 (npm install xxx)</h3><p>告别 <code>pip install</code>，现在我们用 <code>add</code>。</p><p><strong>安装普通依赖：</strong></p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">uv</span><span style="color:#B56959;--shiki-dark:#C98A7D"> add</span><span style="color:#B56959;--shiki-dark:#C98A7D"> requests</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># 甚至可以指定版本</span></span><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">uv</span><span style="color:#B56959;--shiki-dark:#C98A7D"> add</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">flask&gt;=2.0</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span></span></code></pre><p><strong>安装开发依赖 (DevDependencies):</strong></p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">uv</span><span style="color:#B56959;--shiki-dark:#C98A7D"> add</span><span style="color:#A65E2B;--shiki-dark:#C99076"> --dev</span><span style="color:#B56959;--shiki-dark:#C98A7D"> pytest</span></span></code></pre><h3 id="4-迁移旧项目-requirementstxt"><a class="anchor" href="#4-迁移旧项目-requirementstxt">#</a> 4. 迁移旧项目 (requirements.txt)</h3><p>如果你有一个老的 <code>requirements.txt</code>，不需要像以前那样用 PowerShell 转码了，<code>uv</code> 对编码支持很好，直接读取并添加到 <code>pyproject.toml</code> 中：</p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">uv</span><span style="color:#B56959;--shiki-dark:#C98A7D"> add</span><span style="color:#A65E2B;--shiki-dark:#C99076"> -r</span><span style="color:#B56959;--shiki-dark:#C98A7D"> requirements.txt</span></span></code></pre><p>执行完这一步，你的旧项目就瞬间完成了“现代化”改造。</p><h3 id="5-一键同步环境-npm-install"><a class="anchor" href="#5-一键同步环境-npm-install">#</a> 5. 一键同步环境 (npm install)</h3><p>当你把代码 clone 下来，或者拉取了队友的代码后，只需要一个命令就能把所有依赖（包括 Python 解释器本身）全部装好：</p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">uv</span><span style="color:#B56959;--shiki-dark:#C98A7D"> sync</span></span></code></pre><p>它会自动创建虚拟环境（默认在 <code>.venv</code>），你无需手动配置。</p><h3 id="6-运行代码-npm-run-start"><a class="anchor" href="#6-运行代码-npm-run-start">#</a> 6. 运行代码 (npm run start)</h3><p>不需要手动激活虚拟环境（<code>source venv/bin/activate</code> 已经是过去式了），直接用 <code>uv run</code>：</p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># 运行脚本</span></span><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">uv</span><span style="color:#B56959;--shiki-dark:#C98A7D"> run</span><span style="color:#B56959;--shiki-dark:#C98A7D"> app.py</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># 运行模块</span></span><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">uv</span><span style="color:#B56959;--shiki-dark:#C98A7D"> run</span><span style="color:#B56959;--shiki-dark:#C98A7D"> python</span><span style="color:#A65E2B;--shiki-dark:#C99076"> -m</span><span style="color:#B56959;--shiki-dark:#C98A7D"> http.server</span></span></code></pre><p>uv 会自动检测并使用项目环境中的 Python。</p><hr><h3 id="总结前端-vs-python-uv版-对照表"><a class="anchor" href="#总结前端-vs-python-uv版-对照表">#</a> 总结：前端 vs Python (uv版) 对照表</h3><table><thead><tr><th style="text-align:left">前端 (Node/NPM)</th><th style="text-align:left">Python (uv)</th><th style="text-align:left">说明</th></tr></thead><tbody><tr><td style="text-align:left"><code>package.json</code></td><td style="text-align:left"><code>pyproject.toml</code></td><td style="text-align:left">项目配置文件</td></tr><tr><td style="text-align:left"><code>package-lock.json</code></td><td style="text-align:left"><code>uv.lock</code></td><td style="text-align:left">版本锁定文件</td></tr><tr><td style="text-align:left"><code>npm init</code></td><td style="text-align:left"><code>uv init</code></td><td style="text-align:left">初始化</td></tr><tr><td style="text-align:left"><code>npm install axios</code></td><td style="text-align:left"><code>uv add requests</code></td><td style="text-align:left">安装依赖</td></tr><tr><td style="text-align:left"><code>npm install</code></td><td style="text-align:left"><code>uv sync</code></td><td style="text-align:left"><strong>一键安装所有依赖</strong></td></tr><tr><td style="text-align:left"><code>npm run start</code></td><td style="text-align:left"><code>uv run app.py</code></td><td style="text-align:left">使用环境运行</td></tr><tr><td style="text-align:left"><code>nvm use 18</code></td><td style="text-align:left"><code>uv python pin 3.12</code></td><td style="text-align:left"><strong>管理语言版本</strong></td></tr></tbody></table>]]></content>
    
    
    <summary type="html">抛弃慢吞吞的Pipenv，用Rust编写的uv让Python项目管理快到飞起，完美对标前端开发体验。</summary>
    
    
    
    <category term="code" scheme="https://koen666.github.io/categories/code/"/>
    
    
    <category term="python" scheme="https://koen666.github.io/tags/python/"/>
    
    <category term="uv" scheme="https://koen666.github.io/tags/uv/"/>
    
    <category term="environment" scheme="https://koen666.github.io/tags/environment/"/>
    
  </entry>
  
  <entry>
    <title>GA遗传算法</title>
    <link href="https://koen666.github.io/2025/11/23/GA/"/>
    <id>https://koen666.github.io/2025/11/23/GA/</id>
    <published>2025-11-23T02:58:59.514Z</published>
    <updated>2025-11-23T03:35:03.910Z</updated>
    
    <content type="html"><![CDATA[<h1 id="遗传算法ga"><a class="anchor" href="#遗传算法ga">#</a> 遗传算法（GA）</h1><p>遗传算法如今已经发展出来了很多家族</p><h2 id="一简介"><a class="anchor" href="#一简介">#</a> 一.简介</h2><p>遗传算法大致可以分为 <strong>单目标 GA、多目标 GA、改进型 GA、特殊结构 GA</strong> 四类。</p><h3 id="1-单目标-ga基础"><a class="anchor" href="#1-单目标-ga基础">#</a> 1. <strong>单目标 GA（基础）</strong></h3><p>最普通的，用来优化一个函数。</p><p>代表算法：</p><table><thead><tr><th>算法名称</th><th>简介</th></tr></thead><tbody><tr><td><strong>Basic GA（经典遗传算法）</strong></td><td>最普通的版本，用选择+交叉+变异进行进化</td></tr><tr><td><strong>Real-coded GA（实数编码 GA）</strong></td><td>个体不是二进制，而是连续变量（更适合工程优化）</td></tr><tr><td><strong>微分进化 DE（Differential Evolution）</strong></td><td>本质是遗传算法的变种，性能很强，进化方式是“差分变异”</td></tr></tbody></table><h3 id="2-多目标遗传算法moea"><a class="anchor" href="#2-多目标遗传算法moea">#</a> 2. <strong>多目标遗传算法（MOEA）</strong></h3><p>多目标问题不是一个目标，而是多个：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>min</mi><mo>⁡</mo><mo stretchy="false">(</mo><msub><mi>f</mi><mn>1</mn></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><msub><mi>f</mi><mn>2</mn></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><mo>…</mo><mo separator="true">,</mo><msub><mi>f</mi><mi>k</mi></msub><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\min (f_1(x), f_2(x), \dots, f_k(x))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">min</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">…</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.1076em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">))</span></span></span></span></span></p><p>比如：</p><ul><li>减少温度</li><li>增加效率</li><li>降低成本</li></ul><p>这些目标互相冲突，所以一个“最优解”不存在，只能得到 <strong>一条帕累托前沿（Pareto Front）</strong>。</p><p>代表算法：</p><table><thead><tr><th>算法</th><th>特点</th><th>是否常用</th></tr></thead><tbody><tr><td><strong>NSGA-II（最经典）</strong></td><td>用“非支配排序 + 拥挤距离”来进化</td><td>✔✔✔ 超常用</td></tr><tr><td><strong>NSGA-III</strong></td><td>适用于高维多目标（10个目标以上）</td><td>✔✔</td></tr><tr><td><strong>SPEA2</strong></td><td>强度值 + 密度估计</td><td>✔</td></tr><tr><td><strong>MOEA/D</strong></td><td>把多目标拆成多个单目标子问题</td><td>✔✔</td></tr></tbody></table><h3 id="3-改进型-ga智能-ga-高级-ga"><a class="anchor" href="#3-改进型-ga智能-ga-高级-ga">#</a> 3. <strong>改进型 GA（智能 GA, 高级 GA）</strong></h3><p>主流改进版：</p><table><thead><tr><th>算法</th><th>思想</th><th>作用</th></tr></thead><tbody><tr><td><strong>精英策略 GA（Elitism GA）</strong></td><td>每代保留最优个体</td><td>防止退化</td></tr><tr><td><strong>自适应遗传算法 AGA</strong></td><td>自动调整变异率、交叉率</td><td>不用固定参数</td></tr><tr><td><strong>免疫遗传算法 IGA</strong></td><td>加入免疫算子（抗体、亲和度）</td><td>维持多样性，避免早熟</td></tr><tr><td><strong>混合 GA（Hybrid GA）</strong></td><td>GA + 梯度下降 / 粒子群 / 模拟退火</td><td>提升收敛速度</td></tr><tr><td><strong>星火遗传算法（Spark GA / Firefly-GA）</strong></td><td>“亮度吸引”机制（受萤火虫算法启发）</td><td>强化局部搜索</td></tr></tbody></table><h3 id="4-特殊结构-ga编码方式进化"><a class="anchor" href="#4-特殊结构-ga编码方式进化">#</a> 4. <strong>特殊结构 GA（编码方式进化）</strong></h3><p>为特殊问题设计的遗传算法。</p><table><thead><tr><th>算法</th><th>应用</th></tr></thead><tbody><tr><td><strong>Permutation GA</strong></td><td>旅行商 TSP、排序优化</td></tr><tr><td><strong>Binary GA</strong></td><td>0-1 组合优化（选与不选）</td></tr><tr><td><strong>Tree GA（遗传规划 GP）</strong></td><td>用树结构进化程序</td></tr></tbody></table><h2 id="二传统ga"><a class="anchor" href="#二传统ga">#</a> 二.传统GA</h2><h3 id="问题目标"><a class="anchor" href="#问题目标">#</a> <strong>问题目标</strong></h3><p>假设你要优化一个函数：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><munder><mrow><mi>min</mi><mo>⁡</mo></mrow><mi>x</mi></munder><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\min_{x} f(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.45em;vertical-align:-0.7em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.6679em;"><span style="top:-2.4em;margin-left:0em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span><span class="mop">min</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span></span></p><p>遗传算法的目标是找到让 $ f(x) $ 最小的 $ x $。</p><h3 id="种群表示population"><a class="anchor" href="#种群表示population">#</a> <strong>种群表示（Population）</strong></h3><p>一个解 $ x $ 被称为 “个体”（Individual）。<br />N 个解组成一代种群：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mi>P</mi><mrow><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></mrow></msup><mo>=</mo><mo stretchy="false">{</mo><msubsup><mi>x</mi><mn>1</mn><mrow><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></mrow></msubsup><mo separator="true">,</mo><msubsup><mi>x</mi><mn>2</mn><mrow><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></mrow></msubsup><mo separator="true">,</mo><mo>…</mo><mo separator="true">,</mo><msubsup><mi>x</mi><mi>N</mi><mrow><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></mrow></msubsup><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">P^{(t)} = \{ x_1^{(t)}, x_2^{(t)}, \dots, x_N^{(t)} \}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.938em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">t</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.3383em;vertical-align:-0.2935em;"></span><span class="mopen">{</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.4337em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">t</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2663em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.4337em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">t</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2663em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">…</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.4065em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">t</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2935em;"><span></span></span></span></span></span></span><span class="mclose">}</span></span></span></span></span></p><p>t 表示当前是第几代。</p><h3 id="适应度函数fitness"><a class="anchor" href="#适应度函数fitness">#</a> <strong>适应度函数（Fitness）</strong></h3><p>遗传算法不直接用 $ f(x) $ ，而是把它转成 “适应度”。<br />最常见的适应度（越大越好）：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>F</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>1</mn><mo>+</mo><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">F(x) = \frac{1}{1 + f(x)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.2574em;vertical-align:-0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>或者最大化问题直接用：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>F</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">F(x) = f(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span></span></p><h3 id="选择selection"><a class="anchor" href="#选择selection">#</a> <strong>选择（Selection）</strong></h3><p>让适应度更高的更容易被选中。</p><h4 id="轮盘赌选择roulette-wheel"><a class="anchor" href="#轮盘赌选择roulette-wheel">#</a> 轮盘赌选择（Roulette Wheel）</h4><p>每个个体被选中的概率：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>p</mi><mi>i</mi></msub><mo>=</mo><mfrac><mrow><mi>F</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mi>i</mi></msub><mo stretchy="false">)</mo></mrow><mrow><munderover><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></munderover><mi>F</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mi>j</mi></msub><mo stretchy="false">)</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">p_i = \frac{F(x_i)}{\sum_{j=1}^{N} F(x_j)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.625em;vertical-align:-0.1944em;"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.734em;vertical-align:-1.307em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.1288em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mop"><span class="mop op-symbol small-op" style="position:relative;top:0em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9812em;"><span style="top:-2.4003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span style="top:-3.2029em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.4358em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.307em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>即：越优秀的个体，概率越大。</p><h3 id="交叉crossover"><a class="anchor" href="#交叉crossover">#</a> <strong>交叉（Crossover）</strong></h3><p>假设随机选出两个父代：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>x</mi><mi>a</mi></msub><mo>=</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mrow><mi>a</mi><mn>1</mn></mrow></msub><mo separator="true">,</mo><msub><mi>x</mi><mrow><mi>a</mi><mn>2</mn></mrow></msub><mo separator="true">,</mo><mo>…</mo><mo separator="true">,</mo><msub><mi>x</mi><mrow><mi>a</mi><mi>d</mi></mrow></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">x_a = (x_{a1}, x_{a2}, \dots, x_{ad})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">…</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">d</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>x</mi><mi>b</mi></msub><mo>=</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mrow><mi>b</mi><mn>1</mn></mrow></msub><mo separator="true">,</mo><msub><mi>x</mi><mrow><mi>b</mi><mn>2</mn></mrow></msub><mo separator="true">,</mo><mo>…</mo><mo separator="true">,</mo><msub><mi>x</mi><mrow><mi>b</mi><mi>d</mi></mrow></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">x_b = (x_{b1}, x_{b2}, \dots, x_{bd})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">b</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">b</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">…</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">b</span><span class="mord mathnormal mtight">d</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p><p>单点交叉公式:</p><p>选择一个位置 $ k $，生成新子代：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mtext>Child</mtext><mn>1</mn></msub><mo>=</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mrow><mi>a</mi><mn>1</mn></mrow></msub><mo separator="true">,</mo><mo>…</mo><mo separator="true">,</mo><msub><mi>x</mi><mrow><mi>a</mi><mi>k</mi></mrow></msub><mo separator="true">,</mo><msub><mi>x</mi><mrow><mi>b</mi><mo stretchy="false">(</mo><mi>k</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></msub><mo separator="true">,</mo><mo>…</mo><mo separator="true">,</mo><msub><mi>x</mi><mrow><mi>b</mi><mi>d</mi></mrow></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\text{Child}_1 = (x_{a1}, \dots, x_{ak}, x_{b(k+1)}, \dots, x_{bd})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord text"><span class="mord">Child</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1052em;vertical-align:-0.3552em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">…</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">ak</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">b</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">+</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">…</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">b</span><span class="mord mathnormal mtight">d</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mtext>Child</mtext><mn>2</mn></msub><mo>=</mo><mo stretchy="false">(</mo><msub><mi>x</mi><mrow><mi>b</mi><mn>1</mn></mrow></msub><mo separator="true">,</mo><mo>…</mo><mo separator="true">,</mo><msub><mi>x</mi><mrow><mi>b</mi><mi>k</mi></mrow></msub><mo separator="true">,</mo><msub><mi>x</mi><mrow><mi>a</mi><mo stretchy="false">(</mo><mi>k</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></msub><mo separator="true">,</mo><mo>…</mo><mo separator="true">,</mo><msub><mi>x</mi><mrow><mi>a</mi><mi>d</mi></mrow></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\text{Child}_2 = (x_{b1}, \dots, x_{bk}, x_{a(k+1)}, \dots, x_{ad})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8444em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord text"><span class="mord">Child</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1052em;vertical-align:-0.3552em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">b</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">…</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">bk</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3448em;"><span style="top:-2.5198em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">+</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.3552em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">…</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">d</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p><p>交叉概率 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>P</mi><mi>c</mi></msub></mrow><annotation encoding="application/x-tex">P_c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> 通常 0.6–0.9。</p><h3 id="变异mutation"><a class="anchor" href="#变异mutation">#</a> <strong>变异（Mutation）</strong></h3><p>对某些位置加一个小扰动（保持探索性）。</p><p>实数编码常用：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msubsup><mi>x</mi><mrow><mi>i</mi><mi>j</mi></mrow><mrow><mo stretchy="false">(</mo><mi>n</mi><mi>e</mi><mi>w</mi><mo stretchy="false">)</mo></mrow></msubsup><mo>=</mo><msubsup><mi>x</mi><mrow><mi>i</mi><mi>j</mi></mrow><mrow><mo stretchy="false">(</mo><mi>o</mi><mi>l</mi><mi>d</mi><mo stretchy="false">)</mo></mrow></msubsup><mo>+</mo><mi>ϵ</mi></mrow><annotation encoding="application/x-tex">x_{ij}^{(new)} = x_{ij}^{(old)} + \epsilon</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.4578em;vertical-align:-0.413em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.4231em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">ij</span></span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.413em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.4578em;vertical-align:-0.413em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.4231em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.05724em;">ij</span></span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight" style="margin-right:0.01968em;">l</span><span class="mord mathnormal mtight">d</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.413em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">ϵ</span></span></span></span></span></p><p>其中</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>ϵ</mi><mo>∼</mo><mi mathvariant="script">N</mi><mo stretchy="false">(</mo><mn>0</mn><mo separator="true">,</mo><msup><mi>σ</mi><mn>2</mn></msup><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\epsilon \sim \mathcal{N}(0, \sigma^2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">ϵ</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∼</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.1141em;vertical-align:-0.25em;"></span><span class="mord mathcal" style="margin-right:0.14736em;">N</span><span class="mopen">(</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p><p>二进制编码常用：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mn>0</mn><mo>→</mo><mn>1</mn><mo separator="true">,</mo><mspace width="1em"/><mn>1</mn><mo>→</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">0 \rightarrow 1,\quad 1 \rightarrow 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:1em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span></span></p><p>变异概率：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>P</mi><mi>m</mi></msub><mo>=</mo><mn>0.01</mn><mo>∼</mo><mn>0.1</mn></mrow><annotation encoding="application/x-tex">P_m = 0.01 \sim 0.1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0.01</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∼</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0.1</span></span></span></span></span></p><h3 id="生成下一代reproduction"><a class="anchor" href="#生成下一代reproduction">#</a> <strong>生成下一代（Reproduction）</strong></h3><p>把选择 + 交叉 + 变异生成的新个体组成：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mi>P</mi><mrow><mo stretchy="false">(</mo><mi>t</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></msup><mo>=</mo><mo stretchy="false">{</mo><msubsup><mi>x</mi><mn>1</mn><mrow><mo stretchy="false">(</mo><mi>t</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></msubsup><mo separator="true">,</mo><msubsup><mi>x</mi><mn>2</mn><mrow><mo stretchy="false">(</mo><mi>t</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></msubsup><mo separator="true">,</mo><mo>…</mo><mo separator="true">,</mo><msubsup><mi>x</mi><mi>N</mi><mrow><mo stretchy="false">(</mo><mi>t</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></msubsup><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">P^{(t+1)} = \{ x_1^{(t+1)}, x_2^{(t+1)}, \dots, x_N^{(t+1)} \}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.938em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.3383em;vertical-align:-0.2935em;"></span><span class="mopen">{</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.4337em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2663em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.4337em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2663em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="minner">…</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.0448em;"><span style="top:-2.4065em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10903em;">N</span></span></span><span style="top:-3.2198em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2935em;"><span></span></span></span></span></span></span><span class="mclose">}</span></span></span></span></span></p><h3 id="算法停止条件"><a class="anchor" href="#算法停止条件">#</a> <strong>算法停止条件</strong></h3><p>重复迭代直到：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>t</mi><mo>=</mo><msub><mi>t</mi><mi>max</mi><mo>⁡</mo></msub></mrow><annotation encoding="application/x-tex">t = t_{\max}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7651em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mop mtight"><span class="mtight">m</span><span class="mtight">a</span><span class="mtight">x</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>或者适应度不再提升（收敛）。</p><h3 id="遗传算法整体公式流程"><a class="anchor" href="#遗传算法整体公式流程">#</a> <strong>遗传算法整体公式流程</strong></h3><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msup><mi>P</mi><mrow><mo stretchy="false">(</mo><mi>t</mi><mo>+</mo><mn>1</mn><mo stretchy="false">)</mo></mrow></msup><mo>=</mo><mtext>Mutation</mtext><mo stretchy="false">(</mo><mtext>Crossover</mtext><mo stretchy="false">(</mo><mtext>Selection</mtext><mo stretchy="false">(</mo><msup><mi>P</mi><mrow><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></mrow></msup><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">P^{(t+1)} = \text{Mutation}(\text{Crossover}(\text{Selection}(P^{(t)})))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.938em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">t</span><span class="mbin mtight">+</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.188em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">Mutation</span></span><span class="mopen">(</span><span class="mord text"><span class="mord">Crossover</span></span><span class="mopen">(</span><span class="mord text"><span class="mord">Selection</span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.938em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathnormal mtight">t</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mclose">)))</span></span></span></span></span></p><p>一句话：</p><p><strong>下一代 = 用选择选出优秀父代 → 交叉组合 → 再随机变异</strong></p><h3 id="例子"><a class="anchor" href="#例子">#</a> <strong>例子</strong></h3><p>优化函数：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><msup><mi>x</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">f(x)=x^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8641em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span></p><p>适应度：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>F</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><mn>1</mn><mo>+</mo><msup><mi>x</mi><mn>2</mn></msup></mrow></mfrac></mrow><annotation encoding="application/x-tex">F(x)=\frac{1}{1+x^2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.0908em;vertical-align:-0.7693em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7401em;"><span style="top:-2.989em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>轮盘赌选出优秀个体：概率与 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">F(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span> 成正比。<br />交叉产生新 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span>：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>x</mi><mrow><mi>n</mi><mi>e</mi><mi>w</mi></mrow></msub><mo>=</mo><mi>α</mi><msub><mi>x</mi><mi>a</mi></msub><mo>+</mo><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mi>α</mi><mo stretchy="false">)</mo><msub><mi>x</mi><mi>b</mi></msub></mrow><annotation encoding="application/x-tex">x_{new} = \alpha x_a + (1-\alpha) x_b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class="mclose">)</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>变异添加噪声：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>x</mi><mrow><mi>n</mi><mi>e</mi><mi>w</mi></mrow></msub><mo>=</mo><msub><mi>x</mi><mrow><mi>n</mi><mi>e</mi><mi>w</mi></mrow></msub><mo>+</mo><mi>ϵ</mi></mrow><annotation encoding="application/x-tex">x_{new} = x_{new} + \epsilon</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight" style="margin-right:0.02691em;">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">ϵ</span></span></span></span></span></p><p>每代都会让 $ x $ 更接近 0（最优点）。</p>]]></content>
    
    
    <summary type="html">本文介绍最简单的遗传算法，后续还会继续在这里更新更多的遗传算法内容</summary>
    
    
    
    <category term="machinelearning" scheme="https://koen666.github.io/categories/machinelearning/"/>
    
    
    <category term="GA" scheme="https://koen666.github.io/tags/GA/"/>
    
    <category term="python" scheme="https://koen666.github.io/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>cypher与neo4j</title>
    <link href="https://koen666.github.io/2025/10/17/cypher/"/>
    <id>https://koen666.github.io/2025/10/17/cypher/</id>
    <published>2025-10-17T04:00:00.000Z</published>
    <updated>2025-10-17T14:30:56.057Z</updated>
    
    <content type="html"><![CDATA[<h3 id="一-cypher是什么"><a class="anchor" href="#一-cypher是什么">#</a> 一、Cypher是什么</h3><p>Cypher是操作<strong>图数据库（Neo4j）</strong> 的语言。<br />图数据库里的数据不是表格（像MySQL的表），而是像“地图”一样的结构：</p><ul><li>有很多“点”（比如“人”“病”“药”），这些“点”叫<strong>节点（Node）</strong>。</li><li>点和点之间有“线”连接（比如“人患病”“药治人”），这些“线”叫<strong>关系（Relationship）</strong>。</li></ul><p>Cypher的作用就是：<strong>描述“点和线”的样子，让数据库找到你要的数据</strong>。</p><h3 id="二-最基础节点node怎么表示"><a class="anchor" href="#二-最基础节点node怎么表示">#</a> 二、最基础：节点（Node）怎么表示？</h3><p>节点是图里的“实体”（比如“张三”“感冒”），写法是：<br /><code>(变量名:标签 &#123;属性&#125;)</code></p><h4 id="拆解每个部分"><a class="anchor" href="#拆解每个部分">#</a> 拆解每个部分：</h4><ul><li><code>()</code>：必须用圆括号把节点包起来，相当于“这是一个节点”。</li><li><code>变量名</code>：给节点起个临时小名（比如用<code>p</code>代表“人”，<code>d</code>代表“病”），方便后面引用。</li><li><code>:标签</code>：节点的“类别”（比如<code>:Person</code>表示“人”，<code>:Disease</code>表示“疾病”），一个节点可以有多个标签（比如<code>:Person:Patient</code>表示“人且是患者”）。</li><li><code>&#123;属性&#125;</code>：描述节点的特征，是键值对（比如<code>name: &quot;张三&quot;</code>，<code>age: 30</code>），用大括号包起来。</li></ul><h4 id="例子"><a class="anchor" href="#例子">#</a> 例子：</h4><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-cypher"><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">// 一个“人”节点：变量p，标签Person，属性name和age</span></span><span class="line"><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">p</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">:</span><span style="color:#B07D48;--shiki-dark:#BD976A">Person</span><span style="color:#1E754F;--shiki-dark:#4D9375"> </span><span style="color:#1e754f;--shiki-dark:#4d9375">&#123;</span><span style="color:#B07D48;--shiki-dark:#BD976A">name</span><span style="color:#1E754F;--shiki-dark:#4D9375">:</span><span style="color:#B56959;--shiki-dark:#C98A7D"> "张三"</span><span style="color:#1E754F;--shiki-dark:#4D9375">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> age</span><span style="color:#1E754F;--shiki-dark:#4D9375">:</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 30</span><span style="color:#1e754f;--shiki-dark:#4d9375">&#125;</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">// 一个“疾病”节点：变量d，标签Disease，属性name</span></span><span class="line"><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">d</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">:</span><span style="color:#B07D48;--shiki-dark:#BD976A">Disease</span><span style="color:#1E754F;--shiki-dark:#4D9375"> </span><span style="color:#1e754f;--shiki-dark:#4d9375">&#123;</span><span style="color:#B07D48;--shiki-dark:#BD976A">name</span><span style="color:#1E754F;--shiki-dark:#4D9375">:</span><span style="color:#B56959;--shiki-dark:#C98A7D"> "感冒"</span><span style="color:#1e754f;--shiki-dark:#4d9375">&#125;</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span></code></pre><p>你可以理解为：<br /><code>(p:Person &#123;name: &quot;张三&quot;&#125;)</code> → “有个叫p的东西，它是‘人’，名字叫张三”。</p><h3 id="三-关键关系relationship怎么表示"><a class="anchor" href="#三-关键关系relationship怎么表示">#</a> 三、关键：关系（Relationship）怎么表示？</h3><p>关系是节点之间的“连接”（比如“张三患感冒”），写法是：<br /><code>-[变量名:类型 &#123;属性&#125;]-&gt;</code></p><h4 id="拆解每个部分-2"><a class="anchor" href="#拆解每个部分-2">#</a> 拆解每个部分：</h4><ul><li><code>-[ ]-</code>：中括号代表“这是一个关系”，横线连接两个节点。</li><li><code>-&gt;</code>：箭头表示方向（比如<code>A-&gt;B</code>表示“A到B的关系”，无方向可以写成<code>--</code>）。</li><li><code>变量名</code>：给关系起个临时小名（比如<code>r</code>），方便引用。</li><li><code>:类型</code>：关系的“类别”（比如<code>:患</code>表示“患病”，<code>:治疗</code>表示“可以治疗”），每个关系只能有一个类型。</li><li><code>&#123;属性&#125;</code>：描述关系的特征（比如<code>:患</code>的关系可以有<code>时间: &quot;2023-10-01&quot;</code>）。</li></ul><h4 id="例子-2"><a class="anchor" href="#例子-2">#</a> 例子：</h4><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-cypher"><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">// “张三患感冒”的关系：p（张三）通过r（患）指向d（感冒）</span></span><span class="line"><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">p</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">:</span><span style="color:#B07D48;--shiki-dark:#BD976A">Person</span><span style="color:#1E754F;--shiki-dark:#4D9375"> </span><span style="color:#1e754f;--shiki-dark:#4d9375">&#123;</span><span style="color:#B07D48;--shiki-dark:#BD976A">name</span><span style="color:#1E754F;--shiki-dark:#4D9375">:</span><span style="color:#B56959;--shiki-dark:#C98A7D"> "张三"</span><span style="color:#1e754f;--shiki-dark:#4d9375">&#125;</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#998418;--shiki-dark:#B8A965">-</span><span style="color:#2993a3;--shiki-dark:#5eaab5">[</span><span style="color:#B07D48;--shiki-dark:#BD976A">r</span><span style="color:#AB5959;--shiki-dark:#CB7676">:</span><span style="color:#59873A;--shiki-dark:#80A665">患</span><span style="color:#1E754F;--shiki-dark:#4D9375"> </span><span style="color:#1e754f;--shiki-dark:#4d9375">&#123;</span><span style="color:#B07D48;--shiki-dark:#BD976A">时间</span><span style="color:#1E754F;--shiki-dark:#4D9375">:</span><span style="color:#B56959;--shiki-dark:#C98A7D"> "2023-10-01"</span><span style="color:#1e754f;--shiki-dark:#4d9375">&#125;</span><span style="color:#2993a3;--shiki-dark:#5eaab5">]</span><span style="color:#998418;--shiki-dark:#B8A965">-</span><span style="color:#998418;--shiki-dark:#B8A965">></span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">d</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">:</span><span style="color:#B07D48;--shiki-dark:#BD976A">Disease</span><span style="color:#1E754F;--shiki-dark:#4D9375"> </span><span style="color:#1e754f;--shiki-dark:#4d9375">&#123;</span><span style="color:#B07D48;--shiki-dark:#BD976A">name</span><span style="color:#1E754F;--shiki-dark:#4D9375">:</span><span style="color:#B56959;--shiki-dark:#C98A7D"> "感冒"</span><span style="color:#1e754f;--shiki-dark:#4d9375">&#125;</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span></code></pre><p>可以理解为：<br /><code>(p)-[r:患]-&gt;(d)</code> → “p和d之间有个叫r的关系，类型是‘患’，意思是p患了d”。</p><h3 id="四-核心操作查数据match-return"><a class="anchor" href="#四-核心操作查数据match-return">#</a> 四、核心操作：查数据（MATCH + RETURN）</h3><p>最常用的操作是“找数据”，用<code>MATCH</code>描述你要找的“点和线的模式”，用<code>RETURN</code>返回结果。</p><h4 id="1-只查节点"><a class="anchor" href="#1-只查节点">#</a> 1. 只查节点</h4><p>比如：“找所有叫‘张三’的人”</p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-cypher"><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">// 步骤1：用MATCH描述模式（找标签是Person，name是张三的节点，变量叫p）</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">MATCH</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> </span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">p</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">:</span><span style="color:#B07D48;--shiki-dark:#BD976A">Person</span><span style="color:#1E754F;--shiki-dark:#4D9375"> </span><span style="color:#1e754f;--shiki-dark:#4d9375">&#123;</span><span style="color:#B07D48;--shiki-dark:#BD976A">name</span><span style="color:#1E754F;--shiki-dark:#4D9375">:</span><span style="color:#B56959;--shiki-dark:#C98A7D"> "张三"</span><span style="color:#1e754f;--shiki-dark:#4d9375">&#125;</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">// 步骤2：用RETURN返回结果（返回p的所有信息）</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">RETURN</span><span style="color:#B07D48;--shiki-dark:#BD976A"> p</span></span></code></pre><p>再比如：“找所有年龄大于30的人，只返回他们的名字”</p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-cypher"><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">MATCH</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> </span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">p</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">:</span><span style="color:#B07D48;--shiki-dark:#BD976A">Person</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">  </span><span style="color:#A0ADA0;--shiki-dark:#758575DD">// 找所有标签是Person的节点</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">WHERE</span><span style="color:#B07D48;--shiki-dark:#BD976A"> p</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">.</span><span style="color:#B07D48;--shiki-dark:#BD976A">age</span><span style="color:#AB5959;--shiki-dark:#CB7676"> </span><span style="color:#AB5959;--shiki-dark:#CB7676">></span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 30</span><span style="color:#A0ADA0;--shiki-dark:#758575DD">  // 加条件：年龄大于30（WHERE是过滤条件）</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">RETURN</span><span style="color:#B07D48;--shiki-dark:#BD976A"> p</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">.</span><span style="color:#B07D48;--shiki-dark:#BD976A">name</span><span style="color:#A0ADA0;--shiki-dark:#758575DD">     // 只返回名字</span></span></code></pre><h4 id="2-查关系节点关系"><a class="anchor" href="#2-查关系节点关系">#</a> 2. 查关系（节点+关系）</h4><p>比如：“找‘感冒’这种病有哪些伴随的症状”</p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-cypher"><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">// 模式：疾病d（名字是感冒）通过关系r（类型是伴随症状）指向症状s</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">MATCH</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> </span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">d</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">:</span><span style="color:#B07D48;--shiki-dark:#BD976A">Disease</span><span style="color:#1E754F;--shiki-dark:#4D9375"> </span><span style="color:#1e754f;--shiki-dark:#4d9375">&#123;</span><span style="color:#B07D48;--shiki-dark:#BD976A">name</span><span style="color:#1E754F;--shiki-dark:#4D9375">:</span><span style="color:#B56959;--shiki-dark:#C98A7D"> "感冒"</span><span style="color:#1e754f;--shiki-dark:#4d9375">&#125;</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#998418;--shiki-dark:#B8A965">-</span><span style="color:#2993a3;--shiki-dark:#5eaab5">[</span><span style="color:#B07D48;--shiki-dark:#BD976A">r</span><span style="color:#AB5959;--shiki-dark:#CB7676">:</span><span style="color:#59873A;--shiki-dark:#80A665">伴随症状</span><span style="color:#2993a3;--shiki-dark:#5eaab5">]</span><span style="color:#998418;--shiki-dark:#B8A965">-</span><span style="color:#998418;--shiki-dark:#B8A965">></span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">s</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">:</span><span style="color:#B07D48;--shiki-dark:#BD976A">Symptom</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">// 返回疾病名、关系的程度（比如“常见”）、症状名</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">RETURN</span><span style="color:#B07D48;--shiki-dark:#BD976A"> d</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">.</span><span style="color:#B07D48;--shiki-dark:#BD976A">name</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">, </span><span style="color:#B07D48;--shiki-dark:#BD976A">r</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">.</span><span style="color:#B07D48;--shiki-dark:#BD976A">degree</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">, </span><span style="color:#B07D48;--shiki-dark:#BD976A">s</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">.</span><span style="color:#B07D48;--shiki-dark:#BD976A">name</span></span></code></pre><p>如果数据库里有“感冒伴随发烧、咳嗽”，结果会是：</p><table><thead><tr><th><a href="http://d.name">d.name</a></th><th>r.degree</th><th><a href="http://s.name">s.name</a></th></tr></thead><tbody><tr><td>感冒</td><td>常见</td><td>发烧</td></tr><tr><td>感冒</td><td>较常见</td><td>咳嗽</td></tr></tbody></table><h4 id="3-查路径多个关系连起来"><a class="anchor" href="#3-查路径多个关系连起来">#</a> 3. 查路径（多个关系连起来）</h4><p>比如：“找张三患的病有哪些症状”（路径：人→患→病→伴随→症状）</p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-cypher"><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">// 模式：p（张三）-患→d（病）-伴随→s（症状）</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">MATCH</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> </span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">p</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">:</span><span style="color:#B07D48;--shiki-dark:#BD976A">Person</span><span style="color:#1E754F;--shiki-dark:#4D9375"> </span><span style="color:#1e754f;--shiki-dark:#4d9375">&#123;</span><span style="color:#B07D48;--shiki-dark:#BD976A">name</span><span style="color:#1E754F;--shiki-dark:#4D9375">:</span><span style="color:#B56959;--shiki-dark:#C98A7D"> "张三"</span><span style="color:#1e754f;--shiki-dark:#4d9375">&#125;</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#998418;--shiki-dark:#B8A965">-</span><span style="color:#2993a3;--shiki-dark:#5eaab5">[</span><span style="color:#B07D48;--shiki-dark:#BD976A">r1</span><span style="color:#AB5959;--shiki-dark:#CB7676">:</span><span style="color:#59873A;--shiki-dark:#80A665">患</span><span style="color:#2993a3;--shiki-dark:#5eaab5">]</span><span style="color:#998418;--shiki-dark:#B8A965">-</span><span style="color:#998418;--shiki-dark:#B8A965">></span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">d</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">:</span><span style="color:#B07D48;--shiki-dark:#BD976A">Disease</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#998418;--shiki-dark:#B8A965">-</span><span style="color:#2993a3;--shiki-dark:#5eaab5">[</span><span style="color:#B07D48;--shiki-dark:#BD976A">r2</span><span style="color:#AB5959;--shiki-dark:#CB7676">:</span><span style="color:#59873A;--shiki-dark:#80A665">伴随</span><span style="color:#2993a3;--shiki-dark:#5eaab5">]</span><span style="color:#998418;--shiki-dark:#B8A965">-</span><span style="color:#998418;--shiki-dark:#B8A965">></span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">s</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">:</span><span style="color:#B07D48;--shiki-dark:#BD976A">Symptom</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">RETURN</span><span style="color:#B07D48;--shiki-dark:#BD976A"> p</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">.</span><span style="color:#B07D48;--shiki-dark:#BD976A">name</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">, </span><span style="color:#B07D48;--shiki-dark:#BD976A">d</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">.</span><span style="color:#B07D48;--shiki-dark:#BD976A">name</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">, </span><span style="color:#B07D48;--shiki-dark:#BD976A">s</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">.</span><span style="color:#B07D48;--shiki-dark:#BD976A">name</span><span style="color:#A0ADA0;--shiki-dark:#758575DD">  // 返回张三、病名、症状名</span></span></code></pre><h3 id="五-其他常用操作增删改"><a class="anchor" href="#五-其他常用操作增删改">#</a> 五、其他常用操作：增删改</h3><h4 id="1-创建create"><a class="anchor" href="#1-创建create">#</a> 1. 创建（CREATE）</h4><p>比如：“新增一个叫‘李四’的人，年龄25”</p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-cypher"><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">CREATE</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> </span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">p</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">:</span><span style="color:#B07D48;--shiki-dark:#BD976A">Person</span><span style="color:#1E754F;--shiki-dark:#4D9375"> </span><span style="color:#1e754f;--shiki-dark:#4d9375">&#123;</span><span style="color:#B07D48;--shiki-dark:#BD976A">name</span><span style="color:#1E754F;--shiki-dark:#4D9375">:</span><span style="color:#B56959;--shiki-dark:#C98A7D"> "李四"</span><span style="color:#1E754F;--shiki-dark:#4D9375">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> age</span><span style="color:#1E754F;--shiki-dark:#4D9375">:</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 25</span><span style="color:#1e754f;--shiki-dark:#4d9375">&#125;</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span></code></pre><p>比如：“给‘李四’和‘感冒’加一个‘患’的关系，时间是今天”</p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-cypher"><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">// 步骤1：先找到李四和感冒这两个节点</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">MATCH</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> </span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">p</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">:</span><span style="color:#B07D48;--shiki-dark:#BD976A">Person</span><span style="color:#1E754F;--shiki-dark:#4D9375"> </span><span style="color:#1e754f;--shiki-dark:#4d9375">&#123;</span><span style="color:#B07D48;--shiki-dark:#BD976A">name</span><span style="color:#1E754F;--shiki-dark:#4D9375">:</span><span style="color:#B56959;--shiki-dark:#C98A7D"> "李四"</span><span style="color:#1e754f;--shiki-dark:#4d9375">&#125;</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">, </span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">d</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">:</span><span style="color:#B07D48;--shiki-dark:#BD976A">Disease</span><span style="color:#1E754F;--shiki-dark:#4D9375"> </span><span style="color:#1e754f;--shiki-dark:#4d9375">&#123;</span><span style="color:#B07D48;--shiki-dark:#BD976A">name</span><span style="color:#1E754F;--shiki-dark:#4D9375">:</span><span style="color:#B56959;--shiki-dark:#C98A7D"> "感冒"</span><span style="color:#1e754f;--shiki-dark:#4d9375">&#125;</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">// 步骤2：创建他们之间的关系</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">CREATE</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> </span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">p</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#998418;--shiki-dark:#B8A965">-</span><span style="color:#2993a3;--shiki-dark:#5eaab5">[</span><span style="color:#B07D48;--shiki-dark:#BD976A">r</span><span style="color:#AB5959;--shiki-dark:#CB7676">:</span><span style="color:#59873A;--shiki-dark:#80A665">患</span><span style="color:#1E754F;--shiki-dark:#4D9375"> </span><span style="color:#1e754f;--shiki-dark:#4d9375">&#123;</span><span style="color:#B07D48;--shiki-dark:#BD976A">时间</span><span style="color:#1E754F;--shiki-dark:#4D9375">:</span><span style="color:#B56959;--shiki-dark:#C98A7D"> "2023-10-02"</span><span style="color:#1e754f;--shiki-dark:#4d9375">&#125;</span><span style="color:#2993a3;--shiki-dark:#5eaab5">]</span><span style="color:#998418;--shiki-dark:#B8A965">-</span><span style="color:#998418;--shiki-dark:#B8A965">></span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">d</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span></code></pre><h4 id="2-修改set"><a class="anchor" href="#2-修改set">#</a> 2. 修改（SET）</h4><p>比如：“把张三的年龄改成31，再加上性别‘男’”</p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-cypher"><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">// 先找到张三</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">MATCH</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> </span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">p</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">:</span><span style="color:#B07D48;--shiki-dark:#BD976A">Person</span><span style="color:#1E754F;--shiki-dark:#4D9375"> </span><span style="color:#1e754f;--shiki-dark:#4d9375">&#123;</span><span style="color:#B07D48;--shiki-dark:#BD976A">name</span><span style="color:#1E754F;--shiki-dark:#4D9375">:</span><span style="color:#B56959;--shiki-dark:#C98A7D"> "张三"</span><span style="color:#1e754f;--shiki-dark:#4d9375">&#125;</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">// 用SET修改/新增属性</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">SET</span><span style="color:#B07D48;--shiki-dark:#BD976A"> p</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">.</span><span style="color:#B07D48;--shiki-dark:#BD976A">age</span><span style="color:#AB5959;--shiki-dark:#CB7676"> =</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 31</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">, </span><span style="color:#B07D48;--shiki-dark:#BD976A">p</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">.</span><span style="color:#B07D48;--shiki-dark:#BD976A">gender</span><span style="color:#AB5959;--shiki-dark:#CB7676"> =</span><span style="color:#B56959;--shiki-dark:#C98A7D"> "男"</span></span></code></pre><h4 id="3-删除delete"><a class="anchor" href="#3-删除delete">#</a> 3. 删除（DELETE）</h4><p>删除节点前，必须先删除它的所有关系（不然“线”断了会报错）。<br />比如：“删除‘发烧’这个症状节点”</p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-cypher"><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">// DETACH DELETE会自动删除该节点的所有关系，再删节点</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">MATCH</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> </span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">s</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">:</span><span style="color:#B07D48;--shiki-dark:#BD976A">Symptom</span><span style="color:#1E754F;--shiki-dark:#4D9375"> </span><span style="color:#1e754f;--shiki-dark:#4d9375">&#123;</span><span style="color:#B07D48;--shiki-dark:#BD976A">name</span><span style="color:#1E754F;--shiki-dark:#4D9375">:</span><span style="color:#B56959;--shiki-dark:#C98A7D"> "发烧"</span><span style="color:#1e754f;--shiki-dark:#4d9375">&#125;</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#B07D48;--shiki-dark:#BD976A">DETACH</span><span style="color:#1E754F;--shiki-dark:#4D9375"> DELETE</span><span style="color:#B07D48;--shiki-dark:#BD976A"> s</span></span></code></pre>]]></content>
    
    
    <summary type="html">本文用于介绍cypher语法</summary>
    
    
    
    <category term="database" scheme="https://koen666.github.io/categories/database/"/>
    
    
    <category term="cypher" scheme="https://koen666.github.io/tags/cypher/"/>
    
    <category term="neo4j" scheme="https://koen666.github.io/tags/neo4j/"/>
    
    <category term="database" scheme="https://koen666.github.io/tags/database/"/>
    
  </entry>
  
  <entry>
    <title>让 SSH 登录变得“无感”且更安全</title>
    <link href="https://koen666.github.io/2025/10/10/ssh-agent/"/>
    <id>https://koen666.github.io/2025/10/10/ssh-agent/</id>
    <published>2025-10-09T16:00:00.000Z</published>
    <updated>2026-01-18T08:24:54.938Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ssh-agent-的工作原理"><a class="anchor" href="#ssh-agent-的工作原理">#</a> ssh-agent 的工作原理</h2><p>简化流程：</p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-text"><span class="line"><span>[用户] → ssh 命令 → [ssh-agent] → [私钥] → [服务器]</span></span></code></pre><ol><li>用户运行 <code>ssh user@host</code>。</li><li>SSH 客户端向 ssh-agent 请求签名（用私钥解密挑战）。</li><li>ssh-agent 返回签名，完成认证。</li><li>私钥从来不会被写入磁盘或发送到服务器。</li></ol><h2 id="ssh-agent-的主要命令"><a class="anchor" href="#ssh-agent-的主要命令">#</a> ssh-agent 的主要命令</h2><h3 id="启动服务"><a class="anchor" href="#启动服务">#</a> 启动服务</h3><ul><li>Linux/macOS：</li></ul><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">eval</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#999999;--shiki-dark:#666666">$(</span><span style="color:#59873A;--shiki-dark:#80A665">ssh-agent</span><span style="color:#A65E2B;--shiki-dark:#C99076"> -s</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span></span></code></pre><ul><li>Windows（PowerShell）：</li></ul><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-powershell"><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">Start-Service</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> ssh</span><span style="color:#999999;--shiki-dark:#666666">-</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">agent</span></span></code></pre><h3 id="添加私钥"><a class="anchor" href="#添加私钥">#</a> 添加私钥</h3><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">ssh-add</span><span style="color:#B56959;--shiki-dark:#C98A7D"> ~/.ssh/id_rsa</span><span style="color:#A0ADA0;--shiki-dark:#758575DD">        # Linux/macOS</span></span><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">ssh-add</span><span style="color:#B56959;--shiki-dark:#C98A7D"> C:</span><span style="color:#A65E2B;--shiki-dark:#C99076">\U</span><span style="color:#B56959;--shiki-dark:#C98A7D">sers</span><span style="color:#A65E2B;--shiki-dark:#C99076">\2</span><span style="color:#B56959;--shiki-dark:#C98A7D">8058</span><span style="color:#A65E2B;--shiki-dark:#C99076">\.</span><span style="color:#B56959;--shiki-dark:#C98A7D">ssh</span><span style="color:#A65E2B;--shiki-dark:#C99076">\i</span><span style="color:#B56959;--shiki-dark:#C98A7D">d_rsa</span><span style="color:#A0ADA0;--shiki-dark:#758575DD">   # Windows</span></span></code></pre><ul><li>第一次添加会要求输入私钥密码（passphrase）</li><li>添加后 session 内就无需再次输入密码</li></ul><h3 id="查看已加载密钥"><a class="anchor" href="#查看已加载密钥">#</a> 查看已加载密钥</h3><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">ssh-add</span><span style="color:#A65E2B;--shiki-dark:#C99076"> -l</span></span></code></pre><ul><li>显示 agent 中已缓存的公钥指纹</li></ul><h3 id="删除密钥"><a class="anchor" href="#删除密钥">#</a> 删除密钥</h3><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">ssh-add</span><span style="color:#A65E2B;--shiki-dark:#C99076"> -D</span><span style="color:#A0ADA0;--shiki-dark:#758575DD">   # 删除 agent 中的所有密钥</span></span><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">ssh-add</span><span style="color:#A65E2B;--shiki-dark:#C99076"> -d</span><span style="color:#B56959;--shiki-dark:#C98A7D"> ~/.ssh/id_rsa</span><span style="color:#A0ADA0;--shiki-dark:#758575DD">  # 删除指定密钥</span></span></code></pre><h2 id="windows-上-ssh-agent-服务"><a class="anchor" href="#windows-上-ssh-agent-服务">#</a> Windows 上 ssh-agent 服务</h2><h3 id="41-服务特点"><a class="anchor" href="#41-服务特点">#</a> 4.1 服务特点</h3><ul><li>Windows 上 ssh-agent 是一个 <strong>系统服务（OpenSSH Authentication Agent）</strong></li><li>可以设置为 <strong>自动启动</strong>：</li></ul><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-powershell"><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">Set-Service</span><span style="color:#999999;--shiki-dark:#666666"> -</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">Name ssh</span><span style="color:#999999;--shiki-dark:#666666">-</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">agent </span><span style="color:#999999;--shiki-dark:#666666">-</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">StartupType Automatic</span></span></code></pre><ul><li>启动后在后台运行，不用每次手动开启</li></ul><h3 id="42-常见命令"><a class="anchor" href="#42-常见命令">#</a> 4.2 常见命令</h3><ul><li>启动服务：</li></ul><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-powershell"><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">Start-Service</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> ssh</span><span style="color:#999999;--shiki-dark:#666666">-</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">agent</span></span></code></pre><ul><li>查看服务状态：</li></ul><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-powershell"><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">Get-Service</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> ssh</span><span style="color:#999999;--shiki-dark:#666666">-</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">agent</span></span></code></pre><ul><li>添加私钥：</li></ul><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-powershell"><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">ssh</span><span style="color:#999999;--shiki-dark:#666666">-</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">add C:\Users\</span><span style="color:#2F798A;--shiki-dark:#4C9A91">28058</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">\.ssh\id_rsa</span></span></code></pre><ul><li>查看已加载密钥：</li></ul><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-powershell"><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">ssh</span><span style="color:#999999;--shiki-dark:#666666">-</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">add </span><span style="color:#999999;--shiki-dark:#666666">-</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">l</span></span></code></pre><h2 id="优势"><a class="anchor" href="#优势">#</a> 优势</h2><ol><li><p><strong>免密码登录</strong></p><ul><li>解锁一次私钥后，整个 session 或服务周期内都无需再输入 passphrase。</li></ul></li><li><p><strong>安全</strong></p><ul><li>私钥只存在内存中，不会被写到磁盘或传输到服务器。</li></ul></li><li><p><strong>支持多密钥</strong></p><ul><li>可以同时缓存多把私钥，适合管理多个服务器或 GitHub、GitLab 等不同账号。</li></ul></li><li><p><strong>与 SSH 配置结合</strong></p><ul><li>配合 <code>~/.ssh/config</code> 可以针对不同 host 自动选择对应私钥。</li></ul></li></ol>]]></content>
    
    
    <summary type="html">本文介绍ssh-agent的使用，以及使用之后的服务器ssh免密登录</summary>
    
    
    
    <category term="ssh" scheme="https://koen666.github.io/categories/ssh/"/>
    
    
    <category term="ssh" scheme="https://koen666.github.io/tags/ssh/"/>
    
  </entry>
  
  <entry>
    <title>介绍screen，挂起的虚拟终端使用</title>
    <link href="https://koen666.github.io/2025/10/06/screen/"/>
    <id>https://koen666.github.io/2025/10/06/screen/</id>
    <published>2025-10-05T16:00:00.000Z</published>
    <updated>2026-01-18T08:25:22.120Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1️screen-是什么"><a class="anchor" href="#1️screen-是什么">#</a> <strong>1️.screen 是什么？</strong></h2><ul><li><p><code>screen</code> 是一个<strong>终端复用器</strong>（terminal multiplexer）。</p></li><li><p>它可以在一个终端窗口中运行多个“虚拟终端”，允许你在后台保持会话。</p></li><li><p>常见用途：</p><ul><li>在远程服务器上运行长时间任务，即使断开 SSH 也能继续执行。</li><li>在一个终端里同时打开多个 shell。</li><li>在同一会话中共享终端（多人操作同一个 session）。</li></ul></li></ul><h2 id="2️安装"><a class="anchor" href="#2️安装">#</a> <strong>2️.安装</strong></h2><p>大多数 Linux 发行版默认有：</p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">screen</span><span style="color:#A65E2B;--shiki-dark:#C99076"> --version</span></span></code></pre><p>如果没有安装：</p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># Ubuntu / Debian</span></span><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">sudo</span><span style="color:#B56959;--shiki-dark:#C98A7D"> apt</span><span style="color:#B56959;--shiki-dark:#C98A7D"> install</span><span style="color:#B56959;--shiki-dark:#C98A7D"> screen</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># CentOS / RHEL</span></span><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">sudo</span><span style="color:#B56959;--shiki-dark:#C98A7D"> yum</span><span style="color:#B56959;--shiki-dark:#C98A7D"> install</span><span style="color:#B56959;--shiki-dark:#C98A7D"> screen</span></span></code></pre><h2 id="3️基本命令"><a class="anchor" href="#3️基本命令">#</a> <strong>3️.基本命令</strong></h2><h3 id="1-启动一个新的-screen-会话"><a class="anchor" href="#1-启动一个新的-screen-会话">#</a> <strong>(1) 启动一个新的 screen 会话</strong></h3><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">screen</span><span style="color:#A65E2B;--shiki-dark:#C99076"> -S</span><span style="color:#B56959;--shiki-dark:#C98A7D"> mysession</span></span></code></pre><ul><li><code>-S mysession</code>：给会话取名字，方便管理。</li><li>执行后，你会进入一个新的终端环境，和普通 shell 一样。</li></ul><h3 id="2-在-screen-中操作"><a class="anchor" href="#2-在-screen-中操作">#</a> <strong>(2) 在 screen 中操作</strong></h3><ul><li><strong>新建窗口</strong>: <code>Ctrl+a</code> 然后 <code>c</code></li><li><strong>切换窗口</strong>: <code>Ctrl+a</code> 然后 <code>n</code>（下一个）、<code>p</code>（上一个）</li><li><strong>查看窗口列表</strong>: <code>Ctrl+a</code> 然后 <code>"</code></li></ul><h3 id="3-暂时离开detach会话"><a class="anchor" href="#3-暂时离开detach会话">#</a> <strong>(3) 暂时离开（detach）会话</strong></h3><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">Ctrl+a</span><span style="color:#B56959;--shiki-dark:#C98A7D"> d</span></span></code></pre><ul><li>会让 screen 会话在后台继续运行，终端回到原来的 shell。</li></ul><h3 id="4-恢复attach会话"><a class="anchor" href="#4-恢复attach会话">#</a> <strong>(4) 恢复（attach）会话</strong></h3><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">screen</span><span style="color:#A65E2B;--shiki-dark:#C99076"> -r</span><span style="color:#B56959;--shiki-dark:#C98A7D"> mysession</span></span></code></pre><ul><li>恢复之前 detach 的会话。</li><li>如果有多个会话：</li></ul><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">screen</span><span style="color:#A65E2B;--shiki-dark:#C99076"> -ls</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># 列出所有会话</span></span><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">screen</span><span style="color:#A65E2B;--shiki-dark:#C99076"> -r</span><span style="color:#B56959;--shiki-dark:#C98A7D"> 会话ID</span></span></code></pre><h3 id="5-杀掉会话"><a class="anchor" href="#5-杀掉会话">#</a> <strong>(5) 杀掉会话</strong></h3><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">exit</span></span></code></pre><ul><li>在 screen 内直接 <code>exit</code> 会结束该窗口和会话。<br>或者：</li></ul><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">screen</span><span style="color:#A65E2B;--shiki-dark:#C99076"> -X</span><span style="color:#A65E2B;--shiki-dark:#C99076"> -S</span><span style="color:#B56959;--shiki-dark:#C98A7D"> mysession</span><span style="color:#B56959;--shiki-dark:#C98A7D"> quit</span></span></code></pre><h2 id="4️高级技巧"><a class="anchor" href="#4️高级技巧">#</a> <strong>4️.高级技巧</strong></h2><ol><li><strong>后台运行任务</strong></li></ol><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">screen</span><span style="color:#A65E2B;--shiki-dark:#C99076"> -S</span><span style="color:#B56959;--shiki-dark:#C98A7D"> mytask</span><span style="color:#A65E2B;--shiki-dark:#C99076"> -dm</span><span style="color:#B56959;--shiki-dark:#C98A7D"> bash</span><span style="color:#A65E2B;--shiki-dark:#C99076"> -c</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">python myscript.py</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span></span></code></pre><ul><li><code>-dm</code> 表示启动会话并立即后台运行。</li><li>可以 <code>screen -r mytask</code> 查看进度。</li></ul><ol start="2"><li><strong>日志记录</strong></li></ol><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">Ctrl+a</span><span style="color:#B56959;--shiki-dark:#C98A7D"> H</span></span></code></pre><ul><li>会将当前窗口的输出记录到 <code>screenlog.0</code> 文件。</li></ul><ol start="3"><li><strong>共享会话</strong></li></ol><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">screen</span><span style="color:#A65E2B;--shiki-dark:#C99076"> -x</span><span style="color:#B56959;--shiki-dark:#C98A7D"> mysession</span></span></code></pre><ul><li>可以和其他用户同时操作同一个 session（需要权限）。</li></ul><h2 id="5️总结"><a class="anchor" href="#5️总结">#</a> <strong>5️.总结</strong></h2><p><code>screen</code> 的核心价值是：</p><ul><li><strong>断开重连</strong>：网络断了也不会影响任务。</li><li><strong>多窗口管理</strong>：在一个终端里搞定多个任务。</li><li><strong>后台执行</strong>：任务可持续运行，不占本地终端。</li></ul>]]></content>
    
    
    <summary type="html">本文介绍screen命令的用法</summary>
    
    
    
    <category term="linux" scheme="https://koen666.github.io/categories/linux/"/>
    
    
    <category term="screen" scheme="https://koen666.github.io/tags/screen/"/>
    
    <category term="termux" scheme="https://koen666.github.io/tags/termux/"/>
    
  </entry>
  
  <entry>
    <title>多gpu训练方式</title>
    <link href="https://koen666.github.io/2025/10/05/%E5%A4%9Agpu/"/>
    <id>https://koen666.github.io/2025/10/05/%E5%A4%9Agpu/</id>
    <published>2025-10-04T16:00:00.000Z</published>
    <updated>2025-10-05T12:25:07.934Z</updated>
    
    <content type="html"><![CDATA[<h2 id="一-为什么需要多-gpu"><a class="anchor" href="#一-为什么需要多-gpu">#</a> 一、为什么需要多 GPU？</h2><p>当我们训练深度学习模型（特别是大模型）时，单张 GPU 往往不够：</p><ul><li>数据太大，单卡放不下；</li><li>模型太复杂，训练太慢；</li><li>想更快训练完成。</li></ul><p>于是就有了「<strong>多 GPU 训练</strong>」这个想法：<br><strong>让多张显卡一起干活，分担计算任务。</strong></p><hr><h2 id="二-多-gpu-的三种主要方式"><a class="anchor" href="#二-多-gpu-的三种主要方式">#</a> 二、多 GPU 的三种主要方式</h2><p>多 GPU 的实现方式有很多，但核心分为三类</p><table><thead><tr><th>方式</th><th>中文名称</th><th>思路</th><th>优缺点</th></tr></thead><tbody><tr><td>1️⃣ 模型并行（Model Parallel）</td><td>模型拆开</td><td>把模型的不同层分给不同 GPU</td><td>适合模型太大放不下一张卡；通信频繁，实现复杂</td></tr><tr><td>2️⃣ 数据并行（Data Parallel）</td><td>数据拆开</td><td>模型每张卡都复制一份，每张卡训练一部分数据</td><td>通用、最常见</td></tr><tr><td>3️⃣ 分布式数据并行（Distributed Data Parallel, DDP）</td><td>高效数据并行</td><td>每张卡独立进程，自动同步梯度</td><td>工业级方案，最快、最稳定</td></tr></tbody></table><hr><h2 id="三-核心思想数据并行"><a class="anchor" href="#三-核心思想数据并行">#</a> 三、核心思想：数据并行</h2><p>多 GPU 训练中，<strong>数据并行</strong>是最常用的方式。</p><p>其思想非常简单：</p><blockquote><p><strong>模型每张卡都有一份副本；每张卡训练不同部分的数据；最后汇总结果。</strong></p></blockquote><p>假设你有 2 张 GPU，每次 batch 有 4 张图片：</p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-text"><span class="line"><span>批次数据： [1, 2, 3, 4]</span></span><span class="line"><span></span></span><span class="line"><span>GPU0 ← [1, 2]</span></span><span class="line"><span>GPU1 ← [3, 4]</span></span></code></pre><p>训练流程<br>1️⃣ 每张 GPU 都有一份相同的模型副本。<br>2️⃣ 各 GPU 前向计算 → 得到自己的 loss。<br>3️⃣ 各 GPU 反向传播 → 得到自己的梯度。<br>4️⃣ <strong>梯度同步（allreduce）</strong> → 求平均。<br>5️⃣ 各 GPU 同步更新参数。</p><p>这样每张 GPU 的参数始终保持一致。</p><hr><h2 id="四-关键概念详解"><a class="anchor" href="#四-关键概念详解">#</a> 四、关键概念详解</h2><p>下面是训练中会出现的一些关键术语</p><table><thead><tr><th>概念</th><th>说明</th></tr></thead><tbody><tr><td><strong>train</strong></td><td>训练集，用于更新模型参数。</td></tr><tr><td><strong>val (validation)</strong></td><td>验证集，用于评估模型是否过拟合，不参与训练。</td></tr><tr><td><strong>test</strong></td><td>测试集，用于最终测试模型效果。</td></tr><tr><td><strong>query</strong></td><td>查询集，常见于检索任务，用来搜索匹配结果。</td></tr><tr><td><strong>gallery / bounding_box</strong></td><td>检索任务中的数据库部分（比如人脸库、行人库）。</td></tr><tr><td><strong>batch（批次）</strong></td><td>一次喂给模型的数据量。</td></tr><tr><td><strong>split_batch</strong></td><td>把一个 batch 的数据拆成几份给不同 GPU。</td></tr><tr><td><strong>allreduce</strong></td><td>把多 GPU 的梯度相加、平均，让模型参数保持一致。</td></tr><tr><td><strong>scatter</strong></td><td>把数据分发到多个 GPU。</td></tr><tr><td><strong>gather / concat</strong></td><td>把多个 GPU 的结果合并回来。</td></tr></tbody></table><hr><h2 id="五-三种实现方式详解"><a class="anchor" href="#五-三种实现方式详解">#</a> 五、三种实现方式详解</h2><h3 id="1️⃣-模型并行model-parallel"><a class="anchor" href="#1️⃣-模型并行model-parallel">#</a> 1️⃣ 模型并行（Model Parallel）</h3><p><strong>思想：</strong></p><blockquote><p>模型太大，一张卡放不下，就把不同层放到不同 GPU 上。</p></blockquote><p>示意：</p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-text"><span class="line"><span>GPU0: 负责模型前半部分</span></span><span class="line"><span>GPU1: 负责模型后半部分</span></span></code></pre><p><strong>特点：</strong></p><ul><li>模型能变得更大；</li><li>但通信频繁，效率不高；</li><li>实现较复杂。</li></ul><p>适用：GPT、BERT 这类超大模型。</p><hr><h3 id="2️⃣-数据并行data-paralleldp"><a class="anchor" href="#2️⃣-数据并行data-paralleldp">#</a> 2️⃣ 数据并行（Data Parallel，DP）</h3><p><strong>思想：</strong></p><blockquote><p>每张卡都有一份完整模型副本，但处理不同部分的数据。</p></blockquote><p>PyTorch 用法：</p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-python"><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">model </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> torch</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">nn</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">DataParallel</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">model</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span></code></pre><p><strong>流程：</strong></p><ol><li>数据被平均分配给每张 GPU（scatter）。</li><li>各 GPU 前向 &amp; 反向传播。</li><li>主 GPU（GPU0）收集所有梯度，求平均。</li><li>GPU0 更新参数，再广播回所有 GPU。</li></ol><p><strong>缺点：</strong></p><ul><li>GPU0 负担过重（通信瓶颈）；</li><li>不能多机训练。</li></ul><p>适用：快速实验、小模型。</p><hr><h3 id="3️⃣-分布式数据并行distributed-data-parallelddp"><a class="anchor" href="#3️⃣-分布式数据并行distributed-data-parallelddp">#</a> 3️⃣ 分布式数据并行（Distributed Data Parallel，DDP）</h3><p><strong>思想：</strong></p><blockquote><p>数据并行的改进版，每张 GPU 独立进程，自动通信同步。</p></blockquote><p>PyTorch 用法：</p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-python"><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">from</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> torch</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">nn</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">parallel </span><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> DistributedDataParallel </span><span style="color:#1E754F;--shiki-dark:#4D9375">as</span><span style="color:#A65E2B;--shiki-dark:#C99076"> DDP</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">model </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> DDP</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">model</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span></code></pre><p><strong>流程图示（假设2张GPU）</strong></p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-text"><span class="line"><span>Step 1: 复制模型</span></span><span class="line"><span>GPU0: 模型A</span></span><span class="line"><span>GPU1: 模型A</span></span><span class="line"><span></span></span><span class="line"><span>Step 2: 拆分数据</span></span><span class="line"><span>GPU0: batch[0:2]</span></span><span class="line"><span>GPU1: batch[2:4]</span></span><span class="line"><span></span></span><span class="line"><span>Step 3: 前向+反向</span></span><span class="line"><span>各GPU独立算梯度</span></span><span class="line"><span></span></span><span class="line"><span>Step 4: allreduce同步</span></span><span class="line"><span>梯度平均后广播到每张卡</span></span><span class="line"><span></span></span><span class="line"><span>Step 5: 更新参数（同步）</span></span></code></pre><p><strong>一句话总结：</strong></p><blockquote><p>DDP 是 PyTorch 官方推荐的多 GPU 训练标准方案。</p></blockquote><hr><h2 id="六-底层机制理解scatter-allreduce-gather"><a class="anchor" href="#六-底层机制理解scatter-allreduce-gather">#</a> 六、底层机制理解：scatter / allreduce / gather</h2><table><thead><tr><th>操作</th><th>作用</th><th>举例</th></tr></thead><tbody><tr><td><strong>scatter</strong></td><td>拆数据</td><td>把 100 张图片分成两份发到 GPU0、GPU1</td></tr><tr><td><strong>allreduce</strong></td><td>同步梯度</td><td>GPU0 的梯度 + GPU1 的梯度 → 平均后广播</td></tr><tr><td><strong>gather / concat</strong></td><td>合并结果</td><td>把每个 GPU 的预测拼起来做整体评估</td></tr></tbody></table><p>这些操作是 <strong>数据并行的核心通信机制</strong>。<br>在 DDP 中，它们是由 PyTorch 自动完成的。</p><hr><h2 id="七-在-ddp-中训练需要注意什么"><a class="anchor" href="#七-在-ddp-中训练需要注意什么">#</a> 七、在 DDP 中训练需要注意什么</h2><table><thead><tr><th>事项</th><th>原因</th></tr></thead><tbody><tr><td>每个 GPU 独立进程</td><td>保证同步和效率</td></tr><tr><td>使用 <code>DistributedSampler</code></td><td>自动分配数据给不同 GPU</td></tr><tr><td>设置环境变量（rank, world_size）</td><td>标识 GPU 编号和总数</td></tr><tr><td>初始化通信（init_process_group）</td><td>建立 NCCL 通信通道</td></tr><tr><td>每个进程保存日志、模型</td><td>避免覆盖</td></tr></tbody></table><hr><h2 id="八-三个阶段的总结对比表"><a class="anchor" href="#八-三个阶段的总结对比表">#</a> 八、三个阶段的总结对比表</h2><table><thead><tr><th>阶段</th><th>干的事</th><th>特点</th><th>示例</th></tr></thead><tbody><tr><td>模型并行</td><td>模型拆分</td><td>各 GPU 存不同层</td><td>GPT、BERT</td></tr><tr><td>数据并行（DP）</td><td>数据拆分 + 主卡同步</td><td>简单但低效</td><td><code>nn.DataParallel</code></td></tr><tr><td>分布式数据并行（DDP）</td><td>数据拆分 + 自动同步</td><td>高效工业级</td><td><code>DistributedDataParallel</code></td></tr></tbody></table><hr><h2 id="九-类比理解多-gpu-像工厂流水线"><a class="anchor" href="#九-类比理解多-gpu-像工厂流水线">#</a> 九、类比理解：多 GPU 像工厂流水线</h2><table><thead><tr><th>工人</th><th>工作</th></tr></thead><tbody><tr><td>GPU0</td><td>处理样本1-50</td></tr><tr><td>GPU1</td><td>处理样本51-100</td></tr></tbody></table><ul><li>每个工人有同样的手册（模型）；</li><li>干完活后汇报经验（梯度）；</li><li>经理平均总结经验（allreduce）；</li><li>更新手册；</li><li>下一轮所有人继续。</li></ul><p>这，就是数据并行和 DDP 的本质。</p>]]></content>
    
    
    <summary type="html">本文介绍了多种gpu深度学习训练的方式</summary>
    
    
    
    <category term="deeplearning" scheme="https://koen666.github.io/categories/deeplearning/"/>
    
    
    <category term="gpu" scheme="https://koen666.github.io/tags/gpu/"/>
    
    <category term="data" scheme="https://koen666.github.io/tags/data/"/>
    
  </entry>
  
  <entry>
    <title>Imperative，Symbolic and Hybrid Programming</title>
    <link href="https://koen666.github.io/2025/10/05/%E7%BC%96%E7%A8%8B%E6%96%B9%E5%BC%8F/"/>
    <id>https://koen666.github.io/2025/10/05/%E7%BC%96%E7%A8%8B%E6%96%B9%E5%BC%8F/</id>
    <published>2025-10-04T16:00:00.000Z</published>
    <updated>2025-10-05T01:14:00.177Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1️⃣-命令式编程imperative-programming"><a class="anchor" href="#1️⃣-命令式编程imperative-programming">#</a> 1️⃣ 命令式编程（Imperative Programming）</h2><h3 id="核心思想"><a class="anchor" href="#核心思想">#</a> 核心思想</h3><ul><li><strong>按顺序执行每条语句</strong>，每执行一步就会改变程序的状态。</li><li>Python 就是典型的解释型语言，执行代码时会 <strong>逐行运行</strong>。</li></ul><h3 id="示例"><a class="anchor" href="#示例">#</a> 示例</h3><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-python"><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">def</span><span style="color:#59873A;--shiki-dark:#80A665"> add</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">a</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> b</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">    return</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> a </span><span style="color:#AB5959;--shiki-dark:#CB7676">+</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> b</span></span><span class="line"></span><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">def</span><span style="color:#59873A;--shiki-dark:#80A665"> fancy_func</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">a</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> b</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> c</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> d</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    e </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> add</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">a</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> b</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    f </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> add</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">c</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> d</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    g </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> add</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">e</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> f</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">    return</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> g</span></span><span class="line"></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">print</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">fancy_func</span><span style="color:#1e754f;--shiki-dark:#4d9375">(</span><span style="color:#2F798A;--shiki-dark:#4C9A91">1</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 2</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 3</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 4</span><span style="color:#1e754f;--shiki-dark:#4d9375">)</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span></code></pre><p>执行过程：</p><ol><li><code>e = add(a, b)</code> → 计算 1+2 = 3，并存到变量 <code>e</code></li><li><code>f = add(c, d)</code> → 计算 3+4 = 7，并存到变量 <code>f</code></li><li><code>g = add(e, f)</code> → 计算 3+7 = 10</li><li>返回并打印结果 <code>10</code></li></ol><p>特点：</p><ul><li><strong>直观易懂</strong>，方便调试</li><li>每次函数调用都需要解释器处理，效率不高（尤其在 GPU 上运行大批量计算时）</li></ul><hr /><h2 id="2️⃣-符号式编程symbolic-programming"><a class="anchor" href="#2️⃣-符号式编程symbolic-programming">#</a> 2️⃣ 符号式编程（Symbolic Programming）</h2><h3 id="核心思想-2"><a class="anchor" href="#核心思想-2">#</a> 核心思想</h3><ul><li><p><strong>先定义整个计算图/计算流程，再一次性执行</strong></p></li><li><p>可以让编译器提前做优化，例如：</p><ul><li>合并重复计算</li><li>直接生成最优机器指令</li><li>提前释放不再需要的内存</li></ul></li></ul><h3 id="示例模拟"><a class="anchor" href="#示例模拟">#</a> 示例（模拟）</h3><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-python"><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">prog </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> """</span></span><span class="line"><span style="color:#B56959;--shiki-dark:#C98A7D">def add(a, b):</span></span><span class="line"><span style="color:#B56959;--shiki-dark:#C98A7D">    return a + b</span></span><span class="line"></span><span class="line"><span style="color:#B56959;--shiki-dark:#C98A7D">def fancy_func(a, b, c, d):</span></span><span class="line"><span style="color:#B56959;--shiki-dark:#C98A7D">    e = add(a, b)</span></span><span class="line"><span style="color:#B56959;--shiki-dark:#C98A7D">    f = add(c, d)</span></span><span class="line"><span style="color:#B56959;--shiki-dark:#C98A7D">    g = add(e, f)</span></span><span class="line"><span style="color:#B56959;--shiki-dark:#C98A7D">    return g</span></span><span class="line"></span><span class="line"><span style="color:#B56959;--shiki-dark:#C98A7D">print(fancy_func(1, 2, 3, 4))</span></span><span class="line"><span style="color:#B5695977;--shiki-dark:#C98A7D77">"""</span></span><span class="line"></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">y </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#998418;--shiki-dark:#B8A965"> compile</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">prog</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> ''</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">exec</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#A0ADA0;--shiki-dark:#758575DD">  # 编译成可执行代码</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">exec</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">y</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#A0ADA0;--shiki-dark:#758575DD">                        # 一次性运行</span></span></code></pre><p>特点：</p><ul><li><strong>运行更快</strong>，可以做优化</li><li>可以生成与 Python 无关的可执行代码，更容易移植</li><li>调试不如命令式方便</li></ul><hr /><h2 id="3️⃣-混合式编程hybrid-programming"><a class="anchor" href="#3️⃣-混合式编程hybrid-programming">#</a> 3️⃣ 混合式编程（Hybrid Programming）</h2><h3 id="背景"><a class="anchor" href="#背景">#</a> 背景</h3><ul><li><p>很多深度学习框架历史上在命令式和符号式之间选择：</p><ul><li>TensorFlow 1.x：符号式</li><li>PyTorch：命令式</li></ul></li><li><p>混合式编程的出现是为了 <strong>兼顾易用性和性能</strong></p><ul><li>开发时用命令式调试方便</li><li>部署时用符号式优化和移植方便</li></ul></li></ul><h3 id="pytorch-示例torchjit"><a class="anchor" href="#pytorch-示例torchjit">#</a> PyTorch 示例：<code>torch.jit</code></h3><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-python"><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> torch</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">from</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> torch </span><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> nn</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># 定义网络</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">net </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> nn</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">Sequential</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    nn</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">Linear</span><span style="color:#1e754f;--shiki-dark:#4d9375">(</span><span style="color:#2F798A;--shiki-dark:#4C9A91">512</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 256</span><span style="color:#1e754f;--shiki-dark:#4d9375">)</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    nn</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">ReLU</span><span style="color:#1e754f;--shiki-dark:#4d9375">(</span><span style="color:#1e754f;--shiki-dark:#4d9375">)</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    nn</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">Linear</span><span style="color:#1e754f;--shiki-dark:#4d9375">(</span><span style="color:#2F798A;--shiki-dark:#4C9A91">256</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 128</span><span style="color:#1e754f;--shiki-dark:#4d9375">)</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    nn</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">ReLU</span><span style="color:#1e754f;--shiki-dark:#4d9375">(</span><span style="color:#1e754f;--shiki-dark:#4d9375">)</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    nn</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">Linear</span><span style="color:#1e754f;--shiki-dark:#4d9375">(</span><span style="color:#2F798A;--shiki-dark:#4C9A91">128</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 2</span><span style="color:#1e754f;--shiki-dark:#4d9375">)</span></span><span class="line"><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">x </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> torch</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">randn</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#2F798A;--shiki-dark:#4C9A91">1</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 512</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">net</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">x</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#A0ADA0;--shiki-dark:#758575DD">  # 命令式执行</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># 转换为符号式/优化版本</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">net </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> torch</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">jit</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">script</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">net</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">net</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">x</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#A0ADA0;--shiki-dark:#758575DD">  # 编译后的网络，效率更高</span></span></code></pre><ul><li><p><code>torch.jit.script</code> 会把命令式网络转换成 <strong>静态计算图</strong>，实现：</p><ol><li>编译优化</li><li>多 GPU 高效运行</li><li>可导出为非 Python 环境使用</li></ol></li></ul><hr /><h2 id="4️⃣-总结对比"><a class="anchor" href="#4️⃣-总结对比">#</a> 4️⃣ 总结对比</h2><table><thead><tr><th>编程方式</th><th>优点</th><th>缺点</th><th>示例框架</th></tr></thead><tbody><tr><td>命令式</td><td>易懂、易调试</td><td>运行慢，难优化</td><td>PyTorch</td></tr><tr><td>符号式</td><td>高效，可优化，易移植</td><td>调试不方便</td><td>TensorFlow 1.x, Theano</td></tr><tr><td>混合式</td><td>易调试 + 高效部署</td><td>需要额外转换步骤</td><td>PyTorch + torch.jit, TensorFlow 2.x</td></tr></tbody></table><hr /><p><strong>理解</strong>：</p><ul><li>命令式：边写边运行</li><li>符号式：先写完整程序再运行</li><li>混合式：平时用命令式调试，部署用符号式加速</li></ul>]]></content>
    
    
    <summary type="html">本文介绍三种编程方式</summary>
    
    
    
    <category term="deeplearning" scheme="https://koen666.github.io/categories/deeplearning/"/>
    
    
    <category term="code" scheme="https://koen666.github.io/tags/code/"/>
    
  </entry>
  
  <entry>
    <title>MLP 多层感知机制</title>
    <link href="https://koen666.github.io/2025/09/29/MLC/"/>
    <id>https://koen666.github.io/2025/09/29/MLC/</id>
    <published>2025-09-28T16:00:00.000Z</published>
    <updated>2025-10-06T02:53:43.066Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1️⃣-什么是-mlp"><a class="anchor" href="#1️⃣-什么是-mlp">#</a> 1️⃣  <strong>什么是 MLP</strong></h2><p><strong>MLP（多层感知机）</strong> 本质上就是：</p><ul><li>输入是一个 <strong>向量</strong>（1D）</li><li>输出也是一个 <strong>向量</strong>（1D）</li><li>每一层就是 <strong>矩阵乘法 + 非线性激活</strong></li></ul><p>数学上，一层 MLP 可以写成：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>h</mi><mo>=</mo><mi>W</mi><mi>x</mi><mo>+</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">h = Wx + b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">h</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span></span></span></span></span></p><ul><li>(x)：输入向量（比如长度是 784）</li><li>(W)：权重矩阵</li><li>(h)：输出向量（比如长度是 256）</li></ul><p>关键点：<strong>MLP 不关心输入有没有二维结构，它只把输入当作一堆数字（向量）</strong>。</p><hr><h2 id="2️⃣-图像输入-mlp-的问题"><a class="anchor" href="#2️⃣-图像输入-mlp-的问题">#</a> 2️⃣ 图像输入 MLP 的问题</h2><p>比如我们有一张 <strong>28×28 的图片</strong>，像素矩阵是：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>X</mi><mo stretchy="false">[</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">]</mo><mo separator="true">,</mo><mspace width="1em"></mspace><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo>=</mo><mn>1</mn><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><mn>28</mn></mrow><annotation encoding="application/x-tex">X[i,j], \quad i,j = 1,...,28</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">]</span><span class="mpunct">,</span><span class="mspace" style="margin-right:1em;"></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">...</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">28</span></span></span></span></span></p><p>在 MLP 里，通常要先把它 <strong>拉平</strong>（flatten）：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>x</mi><mo>=</mo><mtext>vec</mtext><mo stretchy="false">(</mo><mi>X</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">x = \text{vec}(X)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class="mord">vec</span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mclose">)</span></span></span></span></span></p><p>于是它变成一个 <strong>784 维的向量</strong>。<br>MLP 就直接做：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>h</mi><mo>=</mo><mi>W</mi><mi>x</mi><mo>+</mo><mi>b</mi></mrow><annotation encoding="application/x-tex">h = Wx + b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">h</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.7667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal">b</span></span></span></span></span></p><p>这样一来：原本的空间结构（像素的上下左右关系）就丢了。<br>它只知道“这是第 123 个输入值”，而不知道这个像素在图片的哪儿。</p><hr><h2 id="3️⃣-如果想保留二维结构"><a class="anchor" href="#3️⃣-如果想保留二维结构">#</a> 3️⃣ 如果想保留二维结构</h2><p>假设我们不要拉直，而是直接保持：</p><ul><li>输入是二维矩阵 (X[i,j])</li><li>输出（隐藏层）也是二维矩阵 (H[a,b])</li></ul><p>那每个输出位置 (H[a,b]) 都要从整个输入图像里“吸收信息”。<br>于是需要一个 <strong>四维权重张量</strong>：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>W</mi><mo stretchy="false">[</mo><mi>a</mi><mo separator="true">,</mo><mi>b</mi><mo separator="true">,</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">W[a,b,i,j]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mopen">[</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">b</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">]</span></span></span></span></span></p><p>公式就变成：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>H</mi><mo stretchy="false">[</mo><mi>a</mi><mo separator="true">,</mo><mi>b</mi><mo stretchy="false">]</mo><mo>=</mo><munder><mo>∑</mo><mrow><mi>i</mi><mo separator="true">,</mo><mi>j</mi></mrow></munder><mi>W</mi><mo stretchy="false">[</mo><mi>a</mi><mo separator="true">,</mo><mi>b</mi><mo separator="true">,</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">]</mo><mo>⋅</mo><mi>X</mi><mo stretchy="false">[</mo><mi>i</mi><mo separator="true">,</mo><mi>j</mi><mo stretchy="false">]</mo><mo>+</mo><mi>b</mi><mo stretchy="false">[</mo><mi>a</mi><mo separator="true">,</mo><mi>b</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">H[a,b] = \sum_{i,j} W[a,b,i,j] \cdot X[i,j] + b[a,b]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mopen">[</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">b</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.4638em;vertical-align:-1.4138em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.05em;"><span style="top:-1.8723em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:0.05724em;">j</span></span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.4138em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">W</span><span class="mopen">[</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">b</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mopen">[</span><span class="mord mathnormal">i</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.05724em;">j</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">b</span><span class="mopen">[</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">b</span><span class="mclose">]</span></span></span></span></span></p><h3 id="对比"><a class="anchor" href="#对比">#</a> 对比：</h3><ul><li><strong>普通 MLP：</strong> 用的是矩阵（2D 权重），输入输出都是向量。</li><li><strong>二维输入+二维输出：</strong> 用的是四阶张量（4D 权重），输入输出都是矩阵。</li></ul><hr><h2 id="4️⃣-举个例子"><a class="anchor" href="#4️⃣-举个例子">#</a> 4️⃣ 举个例子</h2><p>假设输入图像 (X) 是 <strong>2×2</strong>：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>X</mi><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.16em" columnalign="center center center" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>x</mi><mn>11</mn></msub></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><msub><mi>x</mi><mn>12</mn></msub><mtext> </mtext><msub><mi>x</mi><mn>21</mn></msub></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>x</mi><mn>22</mn></msub></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">X = \begin{bmatrix}x_{11} &amp; x_{12} \x_{21} &amp; x_{22}\end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">X</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1.2em;vertical-align:-0.35em;"></span><span class="minner"><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">11</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">12</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace"> </span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">21</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span><span class="arraycolsep" style="width:0.5em;"></span><span class="arraycolsep" style="width:0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.85em;"><span style="top:-3.01em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">22</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.35em;"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">]</span></span></span></span></span></span></span></p><h3 id="1普通-mlp-做法"><a class="anchor" href="#1普通-mlp-做法">#</a> （1）普通 MLP 做法：</h3><ul><li><p>拉平：(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>=</mo><mo stretchy="false">[</mo><msub><mi>x</mi><mn>11</mn></msub><mo separator="true">,</mo><msub><mi>x</mi><mn>12</mn></msub><mo separator="true">,</mo><msub><mi>x</mi><mn>21</mn></msub><mo separator="true">,</mo><msub><mi>x</mi><mn>22</mn></msub><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">x = [x_{11}, x_{12}, x_{21}, x_{22}]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">11</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">12</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">21</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">22</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">]</span></span></span></span>)，是长度 4 的向量。</p></li><li><p>设隐藏层也是 4 个神经元：</p><ul><li>权重矩阵 (W) 就是 4×4（16 个参数）。</li><li>输出是向量 (h)。</li></ul></li></ul><h3 id="2二维保留做法"><a class="anchor" href="#2二维保留做法">#</a> （2）二维保留做法：</h3><ul><li>输入还是 2×2，输出也想要 2×2。</li><li>每个输出位置 (H[a,b]) 都要看输入所有 4 个像素。</li><li>权重变成 (W[a,b,i,j])，一共 (2×2×2×2 = 16) 个参数。</li><li>输出是矩阵 (H)。</li></ul><hr><h2 id="5️⃣-总结"><a class="anchor" href="#5️⃣-总结">#</a> 5️⃣ 总结</h2><ul><li><strong>MLP 的本质：</strong> 向量输入 → 矩阵乘法 → 向量输出。</li><li><strong>为什么会出现“四维权重”：</strong><br>因为我们把输入/输出都看作二维矩阵，而不是向量。数学上需要一个四维权重张量来描述“矩阵到矩阵”的映射。</li><li><strong>核心问题：</strong> MLP 不利用图像的空间结构 → 参数多、效率低。<br>这正是 CNN 出现的原因（卷积核只看局部，参数大幅减少）。</li></ul>]]></content>
    
    
    <summary type="html">本文介绍MLC及其局限性</summary>
    
    
    
    <category term="deeplearning" scheme="https://koen666.github.io/categories/deeplearning/"/>
    
    
    <category term="math" scheme="https://koen666.github.io/tags/math/"/>
    
    <category term="MLC" scheme="https://koen666.github.io/tags/MLC/"/>
    
  </entry>
  
  <entry>
    <title>Flask框架 基本使用教程</title>
    <link href="https://koen666.github.io/2025/09/24/flask/"/>
    <id>https://koen666.github.io/2025/09/24/flask/</id>
    <published>2025-09-24T13:54:47.228Z</published>
    <updated>2025-09-24T13:59:22.606Z</updated>
    
    <content type="html"><![CDATA[<h2 id="基础介绍"><a class="anchor" href="#基础介绍">#</a> 基础介绍</h2><p>Flask 是一个 <strong>轻量级 Python Web 框架</strong>，特点：</p><ul><li>核心简单，灵活可扩展</li><li>内置开发服务器和调试器</li><li>支持 Jinja2 模板、路由管理、请求处理</li></ul><p>安装 Flask：</p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">pip</span><span style="color:#B56959;--shiki-dark:#C98A7D"> install</span><span style="color:#B56959;--shiki-dark:#C98A7D"> flask</span></span></code></pre><p>创建最简单的 Flask 应用：</p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-python"><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">from</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> flask </span><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> Flask</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># 创建 Flask 应用实例</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">app </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> Flask</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#998418;--shiki-dark:#B8A965">__name__</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># 定义路由</span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">@</span><span style="color:#59873A;--shiki-dark:#80A665">app</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#59873A;--shiki-dark:#80A665">route</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">/</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">def</span><span style="color:#59873A;--shiki-dark:#80A665"> index</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">    return</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">Hello, Flask!</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># 启动应用</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">if</span><span style="color:#998418;--shiki-dark:#B8A965"> __name__</span><span style="color:#AB5959;--shiki-dark:#CB7676"> ==</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">__main__</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    app</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">run</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">debug</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#1E754F;--shiki-dark:#4D9375">True</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span></code></pre><p>解释：</p><ul><li><code>Flask(__name__)</code>：创建应用实例，<code>__name__</code> 用于确定应用资源路径</li><li><code>@app.route(&quot;/&quot;)</code>：将函数绑定到路由 <code>/</code></li><li><code>app.run(debug=True)</code>：启动调试模式，会自动重载代码</li></ul><hr /><h2 id="模板与-jinja2"><a class="anchor" href="#模板与-jinja2">#</a> 模板与 Jinja2</h2><p>Flask 使用 <strong>Jinja2</strong> 模板引擎。模板能动态渲染 HTML，支持变量、过滤器、条件语句、循环、继承和宏。</p><hr /><h3 id="模板继承"><a class="anchor" href="#模板继承">#</a> 模板继承</h3><p>父模板（base.html）：</p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-html"><span class="line"><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#1E754F;--shiki-dark:#4D9375">html</span><span style="color:#999999;--shiki-dark:#666666">></span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#1E754F;--shiki-dark:#4D9375">head</span><span style="color:#999999;--shiki-dark:#666666">></span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">    &#x3C;</span><span style="color:#1E754F;--shiki-dark:#4D9375">title</span><span style="color:#999999;--shiki-dark:#666666">></span><span style="color:#A0ADA0;--shiki-dark:#758575DD">&#x3C;!--swig￼0--></span><span style="color:#999999;--shiki-dark:#666666">&#x3C;/</span><span style="color:#1E754F;--shiki-dark:#4D9375">title</span><span style="color:#999999;--shiki-dark:#666666">></span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">&#x3C;/</span><span style="color:#1E754F;--shiki-dark:#4D9375">head</span><span style="color:#999999;--shiki-dark:#666666">></span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#1E754F;--shiki-dark:#4D9375">body</span><span style="color:#999999;--shiki-dark:#666666">></span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">    &#x3C;</span><span style="color:#1E754F;--shiki-dark:#4D9375">header</span><span style="color:#999999;--shiki-dark:#666666">></span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">导航栏</span><span style="color:#999999;--shiki-dark:#666666">&#x3C;/</span><span style="color:#1E754F;--shiki-dark:#4D9375">header</span><span style="color:#999999;--shiki-dark:#666666">></span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">    &#x3C;!--swig￼1--></span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">    &#x3C;</span><span style="color:#1E754F;--shiki-dark:#4D9375">footer</span><span style="color:#999999;--shiki-dark:#666666">></span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">页脚</span><span style="color:#999999;--shiki-dark:#666666">&#x3C;/</span><span style="color:#1E754F;--shiki-dark:#4D9375">footer</span><span style="color:#999999;--shiki-dark:#666666">></span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">&#x3C;/</span><span style="color:#1E754F;--shiki-dark:#4D9375">body</span><span style="color:#999999;--shiki-dark:#666666">></span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">&#x3C;/</span><span style="color:#1E754F;--shiki-dark:#4D9375">html</span><span style="color:#999999;--shiki-dark:#666666">></span></span></code></pre><p>子模板：</p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-html"><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">&#x3C;!--swig￼2--></span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">&#x3C;!--swig￼3--></span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">&#x3C;!--swig￼4--></span></span></code></pre><p>解释：</p><ul><li>`</li></ul>]]></content>
    
    
    <summary type="html">本文介绍py常用的web框架flask</summary>
    
    
    
    <category term="backen" scheme="https://koen666.github.io/categories/backen/"/>
    
    
    <category term="python" scheme="https://koen666.github.io/tags/python/"/>
    
    <category term="web" scheme="https://koen666.github.io/tags/web/"/>
    
    <category term="flask" scheme="https://koen666.github.io/tags/flask/"/>
    
  </entry>
  
  <entry>
    <title>KL散度</title>
    <link href="https://koen666.github.io/2025/09/22/KL/"/>
    <id>https://koen666.github.io/2025/09/22/KL/</id>
    <published>2025-09-21T16:00:00.000Z</published>
    <updated>2025-09-22T06:34:49.898Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-信息量information-content"><a class="anchor" href="#1-信息量information-content">#</a> 1. 信息量（Information Content）</h2><p>在信息论中，<strong>信息量</strong>用来度量某个事件带来的“惊讶程度”。<br>概率越小的事件，发生时带来的信息量越大。</p><p>定义：如果某个事件 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">x</span></span></span></span> 的概率是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">P(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span>，它的信息量为：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>I</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mo>−</mo><mi>log</mi><mo>⁡</mo><mi>P</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">I(x) = - \log P(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">−</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span></span></p><p>解释：</p><ul><li>概率大 → 事件常见 → 信息量小</li><li>概率小 → 事件稀有 → 信息量大</li></ul><hr><h2 id="2-信息熵entropy"><a class="anchor" href="#2-信息熵entropy">#</a> 2. 信息熵（Entropy）</h2><p>如果我们有一个分布 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span>，它描述了所有可能事件的概率分布，那么<strong>信息熵</strong>表示的是 <strong>在这个分布下，事件发生时平均能带来的信息量</strong>。</p><p>公式为：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>H</mi><mo stretchy="false">(</mo><mi>P</mi><mo stretchy="false">)</mo><mo>=</mo><mo>−</mo><munder><mo>∑</mo><mi>x</mi></munder><mi>P</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mi>log</mi><mo>⁡</mo><mi>P</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">H(P) = - \sum_x P(x) \log P(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.3em;vertical-align:-1.25em;"></span><span class="mord">−</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.05em;"><span style="top:-1.9em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.25em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span></span></p><p>连续分布则写为：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>H</mi><mo stretchy="false">(</mo><mi>P</mi><mo stretchy="false">)</mo><mo>=</mo><mo>−</mo><mo>∫</mo><mi>P</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mi>log</mi><mo>⁡</mo><mi>P</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mtext> </mtext><mi>d</mi><mi>x</mi></mrow><annotation encoding="application/x-tex">H(P) = - \int P(x) \log P(x) \, dx</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.2222em;vertical-align:-0.8622em;"></span><span class="mord">−</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop op-symbol large-op" style="margin-right:0.44445em;position:relative;top:-0.0011em;">∫</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">x</span></span></span></span></span></p><p>直观理解：熵越大，说明分布越“均匀”，不确定性越高；熵越小，说明分布越集中，不确定性越低。</p><hr><h2 id="3-交叉熵cross-entropy"><a class="anchor" href="#3-交叉熵cross-entropy">#</a> 3. 交叉熵（Cross Entropy）</h2><p>假设真实分布是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span>，但我们用另一个分布 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Q</mi></mrow><annotation encoding="application/x-tex">Q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">Q</span></span></span></span> 去建模，那么平均信息量会是多少？<br>这就引出了 <strong>交叉熵</strong>：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>H</mi><mo stretchy="false">(</mo><mi>P</mi><mo separator="true">,</mo><mi>Q</mi><mo stretchy="false">)</mo><mo>=</mo><mo>−</mo><munder><mo>∑</mo><mi>x</mi></munder><mi>P</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mi>log</mi><mo>⁡</mo><mi>Q</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">H(P, Q) = - \sum_x P(x) \log Q(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">Q</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.3em;vertical-align:-1.25em;"></span><span class="mord">−</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.05em;"><span style="top:-1.9em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.25em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span></span></p><p>解释：</p><ul><li>如果我们用 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Q</mi></mrow><annotation encoding="application/x-tex">Q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">Q</span></span></span></span> 来代替 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span>，那么事件的概率会按照 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Q</mi></mrow><annotation encoding="application/x-tex">Q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">Q</span></span></span></span> 来估计。</li><li>交叉熵越小，说明 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Q</mi></mrow><annotation encoding="application/x-tex">Q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">Q</span></span></span></span> 越接近 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span>。</li></ul><hr><h2 id="4-kl-散度kullbackleibler-divergence"><a class="anchor" href="#4-kl-散度kullbackleibler-divergence">#</a> 4. KL 散度（Kullback–Leibler Divergence）</h2><p>KL 散度就是 <strong>交叉熵和信息熵的差</strong>：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>D</mi><mrow><mi>K</mi><mi>L</mi></mrow></msub><mo stretchy="false">(</mo><mi>P</mi><mi mathvariant="normal">∥</mi><mi>Q</mi><mo stretchy="false">)</mo><mo>=</mo><mi>H</mi><mo stretchy="false">(</mo><mi>P</mi><mo separator="true">,</mo><mi>Q</mi><mo stretchy="false">)</mo><mo>−</mo><mi>H</mi><mo stretchy="false">(</mo><mi>P</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">D_{KL}(P \| Q) = H(P, Q) - H(P)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">K</span><span class="mord mathnormal mtight">L</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord">∥</span><span class="mord mathnormal">Q</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">Q</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mclose">)</span></span></span></span></span></p><p>展开后就是常见的定义：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>D</mi><mrow><mi>K</mi><mi>L</mi></mrow></msub><mo stretchy="false">(</mo><mi>P</mi><mi mathvariant="normal">∥</mi><mi>Q</mi><mo stretchy="false">)</mo><mo>=</mo><munder><mo>∑</mo><mi>x</mi></munder><mi>P</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mi>log</mi><mo>⁡</mo><mfrac><mrow><mi>P</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><mrow><mi>Q</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow></mfrac></mrow><annotation encoding="application/x-tex">D_{KL}(P \| Q) = \sum_x P(x) \log \frac{P(x)}{Q(x)}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">K</span><span class="mord mathnormal mtight">L</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord">∥</span><span class="mord mathnormal">Q</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.677em;vertical-align:-1.25em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.05em;"><span style="top:-1.9em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span><span style="top:-3.05em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.25em;"><span></span></span></span></span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.427em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal">Q</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>意义：</p><ul><li>它表示：<strong>如果真实分布是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span>，但我们用 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Q</mi></mrow><annotation encoding="application/x-tex">Q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">Q</span></span></span></span> 来近似时，额外多花了多少信息量</strong>。</li><li>当 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo>=</mo><mi>Q</mi></mrow><annotation encoding="application/x-tex">P=Q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">Q</span></span></span></span> 时，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>D</mi><mrow><mi>K</mi><mi>L</mi></mrow></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">D_{KL}=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">K</span><span class="mord mathnormal mtight">L</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span>；否则 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>D</mi><mrow><mi>K</mi><mi>L</mi></mrow></msub><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">D_{KL} &gt; 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">K</span><span class="mord mathnormal mtight">L</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span>。</li></ul><hr><h2 id="5-性质总结"><a class="anchor" href="#5-性质总结">#</a> 5. 性质总结</h2><ol><li><p><strong>非负性</strong>：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>D</mi><mrow><mi>K</mi><mi>L</mi></mrow></msub><mo stretchy="false">(</mo><mi>P</mi><mi mathvariant="normal">∥</mi><mi>Q</mi><mo stretchy="false">)</mo><mo>≥</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">D_{KL}(P \| Q) \geq 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">K</span><span class="mord mathnormal mtight">L</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord">∥</span><span class="mord mathnormal">Q</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≥</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span></span></p><p>（由 Jensen 不等式保证）</p></li><li><p><strong>不对称性</strong>：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>D</mi><mrow><mi>K</mi><mi>L</mi></mrow></msub><mo stretchy="false">(</mo><mi>P</mi><mi mathvariant="normal">∥</mi><mi>Q</mi><mo stretchy="false">)</mo><mo mathvariant="normal">≠</mo><msub><mi>D</mi><mrow><mi>K</mi><mi>L</mi></mrow></msub><mo stretchy="false">(</mo><mi>Q</mi><mi mathvariant="normal">∥</mi><mi>P</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">D_{KL}(P \| Q) \neq D_{KL}(Q \| P)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">K</span><span class="mord mathnormal mtight">L</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord">∥</span><span class="mord mathnormal">Q</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel"><span class="mrel"><span class="mord vbox"><span class="thinbox"><span class="rlap"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="inner"><span class="mord"><span class="mrel"></span></span></span><span class="fix"></span></span></span></span></span><span class="mrel">=</span></span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">K</span><span class="mord mathnormal mtight">L</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">Q</span><span class="mord">∥</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mclose">)</span></span></span></span></span></p></li><li><p><strong>等于零的条件</strong>：<br>当且仅当 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mo>=</mo><mi>Q</mi></mrow><annotation encoding="application/x-tex">P = Q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">Q</span></span></span></span>。</p></li></ol><hr><h2 id="6-举个例子"><a class="anchor" href="#6-举个例子">#</a> 6. 举个例子</h2><p>真实分布：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>P</mi><mo>=</mo><mo stretchy="false">(</mo><mn>0.8</mn><mo separator="true">,</mo><mn>0.2</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">P = (0.8, 0.2)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">0.8</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0.2</span><span class="mclose">)</span></span></span></span></span></p><p>预测分布：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>Q</mi><mo>=</mo><mo stretchy="false">(</mo><mn>0.5</mn><mo separator="true">,</mo><mn>0.5</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">Q = (0.5, 0.5)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">Q</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">0.5</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">0.5</span><span class="mclose">)</span></span></span></span></span></p><p>计算：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>D</mi><mrow><mi>K</mi><mi>L</mi></mrow></msub><mo stretchy="false">(</mo><mi>P</mi><mi mathvariant="normal">∥</mi><mi>Q</mi><mo stretchy="false">)</mo><mo>=</mo><mn>0.8</mn><mi>log</mi><mo>⁡</mo><mfrac><mn>0.8</mn><mn>0.5</mn></mfrac><mo>+</mo><mn>0.2</mn><mi>log</mi><mo>⁡</mo><mfrac><mn>0.2</mn><mn>0.5</mn></mfrac><mo>≈</mo><mn>0.193</mn></mrow><annotation encoding="application/x-tex">D_{KL}(P \| Q) = 0.8 \log \frac{0.8}{0.5} + 0.2 \log \frac{0.2}{0.5} \approx 0.193</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3283em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.07153em;">K</span><span class="mord mathnormal mtight">L</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord">∥</span><span class="mord mathnormal">Q</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:2.0074em;vertical-align:-0.686em;"></span><span class="mord">0.8</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0.5</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0.8</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:2.0074em;vertical-align:-0.686em;"></span><span class="mord">0.2</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3214em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0.5</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord">0.2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0.193</span></span></span></span></span></p><p>说明：预测分布 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Q</mi></mrow><annotation encoding="application/x-tex">Q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"></span><span class="mord mathnormal">Q</span></span></span></span> 和真实分布 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span></span></span></span> 有一定差异，但还算可以接受。</p><hr><h2 id="7-在机器学习中的应用"><a class="anchor" href="#7-在机器学习中的应用">#</a> 7. 在机器学习中的应用</h2><ol><li><p><strong>分类任务</strong><br>常见的交叉熵损失函数，其实就是 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi><mo stretchy="false">(</mo><mi>P</mi><mo separator="true">,</mo><mi>Q</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">H(P, Q)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">Q</span><span class="mclose">)</span></span></span></span>，等价于 <strong>KL 散度 + 熵 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi><mo stretchy="false">(</mo><mi>P</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">H(P)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mclose">)</span></span></span></span></strong>（因为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>H</mi><mo stretchy="false">(</mo><mi>P</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">H(P)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.08125em;">H</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mclose">)</span></span></span></span> 是常数，不影响优化）。</p></li><li><p><strong>变分自编码器 (VAE)</strong><br>用 KL 散度约束隐变量分布不要偏离先验分布。</p></li><li><p><strong>强化学习</strong><br>用 KL 散度衡量新旧策略的差异，避免训练时更新过大。</p></li></ol><hr>]]></content>
    
    
    <summary type="html">本文从信息量、信息熵、交叉熵讲起，逐步引出 KL 散度的概念与应用。</summary>
    
    
    
    <category term="deeplearning" scheme="https://koen666.github.io/categories/deeplearning/"/>
    
    
    <category term="KL" scheme="https://koen666.github.io/tags/KL/"/>
    
    <category term="RE-ID" scheme="https://koen666.github.io/tags/RE-ID/"/>
    
  </entry>
  
  <entry>
    <title>argparse + yaml 在训练脚本中的使用</title>
    <link href="https://koen666.github.io/2025/09/21/yaml+argparse/"/>
    <id>https://koen666.github.io/2025/09/21/yaml+argparse/</id>
    <published>2025-09-20T16:00:00.000Z</published>
    <updated>2025-09-21T06:36:08.162Z</updated>
    
    <content type="html"><![CDATA[<p>在深度学习训练中，我们常用很多超参数。Python 提供两个工具帮助管理：</p><ol><li><strong>argparse</strong>：从命令行传参</li><li><strong>yaml</strong>：写配置文件</li><li><strong>easydict</strong>：让字典支持点号访问</li></ol><p>结合它们，就能灵活地管理训练参数，代码更清晰、可复现。</p><hr /><h2 id="1-命令行是怎么调用-python-脚本的"><a class="anchor" href="#1-命令行是怎么调用-python-脚本的">#</a> 1. 命令行是怎么调用 Python 脚本的？</h2><p>假设你有一个脚本 <code>train.py</code></p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-python"><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># train.py</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">print</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">Hello</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span></code></pre><p>在命令行里：</p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">python</span><span style="color:#B56959;--shiki-dark:#C98A7D"> train.py</span></span></code></pre><ul><li><code>python</code> → 调用 Python 解释器</li><li><code>train.py</code> → 要运行的脚本</li></ul><p>如果你想给脚本传参：</p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">python</span><span style="color:#B56959;--shiki-dark:#C98A7D"> train.py</span><span style="color:#A65E2B;--shiki-dark:#C99076"> --batch_size</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 64</span><span style="color:#A65E2B;--shiki-dark:#C99076"> --lr</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 0.01</span></span></code></pre><p>这里 <code>--batch_size 64</code>、<code>--lr 0.01</code> 就是 <strong>命令行参数</strong>，Python 默认不会解析它们，需要用 <strong>argparse</strong>。</p><hr /><h2 id="2-argparse-详解"><a class="anchor" href="#2-argparse-详解">#</a> 2. argparse 详解</h2><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-python"><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> argparse</span></span><span class="line"></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">parser </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> argparse</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">ArgumentParser</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">description</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">训练脚本示例</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span></code></pre><ul><li>创建解析器</li><li><code>description</code> 会显示在 <code>--help</code> 中</li></ul><h3 id="21-添加参数"><a class="anchor" href="#21-添加参数">#</a> 2.1 添加参数</h3><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-python"><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">parser</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">add_argument</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">--batch_size</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> type</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#998418;--shiki-dark:#B8A965">int</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> default</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#2F798A;--shiki-dark:#4C9A91">32</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> help</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">训练批大小</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">parser</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">add_argument</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">--lr</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> type</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#998418;--shiki-dark:#B8A965">float</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> default</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#2F798A;--shiki-dark:#4C9A91">0.001</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> help</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">学习率</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">parser</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">add_argument</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">--use_gpu</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> action</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">store_true</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> help</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">是否使用 GPU</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">args </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> parser</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">parse_args</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span></code></pre><h4 id="参数讲解"><a class="anchor" href="#参数讲解">#</a> 参数讲解：</h4><table><thead><tr><th>参数</th><th>说明</th></tr></thead><tbody><tr><td><code>--batch_size</code></td><td>参数名（命令行用 <code>--batch_size 64</code>）</td></tr><tr><td><code>type=int</code></td><td>自动转换类型，如果传入非 int 会报错</td></tr><tr><td><code>default=32</code></td><td>如果命令行没传这个参数，就用默认值 32</td></tr><tr><td><code>help=&quot;...&quot;</code></td><td>在 <code>python train.py -h</code> 中显示帮助</td></tr><tr><td><code>action=&quot;store_true&quot;</code></td><td>布尔开关，不传就是 False，传了就是 True</td></tr></tbody></table><h4 id="运行示例"><a class="anchor" href="#运行示例">#</a> 运行示例</h4><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">python</span><span style="color:#B56959;--shiki-dark:#C98A7D"> train.py</span><span style="color:#A65E2B;--shiki-dark:#C99076"> --batch_size</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 64</span><span style="color:#A65E2B;--shiki-dark:#C99076"> --use_gpu</span></span></code></pre><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-python"><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">print</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">args</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">batch_size</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#A0ADA0;--shiki-dark:#758575DD">  # 64</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">print</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">args</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">use_gpu</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#A0ADA0;--shiki-dark:#758575DD">     # True</span></span></code></pre><ul><li>不写 <code>--use_gpu</code> → <code>False</code></li><li>写了 <code>--use_gpu</code> → <code>True</code></li></ul><hr /><h3 id="22-其他常用-action"><a class="anchor" href="#22-其他常用-action">#</a> 2.2 其他常用 action</h3><ul><li><code>store_true</code> / <code>store_false</code> → 布尔开关</li><li><code>append</code> → 可以多次传参，把值收集成列表</li><li><code>count</code> → 统计参数出现次数（例如 <code>-v</code> 打印更详细日志）</li></ul><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-python"><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">parser</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">add_argument</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">-v</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">--verbose</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> action</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">count</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> default</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#2F798A;--shiki-dark:#4C9A91">0</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> help</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">增加日志详细级别</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span></code></pre><p>运行：</p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">python</span><span style="color:#B56959;--shiki-dark:#C98A7D"> train.py</span><span style="color:#A65E2B;--shiki-dark:#C99076"> -vvv</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">print</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B56959;--shiki-dark:#C98A7D">args.verbose</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">  </span><span style="color:#A0ADA0;--shiki-dark:#758575DD"># 3</span></span></code></pre><hr /><h3 id="23-位置参数必填"><a class="anchor" href="#23-位置参数必填">#</a> 2.3 位置参数（必填）</h3><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-python"><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">parser</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">add_argument</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">dataset_path</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> help</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">数据集路径</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span></code></pre><ul><li>命令行必须写：</li></ul><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">python</span><span style="color:#B56959;--shiki-dark:#C98A7D"> train.py</span><span style="color:#B56959;--shiki-dark:#C98A7D"> ./data</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">print</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B56959;--shiki-dark:#C98A7D">args.dataset_path</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">  </span><span style="color:#A0ADA0;--shiki-dark:#758575DD"># ./data</span></span></code></pre><hr /><h3 id="24-限定选项-choices"><a class="anchor" href="#24-限定选项-choices">#</a> 2.4 限定选项 choices</h3><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-python"><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">parser</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">add_argument</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">--optimizer</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> choices</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#1e754f;--shiki-dark:#4d9375">[</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">sgd</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">adam</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#1e754f;--shiki-dark:#4d9375">]</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> default</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">adam</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> help</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">优化器类型</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span></code></pre><ul><li>只能传 <code>&quot;sgd&quot;</code> 或 <code>&quot;adam&quot;</code></li><li>传其他 → argparse 会报错</li></ul><hr /><h3 id="25-多值参数-nargs"><a class="anchor" href="#25-多值参数-nargs">#</a> 2.5 多值参数 nargs</h3><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-python"><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">parser</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">add_argument</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">--layers</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> type</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#998418;--shiki-dark:#B8A965">int</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> nargs</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">+</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> help</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">每层神经元数量</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span></code></pre><p>运行：</p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">python</span><span style="color:#B56959;--shiki-dark:#C98A7D"> train.py</span><span style="color:#A65E2B;--shiki-dark:#C99076"> --layers</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 64</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 128</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 256</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">print</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B56959;--shiki-dark:#C98A7D">args.layers</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">  </span><span style="color:#A0ADA0;--shiki-dark:#758575DD"># [64, 128, 256]</span></span></code></pre><ul><li><code>nargs='+'</code> → 一个或多个</li><li><code>nargs='*'</code> → 零个或多个</li></ul><hr /><h3 id="26-查看帮助"><a class="anchor" href="#26-查看帮助">#</a> 2.6 查看帮助</h3><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">python</span><span style="color:#B56959;--shiki-dark:#C98A7D"> train.py</span><span style="color:#A65E2B;--shiki-dark:#C99076"> -h</span></span></code></pre><p>输出：</p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-text"><span class="line"><span>usage: train.py [-h] [--batch_size BATCH_SIZE] [--lr LR] [--use_gpu] ...</span></span><span class="line"><span></span></span><span class="line"><span>训练脚本示例</span></span><span class="line"><span></span></span><span class="line"><span>optional arguments:</span></span><span class="line"><span>  -h, --help            show this help message and exit</span></span><span class="line"><span>  --batch_size BATCH_SIZE</span></span><span class="line"><span>                        训练批大小 (default: 32)</span></span><span class="line"><span>  --lr LR               学习率 (default: 0.001)</span></span><span class="line"><span>  --use_gpu             是否使用 GPU</span></span></code></pre><hr /><h2 id="3-yaml-讲解"><a class="anchor" href="#3-yaml-讲解">#</a> 3. YAML 讲解</h2><p><strong>YAML</strong> 是一种人类可读的配置文件格式，常用于存储训练参数。</p><h3 id="31-示例-configyaml"><a class="anchor" href="#31-示例-configyaml">#</a> 3.1 示例 <code>config.yaml</code></h3><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-yaml"><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">train</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">  batch_size</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 64</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">  learning_rate</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 0.001</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">  num_epochs</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 10</span></span><span class="line"></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">model</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">  name</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">resnet18</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">  num_classes</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 100</span></span></code></pre><h3 id="32-python-读取"><a class="anchor" href="#32-python-读取">#</a> 3.2 Python 读取</h3><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-python"><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> yaml</span></span><span class="line"></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">with</span><span style="color:#998418;--shiki-dark:#B8A965"> open</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">config.yaml</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">r</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#1E754F;--shiki-dark:#4D9375"> as</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> f</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    config </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> yaml</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">safe_load</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">f</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">print</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">config</span><span style="color:#1e754f;--shiki-dark:#4d9375">[</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">train</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#1e754f;--shiki-dark:#4d9375">]</span><span style="color:#1e754f;--shiki-dark:#4d9375">[</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">batch_size</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#1e754f;--shiki-dark:#4d9375">]</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#A0ADA0;--shiki-dark:#758575DD">  # 64</span></span></code></pre><blockquote><p>推荐使用 <code>safe_load</code>，防止执行不安全代码</p></blockquote><hr /><h2 id="4-easydict-讲解"><a class="anchor" href="#4-easydict-讲解">#</a> 4. easydict 讲解</h2><p><code>easydict</code> 可以把字典转换成 <strong>支持点号访问的对象</strong>，这样访问嵌套参数就更清晰：</p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-python"><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">from</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> easydict </span><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> EasyDict </span><span style="color:#1E754F;--shiki-dark:#4D9375">as</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> edict</span></span><span class="line"></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">cfg_dict </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#2993a3;--shiki-dark:#5eaab5">&#123;</span></span><span class="line"><span style="color:#B5695977;--shiki-dark:#C98A7D77">    "</span><span style="color:#B56959;--shiki-dark:#C98A7D">train</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#1e754f;--shiki-dark:#4d9375">&#123;</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">batch_size</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 64</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">learning_rate</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 0.001</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">num_epochs</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 10</span><span style="color:#1e754f;--shiki-dark:#4d9375">&#125;</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#B5695977;--shiki-dark:#C98A7D77">    "</span><span style="color:#B56959;--shiki-dark:#C98A7D">model</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#1e754f;--shiki-dark:#4d9375">&#123;</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">name</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">resnet18</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">num_classes</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 100</span><span style="color:#1e754f;--shiki-dark:#4d9375">&#125;</span></span><span class="line"><span style="color:#2993a3;--shiki-dark:#5eaab5">&#125;</span></span><span class="line"></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">cfg </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> edict</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">cfg_dict</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">print</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">cfg</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">train</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">batch_size</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#A0ADA0;--shiki-dark:#758575DD">      # 64</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">print</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">cfg</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">model</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">name</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#A0ADA0;--shiki-dark:#758575DD">            # resnet18</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># 也可以像普通字典一样访问</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">print</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">cfg</span><span style="color:#1e754f;--shiki-dark:#4d9375">[</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">train</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#1e754f;--shiki-dark:#4d9375">]</span><span style="color:#1e754f;--shiki-dark:#4d9375">[</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">learning_rate</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#1e754f;--shiki-dark:#4d9375">]</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#A0ADA0;--shiki-dark:#758575DD">  # 0.001</span></span></code></pre><hr /><h2 id="5-argparse-yaml-easydict-结合使用"><a class="anchor" href="#5-argparse-yaml-easydict-结合使用">#</a> 5. argparse + YAML + easydict 结合使用</h2><p>思路：</p><ol><li>argparse 解析命令行参数</li><li>读取 YAML 配置</li><li>转换为 <code>EasyDict</code></li><li>用命令行参数覆盖 YAML 配置</li></ol><p>完整示例：</p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-python"><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> argparse</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> yaml</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">from</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> easydict </span><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> EasyDict </span><span style="color:#1E754F;--shiki-dark:#4D9375">as</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> edict</span></span><span class="line"></span><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">def</span><span style="color:#59873A;--shiki-dark:#80A665"> get_config</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    parser </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> argparse</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">ArgumentParser</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">description</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">训练脚本</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    parser</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">add_argument</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">--config</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> type</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#998418;--shiki-dark:#B8A965">str</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> default</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">config.yaml</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> help</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">配置文件路径</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    parser</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">add_argument</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">--batch_size</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> type</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#998418;--shiki-dark:#B8A965">int</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> help</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">覆盖 YAML 的批大小</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    parser</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">add_argument</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">--learning_rate</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> type</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#998418;--shiki-dark:#B8A965">float</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> help</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">覆盖 YAML 的学习率</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    parser</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">add_argument</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">--num_epochs</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> type</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#998418;--shiki-dark:#B8A965">int</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> help</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">覆盖 YAML 的训练轮数</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    parser</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">add_argument</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">--use_gpu</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> action</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">store_true</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> help</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">是否使用 GPU</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    args </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> parser</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">parse_args</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">    # 读取 YAML 并转换为 EasyDict</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">    with</span><span style="color:#998418;--shiki-dark:#B8A965"> open</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">args</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">config</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">r</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#1E754F;--shiki-dark:#4D9375"> as</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> f</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">        cfg </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> edict</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">yaml</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">safe_load</span><span style="color:#1e754f;--shiki-dark:#4d9375">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">f</span><span style="color:#1e754f;--shiki-dark:#4d9375">)</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">    # 命令行覆盖</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">    if</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> args</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">batch_size </span><span style="color:#AB5959;--shiki-dark:#CB7676">is</span><span style="color:#AB5959;--shiki-dark:#CB7676"> not</span><span style="color:#1E754F;--shiki-dark:#4D9375"> None</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">        cfg</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">train</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">batch_size </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> args</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">batch_size</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">    if</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> args</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">learning_rate </span><span style="color:#AB5959;--shiki-dark:#CB7676">is</span><span style="color:#AB5959;--shiki-dark:#CB7676"> not</span><span style="color:#1E754F;--shiki-dark:#4D9375"> None</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">        cfg</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">train</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">learning_rate </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> args</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">learning_rate</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">    if</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> args</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">num_epochs </span><span style="color:#AB5959;--shiki-dark:#CB7676">is</span><span style="color:#AB5959;--shiki-dark:#CB7676"> not</span><span style="color:#1E754F;--shiki-dark:#4D9375"> None</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">        cfg</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">train</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">num_epochs </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> args</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">num_epochs</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    cfg</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">train</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">use_gpu </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> args</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">use_gpu</span></span><span class="line"></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">    return</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> cfg</span></span><span class="line"></span><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">def</span><span style="color:#59873A;--shiki-dark:#80A665"> main</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    cfg </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> get_config</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">    print</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">最终训练配置：</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">    print</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">cfg</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">    # 使用配置</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">    print</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#AB5959;--shiki-dark:#CB7676">f</span><span style="color:#B56959;--shiki-dark:#C98A7D">"训练 </span><span style="color:#1e754f;--shiki-dark:#4d9375">&#123;</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">cfg</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">model</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">name</span><span style="color:#1e754f;--shiki-dark:#4d9375">&#125;</span><span style="color:#B56959;--shiki-dark:#C98A7D">，批大小 </span><span style="color:#1e754f;--shiki-dark:#4d9375">&#123;</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">cfg</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">train</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">batch_size</span><span style="color:#1e754f;--shiki-dark:#4d9375">&#125;</span><span style="color:#B56959;--shiki-dark:#C98A7D">，学习率 </span><span style="color:#1e754f;--shiki-dark:#4d9375">&#123;</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">cfg</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">train</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">learning_rate</span><span style="color:#1e754f;--shiki-dark:#4d9375">&#125;</span><span style="color:#B56959;--shiki-dark:#C98A7D">"</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">if</span><span style="color:#998418;--shiki-dark:#B8A965"> __name__</span><span style="color:#AB5959;--shiki-dark:#CB7676"> ==</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">__main__</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    main</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span></code></pre><hr /><h3 id="51-使用方法"><a class="anchor" href="#51-使用方法">#</a> 5.1 使用方法</h3><ol><li>默认 YAML 配置：</li></ol><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">python</span><span style="color:#B56959;--shiki-dark:#C98A7D"> train.py</span></span></code></pre><ol start="2"><li>指定 YAML 文件：</li></ol><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">python</span><span style="color:#B56959;--shiki-dark:#C98A7D"> train.py</span><span style="color:#A65E2B;--shiki-dark:#C99076"> --config</span><span style="color:#B56959;--shiki-dark:#C98A7D"> configs/exp1.yaml</span></span></code></pre><ol start="3"><li>命令行覆盖部分参数：</li></ol><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">python</span><span style="color:#B56959;--shiki-dark:#C98A7D"> train.py</span><span style="color:#A65E2B;--shiki-dark:#C99076"> --batch_size</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 128</span><span style="color:#A65E2B;--shiki-dark:#C99076"> --learning_rate</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 0.0005</span><span style="color:#A65E2B;--shiki-dark:#C99076"> --use_gpu</span></span></code></pre><p>访问参数时可以直接用 <strong>点号</strong>：</p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-python"><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">cfg</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">train</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">batch_size</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">cfg</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">model</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">name</span></span></code></pre><p>训练循环里使用：</p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-python"><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">for</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> epoch </span><span style="color:#1E754F;--shiki-dark:#4D9375">in</span><span style="color:#998418;--shiki-dark:#B8A965"> range</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">cfg</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">train</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">num_epochs</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">    for</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> x</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> y </span><span style="color:#1E754F;--shiki-dark:#4D9375">in</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> dataloader</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">batch_size</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">cfg</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">train</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">batch_size</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#A65E2B;--shiki-dark:#C99076">        ...</span></span></code></pre><hr /><h2 id="6-总结"><a class="anchor" href="#6-总结">#</a> 6. 总结</h2><ul><li><strong>argparse</strong>：灵活修改、临时覆盖参数</li><li><strong>YAML</strong>：记录实验参数、便于复现</li><li><strong>easydict</strong>：让配置访问更直观、简洁</li><li><strong>结合使用</strong>：YAML 保存默认参数，argparse 命令行覆盖，easydict 优化访问</li></ul><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-text"><span class="line"><span></span></span></code></pre>]]></content>
    
    
    <summary type="html">本文介绍使用 argparse + yaml + easydict 三者结合在训练脚本中的使用</summary>
    
    
    
    <category term="deeplearning" scheme="https://koen666.github.io/categories/deeplearning/"/>
    
    
    <category term="yaml" scheme="https://koen666.github.io/tags/yaml/"/>
    
    <category term="argparse" scheme="https://koen666.github.io/tags/argparse/"/>
    
    <category term="easydict" scheme="https://koen666.github.io/tags/easydict/"/>
    
  </entry>
  
  <entry>
    <title>vue如何使用router</title>
    <link href="https://koen666.github.io/2025/09/16/vue-router/"/>
    <id>https://koen666.github.io/2025/09/16/vue-router/</id>
    <published>2025-09-15T16:00:00.000Z</published>
    <updated>2026-01-18T08:23:43.005Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1新建项目并初始化-packagejson"><a class="anchor" href="#1新建项目并初始化-packagejson">#</a> 1）新建项目并初始化 package.json</h1><p>在你想放项目的目录执行：</p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">mkdir</span><span style="color:#B56959;--shiki-dark:#C98A7D"> vue-router-demo</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">cd</span><span style="color:#B56959;--shiki-dark:#C98A7D"> vue-router-demo</span></span><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">npm</span><span style="color:#B56959;--shiki-dark:#C98A7D"> init</span><span style="color:#A65E2B;--shiki-dark:#C99076"> -y</span></span></code></pre><p>说明：</p><ul><li><code>npm init -y</code> 会生成一个基本的 <code>package.json</code>，我们后面会往里面加脚本。</li></ul><hr /><h1 id="2从你要求的那条开始安装-vue"><a class="anchor" href="#2从你要求的那条开始安装-vue">#</a> 2）从你要求的那条开始：安装 Vue</h1><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">npm</span><span style="color:#B56959;--shiki-dark:#C98A7D"> install</span><span style="color:#B56959;--shiki-dark:#C98A7D"> vue@latest</span></span></code></pre><p>说明：</p><ul><li>这会把最新稳定版 Vue（通常是 Vue 3）装到 <code>node_modules</code> 并加到 <code>package.json</code> 的 dependencies。</li></ul><hr /><h1 id="3安装开发工具vite与-vue-插件"><a class="anchor" href="#3安装开发工具vite与-vue-插件">#</a> 3）安装开发工具（Vite）与 Vue 插件</h1><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">npm</span><span style="color:#B56959;--shiki-dark:#C98A7D"> install</span><span style="color:#A65E2B;--shiki-dark:#C99076"> -D</span><span style="color:#B56959;--shiki-dark:#C98A7D"> vite</span><span style="color:#B56959;--shiki-dark:#C98A7D"> @vitejs/plugin-vue</span></span></code></pre><p>说明：</p><ul><li>Vite 是现代前端开发工具：启动快、热模块替换(HMR)体验好。 <code>@vitejs/plugin-vue</code> 让 Vite 能处理 <code>.vue</code> 单文件组件（SFC）。</li></ul><hr /><h1 id="4安装-vue-routervue-3-用-vue-router4"><a class="anchor" href="#4安装-vue-routervue-3-用-vue-router4">#</a> 4）安装 vue-router（Vue 3 用 vue-router@4）</h1><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">npm</span><span style="color:#B56959;--shiki-dark:#C98A7D"> install</span><span style="color:#B56959;--shiki-dark:#C98A7D"> vue-router@4</span></span></code></pre><p>说明：</p><ul><li><code>vue-router@4</code> 与 Vue 3 配套，负责单页应用的路由管理（链接、路由钩子、动态路由等）。</li></ul><hr /><h1 id="5在-packagejson-添加常用脚本"><a class="anchor" href="#5在-packagejson-添加常用脚本">#</a> 5）在 <code>package.json</code> 添加常用脚本</h1><p>编辑 <code>package.json</code> 的 <code>scripts</code> 字段，加入：</p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-json"><span class="line"><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">scripts</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">: </span><span style="color:#2993a3;--shiki-dark:#5eaab5">&#123;</span></span><span class="line"><span style="color:#99841877;--shiki-dark:#B8A96577">  "</span><span style="color:#998418;--shiki-dark:#B8A965">dev</span><span style="color:#99841877;--shiki-dark:#B8A96577">"</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">vite</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#99841877;--shiki-dark:#B8A96577">  "</span><span style="color:#998418;--shiki-dark:#B8A965">build</span><span style="color:#99841877;--shiki-dark:#B8A96577">"</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">vite build</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#99841877;--shiki-dark:#B8A96577">  "</span><span style="color:#998418;--shiki-dark:#B8A965">preview</span><span style="color:#99841877;--shiki-dark:#B8A96577">"</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">vite preview</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span></span><span class="line"><span style="color:#2993a3;--shiki-dark:#5eaab5">&#125;</span></span></code></pre><p>说明：</p><ul><li><code>npm run dev</code>：本地开发服务器（带 HMR）</li><li><code>npm run build</code>：生产构建（打包）</li><li><code>npm run preview</code>：本地预览打包输出（用于检查构建产物）</li></ul><hr /><h1 id="6项目目录结构我们要创建这些文件"><a class="anchor" href="#6项目目录结构我们要创建这些文件">#</a> 6）项目目录结构（我们要创建这些文件）</h1><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-text"><span class="line"><span>vue-router-demo/</span></span><span class="line"><span>├─ index.html</span></span><span class="line"><span>├─ package.json</span></span><span class="line"><span>├─ vite.config.js</span></span><span class="line"><span>└─ src/</span></span><span class="line"><span>   ├─ main.js</span></span><span class="line"><span>   ├─ App.vue</span></span><span class="line"><span>   ├─ router/</span></span><span class="line"><span>   │  └─ index.js</span></span><span class="line"><span>   └─ views/</span></span><span class="line"><span>      ├─ Home.vue</span></span><span class="line"><span>      ├─ About.vue</span></span><span class="line"><span>      └─ User.vue</span></span></code></pre><p>下面逐个文件给出可复制的完整代码，并解释关键行。</p><hr /><h1 id="7创建-viteconfigjs"><a class="anchor" href="#7创建-viteconfigjs">#</a> 7）创建 <code>vite.config.js</code></h1><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-js"><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">// vite.config.js</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#2993a3;--shiki-dark:#5eaab5">&#123;</span><span style="color:#B07D48;--shiki-dark:#BD976A"> defineConfig</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#2993a3;--shiki-dark:#5eaab5">&#125;</span><span style="color:#1E754F;--shiki-dark:#4D9375"> from</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">vite</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#B07D48;--shiki-dark:#BD976A"> vue</span><span style="color:#1E754F;--shiki-dark:#4D9375"> from</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">@vitejs/plugin-vue</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span></span><span class="line"></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">export</span><span style="color:#1E754F;--shiki-dark:#4D9375"> default</span><span style="color:#59873A;--shiki-dark:#80A665"> defineConfig</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#1e754f;--shiki-dark:#4d9375">&#123;</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">  plugins</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#a65e2b;--shiki-dark:#d4976c">[</span><span style="color:#59873A;--shiki-dark:#80A665">vue</span><span style="color:#a13865;--shiki-dark:#d9739f">(</span><span style="color:#a13865;--shiki-dark:#d9739f">)</span><span style="color:#a65e2b;--shiki-dark:#d4976c">]</span></span><span class="line"><span style="color:#1e754f;--shiki-dark:#4d9375">&#125;</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span></code></pre><p>说明：</p><ul><li>必须把 <code>@vitejs/plugin-vue</code> 注册为插件，让 Vite 能识别 <code>.vue</code>。</li></ul><hr /><h1 id="8创建-indexhtml"><a class="anchor" href="#8创建-indexhtml">#</a> 8）创建 <code>index.html</code></h1><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-html"><span class="line"><span style="color:#999999;--shiki-dark:#666666">&#x3C;!</span><span style="color:#1E754F;--shiki-dark:#4D9375">doctype</span><span style="color:#B07D48;--shiki-dark:#BD976A"> html</span><span style="color:#999999;--shiki-dark:#666666">></span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#1E754F;--shiki-dark:#4D9375">html</span><span style="color:#B07D48;--shiki-dark:#BD976A"> lang</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">en</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">></span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">  &#x3C;</span><span style="color:#1E754F;--shiki-dark:#4D9375">head</span><span style="color:#999999;--shiki-dark:#666666">></span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">    &#x3C;</span><span style="color:#1E754F;--shiki-dark:#4D9375">meta</span><span style="color:#B07D48;--shiki-dark:#BD976A"> charset</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">utf-8</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666"> /></span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">    &#x3C;</span><span style="color:#1E754F;--shiki-dark:#4D9375">meta</span><span style="color:#B07D48;--shiki-dark:#BD976A"> name</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">viewport</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B07D48;--shiki-dark:#BD976A"> content</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">width=device-width, initial-scale=1.0</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666"> /></span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">    &#x3C;</span><span style="color:#1E754F;--shiki-dark:#4D9375">title</span><span style="color:#999999;--shiki-dark:#666666">></span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">Vue Router Demo</span><span style="color:#999999;--shiki-dark:#666666">&#x3C;/</span><span style="color:#1E754F;--shiki-dark:#4D9375">title</span><span style="color:#999999;--shiki-dark:#666666">></span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">  &#x3C;/</span><span style="color:#1E754F;--shiki-dark:#4D9375">head</span><span style="color:#999999;--shiki-dark:#666666">></span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">  &#x3C;</span><span style="color:#1E754F;--shiki-dark:#4D9375">body</span><span style="color:#999999;--shiki-dark:#666666">></span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">    &#x3C;</span><span style="color:#1E754F;--shiki-dark:#4D9375">div</span><span style="color:#B07D48;--shiki-dark:#BD976A"> id</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">app</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">>&#x3C;/</span><span style="color:#1E754F;--shiki-dark:#4D9375">div</span><span style="color:#999999;--shiki-dark:#666666">></span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">    &#x3C;!-- vite 使用 module 脚本入口 --></span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">    &#x3C;</span><span style="color:#1E754F;--shiki-dark:#4D9375">script</span><span style="color:#B07D48;--shiki-dark:#BD976A"> type</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">module</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B07D48;--shiki-dark:#BD976A"> src</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">/src/main.js</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">>&#x3C;/</span><span style="color:#1E754F;--shiki-dark:#4D9375">script</span><span style="color:#999999;--shiki-dark:#666666">></span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">  &#x3C;/</span><span style="color:#1E754F;--shiki-dark:#4D9375">body</span><span style="color:#999999;--shiki-dark:#666666">></span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">&#x3C;/</span><span style="color:#1E754F;--shiki-dark:#4D9375">html</span><span style="color:#999999;--shiki-dark:#666666">></span></span></code></pre><p>说明：</p><ul><li>Vite 要求在 HTML 中用 <code>type=&quot;module&quot;</code> 引入入口文件（<code>/src/main.js</code>）。</li></ul><hr /><h1 id="9创建-srcmainjs项目启动文件"><a class="anchor" href="#9创建-srcmainjs项目启动文件">#</a> 9）创建 <code>src/main.js</code>（项目启动文件）</h1><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-js"><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">// src/main.js</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#2993a3;--shiki-dark:#5eaab5">&#123;</span><span style="color:#B07D48;--shiki-dark:#BD976A"> createApp</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#2993a3;--shiki-dark:#5eaab5">&#125;</span><span style="color:#1E754F;--shiki-dark:#4D9375"> from</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">vue</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#B07D48;--shiki-dark:#BD976A"> App</span><span style="color:#1E754F;--shiki-dark:#4D9375"> from</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">./App.vue</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#B07D48;--shiki-dark:#BD976A"> router</span><span style="color:#1E754F;--shiki-dark:#4D9375"> from</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">./router</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#A0ADA0;--shiki-dark:#758575DD"> // 会自动找 src/router/index.js</span></span><span class="line"></span><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">const</span><span style="color:#B07D48;--shiki-dark:#BD976A"> app</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#59873A;--shiki-dark:#80A665"> createApp</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">App</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#B07D48;--shiki-dark:#BD976A">app</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#59873A;--shiki-dark:#80A665">use</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">router</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#A0ADA0;--shiki-dark:#758575DD">  // 把路由插件挂载到 Vue 应用</span></span><span class="line"><span style="color:#B07D48;--shiki-dark:#BD976A">app</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#59873A;--shiki-dark:#80A665">mount</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#B56959;--shiki-dark:#C98A7D">#app</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span></code></pre><p>解释：</p><ul><li><code>createApp(App)</code>：创建 Vue 应用实例。</li><li><code>app.use(router)</code>：把 vue-router 注册为插件（这样组件内可以使用 <code>&lt;router-link&gt;</code>、<code>&lt;router-view&gt;</code>、<code>useRouter()</code> 等）。</li><li><code>app.mount('#app')</code>：把应用挂到 index.html 的 <code>&lt;div id=&quot;app&quot;&gt;</code>。</li></ul><hr /><h1 id="10创建路由文件-srcrouterindexjs"><a class="anchor" href="#10创建路由文件-srcrouterindexjs">#</a> 10）创建路由文件 <code>src/router/index.js</code></h1><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-js"><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">// src/router/index.js</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#2993a3;--shiki-dark:#5eaab5">&#123;</span><span style="color:#B07D48;--shiki-dark:#BD976A"> createRouter</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> createWebHistory</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#2993a3;--shiki-dark:#5eaab5">&#125;</span><span style="color:#1E754F;--shiki-dark:#4D9375"> from</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">vue-router</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#B07D48;--shiki-dark:#BD976A"> Home</span><span style="color:#1E754F;--shiki-dark:#4D9375"> from</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">../views/Home.vue</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#B07D48;--shiki-dark:#BD976A"> About</span><span style="color:#1E754F;--shiki-dark:#4D9375"> from</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">../views/About.vue</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#B07D48;--shiki-dark:#BD976A"> User</span><span style="color:#1E754F;--shiki-dark:#4D9375"> from</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">../views/User.vue</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span></span><span class="line"></span><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">const</span><span style="color:#B07D48;--shiki-dark:#BD976A"> routes</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#2993a3;--shiki-dark:#5eaab5">[</span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">  </span><span style="color:#1e754f;--shiki-dark:#4d9375">&#123;</span><span style="color:#998418;--shiki-dark:#B8A965"> path</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">/</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#998418;--shiki-dark:#B8A965"> name</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">Home</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#998418;--shiki-dark:#B8A965"> component</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B07D48;--shiki-dark:#BD976A"> Home</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#1e754f;--shiki-dark:#4d9375">&#125;</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">  // 懒加载写法（可选）：component: () => import('../views/About.vue')</span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">  </span><span style="color:#1e754f;--shiki-dark:#4d9375">&#123;</span><span style="color:#998418;--shiki-dark:#B8A965"> path</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">/about</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#998418;--shiki-dark:#B8A965"> name</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">About</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#998418;--shiki-dark:#B8A965"> component</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B07D48;--shiki-dark:#BD976A"> About</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#1e754f;--shiki-dark:#4d9375">&#125;</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">  // 动态路由： :id 是参数； props: true 会把 route.params 作为组件 props</span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">  </span><span style="color:#1e754f;--shiki-dark:#4d9375">&#123;</span><span style="color:#998418;--shiki-dark:#B8A965"> path</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">/user/:id</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#998418;--shiki-dark:#B8A965"> name</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">User</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#998418;--shiki-dark:#B8A965"> component</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B07D48;--shiki-dark:#BD976A"> User</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#998418;--shiki-dark:#B8A965"> props</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#1E754F;--shiki-dark:#4D9375"> true</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#1e754f;--shiki-dark:#4d9375">&#125;</span></span><span class="line"><span style="color:#2993a3;--shiki-dark:#5eaab5">]</span></span><span class="line"></span><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">const</span><span style="color:#B07D48;--shiki-dark:#BD976A"> router</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#59873A;--shiki-dark:#80A665"> createRouter</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#1e754f;--shiki-dark:#4d9375">&#123;</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">  history</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#59873A;--shiki-dark:#80A665"> createWebHistory</span><span style="color:#a65e2b;--shiki-dark:#d4976c">(</span><span style="color:#a65e2b;--shiki-dark:#d4976c">)</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#A0ADA0;--shiki-dark:#758575DD"> // 使用 HTML5 history 模式</span></span><span class="line"><span style="color:#B07D48;--shiki-dark:#BD976A">  routes</span></span><span class="line"><span style="color:#1e754f;--shiki-dark:#4d9375">&#125;</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">export</span><span style="color:#1E754F;--shiki-dark:#4D9375"> default</span><span style="color:#B07D48;--shiki-dark:#BD976A"> router</span></span></code></pre><p>说明：</p><ul><li><code>createWebHistory()</code>：产生“漂亮的”URL（无 <code>#</code>）。但部署到静态服务器时要确保服务器把所有请求回退到 <code>index.html</code>（否则刷新会 404）。如果你不能配置服务器，改用 <code>createWebHashHistory()</code>，URL 会带 <code>#</code>（例如 <code>/#/about</code>），无需服务器配置。</li></ul><hr /><h1 id="11创建根组件-srcappvue"><a class="anchor" href="#11创建根组件-srcappvue">#</a> 11）创建根组件 <code>src/App.vue</code></h1><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-vue"><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">&#x3C;!-- src/App.vue --></span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#1E754F;--shiki-dark:#4D9375">template</span><span style="color:#999999;--shiki-dark:#666666">></span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">  </span><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#1E754F;--shiki-dark:#4D9375">div</span><span style="color:#999999;--shiki-dark:#666666">></span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">    </span><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#1E754F;--shiki-dark:#4D9375">nav</span><span style="color:#999999;--shiki-dark:#666666">></span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">      </span><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#1E754F;--shiki-dark:#4D9375">router-link</span><span style="color:#B07D48;--shiki-dark:#BD976A"> to</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">/</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">></span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">Home</span><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#999999;--shiki-dark:#666666">/</span><span style="color:#1E754F;--shiki-dark:#4D9375">router-link</span><span style="color:#999999;--shiki-dark:#666666">></span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> |</span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">      </span><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#1E754F;--shiki-dark:#4D9375">router-link</span><span style="color:#B07D48;--shiki-dark:#BD976A"> to</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">/about</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">></span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">About</span><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#999999;--shiki-dark:#666666">/</span><span style="color:#1E754F;--shiki-dark:#4D9375">router-link</span><span style="color:#999999;--shiki-dark:#666666">></span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> |</span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">      </span><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#1E754F;--shiki-dark:#4D9375">router-link</span><span style="color:#B07D48;--shiki-dark:#BD976A"> :to</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">&#123; name: 'User', params: &#123; id: 123 &#125; &#125;</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">></span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">User 123</span><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#999999;--shiki-dark:#666666">/</span><span style="color:#1E754F;--shiki-dark:#4D9375">router-link</span><span style="color:#999999;--shiki-dark:#666666">></span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">    </span><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#999999;--shiki-dark:#666666">/</span><span style="color:#1E754F;--shiki-dark:#4D9375">nav</span><span style="color:#999999;--shiki-dark:#666666">></span></span><span class="line"></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">    </span><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#1E754F;--shiki-dark:#4D9375">hr</span><span style="color:#999999;--shiki-dark:#666666"> /</span><span style="color:#999999;--shiki-dark:#666666">></span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">    &#x3C;!-- 路由视图：当前路由对应的组件会渲染到这里 --></span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">    </span><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#1E754F;--shiki-dark:#4D9375">router-view</span><span style="color:#999999;--shiki-dark:#666666"> /</span><span style="color:#999999;--shiki-dark:#666666">></span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">  </span><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#999999;--shiki-dark:#666666">/</span><span style="color:#1E754F;--shiki-dark:#4D9375">div</span><span style="color:#999999;--shiki-dark:#666666">></span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#999999;--shiki-dark:#666666">/</span><span style="color:#1E754F;--shiki-dark:#4D9375">template</span><span style="color:#999999;--shiki-dark:#666666">></span></span><span class="line"></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#1E754F;--shiki-dark:#4D9375">style</span><span style="color:#999999;--shiki-dark:#666666">></span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">nav</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#2993a3;--shiki-dark:#5eaab5">&#123;</span><span style="color:#998418;--shiki-dark:#B8A965"> padding</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 1</span><span style="color:#AB5959;--shiki-dark:#CB7676">rem</span><span style="color:#999999;--shiki-dark:#666666">;</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#2993a3;--shiki-dark:#5eaab5">&#125;</span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#B07D48;--shiki-dark:#BD976A">router-link-active</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#2993a3;--shiki-dark:#5eaab5">&#123;</span><span style="color:#998418;--shiki-dark:#B8A965"> font-weight</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#A65E2B;--shiki-dark:#C99076"> bold</span><span style="color:#999999;--shiki-dark:#666666">;</span><span style="color:#998418;--shiki-dark:#B8A965"> color</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#999999;--shiki-dark:#666666"> #</span><span style="color:#A65E2B;--shiki-dark:#C99076">42b983</span><span style="color:#999999;--shiki-dark:#666666">;</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#2993a3;--shiki-dark:#5eaab5">&#125;</span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#999999;--shiki-dark:#666666">/</span><span style="color:#1E754F;--shiki-dark:#4D9375">style</span><span style="color:#999999;--shiki-dark:#666666">></span></span></code></pre><p>说明：</p><ul><li><code>&lt;router-link&gt;</code>：替代 <code>&lt;a&gt;</code> 的路由链接组件，内部处理 push/replace 而不刷新页面。</li><li><code>&lt;router-view&gt;</code>：路由占位符，渲染当前路由对应组件。</li><li><code>.router-link-active</code>：路由激活时默认类名，可以用来高亮当前链接。</li></ul><hr /><h1 id="12示例视图组件homevue-aboutvue-uservue"><a class="anchor" href="#12示例视图组件homevue-aboutvue-uservue">#</a> 12）示例视图组件：<code>Home.vue</code>, <code>About.vue</code>, <code>User.vue</code></h1><p><code>src/views/Home.vue</code></p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-vue"><span class="line"><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#1E754F;--shiki-dark:#4D9375">template</span><span style="color:#999999;--shiki-dark:#666666">></span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">  </span><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#1E754F;--shiki-dark:#4D9375">div</span><span style="color:#999999;--shiki-dark:#666666">></span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">    </span><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#1E754F;--shiki-dark:#4D9375">h1</span><span style="color:#999999;--shiki-dark:#666666">></span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">Home</span><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#999999;--shiki-dark:#666666">/</span><span style="color:#1E754F;--shiki-dark:#4D9375">h1</span><span style="color:#999999;--shiki-dark:#666666">></span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">    </span><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#1E754F;--shiki-dark:#4D9375">p</span><span style="color:#999999;--shiki-dark:#666666">></span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">Welcome to the Vue + Router demo.</span><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#999999;--shiki-dark:#666666">/</span><span style="color:#1E754F;--shiki-dark:#4D9375">p</span><span style="color:#999999;--shiki-dark:#666666">></span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">    </span><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#1E754F;--shiki-dark:#4D9375">button</span><span style="color:#B07D48;--shiki-dark:#BD976A"> @click</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">goUser42</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">></span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">Go to User 42 </span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">programmatic</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#999999;--shiki-dark:#666666">/</span><span style="color:#1E754F;--shiki-dark:#4D9375">button</span><span style="color:#999999;--shiki-dark:#666666">></span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">  </span><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#999999;--shiki-dark:#666666">/</span><span style="color:#1E754F;--shiki-dark:#4D9375">div</span><span style="color:#999999;--shiki-dark:#666666">></span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#999999;--shiki-dark:#666666">/</span><span style="color:#1E754F;--shiki-dark:#4D9375">template</span><span style="color:#999999;--shiki-dark:#666666">></span></span><span class="line"></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#1E754F;--shiki-dark:#4D9375">script</span><span style="color:#B07D48;--shiki-dark:#BD976A"> setup</span><span style="color:#999999;--shiki-dark:#666666">></span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#2993a3;--shiki-dark:#5eaab5">&#123;</span><span style="color:#B07D48;--shiki-dark:#BD976A"> useRouter</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#2993a3;--shiki-dark:#5eaab5">&#125;</span><span style="color:#1E754F;--shiki-dark:#4D9375"> from</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">vue-router</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span></span><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">const</span><span style="color:#B07D48;--shiki-dark:#BD976A"> router</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#59873A;--shiki-dark:#80A665"> useRouter</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">function</span><span style="color:#59873A;--shiki-dark:#80A665"> goUser42</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#2993a3;--shiki-dark:#5eaab5">&#123;</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">  // programmatic navigation</span></span><span class="line"><span style="color:#B07D48;--shiki-dark:#BD976A">  router</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#59873A;--shiki-dark:#80A665">push</span><span style="color:#1e754f;--shiki-dark:#4d9375">(</span><span style="color:#a65e2b;--shiki-dark:#d4976c">&#123;</span><span style="color:#998418;--shiki-dark:#B8A965"> name</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">User</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#998418;--shiki-dark:#B8A965"> params</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#a13865;--shiki-dark:#d9739f">&#123;</span><span style="color:#998418;--shiki-dark:#B8A965"> id</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 42</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#a13865;--shiki-dark:#d9739f">&#125;</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#a65e2b;--shiki-dark:#d4976c">&#125;</span><span style="color:#1e754f;--shiki-dark:#4d9375">)</span></span><span class="line"><span style="color:#2993a3;--shiki-dark:#5eaab5">&#125;</span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#999999;--shiki-dark:#666666">/</span><span style="color:#1E754F;--shiki-dark:#4D9375">script</span><span style="color:#999999;--shiki-dark:#666666">></span></span></code></pre><p><code>src/views/About.vue</code></p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-vue"><span class="line"><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#1E754F;--shiki-dark:#4D9375">template</span><span style="color:#999999;--shiki-dark:#666666">></span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">  </span><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#1E754F;--shiki-dark:#4D9375">div</span><span style="color:#999999;--shiki-dark:#666666">></span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">    </span><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#1E754F;--shiki-dark:#4D9375">h1</span><span style="color:#999999;--shiki-dark:#666666">></span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">About</span><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#999999;--shiki-dark:#666666">/</span><span style="color:#1E754F;--shiki-dark:#4D9375">h1</span><span style="color:#999999;--shiki-dark:#666666">></span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">    </span><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#1E754F;--shiki-dark:#4D9375">p</span><span style="color:#999999;--shiki-dark:#666666">></span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">Simple about page.</span><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#999999;--shiki-dark:#666666">/</span><span style="color:#1E754F;--shiki-dark:#4D9375">p</span><span style="color:#999999;--shiki-dark:#666666">></span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">  </span><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#999999;--shiki-dark:#666666">/</span><span style="color:#1E754F;--shiki-dark:#4D9375">div</span><span style="color:#999999;--shiki-dark:#666666">></span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#999999;--shiki-dark:#666666">/</span><span style="color:#1E754F;--shiki-dark:#4D9375">template</span><span style="color:#999999;--shiki-dark:#666666">></span></span></code></pre><p><code>src/views/User.vue</code></p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-vue"><span class="line"><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#1E754F;--shiki-dark:#4D9375">template</span><span style="color:#999999;--shiki-dark:#666666">></span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">  </span><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#1E754F;--shiki-dark:#4D9375">div</span><span style="color:#999999;--shiki-dark:#666666">></span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">    </span><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#1E754F;--shiki-dark:#4D9375">h1</span><span style="color:#999999;--shiki-dark:#666666">></span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">User page</span><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#999999;--shiki-dark:#666666">/</span><span style="color:#1E754F;--shiki-dark:#4D9375">h1</span><span style="color:#999999;--shiki-dark:#666666">></span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">    </span><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#1E754F;--shiki-dark:#4D9375">p</span><span style="color:#999999;--shiki-dark:#666666">></span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">User id: </span><span style="color:#A0ADA0;--shiki-dark:#758575DD">&#x3C;!--swig￼0--></span><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#999999;--shiki-dark:#666666">/</span><span style="color:#1E754F;--shiki-dark:#4D9375">p</span><span style="color:#999999;--shiki-dark:#666666">></span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">    </span><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#1E754F;--shiki-dark:#4D9375">button</span><span style="color:#B07D48;--shiki-dark:#BD976A"> @click</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">$router.back()</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">></span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">Back</span><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#999999;--shiki-dark:#666666">/</span><span style="color:#1E754F;--shiki-dark:#4D9375">button</span><span style="color:#999999;--shiki-dark:#666666">></span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">  </span><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#999999;--shiki-dark:#666666">/</span><span style="color:#1E754F;--shiki-dark:#4D9375">div</span><span style="color:#999999;--shiki-dark:#666666">></span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#999999;--shiki-dark:#666666">/</span><span style="color:#1E754F;--shiki-dark:#4D9375">template</span><span style="color:#999999;--shiki-dark:#666666">></span></span><span class="line"></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#1E754F;--shiki-dark:#4D9375">script</span><span style="color:#B07D48;--shiki-dark:#BD976A"> setup</span><span style="color:#999999;--shiki-dark:#666666">></span></span><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">const</span><span style="color:#B07D48;--shiki-dark:#BD976A"> props</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#59873A;--shiki-dark:#80A665"> defineProps</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#1e754f;--shiki-dark:#4d9375">&#123;</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">  id</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#a65e2b;--shiki-dark:#d4976c">&#123;</span><span style="color:#998418;--shiki-dark:#B8A965"> type</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#a13865;--shiki-dark:#d9739f">[</span><span style="color:#B07D48;--shiki-dark:#BD976A">String</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> Number</span><span style="color:#a13865;--shiki-dark:#d9739f">]</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#998418;--shiki-dark:#B8A965"> required</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#1E754F;--shiki-dark:#4D9375"> true</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#a65e2b;--shiki-dark:#d4976c">&#125;</span></span><span class="line"><span style="color:#1e754f;--shiki-dark:#4d9375">&#125;</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#999999;--shiki-dark:#666666">/</span><span style="color:#1E754F;--shiki-dark:#4D9375">script</span><span style="color:#999999;--shiki-dark:#666666">></span></span></code></pre><p>说明：</p><ul><li><code>Home.vue</code> 示范“编程式导航”（<code>router.push(&#123;...&#125;)</code>）。</li><li><code>User.vue</code> 使用 <code>props</code> 接收路由参数（因为我们在路由配置里写了 <code>props: true</code>）。这样组件更容易测试、复用，不用在组件内部直接读 <code>$route.params</code>。</li></ul><hr /><h1 id="13运行开发服务器"><a class="anchor" href="#13运行开发服务器">#</a> 13）运行开发服务器</h1><p>在项目根运行：</p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">npm</span><span style="color:#B56959;--shiki-dark:#C98A7D"> run</span><span style="color:#B56959;--shiki-dark:#C98A7D"> dev</span></span></code></pre><p>会看到类似：</p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-text"><span class="line"><span>  vite vX.X.X  ready in 200ms</span></span><span class="line"><span>  ➜  Local: http://localhost:5173/</span></span></code></pre><p>打开浏览器访问 <code>http://localhost:5173</code>（端口以实际启动日志为准）。点击导航链接、试试“Go to User 42”按钮，URL 与页面应同步变化且不会完整刷新。</p><hr /><h1 id="14打包与预览生产构建"><a class="anchor" href="#14打包与预览生产构建">#</a> 14）打包与预览（生产构建）</h1><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-bash"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">npm</span><span style="color:#B56959;--shiki-dark:#C98A7D"> run</span><span style="color:#B56959;--shiki-dark:#C98A7D"> build</span></span><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">npm</span><span style="color:#B56959;--shiki-dark:#C98A7D"> run</span><span style="color:#B56959;--shiki-dark:#C98A7D"> preview</span></span></code></pre><ul><li><code>npm run build</code> 生成静态文件（dist/）。</li><li><code>npm run preview</code> 在本地起一个小服务器预览构建后的页面。</li></ul><p>部署注意：</p><ul><li><p>如果使用 <code>createWebHistory()</code>（无 <code>#</code>），服务器必须配置：当用户请求 <code>/about</code> 时返回 <code>index.html</code>（single page app fallback）。例如 Nginx：</p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-text"><span class="line"><span>location / &#123;</span></span><span class="line"><span>  try_files $uri $uri/ /index.html;</span></span><span class="line"><span>&#125;</span></span></code></pre></li><li><p>不想配置服务器可使用 <code>createWebHashHistory()</code>。</p></li></ul><hr /><h1 id="15常见进阶点"><a class="anchor" href="#15常见进阶点">#</a> 15）常见进阶点（</h1><ol><li><p><strong>懒加载路由（减小首包）</strong></p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-js"><span class="line"><span style="color:#2993a3;--shiki-dark:#5eaab5">&#123;</span><span style="color:#59873A;--shiki-dark:#80A665"> path</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">/about</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#59873A;--shiki-dark:#80A665"> component</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#1e754f;--shiki-dark:#4d9375">(</span><span style="color:#1e754f;--shiki-dark:#4d9375">)</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#999999;--shiki-dark:#666666">></span><span style="color:#AB5959;--shiki-dark:#CB7676"> import</span><span style="color:#1e754f;--shiki-dark:#4d9375">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#B56959;--shiki-dark:#C98A7D">../views/About.vue</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#1e754f;--shiki-dark:#4d9375">)</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#2993a3;--shiki-dark:#5eaab5">&#125;</span></span></code></pre><p>这样 <code>About</code> 会被拆成单独 chunk，只有访问时才加载。</p></li><li><p><strong>路由守卫（路由拦截）</strong></p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-js"><span class="line"><span style="color:#B07D48;--shiki-dark:#BD976A">router</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#59873A;--shiki-dark:#80A665">beforeEach</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#1e754f;--shiki-dark:#4d9375">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">to</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> from</span><span style="color:#1e754f;--shiki-dark:#4d9375">)</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#999999;--shiki-dark:#666666">></span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#1e754f;--shiki-dark:#4d9375">&#123;</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">  if</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#a65e2b;--shiki-dark:#d4976c">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">to</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#B07D48;--shiki-dark:#BD976A">meta</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#B07D48;--shiki-dark:#BD976A">requiresAuth</span><span style="color:#AB5959;--shiki-dark:#CB7676"> &#x26;&#x26;</span><span style="color:#AB5959;--shiki-dark:#CB7676"> !</span><span style="color:#59873A;--shiki-dark:#80A665">isLoggedIn</span><span style="color:#a13865;--shiki-dark:#d9739f">(</span><span style="color:#a13865;--shiki-dark:#d9739f">)</span><span style="color:#a65e2b;--shiki-dark:#d4976c">)</span><span style="color:#1E754F;--shiki-dark:#4D9375"> return</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#a65e2b;--shiki-dark:#d4976c">&#123;</span><span style="color:#998418;--shiki-dark:#B8A965"> name</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">Home</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#a65e2b;--shiki-dark:#d4976c">&#125;</span></span><span class="line"><span style="color:#1e754f;--shiki-dark:#4d9375">&#125;</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span></code></pre><p><code>to.meta</code> 可以在路由配置时设置 <code>meta: &#123; requiresAuth: true &#125;</code>。</p></li><li><p><strong>嵌套路由（子路由）</strong></p><ul><li>可用于 Dashboard 布局 + 子页面。</li><li>在父组件里放 <code>&lt;router-view /&gt;</code> 作为子路由的渲染位置。</li></ul></li><li><p><strong>命名视图</strong>（多个 <code>&lt;router-view name=&quot;...&quot;&gt;</code>）</p><ul><li>用于布局复杂页面（侧栏 + 主体同时切换不同组件）。</li></ul></li><li><p><strong>useRoute / useRouter</strong></p><ul><li><code>const route = useRoute()</code>：读取路由信息（params、query、meta）。</li><li><code>const router = useRouter()</code>：编程式导航（push/replace）。</li></ul></li></ol><hr />]]></content>
    
    
    <summary type="html">本文介绍vue框架路由的使用</summary>
    
    
    
    <category term="fronted" scheme="https://koen666.github.io/categories/fronted/"/>
    
    
    <category term="router" scheme="https://koen666.github.io/tags/router/"/>
    
    <category term="vue" scheme="https://koen666.github.io/tags/vue/"/>
    
  </entry>
  
  <entry>
    <title>collections</title>
    <link href="https://koen666.github.io/2025/09/15/py_collections/"/>
    <id>https://koen666.github.io/2025/09/15/py_collections/</id>
    <published>2025-09-14T16:00:00.000Z</published>
    <updated>2025-09-15T12:25:48.748Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1️⃣-导入方式"><a class="anchor" href="#1️⃣-导入方式">#</a> 1️⃣ 导入方式</h2><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-python"><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> collections</span></span></code></pre><hr><h2 id="2️⃣-常用数据结构"><a class="anchor" href="#2️⃣-常用数据结构">#</a> 2️⃣ 常用数据结构</h2><h3 id="1-counter-计数器"><a class="anchor" href="#1-counter-计数器">#</a> 1. <code>Counter</code> —— 计数器</h3><ul><li>功能：统计元素出现的次数。</li><li>类似于 <code>dict</code>，但是专门用于计数。</li></ul><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-python"><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">from</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> collections </span><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> Counter</span></span><span class="line"></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">lst </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#2993a3;--shiki-dark:#5eaab5">[</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#B56959;--shiki-dark:#C98A7D">a</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">b</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">a</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">c</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">b</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">a</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#2993a3;--shiki-dark:#5eaab5">]</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">cnt </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> Counter</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">lst</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">print</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">cnt</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#A0ADA0;--shiki-dark:#758575DD">  # Counter({'a': 3, 'b': 2, 'c': 1})</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">print</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">cnt</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">most_common</span><span style="color:#1e754f;--shiki-dark:#4d9375">(</span><span style="color:#2F798A;--shiki-dark:#4C9A91">2</span><span style="color:#1e754f;--shiki-dark:#4d9375">)</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#A0ADA0;--shiki-dark:#758575DD">  # [('a', 3), ('b', 2)]</span></span></code></pre><hr><h3 id="2-defaultdict-带默认值的字典"><a class="anchor" href="#2-defaultdict-带默认值的字典">#</a> 2. <code>defaultdict</code> —— 带默认值的字典</h3><ul><li>功能：<strong>访问不存在的 key 不会报错</strong>，会返回默认值。</li><li>构造时传入一个函数（如 <code>int</code>、<code>list</code>、<code>set</code>）作为默认值。</li></ul><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-python"><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">from</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> collections </span><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> defaultdict</span></span><span class="line"></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">d </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> defaultdict</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#998418;--shiki-dark:#B8A965">int</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#A0ADA0;--shiki-dark:#758575DD">  # 默认值是 0</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">d</span><span style="color:#2993a3;--shiki-dark:#5eaab5">[</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#B56959;--shiki-dark:#C98A7D">a</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#2993a3;--shiki-dark:#5eaab5">]</span><span style="color:#999999;--shiki-dark:#666666"> +=</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 1</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">print</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">d</span><span style="color:#1e754f;--shiki-dark:#4d9375">[</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#B56959;--shiki-dark:#C98A7D">a</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#1e754f;--shiki-dark:#4d9375">]</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#A0ADA0;--shiki-dark:#758575DD">  # 1</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">print</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">d</span><span style="color:#1e754f;--shiki-dark:#4d9375">[</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#B56959;--shiki-dark:#C98A7D">b</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#1e754f;--shiki-dark:#4d9375">]</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#A0ADA0;--shiki-dark:#758575DD">  # 0</span></span><span class="line"></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">d2 </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> defaultdict</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#998418;--shiki-dark:#B8A965">list</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">d2</span><span style="color:#2993a3;--shiki-dark:#5eaab5">[</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#B56959;--shiki-dark:#C98A7D">x</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#2993a3;--shiki-dark:#5eaab5">]</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">append</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#2F798A;--shiki-dark:#4C9A91">10</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">print</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">d2</span><span style="color:#1e754f;--shiki-dark:#4d9375">[</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#B56959;--shiki-dark:#C98A7D">x</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#1e754f;--shiki-dark:#4d9375">]</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#A0ADA0;--shiki-dark:#758575DD">  # [10]</span></span></code></pre><blockquote><p>在你之前的 <code>mask_outlier</code> 代码里：</p></blockquote><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-python"><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">index2label </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> collections</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">defaultdict</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#998418;--shiki-dark:#B8A965">int</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span></code></pre><p>就是用 <code>int</code> 作为默认值 0，统计每个标签出现的次数。</p><hr><h3 id="3-ordereddict-有序字典"><a class="anchor" href="#3-ordereddict-有序字典">#</a> 3. <code>OrderedDict</code> —— 有序字典</h3><ul><li>功能：<strong>保持 key 的插入顺序</strong>。</li><li>Python 3.7+ 的普通 dict 已经默认保持顺序，所以用途不如以前重要，但有些方法如 <code>move_to_end</code> 仍很有用。</li></ul><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-python"><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">from</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> collections </span><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> OrderedDict</span></span><span class="line"></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">od </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> OrderedDict</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">od</span><span style="color:#2993a3;--shiki-dark:#5eaab5">[</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#B56959;--shiki-dark:#C98A7D">a</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#2993a3;--shiki-dark:#5eaab5">]</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 1</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">od</span><span style="color:#2993a3;--shiki-dark:#5eaab5">[</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#B56959;--shiki-dark:#C98A7D">b</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#2993a3;--shiki-dark:#5eaab5">]</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 2</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">od</span><span style="color:#2993a3;--shiki-dark:#5eaab5">[</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#B56959;--shiki-dark:#C98A7D">c</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#2993a3;--shiki-dark:#5eaab5">]</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 3</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">print</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#998418;--shiki-dark:#B8A965">list</span><span style="color:#1e754f;--shiki-dark:#4d9375">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">od</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">keys</span><span style="color:#a65e2b;--shiki-dark:#d4976c">(</span><span style="color:#a65e2b;--shiki-dark:#d4976c">)</span><span style="color:#1e754f;--shiki-dark:#4d9375">)</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#A0ADA0;--shiki-dark:#758575DD">  # ['a', 'b', 'c']</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">od</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">move_to_end</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#B56959;--shiki-dark:#C98A7D">b</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">print</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#998418;--shiki-dark:#B8A965">list</span><span style="color:#1e754f;--shiki-dark:#4d9375">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">od</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">keys</span><span style="color:#a65e2b;--shiki-dark:#d4976c">(</span><span style="color:#a65e2b;--shiki-dark:#d4976c">)</span><span style="color:#1e754f;--shiki-dark:#4d9375">)</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#A0ADA0;--shiki-dark:#758575DD">  # ['a', 'c', 'b']</span></span></code></pre><hr><h3 id="4-deque-双端队列"><a class="anchor" href="#4-deque-双端队列">#</a> 4. <code>deque</code> —— 双端队列</h3><ul><li>功能：可以 <strong>高效地从两端插入和删除元素</strong>。</li><li>操作复杂度 O(1)，比 list 从左端插入快。</li></ul><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-python"><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">from</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> collections </span><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> deque</span></span><span class="line"></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">q </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> deque</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#1e754f;--shiki-dark:#4d9375">[</span><span style="color:#2F798A;--shiki-dark:#4C9A91">1</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 2</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 3</span><span style="color:#1e754f;--shiki-dark:#4d9375">]</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">q</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">append</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#2F798A;--shiki-dark:#4C9A91">4</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#A0ADA0;--shiki-dark:#758575DD">      # 右端添加</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">q</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">appendleft</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#2F798A;--shiki-dark:#4C9A91">0</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#A0ADA0;--shiki-dark:#758575DD">  # 左端添加</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">print</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">q</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#A0ADA0;--shiki-dark:#758575DD">         # deque([0, 1, 2, 3, 4])</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">q</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">pop</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#A0ADA0;--shiki-dark:#758575DD">          # 右端删除</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">q</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">popleft</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#A0ADA0;--shiki-dark:#758575DD">      # 左端删除</span></span></code></pre><hr><h3 id="5-namedtuple-命名元组"><a class="anchor" href="#5-namedtuple-命名元组">#</a> 5. <code>namedtuple</code> —— 命名元组</h3><ul><li>功能：<strong>给元组的每个元素命名</strong>，既可以像元组一样索引，也可以用属性名访问。</li><li>用于存储轻量对象。</li></ul><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-python"><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">from</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> collections </span><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> namedtuple</span></span><span class="line"></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">Point </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> namedtuple</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#B56959;--shiki-dark:#C98A7D">Point</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#1e754f;--shiki-dark:#4d9375">[</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#B56959;--shiki-dark:#C98A7D">x</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> '</span><span style="color:#B56959;--shiki-dark:#C98A7D">y</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">'</span><span style="color:#1e754f;--shiki-dark:#4d9375">]</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">p </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> Point</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#2F798A;--shiki-dark:#4C9A91">10</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 20</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">print</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">p</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">x</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#A0ADA0;--shiki-dark:#758575DD">  # 10</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">print</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">p</span><span style="color:#1e754f;--shiki-dark:#4d9375">[</span><span style="color:#2F798A;--shiki-dark:#4C9A91">1</span><span style="color:#1e754f;--shiki-dark:#4d9375">]</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#A0ADA0;--shiki-dark:#758575DD"> # 20</span></span></code></pre><hr><h2 id="3️⃣-小结"><a class="anchor" href="#3️⃣-小结">#</a> 3️⃣ 小结</h2><table><thead><tr><th>数据结构</th><th>特点</th><th>典型用途</th></tr></thead><tbody><tr><td>Counter</td><td>计数</td><td>元素频率统计</td></tr><tr><td>defaultdict</td><td>key 不存在返回默认值</td><td>聚合统计、累加</td></tr><tr><td>OrderedDict</td><td>保持插入顺序</td><td>需要顺序字典</td></tr><tr><td>deque</td><td>双端队列，高效两端操作</td><td>队列、滑动窗口</td></tr><tr><td>namedtuple</td><td>命名元组，访问像对象又像元组</td><td>简单对象存储</td></tr></tbody></table><hr>]]></content>
    
    
    <summary type="html">本文介绍collections库带来方便好用的数据结构</summary>
    
    
    
    <category term="python" scheme="https://koen666.github.io/categories/python/"/>
    
    
    <category term="collections" scheme="https://koen666.github.io/tags/collections/"/>
    
  </entry>
  
  <entry>
    <title>从datase到dataloader的过程究竟是什么</title>
    <link href="https://koen666.github.io/2025/09/15/%E4%BB%8Edataset%E5%88%B0dataloader/"/>
    <id>https://koen666.github.io/2025/09/15/%E4%BB%8Edataset%E5%88%B0dataloader/</id>
    <published>2025-09-14T16:00:00.000Z</published>
    <updated>2026-01-18T08:22:58.337Z</updated>
    
    <content type="html"><![CDATA[<h2 id="dataset-dataloader"><a class="anchor" href="#dataset-dataloader">#</a> <strong>dataset-&gt;dataloader</strong></h2><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-python"><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> torch</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">from</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> torch</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">utils</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">data </span><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> Dataset</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> DataLoader</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> Sampler</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> torch</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">nn </span><span style="color:#1E754F;--shiki-dark:#4D9375">as</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> nn</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> torch</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">optim </span><span style="color:#1E754F;--shiki-dark:#4D9375">as</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> optim</span></span></code></pre><p><strong>解析</strong>：</p><ul><li><code>torch</code>：PyTorch 主库，用于张量操作。</li><li><code>Dataset</code>：数据集基类。</li><li><code>DataLoader</code>：批次生成器。</li><li><code>Sampler</code>：索引生成器。</li><li><code>nn</code>：神经网络模块。</li><li><code>optim</code>：优化器。</li></ul><hr><h3 id="1️⃣-定义-dataset"><a class="anchor" href="#1️⃣-定义-dataset">#</a> <strong>1️⃣ 定义 Dataset</strong></h3><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-python"><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">class</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> MyDataset</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#59873A;--shiki-dark:#80A665">Dataset</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">    def</span><span style="color:#998418;--shiki-dark:#B8A965"> __init__</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">self</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> data</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> labels</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#A65E2B;--shiki-dark:#C99076">        self</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">data </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> data       </span><span style="color:#A0ADA0;--shiki-dark:#758575DD"># 存储特征列表</span></span><span class="line"><span style="color:#A65E2B;--shiki-dark:#C99076">        self</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">labels </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> labels   </span><span style="color:#A0ADA0;--shiki-dark:#758575DD"># 存储标签列表</span></span><span class="line"></span><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">    def</span><span style="color:#998418;--shiki-dark:#B8A965"> __len__</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">self</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">        return</span><span style="color:#998418;--shiki-dark:#B8A965"> len</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#A65E2B;--shiki-dark:#C99076">self</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">data</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#A0ADA0;--shiki-dark:#758575DD">  # 返回样本总数</span></span><span class="line"></span><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">    def</span><span style="color:#998418;--shiki-dark:#B8A965"> __getitem__</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">self</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> index</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">        x </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#A65E2B;--shiki-dark:#C99076"> self</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">data</span><span style="color:#2993a3;--shiki-dark:#5eaab5">[</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">index</span><span style="color:#2993a3;--shiki-dark:#5eaab5">]</span><span style="color:#A0ADA0;--shiki-dark:#758575DD">  # 取第 index 个特征</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">        y </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#A65E2B;--shiki-dark:#C99076"> self</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">labels</span><span style="color:#2993a3;--shiki-dark:#5eaab5">[</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">index</span><span style="color:#2993a3;--shiki-dark:#5eaab5">]</span><span style="color:#A0ADA0;--shiki-dark:#758575DD">  # 取第 index 个标签</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">        # 转为 tensor 并指定数据类型</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">        return</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> torch</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">tensor</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">x</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> dtype</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">torch</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">float32</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> torch</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">tensor</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">y</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> dtype</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">torch</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">long</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span></code></pre><p><strong>详细解析</strong>：</p><ol><li><p><code>__init__</code>：初始化 Dataset 对象，存储数据和标签。</p></li><li><p><code>__len__</code>：Dataset 的长度（样本数），DataLoader 内部会用它来计算 batch 数量。</p></li><li><p><code>__getitem__</code>：</p><ul><li><p>接收一个整数 <code>index</code>。</p></li><li><p>从列表中取数据和标签。</p></li><li><p>转为 PyTorch 张量：</p><ul><li><code>x</code> → float32，用于计算。</li><li><code>y</code> → long，用于分类任务的 CrossEntropyLoss。</li></ul></li><li><p>返回 <code>(x, y)</code> 元组。</p></li></ul></li><li><p><strong>关键点</strong>：Dataset 本身不处理 batch，也不决定顺序，它只知道如何根据索引取单个样本。</p></li></ol><hr><h3 id="2️⃣-定义-sampler"><a class="anchor" href="#2️⃣-定义-sampler">#</a> <strong>2️⃣ 定义 Sampler</strong></h3><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-python"><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">class</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> ReverseSampler</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#59873A;--shiki-dark:#80A665">Sampler</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">    def</span><span style="color:#998418;--shiki-dark:#B8A965"> __init__</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">self</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> data_source</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#A65E2B;--shiki-dark:#C99076">        self</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">data_source </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> data_source  </span><span style="color:#A0ADA0;--shiki-dark:#758575DD"># Dataset 对象</span></span><span class="line"></span><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">    def</span><span style="color:#998418;--shiki-dark:#B8A965"> __iter__</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">self</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">        # 返回索引迭代器：倒序取样</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">        return</span><span style="color:#998418;--shiki-dark:#B8A965"> iter</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#998418;--shiki-dark:#B8A965">range</span><span style="color:#1e754f;--shiki-dark:#4d9375">(</span><span style="color:#998418;--shiki-dark:#B8A965">len</span><span style="color:#a65e2b;--shiki-dark:#d4976c">(</span><span style="color:#A65E2B;--shiki-dark:#C99076">self</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">data_source</span><span style="color:#a65e2b;--shiki-dark:#d4976c">)</span><span style="color:#AB5959;--shiki-dark:#CB7676">-</span><span style="color:#2F798A;--shiki-dark:#4C9A91">1</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#AB5959;--shiki-dark:#CB7676"> -</span><span style="color:#2F798A;--shiki-dark:#4C9A91">1</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#AB5959;--shiki-dark:#CB7676"> -</span><span style="color:#2F798A;--shiki-dark:#4C9A91">1</span><span style="color:#1e754f;--shiki-dark:#4d9375">)</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"></span><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">    def</span><span style="color:#998418;--shiki-dark:#B8A965"> __len__</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">self</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">        return</span><span style="color:#998418;--shiki-dark:#B8A965"> len</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#A65E2B;--shiki-dark:#C99076">self</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">data_source</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#A0ADA0;--shiki-dark:#758575DD">  # 样本总数</span></span></code></pre><p><strong>详细解析</strong>：</p><ol><li><p><code>__iter__</code>：</p><ul><li><p>返回一个迭代器，用于生成索引序列。</p></li><li><p><code>range(len(self.data_source)-1, -1, -1)</code>：</p><ul><li>从最大索引到 0</li><li>例如数据有 5 个样本，索引顺序是 <code>[4,3,2,1,0]</code></li></ul></li></ul></li><li><p><code>__len__</code>：</p><ul><li>返回 Dataset 长度</li><li>DataLoader 内部可能用它计算 batch 总数或进度条。</li></ul></li><li><p><strong>关键点</strong>：</p><ul><li>Sampler 只负责“索引顺序”，不涉及数据本身。</li><li>可以用它实现顺序、随机或自定义采样策略。</li></ul></li></ol><hr><h3 id="3️⃣-初始化-dataset-和-sampler"><a class="anchor" href="#3️⃣-初始化-dataset-和-sampler">#</a> <strong>3️⃣ 初始化 Dataset 和 Sampler</strong></h3><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-python"><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">data </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#2993a3;--shiki-dark:#5eaab5">[</span><span style="color:#1e754f;--shiki-dark:#4d9375">[</span><span style="color:#2F798A;--shiki-dark:#4C9A91">1</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#2F798A;--shiki-dark:#4C9A91">2</span><span style="color:#1e754f;--shiki-dark:#4d9375">]</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#1e754f;--shiki-dark:#4d9375">[</span><span style="color:#2F798A;--shiki-dark:#4C9A91">3</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#2F798A;--shiki-dark:#4C9A91">4</span><span style="color:#1e754f;--shiki-dark:#4d9375">]</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#1e754f;--shiki-dark:#4d9375">[</span><span style="color:#2F798A;--shiki-dark:#4C9A91">5</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#2F798A;--shiki-dark:#4C9A91">6</span><span style="color:#1e754f;--shiki-dark:#4d9375">]</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#1e754f;--shiki-dark:#4d9375">[</span><span style="color:#2F798A;--shiki-dark:#4C9A91">7</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#2F798A;--shiki-dark:#4C9A91">8</span><span style="color:#1e754f;--shiki-dark:#4d9375">]</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#1e754f;--shiki-dark:#4d9375">[</span><span style="color:#2F798A;--shiki-dark:#4C9A91">9</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#2F798A;--shiki-dark:#4C9A91">10</span><span style="color:#1e754f;--shiki-dark:#4d9375">]</span><span style="color:#2993a3;--shiki-dark:#5eaab5">]</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">labels </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#2993a3;--shiki-dark:#5eaab5">[</span><span style="color:#2F798A;--shiki-dark:#4C9A91">0</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 1</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 0</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 1</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 0</span><span style="color:#2993a3;--shiki-dark:#5eaab5">]</span></span><span class="line"></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">dataset </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> MyDataset</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">data</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> labels</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">sampler </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> ReverseSampler</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">dataset</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span></code></pre><ul><li><p>Dataset 保存原始数据。</p></li><li><p>Sampler 定义索引顺序（倒序）。</p></li><li><p>此时数据和索引是分开的：</p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-text"><span class="line"><span>Dataset: [ [1,2], [3,4], [5,6], [7,8], [9,10] ]</span></span><span class="line"><span>Sampler: [4,3,2,1,0]</span></span></code></pre></li></ul><hr><h3 id="4️⃣-定义-dataloader"><a class="anchor" href="#4️⃣-定义-dataloader">#</a> <strong>4️⃣ 定义 DataLoader</strong></h3><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-python"><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">batch_size </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 2</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">dataloader </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> DataLoader</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">dataset</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> batch_size</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">batch_size</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> sampler</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">sampler</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span></code></pre><p><strong>详细解析</strong>：</p><ul><li><p>DataLoader 接收 Dataset 对象。</p></li><li><p><code>batch_size=2</code> → 每个 batch 2 个样本。</p></li><li><p><code>sampler=sampler</code> → 使用我们自定义的倒序索引。</p></li><li><p><strong>内部流程</strong>：</p><ol><li><p>DataLoader 调用 <code>sampler.__iter__()</code> → 得到索引迭代器 <code>[4,3,2,1,0]</code></p></li><li><p>按 <code>batch_size=2</code> 将索引分批：</p><ul><li>Batch 0 → <code>[4,3]</code></li><li>Batch 1 → <code>[2,1]</code></li><li>Batch 2 → <code>[0]</code></li></ul></li><li><p>对每个 batch 调用 <code>dataset.__getitem__</code>，获取 <code>(x, y)</code> 张量。</p></li><li><p>返回 batch 张量：</p><ul><li><code>x_batch.shape = [batch_size, feature_dim]</code></li><li><code>y_batch.shape = [batch_size]</code></li></ul></li></ol></li><li><p>DataLoader 可以多线程加载数据（通过 <code>num_workers</code>），提升效率。</p></li></ul><hr><h3 id="5️⃣-定义模型和优化器"><a class="anchor" href="#5️⃣-定义模型和优化器">#</a> <strong>5️⃣ 定义模型和优化器</strong></h3><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-python"><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">model </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> nn</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">Linear</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#2F798A;--shiki-dark:#4C9A91">2</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 2</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#A0ADA0;--shiki-dark:#758575DD">  # 输入2维，输出2类</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">criterion </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> nn</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">CrossEntropyLoss</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#A0ADA0;--shiki-dark:#758575DD">  # 分类损失</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">optimizer </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> optim</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">SGD</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">model</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">parameters</span><span style="color:#1e754f;--shiki-dark:#4d9375">(</span><span style="color:#1e754f;--shiki-dark:#4d9375">)</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> lr</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#2F798A;--shiki-dark:#4C9A91">0.01</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span></code></pre><ul><li><p><code>nn.Linear(2,2)</code>：</p><ul><li>输入 2 维特征 <code>[x1,x2]</code></li><li>输出 2 类的 logits</li></ul></li><li><p><code>CrossEntropyLoss</code>：</p><ul><li>用于分类任务</li><li>内部会自动做 softmax</li></ul></li><li><p><code>SGD</code>：</p><ul><li>随机梯度下降优化器</li><li>更新模型参数</li></ul></li></ul><hr><h3 id="6️⃣-模拟训练循环"><a class="anchor" href="#6️⃣-模拟训练循环">#</a> <strong>6️⃣ 模拟训练循环</strong></h3><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-python"><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">for</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> epoch </span><span style="color:#1E754F;--shiki-dark:#4D9375">in</span><span style="color:#998418;--shiki-dark:#B8A965"> range</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#2F798A;--shiki-dark:#4C9A91">1</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">    for</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> x_batch</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> y_batch </span><span style="color:#1E754F;--shiki-dark:#4D9375">in</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> dataloader</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">        # 前向传播</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">        outputs </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> model</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">x_batch</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#A0ADA0;--shiki-dark:#758575DD">   # [batch_size, num_classes]</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">        loss </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> criterion</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">outputs</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> y_batch</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">        # 反向传播</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">        optimizer</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">zero_grad</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">        loss</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">backward</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">        optimizer</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">step</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">        print</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">Batch x:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> x_batch</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">        print</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">Batch y:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> y_batch</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#998418;--shiki-dark:#B8A965">        print</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">Loss:</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> loss</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">item</span><span style="color:#1e754f;--shiki-dark:#4d9375">(</span><span style="color:#1e754f;--shiki-dark:#4d9375">)</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span></code></pre><p><strong>详细解析</strong>：</p><ol><li><p><code>for x_batch, y_batch in dataloader</code>：</p><ul><li>DataLoader 迭代 batch</li><li>每个 batch 是 <code>(x_batch, y_batch)</code> 张量</li></ul></li><li><p><code>outputs = model(x_batch)</code>：</p><ul><li>前向传播，输出 <code>[batch_size, num_classes]</code> 张量</li></ul></li><li><p><code>loss = criterion(outputs, y_batch)</code>：</p><ul><li>计算 loss</li></ul></li><li><p><code>optimizer.zero_grad()</code>：</p><ul><li>清空梯度，否则梯度会累加</li></ul></li><li><p><code>loss.backward()</code>：</p><ul><li>自动计算梯度</li></ul></li><li><p><code>optimizer.step()</code>：</p><ul><li>更新模型参数</li></ul></li><li><p>打印 batch 信息，观察训练数据流和 loss</p></li></ol><p><strong>示例输出</strong>（倒序 batch）：</p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-text"><span class="line"><span>Batch x: tensor([[ 9., 10.],</span></span><span class="line"><span>                 [ 7.,  8.]])</span></span><span class="line"><span>Batch y: tensor([0,1])</span></span><span class="line"><span>Loss: 0.7378</span></span><span class="line"><span>Batch x: tensor([[5.,6.],</span></span><span class="line"><span>                 [3.,4.]])</span></span><span class="line"><span>Batch y: tensor([0,1])</span></span><span class="line"><span>Loss: 0.6923</span></span><span class="line"><span>Batch x: tensor([[1.,2.]])</span></span><span class="line"><span>Batch y: tensor([0])</span></span><span class="line"><span>Loss: 0.6789</span></span></code></pre><hr><h3 id="7️⃣-数据流可视化"><a class="anchor" href="#7️⃣-数据流可视化">#</a> <strong>7️⃣ 数据流可视化</strong></h3><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-text"><span class="line"><span>原始数据</span></span><span class="line"><span>data = [[1,2],[3,4],[5,6],[7,8],[9,10]]</span></span><span class="line"><span>labels = [0,1,0,1,0]</span></span><span class="line"><span>        │</span></span><span class="line"><span>        ▼</span></span><span class="line"><span>Dataset (MyDataset)</span></span><span class="line"><span>  - __getitem__ 返回单个样本</span></span><span class="line"><span>        │</span></span><span class="line"><span>        ▼</span></span><span class="line"><span>Sampler (ReverseSampler)</span></span><span class="line"><span>  - 返回索引序列 [4,3,2,1,0]</span></span><span class="line"><span>        │</span></span><span class="line"><span>        ▼</span></span><span class="line"><span>DataLoader (batch_size=2)</span></span><span class="line"><span>  - Batch 0: idx=[4,3] → x=[[9,10],[7,8]], y=[0,1]</span></span><span class="line"><span>  - Batch 1: idx=[2,1] → x=[[5,6],[3,4]], y=[0,1]</span></span><span class="line"><span>  - Batch 2: idx=[0]   → x=[[1,2]], y=[0]</span></span><span class="line"><span>        │</span></span><span class="line"><span>        ▼</span></span><span class="line"><span>模型训练</span></span><span class="line"><span>  - 前向传播: y_pred = model(x_batch)</span></span><span class="line"><span>  - 计算 loss</span></span><span class="line"><span>  - 反向传播: loss.backward()</span></span><span class="line"><span>  - 参数更新: optimizer.step()</span></span></code></pre><p>💡 <strong>关键点</strong>：</p><ol><li>Dataset → 管理原始数据和取样方法</li><li>Sampler → 决定索引顺序</li><li>DataLoader → 按 batch 聚合数据</li><li>模型训练 → 接收 batch，计算梯度，更新参数</li></ol>]]></content>
    
    
    <summary type="html">本文介绍pytorch内从dataset到dataloader的实现,并给出一个简单线性层实例</summary>
    
    
    
    <category term="pytorch" scheme="https://koen666.github.io/categories/pytorch/"/>
    
    
    <category term="deeplearning" scheme="https://koen666.github.io/tags/deeplearning/"/>
    
    <category term="pytorch" scheme="https://koen666.github.io/tags/pytorch/"/>
    
    <category term="dataset" scheme="https://koen666.github.io/tags/dataset/"/>
    
    <category term="dataloader" scheme="https://koen666.github.io/tags/dataloader/"/>
    
  </entry>
  
  <entry>
    <title>关于模型可视化Gradio的使用</title>
    <link href="https://koen666.github.io/2025/09/08/gradio/"/>
    <id>https://koen666.github.io/2025/09/08/gradio/</id>
    <published>2025-09-07T16:00:00.000Z</published>
    <updated>2026-01-18T08:32:36.686Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-hello-world-入门示例"><a class="anchor" href="#1-hello-world-入门示例">#</a> 1. Hello World 入门示例</h2><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-python"><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> gradio </span><span style="color:#1E754F;--shiki-dark:#4D9375">as</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> gr</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># 定义一个最简单的函数</span></span><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">def</span><span style="color:#59873A;--shiki-dark:#80A665"> greet</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">name</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#998418;--shiki-dark:#B8A965"> str</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">    return</span><span style="color:#AB5959;--shiki-dark:#CB7676"> f</span><span style="color:#B56959;--shiki-dark:#C98A7D">"Hello, </span><span style="color:#2993a3;--shiki-dark:#5eaab5">{</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">name</span><span style="color:#2993a3;--shiki-dark:#5eaab5">}</span><span style="color:#B56959;--shiki-dark:#C98A7D">!"</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># 使用 Interface 快速构建应用</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">demo </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> gr</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">Interface</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span></span><span class="line"><span style="color:#B07D48;--shiki-dark:#BD976A">    fn</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">greet</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#A0ADA0;--shiki-dark:#758575DD">  # 绑定函数</span></span><span class="line"><span style="color:#B07D48;--shiki-dark:#BD976A">    inputs</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">gr</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">Textbox</span><span style="color:#1e754f;--shiki-dark:#4d9375">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">label</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">请输入名字</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#1e754f;--shiki-dark:#4d9375">)</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#A0ADA0;--shiki-dark:#758575DD">  # 输入组件：单行文本框</span></span><span class="line"><span style="color:#B07D48;--shiki-dark:#BD976A">    outputs</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">gr</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">Textbox</span><span style="color:#1e754f;--shiki-dark:#4d9375">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">label</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">问候语</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#1e754f;--shiki-dark:#4d9375">)</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#A0ADA0;--shiki-dark:#758575DD">    # 输出组件：单行文本框</span></span><span class="line"><span style="color:#B07D48;--shiki-dark:#BD976A">    title</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">Gradio Hello World</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span></span><span class="line"><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">demo</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">launch</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">share</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#1E754F;--shiki-dark:#4D9375">True</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#A0ADA0;--shiki-dark:#758575DD">  # 启动服务，并生成公网临时链接</span></span></code></pre><h3 id="组件解释"><a class="anchor" href="#组件解释">#</a> 组件解释：</h3><ul><li><strong>Textbox</strong>：输入或输出文本。支持 <code>lines</code> 参数控制多行。</li><li><strong>Interface</strong>：最基础的封装方式，适合单函数输入输出。</li></ul><hr><h2 id="2-加载-pytorch-pth-模型并结合-gradio"><a class="anchor" href="#2-加载-pytorch-pth-模型并结合-gradio">#</a> 2. 加载 PyTorch <code>.pth</code> 模型并结合 Gradio</h2><p>这里我们以 <strong>ResNet18 二分类模型（猫 vs 狗）</strong> 为例。</p><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-python"><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> torch</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> torchvision</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">transforms </span><span style="color:#1E754F;--shiki-dark:#4D9375">as</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> T</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">from</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> torchvision</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">models </span><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> resnet18</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">from</span><span style="color:#A65E2B;--shiki-dark:#C99076"> PIL</span><span style="color:#1E754F;--shiki-dark:#4D9375"> import</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> Image</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> gradio </span><span style="color:#1E754F;--shiki-dark:#4D9375">as</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> gr</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># 1. 加载模型结构</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">model </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> resnet18</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">pretrained</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#1E754F;--shiki-dark:#4D9375">False</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">model</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">fc </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> torch</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">nn</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">Linear</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">model</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">fc</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">in_features</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 2</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#A0ADA0;--shiki-dark:#758575DD">  # 修改输出层为二分类</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># 2. 加载训练好的权重（model.pth）</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">model</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">load_state_dict</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">torch</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">load</span><span style="color:#1e754f;--shiki-dark:#4d9375">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">model.pth</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> map_location</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">cpu</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#1e754f;--shiki-dark:#4d9375">)</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">model</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">eval</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#A0ADA0;--shiki-dark:#758575DD">  # 切换到推理模式</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># 3. 定义图像预处理（与训练时一致）</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">transform </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> T</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">Compose</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#1e754f;--shiki-dark:#4d9375">[</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    T</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">Resize</span><span style="color:#a65e2b;--shiki-dark:#d4976c">(</span><span style="color:#a13865;--shiki-dark:#d9739f">(</span><span style="color:#2F798A;--shiki-dark:#4C9A91">224</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 224</span><span style="color:#a13865;--shiki-dark:#d9739f">)</span><span style="color:#a65e2b;--shiki-dark:#d4976c">)</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#A0ADA0;--shiki-dark:#758575DD">  # 缩放图片</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    T</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">ToTensor</span><span style="color:#a65e2b;--shiki-dark:#d4976c">(</span><span style="color:#a65e2b;--shiki-dark:#d4976c">)</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#A0ADA0;--shiki-dark:#758575DD">          # 转 Tensor</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    T</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">Normalize</span><span style="color:#a65e2b;--shiki-dark:#d4976c">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">mean</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#a13865;--shiki-dark:#d9739f">[</span><span style="color:#2F798A;--shiki-dark:#4C9A91">0.485</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 0.456</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 0.406</span><span style="color:#a13865;--shiki-dark:#d9739f">]</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#B07D48;--shiki-dark:#BD976A">                std</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#a13865;--shiki-dark:#d9739f">[</span><span style="color:#2F798A;--shiki-dark:#4C9A91">0.229</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 0.224</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 0.225</span><span style="color:#a13865;--shiki-dark:#d9739f">]</span><span style="color:#a65e2b;--shiki-dark:#d4976c">)</span><span style="color:#A0ADA0;--shiki-dark:#758575DD">  # 标准化</span></span><span class="line"><span style="color:#1e754f;--shiki-dark:#4d9375">]</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># 4. 推理函数</span></span><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">def</span><span style="color:#59873A;--shiki-dark:#80A665"> predict</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">img</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> Image</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">Image</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    x </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> transform</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">img</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">unsqueeze</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#2F798A;--shiki-dark:#4C9A91">0</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#A0ADA0;--shiki-dark:#758575DD">  # 扩展 batch 维度 [1,3,224,224]</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">    with</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> torch</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">no_grad</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">        logits </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> model</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">x</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#A0ADA0;--shiki-dark:#758575DD">  # 前向传播</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">        probs </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> torch</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">softmax</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">logits</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> dim</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#2F798A;--shiki-dark:#4C9A91">1</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">squeeze</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">tolist</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#A0ADA0;--shiki-dark:#758575DD">  # 转换为概率</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">    return</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#2993a3;--shiki-dark:#5eaab5">{</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">cat</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> probs</span><span style="color:#1e754f;--shiki-dark:#4d9375">[</span><span style="color:#2F798A;--shiki-dark:#4C9A91">0</span><span style="color:#1e754f;--shiki-dark:#4d9375">]</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">dog</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> probs</span><span style="color:#1e754f;--shiki-dark:#4d9375">[</span><span style="color:#2F798A;--shiki-dark:#4C9A91">1</span><span style="color:#1e754f;--shiki-dark:#4d9375">]</span><span style="color:#2993a3;--shiki-dark:#5eaab5">}</span><span style="color:#A0ADA0;--shiki-dark:#758575DD">  # 输出字典</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    </span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># 5. Gradio 封装</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">demo </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> gr</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">Interface</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span></span><span class="line"><span style="color:#B07D48;--shiki-dark:#BD976A">    fn</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">predict</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#B07D48;--shiki-dark:#BD976A">    inputs</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">gr</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">Image</span><span style="color:#1e754f;--shiki-dark:#4d9375">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">type</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">pil</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> label</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">上传图片</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#1e754f;--shiki-dark:#4d9375">)</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#A0ADA0;--shiki-dark:#758575DD">  # 输入组件：图片</span></span><span class="line"><span style="color:#B07D48;--shiki-dark:#BD976A">    outputs</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">gr</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">Label</span><span style="color:#1e754f;--shiki-dark:#4d9375">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">num_top_classes</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#2F798A;--shiki-dark:#4C9A91">2</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> label</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">预测结果</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#1e754f;--shiki-dark:#4d9375">)</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#A0ADA0;--shiki-dark:#758575DD">  # 输出组件：标签（带概率条）</span></span><span class="line"><span style="color:#B07D48;--shiki-dark:#BD976A">    title</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">猫狗分类器</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span></span><span class="line"><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">demo</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">launch</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span></code></pre><h3 id="组件解释-2"><a class="anchor" href="#组件解释-2">#</a> 组件解释：</h3><ul><li><strong>Image</strong>：支持上传或摄像头输入，<code>type="pil"</code> 表示输出为 PIL Image。</li><li><strong>Label</strong>：显示分类概率，自动渲染柱状图。</li></ul><hr><h2 id="3-使用-blocks-构建多步骤界面"><a class="anchor" href="#3-使用-blocks-构建多步骤界面">#</a> 3. 使用 Blocks 构建多步骤界面</h2><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-python"><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">with</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> gr</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">Blocks</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#1E754F;--shiki-dark:#4D9375"> as</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> demo</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">    with</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> gr</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">Row</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#A0ADA0;--shiki-dark:#758575DD">  # 横向布局</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">        img </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> gr</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">Image</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">type</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">pil</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> label</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">上传图片</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">        btn </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> gr</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">Button</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">开始分类</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#A0ADA0;--shiki-dark:#758575DD">  # 按钮</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    out </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> gr</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">Label</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">num_top_classes</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#2F798A;--shiki-dark:#4C9A91">2</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> label</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">预测结果</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">    # 点击按钮时执行预测</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    btn</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">click</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">fn</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">predict</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> inputs</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">img</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> outputs</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">out</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">demo</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">launch</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span></code></pre><h3 id="组件解释-3"><a class="anchor" href="#组件解释-3">#</a> 组件解释：</h3><ul><li><strong>Blocks</strong>：更灵活的 UI 构建方式。</li><li><strong>Row / Column</strong>：布局容器。</li><li><strong>Button</strong>：可绑定点击事件。</li></ul><hr><h2 id="4-扩展功能显示-top-k-原图"><a class="anchor" href="#4-扩展功能显示-top-k-原图">#</a> 4. 扩展功能：显示 Top-K + 原图</h2><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-python"><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">def</span><span style="color:#59873A;--shiki-dark:#80A665"> predict_with_img</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">img</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> Image</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">Image</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    x </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> transform</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">img</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">unsqueeze</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#2F798A;--shiki-dark:#4C9A91">0</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">    with</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> torch</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">no_grad</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">        logits </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> model</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">x</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">        probs </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> torch</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">softmax</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">logits</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> dim</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#2F798A;--shiki-dark:#4C9A91">1</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">squeeze</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    classes </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#2993a3;--shiki-dark:#5eaab5">[</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">cat</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">dog</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#2993a3;--shiki-dark:#5eaab5">]</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    result </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#2993a3;--shiki-dark:#5eaab5">{</span><span style="color:#A65E2B;--shiki-dark:#C99076">cls</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#998418;--shiki-dark:#B8A965"> float</span><span style="color:#1e754f;--shiki-dark:#4d9375">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">probs</span><span style="color:#a65e2b;--shiki-dark:#d4976c">[</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">i</span><span style="color:#a65e2b;--shiki-dark:#d4976c">]</span><span style="color:#1e754f;--shiki-dark:#4d9375">)</span><span style="color:#1E754F;--shiki-dark:#4D9375"> for</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> i</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#A65E2B;--shiki-dark:#C99076"> cls</span><span style="color:#1E754F;--shiki-dark:#4D9375"> in</span><span style="color:#998418;--shiki-dark:#B8A965"> enumerate</span><span style="color:#1e754f;--shiki-dark:#4d9375">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">classes</span><span style="color:#1e754f;--shiki-dark:#4d9375">)</span><span style="color:#2993a3;--shiki-dark:#5eaab5">}</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">    return</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> result</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> img  </span><span style="color:#A0ADA0;--shiki-dark:#758575DD"># 返回两个结果</span></span><span class="line"></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">with</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> gr</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">Blocks</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#1E754F;--shiki-dark:#4D9375"> as</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> demo</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">    with</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> gr</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">Row</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">        img </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> gr</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">Image</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">type</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">pil</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> label</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">上传图片</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">        btn </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> gr</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">Button</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">开始分类</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">    with</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> gr</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">Row</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">        out_probs </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> gr</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">Label</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">num_top_classes</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#2F798A;--shiki-dark:#4C9A91">2</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> label</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">预测概率</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">        out_img </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> gr</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">Image</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">label</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">原始图片</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    btn</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">click</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">fn</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">predict_with_img</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> inputs</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">img</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> outputs</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#1e754f;--shiki-dark:#4d9375">[</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">out_probs</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> out_img</span><span style="color:#1e754f;--shiki-dark:#4d9375">]</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">demo</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">launch</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span></code></pre><h3 id="解释"><a class="anchor" href="#解释">#</a> 解释：</h3><ul><li>Gradio 函数可以返回多个输出 → 绑定到多个组件。</li><li><code>Label</code> 用来显示概率条，<code>Image</code> 再显示原图，增强可解释性。</li></ul><hr><h2 id="5-常用组件一览"><a class="anchor" href="#5-常用组件一览">#</a> 5. 常用组件一览</h2><ul><li><strong>Textbox</strong>：输入文本</li><li><strong>Image</strong>：上传或拍照输入图像</li><li><strong>Label</strong>：展示分类结果与概率</li><li><strong>Button</strong>：触发事件</li><li><strong>Chatbot</strong>：用于构建对话界面（常见于 LLM Demo）</li><li><strong>File</strong>：上传或下载文件</li><li><strong>Slider / Dropdown / Checkbox</strong>：用于选择参数</li></ul><hr><h2 id="6-队列与并发控制"><a class="anchor" href="#6-队列与并发控制">#</a> 6. 队列与并发控制</h2><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-python"><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">demo</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">queue</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">concurrency_count</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#2F798A;--shiki-dark:#4C9A91">2</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">launch</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span></code></pre><ul><li><strong>queue()</strong>：开启请求队列，避免推理时间过长导致前端超时。</li><li><strong>concurrency_count</strong>：同时处理的请求数。</li></ul><hr><h2 id="7-自定义样式-鉴权-安全性"><a class="anchor" href="#7-自定义样式-鉴权-安全性">#</a> 7. 自定义样式 / 鉴权 / 安全性</h2><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-python"><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">with</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> gr</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">Blocks</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">css</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">body {background-color: #f0f8ff;}</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#1E754F;--shiki-dark:#4D9375"> as</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> demo</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    img </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> gr</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">Image</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">type</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">pil</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    out </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> gr</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">Label</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    img</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">change</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">predict</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> inputs</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">img</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> outputs</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">out</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">demo</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">launch</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">auth</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#1e754f;--shiki-dark:#4d9375">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">admin</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">1234</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#1e754f;--shiki-dark:#4d9375">)</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> allowed_paths</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#1e754f;--shiki-dark:#4d9375">[</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">/safe_dir</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#1e754f;--shiki-dark:#4d9375">]</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span></code></pre><ul><li><strong>css=</strong>：注入自定义 CSS。</li><li><strong>auth=</strong>：开启简单的用户名/密码鉴权。</li><li><strong>allowed_paths=</strong>：限制访问目录，避免文件泄露。</li></ul><hr><h2 id="8-最终完整应用整合版"><a class="anchor" href="#8-最终完整应用整合版">#</a> 8. 最终完整应用（整合版）</h2><pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-python"><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> gradio </span><span style="color:#1E754F;--shiki-dark:#4D9375">as</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> gr</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> torch</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> torchvision</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">transforms </span><span style="color:#1E754F;--shiki-dark:#4D9375">as</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> T</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">from</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> torchvision</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">models </span><span style="color:#1E754F;--shiki-dark:#4D9375">import</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> resnet18</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">from</span><span style="color:#A65E2B;--shiki-dark:#C99076"> PIL</span><span style="color:#1E754F;--shiki-dark:#4D9375"> import</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> Image</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># 模型加载</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">model </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> resnet18</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">pretrained</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#1E754F;--shiki-dark:#4D9375">False</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">model</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">fc </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> torch</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">nn</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">Linear</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">model</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">fc</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">in_features</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 2</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">model</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">load_state_dict</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">torch</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">load</span><span style="color:#1e754f;--shiki-dark:#4d9375">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">model.pth</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> map_location</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">cpu</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#1e754f;--shiki-dark:#4d9375">)</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">model</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">eval</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># 预处理</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">transform </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> T</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">Compose</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#1e754f;--shiki-dark:#4d9375">[</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    T</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">Resize</span><span style="color:#a65e2b;--shiki-dark:#d4976c">(</span><span style="color:#a13865;--shiki-dark:#d9739f">(</span><span style="color:#2F798A;--shiki-dark:#4C9A91">224</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 224</span><span style="color:#a13865;--shiki-dark:#d9739f">)</span><span style="color:#a65e2b;--shiki-dark:#d4976c">)</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    T</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">ToTensor</span><span style="color:#a65e2b;--shiki-dark:#d4976c">(</span><span style="color:#a65e2b;--shiki-dark:#d4976c">)</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    T</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">Normalize</span><span style="color:#a65e2b;--shiki-dark:#d4976c">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">mean</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#a13865;--shiki-dark:#d9739f">[</span><span style="color:#2F798A;--shiki-dark:#4C9A91">0.485</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 0.456</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 0.406</span><span style="color:#a13865;--shiki-dark:#d9739f">]</span><span style="color:#999999;--shiki-dark:#666666">,</span></span><span class="line"><span style="color:#B07D48;--shiki-dark:#BD976A">                std</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#a13865;--shiki-dark:#d9739f">[</span><span style="color:#2F798A;--shiki-dark:#4C9A91">0.229</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 0.224</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 0.225</span><span style="color:#a13865;--shiki-dark:#d9739f">]</span><span style="color:#a65e2b;--shiki-dark:#d4976c">)</span></span><span class="line"><span style="color:#1e754f;--shiki-dark:#4d9375">]</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># 推理函数</span></span><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">def</span><span style="color:#59873A;--shiki-dark:#80A665"> predict</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">img</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> Image</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">Image</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    x </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> transform</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">img</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">unsqueeze</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#2F798A;--shiki-dark:#4C9A91">0</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">    with</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> torch</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">no_grad</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">        logits </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> model</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">x</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">        probs </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> torch</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">softmax</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">logits</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> dim</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#2F798A;--shiki-dark:#4C9A91">1</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">squeeze</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    classes </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#2993a3;--shiki-dark:#5eaab5">[</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">cat</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">dog</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#2993a3;--shiki-dark:#5eaab5">]</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">    return</span><span style="color:#999999;--shiki-dark:#666666"> </span><span style="color:#2993a3;--shiki-dark:#5eaab5">{</span><span style="color:#A65E2B;--shiki-dark:#C99076">cls</span><span style="color:#999999;--shiki-dark:#666666">:</span><span style="color:#998418;--shiki-dark:#B8A965"> float</span><span style="color:#1e754f;--shiki-dark:#4d9375">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">probs</span><span style="color:#a65e2b;--shiki-dark:#d4976c">[</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">i</span><span style="color:#a65e2b;--shiki-dark:#d4976c">]</span><span style="color:#1e754f;--shiki-dark:#4d9375">)</span><span style="color:#1E754F;--shiki-dark:#4D9375"> for</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> i</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#A65E2B;--shiki-dark:#C99076"> cls</span><span style="color:#1E754F;--shiki-dark:#4D9375"> in</span><span style="color:#998418;--shiki-dark:#B8A965"> enumerate</span><span style="color:#1e754f;--shiki-dark:#4d9375">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">classes</span><span style="color:#1e754f;--shiki-dark:#4d9375">)</span><span style="color:#2993a3;--shiki-dark:#5eaab5">}</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># 构建应用</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">with</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> gr</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">Blocks</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">css</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">body {font-family: Arial; background:#fafafa;}</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#1E754F;--shiki-dark:#4D9375"> as</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> demo</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">    with</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> gr</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">Row</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">        img </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> gr</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">Image</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">type</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">pil</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> label</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">上传图片</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">        btn </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> gr</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">Button</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">开始分类</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">    with</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> gr</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">Row</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#999999;--shiki-dark:#666666">:</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">        out </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> gr</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">Label</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">num_top_classes</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#2F798A;--shiki-dark:#4C9A91">2</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> label</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">预测结果</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">    btn</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">click</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">predict</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> inputs</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">img</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> outputs</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">out</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span><span class="line"></span><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD"># 开启队列 + 鉴权</span></span><span class="line"><span style="color:#393A34;--shiki-dark:#DBD7CAEE">demo</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">queue</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">concurrency_count</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#2F798A;--shiki-dark:#4C9A91">2</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span><span style="color:#999999;--shiki-dark:#666666">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">launch</span><span style="color:#2993a3;--shiki-dark:#5eaab5">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">auth</span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#1e754f;--shiki-dark:#4d9375">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">user</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">pass</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#1e754f;--shiki-dark:#4d9375">)</span><span style="color:#2993a3;--shiki-dark:#5eaab5">)</span></span></code></pre><hr>]]></content>
    
    
    <summary type="html">本文旨在介绍如何对Pytorch和Tensorflow模型实现可视化操作</summary>
    
    
    
    <category term="fronted" scheme="https://koen666.github.io/categories/fronted/"/>
    
    
    <category term="python" scheme="https://koen666.github.io/tags/python/"/>
    
    <category term="web" scheme="https://koen666.github.io/tags/web/"/>
    
    <category term="gradio" scheme="https://koen666.github.io/tags/gradio/"/>
    
  </entry>
  
</feed>
